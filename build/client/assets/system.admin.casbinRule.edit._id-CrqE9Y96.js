import{j as r}from"./jsx-runtime-C-_spy54.js";import{t as j}from"./form-CvgtEUdj.js";import{a as g,P as y}from"./index-Cr0IeYe7.js";import{C as h,F as m}from"./field-C2fXiMPB.js";import{r as E}from"./index-aGVi9Z7h.js";import{P as C}from"./500-Bi-8cWwO.js";import{D as d}from"./delete-Bb7Ih5Bg.js";import{C as F}from"./combobox-Cboc2YBq.js";import{F as R}from"./form-CgbINn9k.js";import{S as u}from"./select-CQU4yFvS.js";import{S}from"./select-multi-xQoT5VS_.js";import{I}from"./input-3H16G6Wh.js";import{a as A,E as O}from"./action-DSYjqVEc.js";import{E as P}from"./resource-BEg55So-.js";import{E as T}from"./roles-DiwHkXNk.js";import{g as w,d as N}from"./get-changed-values-vLde9APN.js";import{g as U}from"./form-BJoh7EuQ.js";import{g as V}from"./get-default-title-CrVGbO9H.js";import{z as l}from"./index-Cb7h-Ku-.js";import{u as q}from"./components-BZV9jaWy.js";const z=l.object({ptype:l.string(),v0:l.string().min(2),v1:l.string(),v2:l.string(),v3:l.string().optional().nullable()}),me=({matches:e})=>[{title:V(e)}],ie={uiTools:e=>r.jsx(B,{match:e})};function pe(){const{initialData:e}=q();return r.jsx(K,{initialData:e})}function B({match:e}){const{data:i}=e||{},{initialData:s}=i||{};return r.jsx("div",{className:"flex items-center gap-1 text-sm",children:r.jsx(d,{disabled:(s==null?void 0:s.v0)===T.administrator,variant:"ghost",size:"icon",className:"text-destructive!"})})}function ue(){return r.jsx(C,{})}const L=e=>({ptype:(e==null?void 0:e.ptype)||"p",v0:(e==null?void 0:e.v0)||"",v1:(e==null?void 0:e.v1)||"",v2:(e==null?void 0:e.v2)||"",v3:(e==null?void 0:e.v3)||""}),K=({className:e,redirect:i=O.list,initialData:s,action:c})=>{const{formAction:f,id:a=s==null?void 0:s.id,identifier:v}=g({action:c}),b=y({resource:P.role,pagination:{mode:"off"}}).options.map(o=>({label:o.label,value:o.label})),p=L(s),n=h({resolver:j(z),defaultValues:p,warnWhenUnsavedChanges:!0,mode:"onChange",refineCoreProps:{resource:v,action:f,id:a,queryOptions:U(p),redirect:i}}),x=E.useCallback(o=>{const t=w(o,p);return N(t)},[]);return r.jsxs(R,{...n,beforeSubmit:x,className:e,recordItemId:s==null?void 0:s.id,children:[r.jsx(m,{...n,name:"ptype",label:"Policy Type",children:r.jsx(u,{options:[{label:"policy",value:"p"},{label:"role",value:"g"}]})}),r.jsx(m,{...n,name:"v0",label:"Subject、Role",children:r.jsx(F,{options:b})}),r.jsx(m,{...n,name:"v1",label:"Object、User",children:r.jsx(I,{placeholder:"*、post、post/*"})}),r.jsx(m,{...n,name:"v2",label:"Action",children:r.jsx(S,{options:A.map(o=>({label:o,value:o})),valueFormatInput:o=>Array.isArray(o)?o:o.split("|").filter(t=>t).map(t=>({label:t,value:t})),valueFormatOutput:o=>typeof o=="string"?o:o.map(t=>t.value).join("|")})}),r.jsx(m,{...n,name:"v3",label:"Effect",children:r.jsx(u,{options:[{label:"allow",value:"allow"},{label:"deny",value:"deny"}]})})]})};export{K as C,ue as E,pe as a,ie as h,me as m};
