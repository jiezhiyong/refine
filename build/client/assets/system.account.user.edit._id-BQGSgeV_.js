import{j as o}from"./jsx-runtime-C-_spy54.js";import{t as F}from"./form-C6QjBNoK.js";import{a as I}from"./index-hdkCHUwo.js";import{C as y,F as p}from"./field-83Oe2ZIn.js";import{r as O}from"./index-aGVi9Z7h.js";import{z as t}from"./index-Cb7h-Ku-.js";import{P as T}from"./500-CUoB5SEY.js";import{D as C}from"./delete-BZA95DwZ.js";import{F as N}from"./form-C6Kqb6cn.js";import{S as _}from"./select-multi-DdTJIlWD.js";import{I as x}from"./input-CqjlsziW.js";import{E as w}from"./action-DSYjqVEc.js";import{A as R,b as S}from"./log-Dv4uGBGl.js";import{E as L,r as h}from"./roles-Bk5ifpzU.js";import{g as M}from"./form-BJoh7EuQ.js";import{g as P}from"./get-default-title-CrVGbO9H.js";import{u as q,c as z}from"./components-CzmxjdGq.js";import"./button-hXZAo1l1.js";import"./label-CQrdb056.js";import"./index-BivEtBZR.js";import"./tslib.es6-DDzNqjJ8.js";import"./index-DN0hhrBY.js";import"./index--6MpHGvz.js";import"./i18next-BaiEmIpz.js";import"./alert-dialog-CMOSIC-o.js";import"./index-BTG9THwZ.js";import"./index-BBe4U18k.js";import"./index-D6J7U5p3.js";import"./index-oFZnn4P-.js";import"./index-j_Y29uav.js";import"./x-DSx3Oiao.js";import"./check-DuC-6lq_.js";import"./trash-2-PoNELgpf.js";import"./dayjs.min-CHrC0Ux9.js";import"./create-D7Ur1QKT.js";import"./circle-plus-e3zLOx1g.js";import"./check-check-BALC1p_C.js";import"./card-cVzU8pnd.js";import"./undo-2-BTw56Gmb.js";import"./command-UrgpALSp.js";import"./search-P2vsbpZb.js";import"./badge-D4AhLx1S.js";import"./popover-BoK46nO7.js";import"./index-BkIYOchD.js";import"./biceps-flexed-D3S_LjaW.js";import"./audio-lines-CrG3NiE5.js";import"./baby-BsEDlitB.js";import"./resources-nPXTaVLM.js";import"./capitalize-first-letter-B7Vzw64t.js";const B=t.object({name:t.string().min(1,"用户名不能为空"),email:t.string().email("请输入有效的邮箱地址"),avatar:t.string().optional().nullable()}),Br=({matches:r})=>[{title:P(r)}],Gr={uiTools:r=>o.jsx(G,{match:r})};function Wr(){const{initialData:r,rolesData:s}=q();return o.jsx(V,{initialData:r,rolesData:s})}function G({match:r}){const{data:s}=r||{},{initialData:c}=s||{},{data:m}=c||{};return o.jsx("div",{className:"flex items-center gap-1 text-sm",children:o.jsx(C,{disabled:m==null?void 0:m.roles.some(u=>u.label===L.administrator),variant:"ghost",size:"icon",className:"text-destructive!"})})}function Qr(){return o.jsx(T,{})}const W=r=>({avatar:r==null?void 0:r.avatar,name:(r==null?void 0:r.name)||"",email:(r==null?void 0:r.email)||"",roles:(r==null?void 0:r.roles)||[]}),Q=B.extend({roles:t.array(t.object({label:t.string(),value:t.string()}))}),V=({className:r,redirect:s=w.list,initialData:c,rolesData:m,action:u})=>{const{data:e}=c||{},{formAction:b,id:g=e==null?void 0:e.id,identifier:v}=I({action:u}),{data:j}=m||{},D=z(),d=W(e),n=y({resolver:F(Q),defaultValues:d,warnWhenUnsavedChanges:!0,mode:"onChange",refineCoreProps:{resource:v,action:b,id:g,queryOptions:M(d),redirect:s}}),E=async i=>{const{roles:l,...A}=i,f=new FormData;return f.append("userId",e.id),f.append("roleIds",l.map(a=>a.value).join(",")),await D.submit(f,{method:"post"}),{...A,[R]:{permissions:e.roles.map(a=>a.label).join(", ")},[S]:{permissions:l.map(a=>a.label).join(", ")}}},U=O.useMemo(()=>j.sort((i,l)=>h[i.title]-h[l.title]).map(i=>({label:i.title,value:i.id})),[j]);return o.jsxs(N,{...n,beforeSubmit:E,className:r,recordItemId:e==null?void 0:e.id,children:[o.jsx(p,{...n,name:"name",label:"Name",children:o.jsx(x,{placeholder:"Name"})}),o.jsx(p,{...n,name:"email",label:"Email",children:o.jsx(x,{placeholder:"Email"})}),o.jsx(p,{...n,name:"avatar",label:"Avatar",children:o.jsx(x,{placeholder:"Avatar"})}),o.jsx(p,{...n,name:"roles",label:"Roles",children:o.jsx(_,{options:U})})]})};export{Qr as ErrorBoundary,Wr as default,Gr as handle,Br as meta};
