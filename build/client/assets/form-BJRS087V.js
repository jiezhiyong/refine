import{j as e}from"./jsx-runtime-C-_spy54.js";import{z as w,t as k,k as N,c as B,M as E}from"./index-hdkCHUwo.js";import{t as D}from"./i18next-BaiEmIpz.js";import{r as L}from"./index-aGVi9Z7h.js";import{d as p}from"./dayjs.min-CHrC0Ux9.js";import{c as j,B as b}from"./button-8zOaFnqZ.js";import{C as A}from"./create-BR9gIq3J.js";import{m as H,r as M}from"./lucide-icons-Cs_6wGxK.js";import{C as R,a as _,e as z}from"./card-BavCCNFE.js";import{a as I}from"./form-EOytp2cR.js";import{E as v}from"./action-DSYjqVEc.js";const K=({status:t,elements:{success:s=e.jsx(l,{translationKey:"autoSave.success",defaultMessage:"saved"}),error:r=e.jsx(l,{translationKey:"autoSave.error",defaultMessage:"auto save failed"}),loading:o=e.jsx(l,{translationKey:"autoSave.loading",defaultMessage:"saving ..."}),idle:i=e.jsx(l,{translationKey:"autoSave.idle",defaultMessage:"waiting for changes ..."})}={}})=>{switch(t){case"success":return e.jsx(e.Fragment,{children:s});case"error":return e.jsx(e.Fragment,{children:r});case"loading":return e.jsx(e.Fragment,{children:o});default:return e.jsx(e.Fragment,{children:i})}},l=({translationKey:t,defaultMessage:s})=>{const r=w();return e.jsxs("span",{className:j("text-muted-foreground text-sm",{"text-destructive":t==="autoSave.error","text-green-500":t==="autoSave.success"}),children:[r(t,s),t==="autoSave.success"&&` - ${p().format("HH:mm:ss")}`]})},y=({hideText:t=!1,children:s,accessControl:r,access:o,resource:i,recordItemId:n,disabled:m,...f})=>{const{label:x}=k(),{data:a}=N({resource:i,action:"edit",params:{id:n}}),c=!(a!=null&&a.can)||m;return e.jsx(b,{icon:e.jsx(H,{}),disabled:c,...f,children:!t&&(s??x)})};y.displayName="SaveButton";const ee=({autoSave:t,beforeSubmit:s,formProps:r,isWatchable:o,saveButtonProps:i,formModalClose:n,recordItemId:m,className:f,classNameCardContent:x,...a})=>{const c=L.useRef(!1),{resource:P,action:h}=B(),S=E(),C=h!==v.list||typeof h<"u"?S:void 0;o&&!c.current&&(c.current=!0,a.watch());const F=a.handleSubmit(async T=>{var u;let d=a.getValues();if(s)try{d=await s(d)}catch{return}d!==null?await a.refineCore.onFinish(d):((u=a.refineCore)==null?void 0:u.redirect).call(u),n==null||n()}),{disabled:g}=i||{};return e.jsx(I,{...a,children:e.jsx("form",{...r,onSubmit:F,children:e.jsxs(R,{className:j("space-y-8 border-none p-8 shadow-none",f),children:[e.jsx(_,{className:j("space-y-4 p-0",x),children:a.children}),e.jsxs(z,{className:"flex gap-x-2 p-0",children:[h===v.edit?e.jsx(y,{type:"submit",recordItemId:m,loading:a.refineCore.formLoading,disabled:g||!a.formState.isDirty}):e.jsx(A,{type:"submit",loading:a.refineCore.formLoading,disabled:g||!a.formState.isDirty}),!a.hideCancel&&e.jsx(b,{icon:e.jsx(M,{}),type:"button",onClick:n||C,disabled:a.refineCore.formLoading,variant:"outline",children:D("buttons.cancel")}),t&&e.jsx("div",{className:"ml-auto",children:e.jsx(K,{...a.refineCore.autoSaveProps})})]})]})})})};export{ee as F};
