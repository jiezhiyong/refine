import{j as Y}from"./jsx-runtime-C-_spy54.js";import{$ as st,a0 as rr,K as ir,z as cn,B as or,F as sr,f as ar,a1 as ur,G as cr,j as lr,X as fr,h as dr,a2 as hr,a3 as pr}from"./index-Cif3Vfib.js";import{r as ye,R as Se,c as gr,g as ln}from"./index-aGVi9Z7h.js";import{f as Ot,v as mr,u as Rt,P as yr,Q as vr,b as Cr,i as Or,a as Rr,O as Sr}from"./index-Cj7hasNJ.js";import{t as Ar,v as br,_ as Er,L as Tr,u as fn,M as wr,w as Ir,S as Pr}from"./components-BXAOArSq.js";import{l as ue,R as xr,b as Bt,a as Mr}from"./index-jd4myY9j.js";import{N as Dr}from"./404-Bh48QEIQ.js";import{P as Vt}from"./500-C3XOm4pH.js";import{t as dn,c as hn,i as Ye,u as _r,a as pn}from"./i18next-BaiEmIpz.js";import{a as gn}from"./resources-nPXTaVLM.js";import{H as Lr,L as Nr}from"./loader-BkIAgoYr.js";import{L as Br}from"./list-BkTrzMDE.js";import{C as Ur}from"./circle-plus-BJr9FRB3.js";import{E as kr}from"./eye-B4mWZ-xV.js";import{P as jr}from"./pencil-D_X_NzJl.js";import{T as Hr}from"./trash-2-BY4sV4mk.js";import{B as Gr,t as Ve}from"./index-DJzNQfCY.js";import{c as Fr}from"./button-fwOzNkKg.js";import{E as De}from"./action-DSYjqVEc.js";import{a as he}from"./base-url-B9uMRsbQ.js";import{v as Vr,e as Ze}from"./axios-EFBqHVWI.js";import{B as Wr,T as mn,U as zr}from"./performance-UIr2tu2K.js";import{E as at}from"./resource-BEg55So-.js";import{e as qr,Z as le,a as Wt,z as Kr}from"./index-Cb7h-Ku-.js";import{i as $r}from"./node-_8Bt17R8.js";import"./index-rNzEV3Eb.js";import"./index-BR3_WpCG.js";import"./tslib.es6-DDzNqjJ8.js";import"./tiny-invariant-CopsF_GD.js";/**
 * @remix-run/react v2.15.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */let zt="positions";function Jr({getKey:r,...t}){let{isSpaMode:n}=Ar(),e=Ot(),o=mr();br({getKey:r,storageKey:zt});let f=ye.useMemo(()=>{if(!r)return null;let O=r(e,o);return O!==e.key?O:null},[]);if(n)return null;let s=((O,C)=>{if(!window.history.state||!window.history.state.key){let T=Math.random().toString(32).slice(2);window.history.replaceState({key:T},"")}try{let x=JSON.parse(sessionStorage.getItem(O)||"{}")[C||window.history.state.key];typeof x=="number"&&window.scrollTo(0,x)}catch(T){console.error(T),sessionStorage.removeItem(O)}}).toString();return ye.createElement("script",Er({},t,{suppressHydrationWarning:!0,dangerouslySetInnerHTML:{__html:`(${s})(${JSON.stringify(zt)}, ${JSON.stringify(f)})`}}))}function Qr(r){return r!=null&&typeof r.status=="number"&&typeof r.statusText=="string"&&typeof r.headers=="object"&&typeof r.body<"u"}function Xr(r){if(!(Qr(r)||$r()||!(r instanceof Error)))return Wr(r,{mechanism:{type:"instrument",handled:!1,data:{function:"ReactError"}}})}var Yr=(r,t)=>{let n={},e=t.replace(/^\/|\/$/g,""),o=r.replace(/^\/|\/$/g,""),f=e.split("/"),s=o.split("/");return f.forEach((O,C)=>{var T;O.startsWith(":")&&((T=s[C])==null?void 0:T.length)>0&&(n[O.replace(":","")]=s[C])}),n},qt=r=>{if(typeof r>"u")return r;let t=Number(r);return`${t}`===r?t:r},Zr={addQueryPrefix:!0,skipNulls:!0,arrayFormat:"indices",encode:!1,encodeValuesOnly:!0},ei={go:()=>{let{search:r,hash:t}=Ot(),n=Rt();return ye.useCallback(({to:e,type:o,query:f,hash:s,options:{keepQuery:O,keepHash:C}={}})=>{let T={...O&&r&&st.parse(r,{ignoreQueryPrefix:!0}),...f};T.to&&(T.to=encodeURIComponent(`${T.to}`));let x=Object.keys(T).length>0,M=`#${(s||C&&t||"").replace(/^#/,"")}`,R=M.length>1,b=`${e||""}${x?st.stringify(T,Zr):""}${R?M:""}`;return o==="path"?b:n(b,{replace:o==="replace"})},[t,r,n])},back:()=>{let r=Rt();return()=>{r(-1)}},parse:()=>{let r=yr(),{pathname:t,search:n}=Ot(),{resources:e}=ye.useContext(rr),{resource:o,action:f,matchedRoute:s}=Se.useMemo(()=>ir(t,e),[e,t]),O=s&&t?Yr(t,s):{},C=O.id;return ye.useCallback(()=>{let T=st.parse(n,{ignoreQueryPrefix:!0}),x={...O,...r,...T};return{...o&&{resource:o},...f&&{action:f},...C&&{id:decodeURIComponent(C)},...(r==null?void 0:r.id)&&{id:decodeURIComponent(r.id)},pathname:t,params:{...x,current:qt(x.current),pageSize:qt(x.pageSize),to:x.to?decodeURIComponent(x.to):void 0}}},[t,n,r,o,f,O,C])},Link:Se.forwardRef(function(r,t){return Se.createElement(Tr,{...r,ref:t})})},ti=({translationKey:r="warnWhenUnsavedChanges",message:t="Are you sure you want to leave? You have unsaved changes."})=>{let n=cn(),{warnWhen:e,setWarnWhen:o}=or(),f=Se.useMemo(()=>n(r,t),[r,t,n]),s=Se.useCallback(C=>(C.preventDefault(),C.returnValue=f,C.returnValue),[f]);Se.useEffect(()=>(e&&window.addEventListener("beforeunload",s),window.removeEventListener("beforeunload",s)),[e,s]);let O=Se.useCallback(()=>e?window.confirm(f)?(o==null||o(!1),!1):!0:!1,[e,f,o]);return vr(O),null},yn={exports:{}};/* NProgress, (c) 2013, 2014 Rico Sta. Cruz - http://ricostacruz.com/nprogress
 * @license MIT */(function(r,t){(function(n,e){r.exports=e()})(gr,function(){var n={};n.version="0.2.0";var e=n.settings={minimum:.08,easing:"ease",positionUsing:"",speed:200,trickle:!0,trickleRate:.02,trickleSpeed:800,showSpinner:!0,barSelector:'[role="bar"]',spinnerSelector:'[role="spinner"]',parent:"body",template:'<div class="bar" role="bar"><div class="peg"></div></div><div class="spinner" role="spinner"><div class="spinner-icon"></div></div>'};n.configure=function(a){var m,S;for(m in a)S=a[m],S!==void 0&&a.hasOwnProperty(m)&&(e[m]=S);return this},n.status=null,n.set=function(a){var m=n.isStarted();a=o(a,e.minimum,1),n.status=a===1?null:a;var S=n.render(!m),A=S.querySelector(e.barSelector),y=e.speed,p=e.easing;return S.offsetWidth,O(function(v){e.positionUsing===""&&(e.positionUsing=n.getPositioningCSS()),C(A,s(a,y,p)),a===1?(C(S,{transition:"none",opacity:1}),S.offsetWidth,setTimeout(function(){C(S,{transition:"all "+y+"ms linear",opacity:0}),setTimeout(function(){n.remove(),v()},y)},y)):setTimeout(v,y)}),this},n.isStarted=function(){return typeof n.status=="number"},n.start=function(){n.status||n.set(0);var a=function(){setTimeout(function(){n.status&&(n.trickle(),a())},e.trickleSpeed)};return e.trickle&&a(),this},n.done=function(a){return!a&&!n.status?this:n.inc(.3+.5*Math.random()).set(1)},n.inc=function(a){var m=n.status;return m?(typeof a!="number"&&(a=(1-m)*o(Math.random()*m,.1,.95)),m=o(m+a,0,.994),n.set(m)):n.start()},n.trickle=function(){return n.inc(Math.random()*e.trickleRate)},function(){var a=0,m=0;n.promise=function(S){return!S||S.state()==="resolved"?this:(m===0&&n.start(),a++,m++,S.always(function(){m--,m===0?(a=0,n.done()):n.set((a-m)/a)}),this)}}(),n.render=function(a){if(n.isRendered())return document.getElementById("nprogress");x(document.documentElement,"nprogress-busy");var m=document.createElement("div");m.id="nprogress",m.innerHTML=e.template;var S=m.querySelector(e.barSelector),A=a?"-100":f(n.status||0),y=document.querySelector(e.parent),p;return C(S,{transition:"all 0 linear",transform:"translate3d("+A+"%,0,0)"}),e.showSpinner||(p=m.querySelector(e.spinnerSelector),p&&b(p)),y!=document.body&&x(y,"nprogress-custom-parent"),y.appendChild(m),m},n.remove=function(){M(document.documentElement,"nprogress-busy"),M(document.querySelector(e.parent),"nprogress-custom-parent");var a=document.getElementById("nprogress");a&&b(a)},n.isRendered=function(){return!!document.getElementById("nprogress")},n.getPositioningCSS=function(){var a=document.body.style,m="WebkitTransform"in a?"Webkit":"MozTransform"in a?"Moz":"msTransform"in a?"ms":"OTransform"in a?"O":"";return m+"Perspective"in a?"translate3d":m+"Transform"in a?"translate":"margin"};function o(a,m,S){return a<m?m:a>S?S:a}function f(a){return(-1+a)*100}function s(a,m,S){var A;return e.positionUsing==="translate3d"?A={transform:"translate3d("+f(a)+"%,0,0)"}:e.positionUsing==="translate"?A={transform:"translate("+f(a)+"%,0)"}:A={"margin-left":f(a)+"%"},A.transition="all "+m+"ms "+S,A}var O=function(){var a=[];function m(){var S=a.shift();S&&S(m)}return function(S){a.push(S),a.length==1&&m()}}(),C=function(){var a=["Webkit","O","Moz","ms"],m={};function S(v){return v.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,function(u,c){return c.toUpperCase()})}function A(v){var u=document.body.style;if(v in u)return v;for(var c=a.length,l=v.charAt(0).toUpperCase()+v.slice(1),i;c--;)if(i=a[c]+l,i in u)return i;return v}function y(v){return v=S(v),m[v]||(m[v]=A(v))}function p(v,u,c){u=y(u),v.style[u]=c}return function(v,u){var c=arguments,l,i;if(c.length==2)for(l in u)i=u[l],i!==void 0&&u.hasOwnProperty(l)&&p(v,l,i);else p(v,c[1],c[2])}}();function T(a,m){var S=typeof a=="string"?a:R(a);return S.indexOf(" "+m+" ")>=0}function x(a,m){var S=R(a),A=S+m;T(S,m)||(a.className=A.substring(1))}function M(a,m){var S=R(a),A;T(a,m)&&(A=S.replace(" "+m+" "," "),a.className=A.substring(1,A.length-1))}function R(a){return(" "+(a.className||"")+" ").replace(/\s+/gi," ")}function b(a){a&&a.parentNode&&a.parentNode.removeChild(a)}return n})})(yn);var ni=yn.exports;const ut=ln(ni),ri="/assets/nprogress-BgDCIyLK.css";/*! js-cookie v3.0.5 | MIT */function We(r){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var e in n)r[e]=n[e]}return r}var ii={read:function(r){return r[0]==='"'&&(r=r.slice(1,-1)),r.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(r){return encodeURIComponent(r).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function St(r,t){function n(o,f,s){if(!(typeof document>"u")){s=We({},t,s),typeof s.expires=="number"&&(s.expires=new Date(Date.now()+s.expires*864e5)),s.expires&&(s.expires=s.expires.toUTCString()),o=encodeURIComponent(o).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var O="";for(var C in s)s[C]&&(O+="; "+C,s[C]!==!0&&(O+="="+s[C].split(";")[0]));return document.cookie=o+"="+r.write(f,o)+O}}function e(o){if(!(typeof document>"u"||arguments.length&&!o)){for(var f=document.cookie?document.cookie.split("; "):[],s={},O=0;O<f.length;O++){var C=f[O].split("="),T=C.slice(1).join("=");try{var x=decodeURIComponent(C[0]);if(s[x]=r.read(T,x),o===x)break}catch{}}return o?s[o]:s}}return Object.create({set:n,get:e,remove:function(o,f){n(o,"",We({},f,{expires:-1}))},withAttributes:function(o){return St(this.converter,We({},this.attributes,o))},withConverter:function(o){return St(We({},this.converter,o),this.attributes)}},{attributes:{value:Object.freeze(t)},converter:{value:Object.freeze(r)}})}var oi=St(ii,{path:"/"});const vn=({action:r,active:t,currentRootActionId:n})=>{var o;const e=Se.useMemo(()=>{if(!n)return r.ancestors;const f=r.ancestors.findIndex(s=>s.id===n);return r.ancestors.slice(f+1)},[r.ancestors,n]);return Y.jsxs("div",{style:{padding:"12px 16px",background:t?"rgba(0 0 0 / 0.05)":"transparent",borderLeft:`2px solid ${t?"rgb(28 28 29)":"transparent"}`,display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer"},children:[Y.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center",fontSize:14},children:[r.icon&&r.icon,Y.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[Y.jsxs("div",{children:[e.length>0&&e.map(f=>Y.jsxs(Se.Fragment,{children:[Y.jsx("span",{style:{opacity:.5,marginRight:8},children:f.name}),Y.jsx("span",{style:{marginRight:8},children:"›"})]},f.id)),Y.jsx("span",{style:{color:r.name.toLocaleUpperCase()==="DELETE"?"red":"black"},children:r.name})]}),r.subtitle&&Y.jsx("span",{style:{fontSize:12},children:r.subtitle})]})]}),(o=r.shortcut)!=null&&o.length?Y.jsx("div",{"aria-hidden":!0,style:{display:"grid",gridAutoFlow:"column",gap:"4px"},children:r.shortcut.map(f=>Y.jsx("kbd",{style:{padding:"4px 6px",background:"rgba(0 0 0 / .1)",borderRadius:"4px",fontSize:14},children:f},f))}):null]})};vn.displayName="ResultItem";const si={padding:"8px 0",margin:"0 16px",fontSize:"14px",fontWeight:"bold",opacity:.5,borderBottom:"1px solid rgba(0 0 0 / 0.1)"},ai=()=>{const{results:r,rootActionId:t}=ue.useMatches();return Y.jsx(ue.KBarResults,{items:r,onRender:({item:n,active:e})=>typeof n=="string"?Y.jsxs("div",{style:si,children:["Resource.",n]}):Y.jsx(vn,{action:n,active:e,currentRootActionId:t})})},ui=()=>{const r={padding:"12px 16px",fontSize:"16px",width:"100%",boxSizing:"border-box",outline:"none",border:"none",background:"rgb(252 252 252)",color:"black"},t={maxWidth:"600px",width:"100%",background:"white",color:"black",borderRadius:"8px",overflow:"hidden",boxShadow:"0px 4px 4px rgba(0, 0, 0, 0.25)"},n={opacity:1,transition:"background 0.35s cubic-bezier(0.4, 0, 0.2, 1) 0s",backdropFilter:"saturate(180%) blur(1px)",background:"rgba(0, 0, 0, 0.1)",zIndex:"9999"};return Y.jsx(ue.KBarPortal,{children:Y.jsx(ue.KBarPositioner,{style:n,children:Y.jsxs(ue.KBarAnimator,{style:t,children:[Y.jsx(ue.KBarSearch,{style:r}),Y.jsx(ai,{})]})})})},Te=r=>r.replace(/\w\S*/g,t=>t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()),ci=()=>{const r=cn(),{resource:t,resources:n,id:e,action:o}=sr(),f=ar(),s=ur(),O=cr(),{mutate:C}=lr(),{push:T,list:x,create:M,show:R,edit:b}=fr(),a=dr(),m=ye.useContext(ue.KBarContext),{can:S}=hr(),[A,y]=ye.useState([]);ye.useEffect(()=>{(async()=>await Promise.all(p().flatMap(c=>v(c))))().then(c=>y(c.flatMap(l=>l)))},[n,e,t,o]),ye.useEffect(()=>{A.length===0&&m.query.setVisualState(ue.VisualState.hidden)},[A]);const p=()=>{const u=[...n],c=u==null?void 0:u.findIndex(l=>(l.identifier??(l==null?void 0:l.name))===((t==null?void 0:t.identifier)??(t==null?void 0:t.name)));if(c>0){const l=u[c];u.splice(c,1),u.splice(0,0,l)}return u},v=async u=>{var W,F,E,N,B,k;const{name:c,label:l,list:i,create:h,canCreate:d,canEdit:g,canShow:L,icon:_,show:D,canDelete:I,edit:P}=u,w=((W=u==null?void 0:u.meta)==null?void 0:W.label)??((F=u==null?void 0:u.options)==null?void 0:F.label)??l,U=((E=u==null?void 0:u.meta)==null?void 0:E.icon)??((N=u==null?void 0:u.options)==null?void 0:N.icon)??_,j=((B=u==null?void 0:u.meta)==null?void 0:B.canDelete)??((k=u==null?void 0:u.options)==null?void 0:k.canDelete)??I,G=w??r(`${u.name}.${u.name}`,a(u.name,"plural")),z=[];if(i&&(t!==void 0&&(t==null?void 0:t.name)!==c||o!==void 0&&(t==null?void 0:t.name)===c)){const{can:V}=await(S==null?void 0:S({resource:c,action:"list",params:{id:e,resource:u}}))||{can:!0};V&&z.push(ue.createAction({name:r("actions.list",Te("list")),section:G,icon:U||Y.jsx(Br,{size:16}),perform:()=>{const K=s({resource:u,action:"list",legacy:f==="legacy"});K&&(f==="legacy"?T(K):O({to:K}))}}))}if((d||h)&&h&&(o!=="create"||(t==null?void 0:t.name)!==c)){const{can:V}=await(S==null?void 0:S({resource:c,action:"create",params:{resource:u}}))||{can:!0};V&&z.push(ue.createAction({name:r("actions.create",Te("create")),section:G,icon:U||Y.jsx(Ur,{size:16}),keywords:"new",perform:()=>{const K=s({resource:u,action:"create",legacy:f==="legacy"});K&&(f==="legacy"?T(K):O({to:K}))}}))}if((t==null?void 0:t.name)===c&&e){if((L||D)&&D&&o!=="show"){const{can:V}=await(S==null?void 0:S({resource:c,action:"show",params:{id:e,resource:u}}))||{can:!0};V&&z.push(ue.createAction({name:r("actions.show",Te("show")),section:G,icon:U||Y.jsx(kr,{size:16}),perform:()=>{const K=s({resource:u,action:"show",legacy:f==="legacy",meta:{id:e}});K&&(f==="legacy"?T(K):O({to:K}))}}))}if((g||P)&&P&&o!=="edit"){const{can:V}=await(S==null?void 0:S({resource:c,action:"edit",params:{id:e,resource:u}}))||{can:!0};V&&z.push(ue.createAction({name:r("actions.edit",Te("edit")),section:G,icon:U||Y.jsx(jr,{size:16}),perform:()=>{const K=s({resource:u,action:"edit",legacy:f==="legacy",meta:{id:e}});K&&(f==="legacy"?T(K):O({to:K}))}}))}if(j){const{can:V}=await(S==null?void 0:S({resource:c,action:"delete",params:{id:e,resource:u}}))||{can:!0};V&&z.push({id:"delete",name:r("actions.delete",Te("delete")),section:G,icon:U||Y.jsx(Hr,{size:16})},ue.createAction({name:r("buttons.delete",Te("delete")),section:r("buttons.confirm","Are you sure?"),parent:"delete",perform:()=>{C({resource:u.name,id:e},{onSuccess:()=>{const K=s({resource:u,action:"list",legacy:f==="legacy"});K&&(f==="legacy"?T(K):O({to:K}))}})}}),ue.createAction({name:r("buttons.cancel","Cancel"),parent:"delete",perform:()=>null}))}}return z};ue.useRegisterActions(A,[A])},li=({commandBarProps:r})=>{const t=ye.useContext(xr);ci();const n={...t,...r};return Y.jsx(ui,{...n})},fi=()=>{const r=Rt(),t=ue.createAction({section:"Suggestions",name:dn("backHome"),icon:Y.jsx(Lr,{size:16}),priority:ue.Priority.HIGH,perform:()=>{r(gn)}});ue.useRegisterActions([t])},di=()=>(fi(),Y.jsx(li,{})),hi=({...r})=>{const[t="system"]=Bt.useTheme();return Y.jsx(Gr,{theme:t,className:"toaster group",style:{"--width":"414px"},toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground",icon:"self-start mt-0.5"}},...r})};var Cn={exports:{}};/*!
 * @license Copyright 2015-2022 Ably Real-time Ltd (ably.com)
 * 
 * Ably JavaScript Library v1.2.50
 * https://github.com/ably/ably-js
 * 
 * Released under the Apache Licence v2.0
 */(function(r,t){(function(e,o){r.exports=o()})(window,function(){return function(n){var e={};function o(f){if(e[f])return e[f].exports;var s=e[f]={i:f,l:!1,exports:{}};return n[f].call(s.exports,s,s.exports,o),s.l=!0,s.exports}return o.m=n,o.c=e,o.d=function(f,s,O){o.o(f,s)||Object.defineProperty(f,s,{enumerable:!0,get:O})},o.r=function(f){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(f,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(f,"__esModule",{value:!0})},o.t=function(f,s){if(s&1&&(f=o(f)),s&8||s&4&&typeof f=="object"&&f&&f.__esModule)return f;var O=Object.create(null);if(o.r(O),Object.defineProperty(O,"default",{enumerable:!0,value:f}),s&2&&typeof f!="string")for(var C in f)o.d(O,C,(function(T){return f[T]}).bind(null,C));return O},o.n=function(f){var s=f&&f.__esModule?function(){return f.default}:function(){return f};return o.d(s,"a",s),s},o.o=function(f,s){return Object.prototype.hasOwnProperty.call(f,s)},o.p="",o(o.s=42)}([function(n,e,o){o.r(e),o.d(e,"__extends",function(){return s}),o.d(e,"__assign",function(){return O}),o.d(e,"__rest",function(){return C}),o.d(e,"__decorate",function(){return T}),o.d(e,"__param",function(){return x}),o.d(e,"__metadata",function(){return M}),o.d(e,"__awaiter",function(){return R}),o.d(e,"__generator",function(){return b}),o.d(e,"__createBinding",function(){return a}),o.d(e,"__exportStar",function(){return m}),o.d(e,"__values",function(){return S}),o.d(e,"__read",function(){return A}),o.d(e,"__spread",function(){return y}),o.d(e,"__spreadArrays",function(){return p}),o.d(e,"__spreadArray",function(){return v}),o.d(e,"__await",function(){return u}),o.d(e,"__asyncGenerator",function(){return c}),o.d(e,"__asyncDelegator",function(){return l}),o.d(e,"__asyncValues",function(){return i}),o.d(e,"__makeTemplateObject",function(){return h}),o.d(e,"__importStar",function(){return g}),o.d(e,"__importDefault",function(){return L}),o.d(e,"__classPrivateFieldGet",function(){return _}),o.d(e,"__classPrivateFieldSet",function(){return D});/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var f=function(I,P){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(w,U){w.__proto__=U}||function(w,U){for(var j in U)Object.prototype.hasOwnProperty.call(U,j)&&(w[j]=U[j])},f(I,P)};function s(I,P){if(typeof P!="function"&&P!==null)throw new TypeError("Class extends value "+String(P)+" is not a constructor or null");f(I,P);function w(){this.constructor=I}I.prototype=P===null?Object.create(P):(w.prototype=P.prototype,new w)}var O=function(){return O=Object.assign||function(P){for(var w,U=1,j=arguments.length;U<j;U++){w=arguments[U];for(var G in w)Object.prototype.hasOwnProperty.call(w,G)&&(P[G]=w[G])}return P},O.apply(this,arguments)};function C(I,P){var w={};for(var U in I)Object.prototype.hasOwnProperty.call(I,U)&&P.indexOf(U)<0&&(w[U]=I[U]);if(I!=null&&typeof Object.getOwnPropertySymbols=="function")for(var j=0,U=Object.getOwnPropertySymbols(I);j<U.length;j++)P.indexOf(U[j])<0&&Object.prototype.propertyIsEnumerable.call(I,U[j])&&(w[U[j]]=I[U[j]]);return w}function T(I,P,w,U){var j=arguments.length,G=j<3?P:U===null?U=Object.getOwnPropertyDescriptor(P,w):U,z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")G=Reflect.decorate(I,P,w,U);else for(var W=I.length-1;W>=0;W--)(z=I[W])&&(G=(j<3?z(G):j>3?z(P,w,G):z(P,w))||G);return j>3&&G&&Object.defineProperty(P,w,G),G}function x(I,P){return function(w,U){P(w,U,I)}}function M(I,P){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(I,P)}function R(I,P,w,U){function j(G){return G instanceof w?G:new w(function(z){z(G)})}return new(w||(w=Promise))(function(G,z){function W(N){try{E(U.next(N))}catch(B){z(B)}}function F(N){try{E(U.throw(N))}catch(B){z(B)}}function E(N){N.done?G(N.value):j(N.value).then(W,F)}E((U=U.apply(I,P||[])).next())})}function b(I,P){var w={label:0,sent:function(){if(G[0]&1)throw G[1];return G[1]},trys:[],ops:[]},U,j,G,z;return z={next:W(0),throw:W(1),return:W(2)},typeof Symbol=="function"&&(z[Symbol.iterator]=function(){return this}),z;function W(E){return function(N){return F([E,N])}}function F(E){if(U)throw new TypeError("Generator is already executing.");for(;w;)try{if(U=1,j&&(G=E[0]&2?j.return:E[0]?j.throw||((G=j.return)&&G.call(j),0):j.next)&&!(G=G.call(j,E[1])).done)return G;switch(j=0,G&&(E=[E[0]&2,G.value]),E[0]){case 0:case 1:G=E;break;case 4:return w.label++,{value:E[1],done:!1};case 5:w.label++,j=E[1],E=[0];continue;case 7:E=w.ops.pop(),w.trys.pop();continue;default:if(G=w.trys,!(G=G.length>0&&G[G.length-1])&&(E[0]===6||E[0]===2)){w=0;continue}if(E[0]===3&&(!G||E[1]>G[0]&&E[1]<G[3])){w.label=E[1];break}if(E[0]===6&&w.label<G[1]){w.label=G[1],G=E;break}if(G&&w.label<G[2]){w.label=G[2],w.ops.push(E);break}G[2]&&w.ops.pop(),w.trys.pop();continue}E=P.call(I,w)}catch(N){E=[6,N],j=0}finally{U=G=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}}var a=Object.create?function(I,P,w,U){U===void 0&&(U=w),Object.defineProperty(I,U,{enumerable:!0,get:function(){return P[w]}})}:function(I,P,w,U){U===void 0&&(U=w),I[U]=P[w]};function m(I,P){for(var w in I)w!=="default"&&!Object.prototype.hasOwnProperty.call(P,w)&&a(P,I,w)}function S(I){var P=typeof Symbol=="function"&&Symbol.iterator,w=P&&I[P],U=0;if(w)return w.call(I);if(I&&typeof I.length=="number")return{next:function(){return I&&U>=I.length&&(I=void 0),{value:I&&I[U++],done:!I}}};throw new TypeError(P?"Object is not iterable.":"Symbol.iterator is not defined.")}function A(I,P){var w=typeof Symbol=="function"&&I[Symbol.iterator];if(!w)return I;var U=w.call(I),j,G=[],z;try{for(;(P===void 0||P-- >0)&&!(j=U.next()).done;)G.push(j.value)}catch(W){z={error:W}}finally{try{j&&!j.done&&(w=U.return)&&w.call(U)}finally{if(z)throw z.error}}return G}function y(){for(var I=[],P=0;P<arguments.length;P++)I=I.concat(A(arguments[P]));return I}function p(){for(var I=0,P=0,w=arguments.length;P<w;P++)I+=arguments[P].length;for(var U=Array(I),j=0,P=0;P<w;P++)for(var G=arguments[P],z=0,W=G.length;z<W;z++,j++)U[j]=G[z];return U}function v(I,P,w){if(w||arguments.length===2)for(var U=0,j=P.length,G;U<j;U++)(G||!(U in P))&&(G||(G=Array.prototype.slice.call(P,0,U)),G[U]=P[U]);return I.concat(G||Array.prototype.slice.call(P))}function u(I){return this instanceof u?(this.v=I,this):new u(I)}function c(I,P,w){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var U=w.apply(I,P||[]),j,G=[];return j={},z("next"),z("throw"),z("return"),j[Symbol.asyncIterator]=function(){return this},j;function z(k){U[k]&&(j[k]=function(V){return new Promise(function(K,J){G.push([k,V,K,J])>1||W(k,V)})})}function W(k,V){try{F(U[k](V))}catch(K){B(G[0][3],K)}}function F(k){k.value instanceof u?Promise.resolve(k.value.v).then(E,N):B(G[0][2],k)}function E(k){W("next",k)}function N(k){W("throw",k)}function B(k,V){k(V),G.shift(),G.length&&W(G[0][0],G[0][1])}}function l(I){var P,w;return P={},U("next"),U("throw",function(j){throw j}),U("return"),P[Symbol.iterator]=function(){return this},P;function U(j,G){P[j]=I[j]?function(z){return(w=!w)?{value:u(I[j](z)),done:j==="return"}:G?G(z):z}:G}}function i(I){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var P=I[Symbol.asyncIterator],w;return P?P.call(I):(I=typeof S=="function"?S(I):I[Symbol.iterator](),w={},U("next"),U("throw"),U("return"),w[Symbol.asyncIterator]=function(){return this},w);function U(G){w[G]=I[G]&&function(z){return new Promise(function(W,F){z=I[G](z),j(W,F,z.done,z.value)})}}function j(G,z,W,F){Promise.resolve(F).then(function(E){G({value:E,done:W})},z)}}function h(I,P){return Object.defineProperty?Object.defineProperty(I,"raw",{value:P}):I.raw=P,I}var d=Object.create?function(I,P){Object.defineProperty(I,"default",{enumerable:!0,value:P})}:function(I,P){I.default=P};function g(I){if(I&&I.__esModule)return I;var P={};if(I!=null)for(var w in I)w!=="default"&&Object.prototype.hasOwnProperty.call(I,w)&&a(P,I,w);return d(P,I),P}function L(I){return I&&I.__esModule?I:{default:I}}function _(I,P,w,U){if(w==="a"&&!U)throw new TypeError("Private accessor was defined without a getter");if(typeof P=="function"?I!==P||!U:!P.has(I))throw new TypeError("Cannot read private member from an object whose class did not declare it");return w==="m"?U:w==="a"?U.call(I):U?U.value:P.get(I)}function D(I,P,w,U,j){if(U==="m")throw new TypeError("Private method is not writable");if(U==="a"&&!j)throw new TypeError("Private accessor was defined without a setter");if(typeof P=="function"?I!==P||!j:!P.has(I))throw new TypeError("Cannot write private member to an object whose class did not declare it");return U==="a"?j.call(I,w):j?j.value=w:P.set(I,w),w}},function(n,e,o){(function(f){Object.defineProperty(e,"__esModule",{value:!0}),e.allToUpperCase=e.allToLowerCase=e.encodeBody=e.decodeBody=e.Format=e.promisify=e.trim=e.arrChooseN=e.randomHexString=e.randomString=e.cheapRandStr=e.dataSizeBytes=e.inspectBody=e.inspectError=e.isErrorInfoOrPartialErrorInfo=e.now=e.parseQueryString=e.toQueryString=e.arrPopRandomElement=e.defaultPostHeaders=e.defaultGetHeaders=e.allSame=e.arrEvery=e.arrFilter=e.arrMap=e.safeArrForEach=e.arrForEach=e.forInOwnNonNullProperties=e.valuesArray=e.keysArray=e.arrWithoutValue=e.arrDeleteValue=e.arrIn=e.arrIndexOf=e.arrSubtract=e.arrIntersectOb=e.arrIntersect=e.intersect=e.containsValue=e.inherits=e.prototypicalClone=e.shallowClone=e.isEmptyArg=e.isOnlyPropIn=e.isEmpty=e.isObject=e.ensureArray=e.isArray=e.copy=e.mixin=void 0,e.arrEquals=e.toBase64=e.matchDerivedChannel=e.shallowEquals=e.getGlobalObject=e.getRetryTime=e.getJitterCoefficient=e.getBackoffCoefficient=void 0;var s=o(0),O=s.__importDefault(o(3)),C=s.__importStar(o(8)),T=s.__importDefault(o(4)),x=o(11),M=o(31);function R(H){return Math.floor(Math.random()*H.length)}function b(H){for(var q=[],$=1;$<arguments.length;$++)q[$-1]=arguments[$];for(var X=0;X<q.length;X++){var te=q[X];if(!te)break;var de=Object.prototype.hasOwnProperty;for(var Me in te)(!de||de.call(te,Me))&&(H[Me]=te[Me])}return H}e.mixin=b;function a(H){return b({},H)}e.copy=a,e.isArray=Array.isArray||function(H){return Object.prototype.toString.call(H)=="[object Array]"};function m(H){return p(H)?[]:(0,e.isArray)(H)?H:[H]}e.ensureArray=m;function S(H){return Object.prototype.toString.call(H)=="[object Object]"}e.isObject=S;function A(H){for(var q in H)return!1;return!0}e.isEmpty=A;function y(H,q){for(var $ in H)if($!==q)return!1;return!0}e.isOnlyPropIn=y;function p(H){return H==null}e.isEmptyArg=p;function v(H){var q=new Object;for(var $ in H)q[$]=H[$];return q}e.shallowClone=v;function u(H,q){var $=function(){function te(){}return te}();$.prototype=H;var X=new $;return q&&b(X,q),X}e.prototypicalClone=u;var c=function(H,q){if(O.default.Config.inherits){O.default.Config.inherits(H,q);return}H.super_=q,H.prototype=u(q.prototype,{constructor:H})};e.inherits=c;function l(H,q){for(var $ in H)if(H[$]==q)return!0;return!1}e.containsValue=l;function i(H,q){return(0,e.isArray)(q)?h(H,q):d(H,q)}e.intersect=i;function h(H,q){for(var $=[],X=0;X<H.length;X++){var te=H[X];(0,e.arrIndexOf)(q,te)!=-1&&$.push(te)}return $}e.arrIntersect=h;function d(H,q){for(var $=[],X=0;X<H.length;X++){var te=H[X];te in q&&$.push(te)}return $}e.arrIntersectOb=d;function g(H,q){for(var $=[],X=0;X<H.length;X++){var te=H[X];(0,e.arrIndexOf)(q,te)==-1&&$.push(te)}return $}e.arrSubtract=g,e.arrIndexOf=Array.prototype.indexOf?function(H,q,$){return H.indexOf(q,$)}:function(H,q,$){$=$||0;for(var X=H.length;$<X;$++)if(H[$]===q)return $;return-1};function L(H,q){return(0,e.arrIndexOf)(H,q)!==-1}e.arrIn=L;function _(H,q){var $=(0,e.arrIndexOf)(H,q),X=$!=-1;return X&&H.splice($,1),X}e.arrDeleteValue=_;function D(H,q){var $=H.slice();return _($,q),$}e.arrWithoutValue=D;function I(H,q){var $=[];for(var X in H)q&&!Object.prototype.hasOwnProperty.call(H,X)||$.push(X);return $}e.keysArray=I;function P(H,q){var $=[];for(var X in H)q&&!Object.prototype.hasOwnProperty.call(H,X)||$.push(H[X]);return $}e.valuesArray=P;function w(H,q){for(var $ in H)Object.prototype.hasOwnProperty.call(H,$)&&H[$]&&q($)}e.forInOwnNonNullProperties=w,e.arrForEach=Array.prototype.forEach?function(H,q){H.forEach(q)}:function(H,q){for(var $=H.length,X=0;X<$;X++)q(H[X],X,H)};function U(H,q){return(0,e.arrForEach)(H.slice(),q)}e.safeArrForEach=U,e.arrMap=Array.prototype.map?function(H,q){return H.map(q)}:function(H,q){for(var $=[],X=H.length,te=0;te<X;te++)$.push(q(H[te],te,H));return $},e.arrFilter=Array.prototype.filter?function(H,q){return H.filter(q)}:function(H,q){for(var $=[],X=H.length,te=0;te<X;te++)q(H[te])&&$.push(H[te]);return $},e.arrEvery=Array.prototype.every?function(H,q){return H.every(q)}:function(H,q){for(var $=H.length,X=0;X<$;X++)if(!q(H[X],X,H))return!1;return!0};function j(H,q){if(H.length===0)return!0;var $=H[0][q];return(0,e.arrEvery)(H,function(X){return X[q]===$})}e.allSame=j;var G={json:"application/json",jsonp:"application/javascript",xml:"application/xml",html:"text/html",msgpack:"application/x-msgpack"};function z(H,q){var $=G[q||oe.json];return{accept:$,"X-Ably-Version":C.default.protocolVersion.toString(),"Ably-Agent":(0,C.getAgentString)(H)}}e.defaultGetHeaders=z;function W(H,q){var $,X=$=G[q||oe.json];return{accept:X,"content-type":$,"X-Ably-Version":C.default.protocolVersion.toString(),"Ably-Agent":(0,C.getAgentString)(H)}}e.defaultPostHeaders=W;function F(H){return H.splice(R(H),1)[0]}e.arrPopRandomElement=F;function E(H){var q=[];if(H)for(var $ in H)q.push(encodeURIComponent($)+"="+encodeURIComponent(H[$]));return q.length?"?"+q.join("&"):""}e.toQueryString=E;function N(H){for(var q,$=/([^?&=]+)=?([^&]*)/g,X={};q=$.exec(H);)X[decodeURIComponent(q[1])]=decodeURIComponent(q[2]);return X}e.parseQueryString=N,e.now=Date.now||function(){return new Date().getTime()};function B(H){return typeof H=="object"&&H!==null&&(H.constructor.name=="ErrorInfo"||H.constructor.name=="PartialErrorInfo")}e.isErrorInfoOrPartialErrorInfo=B;function k(H){var q,$;return H instanceof Error||((q=H==null?void 0:H.constructor)===null||q===void 0?void 0:q.name)==="ErrorInfo"||(($=H==null?void 0:H.constructor)===null||$===void 0?void 0:$.name)==="PartialErrorInfo"?H.toString():O.default.Config.inspect(H)}e.inspectError=k;function V(H){return O.default.BufferUtils.isBuffer(H)?H.toString():typeof H=="string"?H:O.default.Config.inspect(H)}e.inspectBody=V;function K(H){if(O.default.BufferUtils.isBuffer(H))return O.default.BufferUtils.byteLength(H);if(typeof H=="string")return O.default.Config.stringByteSize(H);throw new Error("Expected input of Utils.dataSizeBytes to be a buffer or string, but was: "+typeof H)}e.dataSizeBytes=K;function J(){return String(Math.random()).substr(2)}e.cheapRandStr=J;var Z=function(H){if(O.default.Config.getRandomValues&&typeof Uint8Array<"u"){var q=new Uint8Array(H);return O.default.Config.getRandomValues(q),O.default.BufferUtils.base64Encode(q)}for(var $=O.default.BufferUtils.base64CharSet,X=Math.round(H*4/3),te="",de=0;de<X;de++)te+=$[R($)];return te};e.randomString=Z;var ee=function(H){if(O.default.Config.getRandomValues&&typeof Uint8Array<"u"){var q=new Uint8Array(H);return O.default.Config.getRandomValues(q),O.default.BufferUtils.hexEncode(q)}for(var $=O.default.BufferUtils.hexCharSet,X=H*2,te="",de=0;de<X;de++)te+=$[R($)];return te};e.randomHexString=ee;function re(H,q){for(var $=Math.min(q,H.length),X=H.slice(),te=[],de=0;de<$;de++)te.push(F(X));return te}e.arrChooseN=re,e.trim=String.prototype.trim?function(H){return H.trim()}:function(H){return H.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};function Q(H,q,$){return new Promise(function(X,te){H[q].apply(H,s.__spreadArray(s.__spreadArray([],$,!1),[function(de,Me){de?te(de):X(Me)}],!1))})}e.promisify=Q;var oe;(function(H){H.msgpack="msgpack",H.json="json"})(oe=e.Format||(e.Format={}));function ce(H,q){return q=="msgpack"?O.default.Config.msgpack.decode(H):JSON.parse(String(H))}e.decodeBody=ce;function fe(H,q){return q=="msgpack"?O.default.Config.msgpack.encode(H,!0):JSON.stringify(H)}e.encodeBody=fe;function ae(H){return H.map(function(q){return q&&q.toLowerCase()})}e.allToLowerCase=ae;function Re(H){return H.map(function(q){return q&&q.toUpperCase()})}e.allToUpperCase=Re;function Ge(H){return Math.min((H+2)/3,2)}e.getBackoffCoefficient=Ge;function ge(){return 1-Math.random()*.2}e.getJitterCoefficient=ge;function Fe(H,q){return H*Ge(q)*ge()}e.getRetryTime=Fe;function it(){return f||(typeof window<"u"?window:self)}e.getGlobalObject=it;function ot(H,q){return Object.keys(H).every(function($){return H[$]===q[$]})&&Object.keys(q).every(function($){return q[$]===H[$]})}e.shallowEquals=ot;function er(H){var q=/^(\[([^?]*)(?:(.*))\])?(.+)$/,$=H.match(q);if(!$||!$.length||$.length<5)throw new T.default("regex match failed",400,40010);if($[2])throw new T.default("cannot use a derived option with a ".concat($[2]," channel"),400,40010);return{qualifierParam:$[3]||"",channelName:$[4]}}e.matchDerivedChannel=er;function tr(H){return O.default.Config.createHmac?Buffer.from(H,"ascii").toString("base64"):(0,x.stringify)((0,M.parse)(H))}e.toBase64=tr;function nr(H,q){return H.length===q.length&&(0,e.arrEvery)(H,function($,X){return $===q[X]})}e.arrEquals=nr}).call(this,o(13))},function(n,e,o){(function(f){Object.defineProperty(e,"__esModule",{value:!0});var s=o(0),O=s.__importDefault(o(3)),C=f||(typeof window<"u"?window:self),T;(function(a){a[a.None=0]="None",a[a.Error=1]="Error",a[a.Major=2]="Major",a[a.Minor=3]="Minor",a[a.Micro=4]="Micro"})(T||(T={}));function x(a,m){return"".concat(a).padStart(m?3:2,"0")}function M(a){return O.default.Config.logTimestamps?function(m){var S=new Date;a(x(S.getHours())+":"+x(S.getMinutes())+":"+x(S.getSeconds())+"."+x(S.getMilliseconds(),1)+" "+m)}:a}var R=function(){var a,m,S,A;return typeof Window>"u"&&typeof WorkerGlobalScope>"u"||typeof((m=(a=C==null?void 0:C.console)===null||a===void 0?void 0:a.log)===null||m===void 0?void 0:m.apply)=="function"?(S=function(){for(var y=[],p=0;p<arguments.length;p++)y[p]=arguments[p];console.log.apply(console,y)},A=console.warn?function(){for(var y=[],p=0;p<arguments.length;p++)y[p]=arguments[p];console.warn.apply(console,y)}:S):C!=null&&C.console.log?S=A=function(){Function.prototype.apply.call(console.log,console,arguments)}:S=A=function(){},[S,A].map(M)},b=function(){function a(){a.logLevel=a.LOG_DEFAULT}return a.initLogHandlers=function(){var m=R(),S=m[0],A=m[1];this.logHandler=S,this.logErrorHandler=A},a.renamedClientOption=function(m,S){a.deprecationWarning("The `".concat(m,"` client option has been renamed to `").concat(S,"`. Please update your code to use `").concat(S,"` instead. `").concat(m,"` will be removed in a future version."))},a.renamedMethod=function(m,S,A){a.deprecationWarning("`".concat(m,"`’s `").concat(S,"` method has been renamed to `").concat(A,"`. Please update your code to use `").concat(A,"` instead. `").concat(S,"` will be removed in a future version."))},a.deprecationWarning=function(m){a.shouldLog(T.Error)&&a.logErrorHandler("Ably: Deprecation warning - ".concat(m))},a.logLevel=T.Error,a.LOG_NONE=T.None,a.LOG_ERROR=T.Error,a.LOG_MAJOR=T.Major,a.LOG_MINOR=T.Minor,a.LOG_MICRO=T.Micro,a.LOG_DEFAULT=T.Error,a.LOG_DEBUG=T.Micro,a.logAction=function(m,S,A){a.shouldLog(m)&&(m===T.Error?a.logErrorHandler:a.logHandler)("Ably: "+S+": "+A)},a.deprecated=function(m,S){a.deprecationWarning("".concat(m," is deprecated and will be removed in a future version. ").concat(S))},a.shouldLog=function(m){return m<=a.logLevel},a.setLog=function(m,S){m!==void 0&&(a.logLevel=m),S!==void 0&&(a.logHandler=a.logErrorHandler=S)},a}();e.default=b}).call(this,o(13))},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0});var f=function(){function s(){}return s}();e.default=f},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0}),e.PartialErrorInfo=void 0;var f=o(0),s=f.__importDefault(o(3)),O=f.__importStar(o(1));function C(M){var R="["+M.constructor.name;return M.message&&(R+=": "+M.message),M.statusCode&&(R+="; statusCode="+M.statusCode),M.code&&(R+="; code="+M.code),M.cause&&(R+="; cause="+O.inspectError(M.cause)),M.href&&!(M.message&&M.message.indexOf("help.ably.io")>-1)&&(R+="; see "+M.href+" "),R+="]",R}var T=function(M){f.__extends(R,M);function R(b,a,m,S){var A=M.call(this,b)||this;return typeof Object.setPrototypeOf<"u"&&Object.setPrototypeOf(A,R.prototype),A.code=a,A.statusCode=m,A.cause=S,A}return R.prototype.toString=function(){return C(this)},R.fromValues=function(b){var a=b,m=a.message,S=a.code,A=a.statusCode;if(typeof m!="string"||typeof S!="number"||typeof A!="number")throw new Error("ErrorInfo.fromValues(): invalid values: "+s.default.Config.inspect(b));var y=Object.assign(new R(m,S,A),b);return y.code&&!y.href&&(y.href="https://help.ably.io/error/"+y.code),y},R}(Error);e.default=T;var x=function(M){f.__extends(R,M);function R(b,a,m,S){var A=M.call(this,b)||this;return typeof Object.setPrototypeOf<"u"&&Object.setPrototypeOf(A,R.prototype),A.code=a,A.statusCode=m,A.cause=S,A}return R.prototype.toString=function(){return C(this)},R}(Error);e.PartialErrorInfo=x},function(n,e,o){(function(f,s){n.exports=s(o(6))})(this,function(f){return function(){if(typeof ArrayBuffer=="function"){var s=f,O=s.lib,C=O.WordArray,T=C.init,x=C.init=function(M){if(M instanceof ArrayBuffer&&(M=new Uint8Array(M)),(M instanceof Int8Array||typeof Uint8ClampedArray<"u"&&M instanceof Uint8ClampedArray||M instanceof Int16Array||M instanceof Uint16Array||M instanceof Int32Array||M instanceof Uint32Array||M instanceof Float32Array||M instanceof Float64Array)&&(M=new Uint8Array(M.buffer,M.byteOffset,M.byteLength)),M instanceof Uint8Array){for(var R=M.byteLength,b=[],a=0;a<R;a++)b[a>>>2]|=M[a]<<24-a%4*8;T.call(this,b,R)}else T.apply(this,arguments)};x.prototype=C}}(),f.lib.WordArray})},function(n,e,o){(function(f){(function(s,O){n.exports=O()})(this,function(){var s=s||function(O,C){var T;if(typeof window<"u"&&window.crypto&&(T=window.crypto),!T&&typeof window<"u"&&window.msCrypto&&(T=window.msCrypto),!T&&typeof f<"u"&&f.crypto&&(T=f.crypto),!T)try{T=o(44)}catch{}var x=function(){if(T){if(typeof T.getRandomValues=="function")try{return T.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof T.randomBytes=="function")try{return T.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},M=Object.create||function(){function c(){}return function(l){var i;return c.prototype=l,i=new c,c.prototype=null,i}}(),R={},b=R.lib={},a=b.Base=function(){return{extend:function(c){var l=M(this);return c&&l.mixIn(c),(!l.hasOwnProperty("init")||this.init===l.init)&&(l.init=function(){l.$super.init.apply(this,arguments)}),l.init.prototype=l,l.$super=this,l},create:function(){var c=this.extend();return c.init.apply(c,arguments),c},init:function(){},mixIn:function(c){for(var l in c)c.hasOwnProperty(l)&&(this[l]=c[l]);c.hasOwnProperty("toString")&&(this.toString=c.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),m=b.WordArray=a.extend({init:function(c,l){c=this.words=c||[],l!=C?this.sigBytes=l:this.sigBytes=c.length*4},toString:function(c){return(c||A).stringify(this)},concat:function(c){var l=this.words,i=c.words,h=this.sigBytes,d=c.sigBytes;if(this.clamp(),h%4)for(var g=0;g<d;g++){var L=i[g>>>2]>>>24-g%4*8&255;l[h+g>>>2]|=L<<24-(h+g)%4*8}else for(var g=0;g<d;g+=4)l[h+g>>>2]=i[g>>>2];return this.sigBytes+=d,this},clamp:function(){var c=this.words,l=this.sigBytes;c[l>>>2]&=4294967295<<32-l%4*8,c.length=O.ceil(l/4)},clone:function(){var c=a.clone.call(this);return c.words=this.words.slice(0),c},random:function(c){for(var l=[],i=0;i<c;i+=4)l.push(x());return new m.init(l,c)}}),S=R.enc={},A=S.Hex={stringify:function(c){for(var l=c.words,i=c.sigBytes,h=[],d=0;d<i;d++){var g=l[d>>>2]>>>24-d%4*8&255;h.push((g>>>4).toString(16)),h.push((g&15).toString(16))}return h.join("")},parse:function(c){for(var l=c.length,i=[],h=0;h<l;h+=2)i[h>>>3]|=parseInt(c.substr(h,2),16)<<24-h%8*4;return new m.init(i,l/2)}},y=S.Latin1={stringify:function(c){for(var l=c.words,i=c.sigBytes,h=[],d=0;d<i;d++){var g=l[d>>>2]>>>24-d%4*8&255;h.push(String.fromCharCode(g))}return h.join("")},parse:function(c){for(var l=c.length,i=[],h=0;h<l;h++)i[h>>>2]|=(c.charCodeAt(h)&255)<<24-h%4*8;return new m.init(i,l)}},p=S.Utf8={stringify:function(c){try{return decodeURIComponent(escape(y.stringify(c)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(c){return y.parse(unescape(encodeURIComponent(c)))}},v=b.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new m.init,this._nDataBytes=0},_append:function(c){typeof c=="string"&&(c=p.parse(c)),this._data.concat(c),this._nDataBytes+=c.sigBytes},_process:function(c){var l,i=this._data,h=i.words,d=i.sigBytes,g=this.blockSize,L=g*4,_=d/L;c?_=O.ceil(_):_=O.max((_|0)-this._minBufferSize,0);var D=_*g,I=O.min(D*4,d);if(D){for(var P=0;P<D;P+=g)this._doProcessBlock(h,P);l=h.splice(0,D),i.sigBytes-=I}return new m.init(l,I)},clone:function(){var c=a.clone.call(this);return c._data=this._data.clone(),c},_minBufferSize:0});b.Hasher=v.extend({cfg:a.extend(),init:function(c){this.cfg=this.cfg.extend(c),this.reset()},reset:function(){v.reset.call(this),this._doReset()},update:function(c){return this._append(c),this._process(),this},finalize:function(c){c&&this._append(c);var l=this._doFinalize();return l},blockSize:16,_createHelper:function(c){return function(l,i){return new c.init(i).finalize(l)}},_createHmacHelper:function(c){return function(l,i){return new u.HMAC.init(c,i).finalize(l)}}});var u=R.algo={};return R}(Math);return s})}).call(this,o(13))},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0});var f=o(0),s=f.__importStar(o(1)),O=f.__importDefault(o(2)),C=f.__importDefault(o(3));function T(R,b,a){try{b.apply(R,a)}catch(m){O.default.logAction(O.default.LOG_ERROR,"EventEmitter.emit()","Unexpected listener exception: "+m+"; stack = "+(m&&m.stack))}}function x(R,b,a){for(var m,S,A,y=0;y<R.length;y++)if(m=R[y],a&&(m=m[a]),s.isArray(m)){for(;(S=s.arrIndexOf(m,b))!==-1;)m.splice(S,1);a&&m.length===0&&delete R[y][a]}else if(s.isObject(m))for(A in m)Object.prototype.hasOwnProperty.call(m,A)&&s.isArray(m[A])&&x([m],b,A)}var M=function(){function R(){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null)}return R.prototype.on=function(){for(var b=this,a=[],m=0;m<arguments.length;m++)a[m]=arguments[m];if(a.length===1){var S=a[0];if(typeof S=="function")this.any.push(S);else throw new Error("EventListener.on(): Invalid arguments: "+C.default.Config.inspect(a))}if(a.length===2){var A=a[0],y=a[1];if(typeof y!="function")throw new Error("EventListener.on(): Invalid arguments: "+C.default.Config.inspect(a));if(s.isEmptyArg(A))this.any.push(y);else if(s.isArray(A))A.forEach(function(v){b.on(v,y)});else{if(typeof A!="string")throw new Error("EventListener.on(): Invalid arguments: "+C.default.Config.inspect(a));var p=this.events[A]||(this.events[A]=[]);p.push(y)}}},R.prototype.off=function(){for(var b,a=this,m=[],S=0;S<arguments.length;S++)m[S]=arguments[S];if(m.length==0||s.isEmptyArg(m[0])&&s.isEmptyArg(m[1])){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null);return}var A=m[0],y=m[1],p=null,v=null;if(m.length===1||!y)typeof A=="function"?p=A:v=A;else{if(typeof y!="function")throw new Error("EventEmitter.off(): invalid arguments:"+C.default.Config.inspect(m));b=[A,y],v=b[0],p=b[1]}if(p&&s.isEmptyArg(v)){x([this.any,this.events,this.anyOnce,this.eventsOnce],p);return}if(s.isArray(v)){v.forEach(function(u){a.off(u,p)});return}if(typeof v!="string")throw new Error("EventEmitter.off(): invalid arguments:"+C.default.Config.inspect(m));p?x([this.events,this.eventsOnce],p,v):(delete this.events[v],delete this.eventsOnce[v])},R.prototype.listeners=function(b){if(b){var a=this.events[b]||[];return this.eventsOnce[b]&&Array.prototype.push.apply(a,this.eventsOnce[b]),a.length?a:null}return this.any.length?this.any:null},R.prototype.emit=function(b){for(var a=[],m=1;m<arguments.length;m++)a[m-1]=arguments[m];var S={event:b},A=[];this.anyOnce.length&&(Array.prototype.push.apply(A,this.anyOnce),this.anyOnce=[]),this.any.length&&Array.prototype.push.apply(A,this.any);var y=this.eventsOnce[b];y&&(Array.prototype.push.apply(A,y),delete this.eventsOnce[b]);var p=this.events[b];p&&Array.prototype.push.apply(A,p),s.arrForEach(A,function(v){T(S,v,a)})},R.prototype.once=function(){for(var b=this,a=[],m=0;m<arguments.length;m++)a[m]=arguments[m];var S=a.length;if((S===0||S===1&&typeof a[0]!="function")&&C.default.Config.Promise){var A=a[0];return new C.default.Config.Promise(function(l){b.once(A,l)})}var y=a[0],p=a[1];if(a.length===1&&typeof y=="function")this.anyOnce.push(y);else if(s.isEmptyArg(y)){if(typeof p!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+C.default.Config.inspect(a));this.anyOnce.push(p)}else if(s.isArray(y)){var v=this,u=function(){var l=Array.prototype.slice.call(arguments);if(s.arrForEach(y,function(i){v.off(i,u)}),typeof p!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+C.default.Config.inspect(a));p.apply(this,l)};s.arrForEach(y,function(l){v.on(l,u)})}else{if(typeof y!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+C.default.Config.inspect(a));var c=this.eventsOnce[y]||(this.eventsOnce[y]=[]);if(p){if(typeof p!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+C.default.Config.inspect(a));c.push(p)}}},R.prototype.whenState=function(b,a,m){for(var S=this,A=[],y=3;y<arguments.length;y++)A[y-3]=arguments[y];var p={event:b};if(typeof b!="string"||typeof a!="string")throw"whenState requires a valid event String argument";if(typeof m!="function"&&C.default.Config.Promise)return new C.default.Config.Promise(function(v){R.prototype.whenState.apply(S,[b,a,v].concat(A))});b===a?T(p,m,A):this.once(b,m)},R}();e.default=M},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0}),e.getDefaults=e.normaliseOptions=e.objectifyOptions=e.getAgentString=e.getHosts=e.getFallbackHosts=e.environmentFallbackHosts=e.getHttpScheme=e.getPort=e.getHost=void 0;var f=o(0),s=f.__importDefault(o(3)),O=f.__importStar(o(1)),C=f.__importDefault(o(2)),T=f.__importDefault(o(4)),x=o(43),M="ably-js/"+x.version,R={ENVIRONMENT:"",REST_HOST:"rest.ably.io",REALTIME_HOST:"realtime.ably.io",FALLBACK_HOSTS:["A.ably-realtime.com","B.ably-realtime.com","C.ably-realtime.com","D.ably-realtime.com","E.ably-realtime.com"],PORT:80,TLS_PORT:443,TIMEOUTS:{disconnectedRetryTimeout:15e3,suspendedRetryTimeout:3e4,httpRequestTimeout:15e3,channelRetryTimeout:15e3,fallbackRetryTimeout:6e5,connectionStateTtl:12e4,realtimeRequestTimeout:1e4,recvTimeout:9e4,preferenceConnectTimeout:6e3,parallelUpgradeDelay:6e3},httpMaxRetryCount:3,maxMessageSize:65536,version:x.version,protocolVersion:2,agent:M,getHost:b,getPort:a,getHttpScheme:m,environmentFallbackHosts:S,getFallbackHosts:A,getHosts:y,checkHost:p,objectifyOptions:l,normaliseOptions:i};function b(d,g,L){return L?g=g==d.restHost&&d.realtimeHost||g||d.realtimeHost:g=g||d.restHost,g}e.getHost=b;function a(d,g){return g||d.tls?d.tlsPort:d.port}e.getPort=a;function m(d){return d.tls?"https://":"http://"}e.getHttpScheme=m;function S(d){return[d+"-a-fallback.ably-realtime.com",d+"-b-fallback.ably-realtime.com",d+"-c-fallback.ably-realtime.com",d+"-d-fallback.ably-realtime.com",d+"-e-fallback.ably-realtime.com"]}e.environmentFallbackHosts=S;function A(d){var g=d.fallbackHosts,L=typeof d.httpMaxRetryCount<"u"?d.httpMaxRetryCount:R.httpMaxRetryCount;return g?O.arrChooseN(g,L):[]}e.getFallbackHosts=A;function y(d){return[d.restHost].concat(A(d))}e.getHosts=y;function p(d){if(typeof d!="string")throw new T.default("host must be a string; was a "+typeof d,4e4,400);if(!d.length)throw new T.default("host must not be zero-length",4e4,400)}function v(d,g,L){return d.realtimeHost?d.realtimeHost:d.restHost?(C.default.logAction(C.default.LOG_MINOR,"Defaults.normaliseOptions",'restHost is set to "'+d.restHost+'" but realtimeHost is not set, so setting realtimeHost to "'+d.restHost+'" too. If this is not what you want, please set realtimeHost explicitly.'),d.restHost):g?R.REALTIME_HOST:L+"-"+R.REALTIME_HOST}function u(d){var g={};for(var L in R.TIMEOUTS)g[L]=d[L]||R.TIMEOUTS[L];return g}function c(d){var g=R.agent;if(d.agents)for(var L in d.agents)g+=" "+L+"/"+d.agents[L];return g}e.getAgentString=c;function l(d){return typeof d=="string"?d.indexOf(":")==-1?{token:d}:{key:d}:d}e.objectifyOptions=l;function i(d){if(d.host&&(C.default.renamedClientOption("host","restHost"),d.restHost=d.host),d.wsHost&&(C.default.renamedClientOption("wsHost","realtimeHost"),d.realtimeHost=d.wsHost),d.queueEvents&&(C.default.renamedClientOption("queueEvents","queueMessages"),d.queueMessages=d.queueEvents),d.headers&&C.default.deprecated("the `headers` client option",""),d.fallbackHostsUseDefault){if(d.fallbackHosts){var g="fallbackHosts and fallbackHostsUseDefault cannot both be set";throw C.default.logAction(C.default.LOG_ERROR,"Defaults.normaliseOptions",g),new T.default(g,4e4,400)}if(d.port||d.tlsPort){var g="fallbackHostsUseDefault cannot be set when port or tlsPort are set";throw C.default.logAction(C.default.LOG_ERROR,"Defaults.normaliseOptions",g),new T.default(g,4e4,400)}d.environment?C.default.deprecated("The `fallbackHostsUseDefault` client option","If you’re using this client option to force the library to make use of fallback hosts even though you’ve set the `environment` client option, then this is no longer necessary: remove your usage of the `fallbackHostsUseDefault` client option and the library will then automatically choose the correct fallback hosts to use for the specified environment."):C.default.deprecated("The `fallbackHostsUseDefault` client option","If you’re using this client option to force the library to make use of fallback hosts even though you’re not using the primary Ably environment, then stop using `fallbackHostsUseDefault`, and update your code to either pass the `environment` client option (in which case the library will automatically choose the correct fallback hosts to use for the specified environment), or to pass the `fallbackHosts` client option to specify a custom list of fallback hosts to use (for example, if you’re using a custom CNAME, in which case Ably will have provided you with an explicit list of fallback hosts)."),d.fallbackHosts=R.FALLBACK_HOSTS}d.recover===!0&&(C.default.deprecated("The ability to use a boolean value for the `recover` client option","If you wish for the connection to always be recovered, replace `{ recover: true }` with a function that always passes `true` to its callback: `{ recover: function(lastConnectionDetails, cb) { cb(true); } }`"),d.recover=function(F,E){E(!0)}),typeof d.recover=="function"&&d.closeOnUnload===!0&&(C.default.logAction(C.default.LOG_ERROR,"Defaults.normaliseOptions","closeOnUnload was true and a session recovery function was set - these are mutually exclusive, so unsetting the latter"),d.recover=void 0),"closeOnUnload"in d||(d.closeOnUnload=!d.recover),d.transports&&O.arrIn(d.transports,"xhr")&&(C.default.deprecationWarning('The "xhr" transport has been renamed to "xhr_streaming". Please update your client options code to use `transports: ["xhr_streaming"]` instead. The ability to use `transports: ["xhr"]` will be removed in a future version.'),O.arrDeleteValue(d.transports,"xhr"),d.transports.push("xhr_streaming")),"queueMessages"in d||(d.queueMessages=!0);var L=d.environment&&String(d.environment).toLowerCase()||R.ENVIRONMENT,_=!L||L==="production";!d.fallbackHosts&&!d.restHost&&!d.realtimeHost&&!d.port&&!d.tlsPort&&(d.fallbackHosts=_?R.FALLBACK_HOSTS:S(L));var D=d.restHost||(_?R.REST_HOST:L+"-"+R.REST_HOST),I=v(d,_,L);O.arrForEach((d.fallbackHosts||[]).concat(D,I),p),d.port=d.port||R.PORT,d.tlsPort=d.tlsPort||R.TLS_PORT,"tls"in d||(d.tls=!0);var P=u(d);if("useBinaryProtocol"in d?d.useBinaryProtocol=s.default.Config.supportsBinary&&d.useBinaryProtocol:d.useBinaryProtocol=s.default.Config.preferBinary,d.clientId){var w=d.headers=d.headers||{};w["X-Ably-ClientId"]=s.default.BufferUtils.base64Encode(s.default.BufferUtils.utf8Encode(d.clientId))}"idempotentRestPublishing"in d||(d.idempotentRestPublishing=!0),d.promises&&!s.default.Config.Promise&&(C.default.logAction(C.default.LOG_ERROR,"Defaults.normaliseOptions","{promises: true} was specified, but no Promise constructor found; disabling promises"),d.promises=!1);var U=null,j=d.connectivityCheckUrl;if(d.connectivityCheckUrl){var G=d.connectivityCheckUrl.split("?"),z=G[0],W=G[1];U=W?O.parseQueryString(W):{},z.indexOf("://")===-1&&(z="https://"+z),j=z}return f.__assign(f.__assign({},d),{useBinaryProtocol:"useBinaryProtocol"in d?s.default.Config.supportsBinary&&d.useBinaryProtocol:s.default.Config.preferBinary,realtimeHost:I,restHost:D,maxMessageSize:d.maxMessageSize||R.maxMessageSize,timeouts:P,connectivityCheckParams:U,connectivityCheckUrl:j})}e.normaliseOptions=i,e.default=R;function h(d){return Object.assign(R,d)}e.getDefaults=h},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0});var f=o(0),s=f.__importDefault(o(3)),O=f.__importDefault(o(2)),C=f.__importDefault(o(4)),T=f.__importStar(o(1));function x(a){return!a||!a.channelOptions?{channelOptions:a,plugins:{},baseEncodedPreviousPayload:void 0}:a}function M(a){if(a&&a.cipher){if(!s.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var m=s.default.Crypto.getCipher(a.cipher);return{cipher:m.cipherParams,channelCipher:m.cipher}}return a??{}}function R(a){var m=0;return a.name&&(m+=a.name.length),a.clientId&&(m+=a.clientId.length),a.extras&&(m+=JSON.stringify(a.extras).length),a.data&&(m+=T.dataSizeBytes(a.data)),m}var b=function(){function a(){}return a.prototype.toJSON=function(){var m=this.encoding,S=this.data;return S&&s.default.BufferUtils.isBuffer(S)&&(arguments.length>0?(m=m?m+"/base64":"base64",S=s.default.BufferUtils.base64Encode(S)):S=s.default.BufferUtils.toBuffer(S)),{name:this.name,id:this.id,clientId:this.clientId,connectionId:this.connectionId,connectionKey:this.connectionKey,extras:this.extras,encoding:m,data:S}},a.prototype.toString=function(){var m="[Message";return this.name&&(m+="; name="+this.name),this.id&&(m+="; id="+this.id),this.timestamp&&(m+="; timestamp="+this.timestamp),this.clientId&&(m+="; clientId="+this.clientId),this.connectionId&&(m+="; connectionId="+this.connectionId),this.encoding&&(m+="; encoding="+this.encoding),this.extras&&(m+="; extras ="+JSON.stringify(this.extras)),this.data&&(typeof this.data=="string"?m+="; data="+this.data:s.default.BufferUtils.isBuffer(this.data)?m+="; data (buffer)="+s.default.BufferUtils.base64Encode(this.data):m+="; data (json)="+JSON.stringify(this.data)),this.extras&&(m+="; extras="+JSON.stringify(this.extras)),m+="]",m},a.encrypt=function(m,S,A){var y=m.data,p=m.encoding,v=S.channelCipher;p=p?p+"/":"",s.default.BufferUtils.isBuffer(y)||(y=s.default.BufferUtils.utf8Encode(String(y)),p=p+"utf-8/"),v.encrypt(y,function(u,c){if(u){A(u);return}m.data=c,m.encoding=p+"cipher+"+v.algorithm,A(null,m)})},a.encode=function(m,S,A){var y=m.data,p=typeof y=="string"||s.default.BufferUtils.isBuffer(y)||y===null||y===void 0;if(!p)if(T.isObject(y)||T.isArray(y))m.data=JSON.stringify(y),m.encoding=m.encoding?m.encoding+"/json":"json";else throw new C.default("Data type is unsupported",40013,400);S!=null&&S.cipher?a.encrypt(m,S,A):A(null,m)},a.encodeArray=function(m,S,A){for(var y=0,p=0;p<m.length;p++)a.encode(m[p],S,function(v){if(v){A(v);return}y++,y==m.length&&A(null,m)})},a.decode=function(m,S){var A=x(S),y=m.data,p=m.encoding;if(p){var v=p.split("/"),u=void 0,c=v.length,l=m.data,i="";try{for(;(u=c)>0;){var h=v[--c].match(/([-\w]+)(\+([\w-]+))?/);if(!h)break;switch(i=h[1],i){case"base64":l=s.default.BufferUtils.base64Decode(String(l)),u==v.length&&(y=l);continue;case"utf-8":l=s.default.BufferUtils.utf8Decode(l);continue;case"json":l=JSON.parse(l);continue;case"cipher":if(A.channelOptions!=null&&A.channelOptions.cipher&&A.channelOptions.channelCipher){var d=h[3],g=A.channelOptions.channelCipher;if(d!=g.algorithm)throw new Error("Unable to decrypt message with given cipher; incompatible cipher params");l=g.decrypt(l);continue}else throw new Error("Unable to decrypt message; not an encrypted channel");case"vcdiff":if(!A.plugins||!A.plugins.vcdiff)throw new C.default("Missing Vcdiff decoder (https://github.com/ably-forks/vcdiff-decoder)",40019,400);if(typeof Uint8Array>"u")throw new C.default("Delta decoding not supported on this browser (need ArrayBuffer & Uint8Array)",40020,400);try{var L=A.baseEncodedPreviousPayload;typeof L=="string"&&(L=s.default.BufferUtils.utf8Encode(L)),L=s.default.BufferUtils.toBuffer(L),l=s.default.BufferUtils.toBuffer(l),l=s.default.BufferUtils.typedArrayToBuffer(A.plugins.vcdiff.decode(l,L)),y=l}catch(D){throw new C.default("Vcdiff delta decode failed with "+D,40018,400)}continue;default:throw new Error("Unknown encoding")}}}catch(D){var _=D;throw new C.default("Error processing the "+i+" encoding, decoder returned ‘"+_.message+"’",_.code||40013,400)}finally{m.encoding=u<=0?null:v.slice(0,u).join("/"),m.data=l}}A.baseEncodedPreviousPayload=y},a.fromResponseBody=function(m,S,A){A&&(m=T.decodeBody(m,A));for(var y=0;y<m.length;y++){var p=m[y]=a.fromValues(m[y]);try{a.decode(p,S)}catch(v){O.default.logAction(O.default.LOG_ERROR,"Message.fromResponseBody()",v.toString())}}return m},a.fromValues=function(m){return Object.assign(new a,m)},a.fromValuesArray=function(m){for(var S=m.length,A=new Array(S),y=0;y<S;y++)A[y]=a.fromValues(m[y]);return A},a.fromEncoded=function(m,S){var A=a.fromValues(m),y=M(S??null);try{a.decode(A,y)}catch(p){O.default.logAction(O.default.LOG_ERROR,"Message.fromEncoded()",p.toString())}return A},a.fromEncodedArray=function(m,S){return m.map(function(A){return a.fromEncoded(A,S)})},a.getMessagesSize=function(m){for(var S,A=0,y=0;y<m.length;y++)S=m[y],A+=S.size||(S.size=R(S));return A},a.serialize=T.encodeBody,a}();e.default=b},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0});var f=o(0),s=f.__importStar(o(1)),O=f.__importDefault(o(4)),C=f.__importDefault(o(9)),T=f.__importDefault(o(16)),x={HEARTBEAT:0,ACK:1,NACK:2,CONNECT:3,CONNECTED:4,DISCONNECT:5,DISCONNECTED:6,CLOSE:7,CLOSED:8,ERROR:9,ATTACH:10,ATTACHED:11,DETACH:12,DETACHED:13,PRESENCE:14,MESSAGE:15,SYNC:16,AUTH:17,ACTIVATE:18},M=[];Object.keys(x).forEach(function(A){M[x[A]]=A});var R={HAS_PRESENCE:1,HAS_BACKLOG:2,RESUMED:4,TRANSIENT:16,ATTACH_RESUME:32,PRESENCE:65536,PUBLISH:1<<17,SUBSCRIBE:1<<18,PRESENCE_SUBSCRIBE:1<<19},b=Object.keys(R);R.MODE_ALL=R.PRESENCE|R.PUBLISH|R.SUBSCRIBE|R.PRESENCE_SUBSCRIBE;function a(A){var y=[];if(A)for(var p=0;p<A.length;p++)y.push(A[p].toString());return"[ "+y.join(", ")+" ]"}var m="id channel channelSerial connectionId count msgSerial timestamp".split(" "),S=function(){function A(){var y=this;this.hasFlag=function(p){return(y.flags&R[p])>0}}return A.prototype.setFlag=function(y){return this.flags=this.flags|R[y]},A.prototype.getMode=function(){return this.flags&&this.flags&R.MODE_ALL},A.prototype.encodeModesToFlags=function(y){var p=this;y.forEach(function(v){return p.setFlag(v)})},A.prototype.decodeModesFromFlags=function(){var y=this,p=[];return A.channelModes.forEach(function(v){y.hasFlag(v)&&p.push(v)}),p.length>0?p:void 0},A.fromValues=function(y){return Object.assign(new A,y)},A.Action=x,A.channelModes=["PRESENCE","PUBLISH","SUBSCRIBE","PRESENCE_SUBSCRIBE"],A.ActionName=M,A.serialize=s.encodeBody,A.deserialize=function(y,p){var v=s.decodeBody(y,p);return A.fromDeserialized(v)},A.fromDeserialized=function(y){var p=y.error;p&&(y.error=O.default.fromValues(p));var v=y.messages;if(v)for(var u=0;u<v.length;u++)v[u]=C.default.fromValues(v[u]);var c=y.presence;if(c)for(var u=0;u<c.length;u++)c[u]=T.default.fromValues(c[u],!0);return Object.assign(new A,y)},A.stringify=function(y){var p="[ProtocolMessage";y.action!==void 0&&(p+="; action="+A.ActionName[y.action]||!1);for(var v,u=0;u<m.length;u++)v=m[u],y[v]!==void 0&&(p+="; "+v+"="+y[v]);if(y.messages&&(p+="; messages="+a(C.default.fromValuesArray(y.messages))),y.presence&&(p+="; presence="+a(T.default.fromValuesArray(y.presence))),y.error&&(p+="; error="+O.default.fromValues(y.error).toString()),y.auth&&y.auth.accessToken&&(p+="; token="+y.auth.accessToken),y.flags&&(p+="; flags="+b.filter(y.hasFlag).join(",")),y.params){var c="";s.forInOwnNonNullProperties(y.params,function(l){c.length>0&&(c+="; "),c+=l+"="+y.params[l]}),c.length>0&&(p+="; params=["+c+"]")}return p+="]",p},A}();e.default=S},function(n,e,o){(function(f,s){n.exports=s(o(6))})(this,function(f){return function(){var s=f,O=s.lib,C=O.WordArray,T=s.enc;T.Base64={stringify:function(M){var R=M.words,b=M.sigBytes,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";M.clamp();for(var m=[],S=0;S<b;S+=3)for(var A=R[S>>>2]>>>24-S%4*8&255,y=R[S+1>>>2]>>>24-(S+1)%4*8&255,p=R[S+2>>>2]>>>24-(S+2)%4*8&255,v=A<<16|y<<8|p,u=0;u<4&&S+u*.75<b;u++)m.push(a.charAt(v>>>6*(3-u)&63));var c=a.charAt(64);if(c)for(;m.length%4;)m.push(c);return m.join("")},parse:function(M){var R=M.length,b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a=this._reverseMap;if(!a){a=this._reverseMap=[];for(var m=0;m<b.length;m++)a[b.charCodeAt(m)]=m}var S=b.charAt(64);if(S){var A=M.indexOf(S);A!==-1&&(R=A)}return x(M,R,a)}};function x(M,R,b){for(var a=[],m=0,S=0;S<R;S++)if(S%4){var A=b[M.charCodeAt(S-1)]<<S%4*2,y=b[M.charCodeAt(S)]>>>6-S%4*2,p=A|y;a[m>>>2]|=p<<24-m%4*8,m++}return C.create(a,m)}}(),f.enc.Base64})},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0});var f=o(0),s=f.__importStar(o(1)),O=f.__importDefault(o(10)),C=f.__importDefault(o(26)),T=f.__importDefault(o(2)),x=f.__importDefault(o(8)),M=f.__importDefault(o(21)),R=f.__importDefault(o(18)),b=f.__importDefault(o(4)),a=f.__importDefault(o(22)),m=f.__importDefault(o(3));function S(p){var v=[80015,80017,80030];return p.code?R.default.isTokenErr(p)?!1:s.arrIn(v,p.code)?!0:p.code>=4e4&&p.code<5e4:!1}function A(p){return S(p)?[O.default.fromValues({action:O.default.Action.ERROR,error:p})]:[O.default.fromValues({action:O.default.Action.DISCONNECTED,error:p})]}var y=function(p){f.__extends(v,p);function v(u,c,l){var i=p.call(this,u,c,l,!0)||this;return i.onAuthUpdated=function(h){i.authParams={access_token:h.token}},i.stream="stream"in l?l.stream:!0,i.sendRequest=null,i.recvRequest=null,i.pendingCallback=null,i.pendingItems=null,i}return v.prototype.connect=function(){var u=this;T.default.logAction(T.default.LOG_MINOR,"CometTransport.connect()","starting"),C.default.prototype.connect.call(this);var c=this.params,l=c.options,i=x.default.getHost(l,c.host),h=x.default.getPort(l),d=l.tls?"https://":"http://";this.baseUri=d+i+":"+h+"/comet/";var g=this.baseUri+"connect";T.default.logAction(T.default.LOG_MINOR,"CometTransport.connect()","uri: "+g),this.auth.getAuthParams(function(L,_){if(L){u.disconnect(L);return}if(!u.isDisposed){u.authParams=_;var D=u.params.getConnectParams(_);"stream"in D&&(u.stream=D.stream),T.default.logAction(T.default.LOG_MINOR,"CometTransport.connect()","connectParams:"+s.toQueryString(D));var I=!1,P=u.recvRequest=u.createRequest(g,null,D,null,u.stream?a.default.REQ_RECV_STREAM:a.default.REQ_RECV);P.on("data",function(w){u.recvRequest&&(I||(I=!0,u.emit("preconnect")),u.onData(w))}),P.on("complete",function(w){if(u.recvRequest||(w=w||new b.default("Request cancelled",80003,400)),u.recvRequest=null,!I&&!w&&(I=!0,u.emit("preconnect")),u.onActivity(),w){w.code?u.onData(A(w)):u.disconnect(w);return}m.default.Config.nextTick(function(){u.recv()})}),P.exec()}})},v.prototype.requestClose=function(){T.default.logAction(T.default.LOG_MINOR,"CometTransport.requestClose()"),this._requestCloseOrDisconnect(!0)},v.prototype.requestDisconnect=function(){T.default.logAction(T.default.LOG_MINOR,"CometTransport.requestDisconnect()"),this._requestCloseOrDisconnect(!1)},v.prototype._requestCloseOrDisconnect=function(u){var c=this,l=u?this.closeUri:this.disconnectUri;if(l){var i=this.createRequest(l,null,this.authParams,null,a.default.REQ_SEND);i.on("complete",function(h){h&&(T.default.logAction(T.default.LOG_ERROR,"CometTransport.request"+(u?"Close()":"Disconnect()"),"request returned err = "+s.inspectError(h)),c.finish("disconnected",h))}),i.exec()}},v.prototype.dispose=function(){var u=this;T.default.logAction(T.default.LOG_MINOR,"CometTransport.dispose()",""),this.isDisposed||(this.isDisposed=!0,this.recvRequest&&(T.default.logAction(T.default.LOG_MINOR,"CometTransport.dispose()","aborting recv request"),this.recvRequest.abort(),this.recvRequest=null),this.finish("disconnected",M.default.disconnected()),m.default.Config.nextTick(function(){u.emit("disposed")}))},v.prototype.onConnect=function(u){var c;if(!this.isDisposed){var l=(c=u.connectionDetails)===null||c===void 0?void 0:c.connectionKey;C.default.prototype.onConnect.call(this,u);var i=this.baseUri+l;T.default.logAction(T.default.LOG_MICRO,"CometTransport.onConnect()","baseUri = "+i),this.sendUri=i+"/send",this.recvUri=i+"/recv",this.closeUri=i+"/close",this.disconnectUri=i+"/disconnect"}},v.prototype.send=function(u){if(this.sendRequest){this.pendingItems=this.pendingItems||[],this.pendingItems.push(u);return}var c=this.pendingItems||[];c.push(u),this.pendingItems=null,this.sendItems(c)},v.prototype.sendAnyPending=function(){var u=this.pendingItems;u&&(this.pendingItems=null,this.sendItems(u))},v.prototype.sendItems=function(u){var c=this,l=this.sendRequest=this.createRequest(this.sendUri,null,this.authParams,this.encodeRequest(u),a.default.REQ_SEND);l.on("complete",function(i,h){if(i&&T.default.logAction(T.default.LOG_ERROR,"CometTransport.sendItems()","on complete: err = "+s.inspectError(i)),c.sendRequest=null,i){i.code?c.onData(A(i)):c.disconnect(i);return}h&&c.onData(h),c.pendingItems&&m.default.Config.nextTick(function(){c.sendRequest||c.sendAnyPending()})}),l.exec()},v.prototype.recv=function(){var u=this;if(!this.recvRequest&&this.isConnected){var c=this.recvRequest=this.createRequest(this.recvUri,null,this.authParams,null,this.stream?a.default.REQ_RECV_STREAM:a.default.REQ_RECV_POLL);c.on("data",function(l){u.onData(l)}),c.on("complete",function(l){if(u.recvRequest=null,u.onActivity(),l){l.code?u.onData(A(l)):u.disconnect(l);return}m.default.Config.nextTick(function(){u.recv()})}),c.exec()}},v.prototype.onData=function(u){try{var c=this.decodeResponse(u);if(c&&c.length)for(var l=0;l<c.length;l++)this.onProtocolMessage(O.default.fromDeserialized(c[l]))}catch(i){T.default.logAction(T.default.LOG_ERROR,"CometTransport.onData()","Unexpected exception handing channel event: "+i.stack)}},v.prototype.encodeRequest=function(u){return JSON.stringify(u)},v.prototype.decodeResponse=function(u){return typeof u=="string"?JSON.parse(u):u},v}(C.default);e.default=y},function(n,e){var o;o=function(){return this}();try{o=o||new Function("return this")()}catch{typeof window=="object"&&(o=window)}n.exports=o},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0}),e.isSuccessCode=void 0;var f;(function(O){O[O.Success=200]="Success",O[O.NoContent=204]="NoContent",O[O.BadRequest=400]="BadRequest",O[O.Unauthorized=401]="Unauthorized",O[O.Forbidden=403]="Forbidden",O[O.RequestTimeout=408]="RequestTimeout",O[O.InternalServerError=500]="InternalServerError"})(f||(f={}));function s(O){return O>=f.Success&&O<f.BadRequest}e.isSuccessCode=s,e.default=f},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0});var f=o(0),s=f.__importDefault(o(3)),O=f.__importStar(o(1)),C=f.__importDefault(o(2)),T=f.__importDefault(o(18)),x=f.__importDefault(o(19)),M=o(4),R=f.__importDefault(o(14));function b(p,v,u,c,l){p.http.supportsAuthHeaders?p.auth.getAuthHeaders(function(i,h){i?c(i):l(O.mixin(h,v),u)}):p.auth.getAuthParams(function(i,h){i?c(i):l(v,O.mixin(h,u))})}function a(p,v){return function(u,c,l,i,h){if(u&&!c){p(u);return}if(h===R.default.NoContent){p(u,[],l,!0,h);return}if(!i)try{c=O.decodeBody(c,v)}catch(I){O.isErrorInfoOrPartialErrorInfo(I)?p(I):p(new M.PartialErrorInfo(O.inspectError(I),null));return}if(!c){p(new M.PartialErrorInfo("unenvelope(): Response body is missing",null));return}var d=c,g=d.statusCode,L=d.response,_=d.headers;if(g===void 0){p(u,c,l,!0,h);return}if(g<200||g>=300){var D=L&&L.error||u;D||(D=new Error("Error in unenveloping "+c),D.statusCode=g),p(D,L,_,!0,g);return}p(u,L,_,!0,g)}}function m(p){var v=[];if(p)for(var u in p)v.push(u+"="+p[u]);return v.join("&")}function S(p,v){return p+(v?"?":"")+m(v)}function A(p,v,u,c){return function(l,i,h,d,g){l?C.default.logAction(C.default.LOG_MICRO,"Resource."+v+"()","Received Error; "+S(u,c)+"; Error: "+O.inspectError(l)):C.default.logAction(C.default.LOG_MICRO,"Resource."+v+"()","Received; "+S(u,c)+"; Headers: "+m(h)+"; StatusCode: "+g+"; Body: "+(s.default.BufferUtils.isBuffer(i)?i.toString():i)),p&&p(l,i,h,d,g)}}var y=function(){function p(){}return p.get=function(v,u,c,l,i,h){p.do(x.default.Get,v,u,null,c,l,i,h)},p.delete=function(v,u,c,l,i,h){p.do(x.default.Delete,v,u,null,c,l,i,h)},p.post=function(v,u,c,l,i,h,d){p.do(x.default.Post,v,u,c,l,i,h,d)},p.patch=function(v,u,c,l,i,h,d){p.do(x.default.Patch,v,u,c,l,i,h,d)},p.put=function(v,u,c,l,i,h,d){p.do(x.default.Put,v,u,c,l,i,h,d)},p.do=function(v,u,c,l,i,h,d,g){C.default.shouldLog(C.default.LOG_MICRO)&&(g=A(g,v,c,h)),d&&(g=g&&a(g,d),(h=h||{}).envelope=d);function L(_,D){var I;if(C.default.shouldLog(C.default.LOG_MICRO)&&C.default.logAction(C.default.LOG_MICRO,"Resource."+v+"()","Sending; "+S(c,D)),C.default.shouldLog(C.default.LOG_MICRO)){var P=l;if(((I=_["content-type"])===null||I===void 0?void 0:I.indexOf("msgpack"))>0)try{P=s.default.Config.msgpack.decode(l)}catch(w){C.default.logAction(C.default.LOG_MICRO,"Resource."+v+"()","Sending MsgPack Decoding Error: "+O.inspectError(w))}C.default.logAction(C.default.LOG_MICRO,"Resource."+v+"()","Sending; "+S(c,D)+"; Body: "+P)}u.http.do(v,u,c,_,l,D,function(w,U,j,G,z){if(w&&T.default.isTokenErr(w)){u.auth.authorize(null,null,function(W){if(W){g(W);return}b(u,_,D,g,L)});return}g(w,U,j,G,z)})}b(u,i,h,g,L)},p}();e.default=y},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0});var f=o(0),s=f.__importDefault(o(2)),O=f.__importDefault(o(3)),C=f.__importDefault(o(9)),T=f.__importStar(o(1));function x(R){return M.Actions.indexOf(R)}var M=function(){function R(){}return R.prototype.isSynthesized=function(){return!this.id||!this.connectionId?!0:this.id.substring(this.connectionId.length,0)!==this.connectionId},R.prototype.parseId=function(){if(!this.id)throw new Error("parseId(): Presence message does not contain an id");var b=this.id.split(":");return{connectionId:b[0],msgSerial:parseInt(b[1],10),index:parseInt(b[2],10)}},R.prototype.toJSON=function(){var b=this.data,a=this.encoding;return b&&O.default.BufferUtils.isBuffer(b)&&(arguments.length>0?(a=a?a+"/base64":"base64",b=O.default.BufferUtils.base64Encode(b)):b=O.default.BufferUtils.toBuffer(b)),{id:this.id,clientId:this.clientId,action:x(this.action),data:b,encoding:a,extras:this.extras}},R.prototype.toString=function(){var b="[PresenceMessage";return b+="; action="+this.action,this.id&&(b+="; id="+this.id),this.timestamp&&(b+="; timestamp="+this.timestamp),this.clientId&&(b+="; clientId="+this.clientId),this.connectionId&&(b+="; connectionId="+this.connectionId),this.encoding&&(b+="; encoding="+this.encoding),this.data&&(typeof this.data=="string"?b+="; data="+this.data:O.default.BufferUtils.isBuffer(this.data)?b+="; data (buffer)="+O.default.BufferUtils.base64Encode(this.data):b+="; data (json)="+JSON.stringify(this.data)),this.extras&&(b+="; extras="+JSON.stringify(this.extras)),b+="]",b},R.fromResponseBody=function(b,a,m){var S=[];m&&(b=T.decodeBody(b,m));for(var A=0;A<b.length;A++){var y=S[A]=R.fromValues(b[A],!0);try{R.decode(y,a)}catch(p){s.default.logAction(s.default.LOG_ERROR,"PresenceMessage.fromResponseBody()",p.toString())}}return S},R.fromValues=function(b,a){return a&&(b.action=R.Actions[b.action]),Object.assign(new R,b)},R.fromValuesArray=function(b){for(var a=b.length,m=new Array(a),S=0;S<a;S++)m[S]=R.fromValues(b[S]);return m},R.fromEncoded=function(b,a){var m=R.fromValues(b,!0);try{R.decode(m,a??{})}catch(S){s.default.logAction(s.default.LOG_ERROR,"PresenceMessage.fromEncoded()",S.toString())}return m},R.fromEncodedArray=function(b,a){return b.map(function(m){return R.fromEncoded(m,a)})},R.fromData=function(b){return b instanceof R?b:R.fromValues({data:b})},R.Actions=["absent","present","enter","leave","update"],R.encode=C.default.encode,R.decode=C.default.decode,R.getMessagesSize=C.default.getMessagesSize,R}();e.default=M},function(n,e,o){(function(f){Object.defineProperty(e,"__esModule",{value:!0});var s=o(0),O=s.__importStar(o(1)),C=s.__importDefault(o(7)),T=s.__importStar(o(4)),x=s.__importDefault(o(2)),M=s.__importDefault(o(8)),R=s.__importDefault(o(22)),b=s.__importDefault(o(3));function a(d,g){return O.arrIn(O.allToLowerCase(O.keysArray(g)),"x-ably-errorcode")}function m(d,g){if(a(d,g))return d.error&&T.default.fromValues(d.error)}var S=function(){},A=0,y={},p=typeof f<"u"&&f.XDomainRequest;function v(){var d=navigator.userAgent.toString().match(/MSIE\s([\d.]+)/);return d&&Number(d[1])}function u(){var d;return p&&(d=v())&&d===10}function c(d,g){return d.getResponseHeader&&d.getResponseHeader(g)}function l(d){return d.getResponseHeader&&(d.getResponseHeader("transfer-encoding")||!d.getResponseHeader("content-length"))}function i(d){for(var g=O.trim(d.getAllResponseHeaders()).split(`\r
`),L={},_=0;_<g.length;_++){var D=g[_].split(":").map(O.trim);L[D[0].toLowerCase()]=D[1]}return L}var h=function(d){s.__extends(g,d);function g(L,_,D,I,P,w,U){var j=d.call(this)||this;return D=D||{},D.rnd=O.cheapRandStr(),u()&&!D.envelope&&(D.envelope="json"),j.uri=L+O.toQueryString(D),j.headers=_||{},j.body=I,j.method=U?U.toUpperCase():O.isEmptyArg(I)?"GET":"POST",j.requestMode=P,j.timeouts=w,j.timedOut=!1,j.requestComplete=!1,j.id=String(++A),y[j.id]=j,j}return g.createRequest=function(L,_,D,I,P,w,U){var j=w||M.default.TIMEOUTS;return new g(L,_,O.copy(D),I,P,j,U)},g.prototype.complete=function(L,_,D,I,P){this.requestComplete||(this.requestComplete=!0,!L&&_&&this.emit("data",_),this.emit("complete",L,_,D,I,P),this.dispose())},g.prototype.abort=function(){this.dispose()},g.prototype.exec=function(){var L=this,_=this.headers,D=this.requestMode==R.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout,I=this.timer=setTimeout(function(){L.timedOut=!0,w.abort()},D),P=this.method,w=this.xhr=new XMLHttpRequest,U=_.accept,j=this.body,G="text";if(U?U.indexOf("application/x-msgpack")===0&&(G="arraybuffer"):_.accept="application/json",j){var z=_["content-type"]||(_["content-type"]="application/json");z.indexOf("application/json")>-1&&typeof j!="string"&&(j=JSON.stringify(j))}w.open(P,this.uri,!0),w.responseType=G,"authorization"in _&&(w.withCredentials=!0);for(var W in _)w.setRequestHeader(W,_[W]);var F=function(Q,oe,ce,fe){var ae,Re=oe+" (event type: "+Q.type+")";!((ae=L==null?void 0:L.xhr)===null||ae===void 0)&&ae.statusText&&(Re+=", current statusText is "+L.xhr.statusText),x.default.logAction(x.default.LOG_ERROR,"Request.on"+Q.type+"()",Re),L.complete(new T.PartialErrorInfo(Re,ce,fe))};w.onerror=function(Q){F(Q,"XHR error occurred",null,400)},w.onabort=function(Q){L.timedOut?F(Q,"Request aborted due to request timeout expiring",null,408):F(Q,"Request cancelled",null,400)},w.ontimeout=function(Q){F(Q,"Request timed out",null,408)};var E,N,B,k=0,V=!1,K=function(){if(clearTimeout(I),B=N<400,N==204){L.complete(null,null,null,null,N);return}E=L.requestMode==R.default.REQ_RECV_STREAM&&B&&l(w)},J=function(){var Q;try{var oe=c(w,"content-type"),ce=oe?oe.indexOf("application/json")>=0:w.responseType=="text";if(ce){var fe=w.responseType==="arraybuffer"?b.default.BufferUtils.utf8Decode(w.response):String(w.responseText);fe.length?Q=JSON.parse(fe):Q=fe,V=!0}else Q=w.response;Q.response!==void 0?(N=Q.statusCode,B=N<400,_=Q.headers,Q=Q.response):_=i(w)}catch(Re){L.complete(new T.PartialErrorInfo("Malformed response body from server: "+Re.message,null,400));return}if(B||O.isArray(Q)){L.complete(null,Q,_,V,N);return}var ae=m(Q,_);ae||(ae=new T.PartialErrorInfo("Error response received from server: "+N+" body was: "+b.default.Config.inspect(Q),null,N)),L.complete(ae,Q,_,V,N)};function Z(){for(var Q=w.responseText,oe=Q.length-1,ce,fe;k<oe&&(ce=Q.indexOf(`
`,k))>-1;)fe=Q.slice(k,ce),k=ce+1,ee(fe)}var ee=function(Q){try{Q=JSON.parse(Q)}catch(oe){L.complete(new T.PartialErrorInfo("Malformed response body from server: "+oe.message,null,400));return}L.emit("data",Q)},re=function(){Z(),L.streamComplete=!0,b.default.Config.nextTick(function(){L.complete()})};w.onreadystatechange=function(){var Q=w.readyState;Q<3||w.status!==0&&(N===void 0&&(N=w.status,N===1223&&(N=204),K()),Q==3&&E?Z():Q==4&&(E?re():J()))},w.send(j)},g.prototype.dispose=function(){var L=this.xhr;if(L){L.onreadystatechange=L.onerror=L.onabort=L.ontimeout=S,this.xhr=null;var _=this.timer;_&&(clearTimeout(_),this.timer=null),this.requestComplete||L.abort()}delete y[this.id]},g}(C.default);e.default=h}).call(this,o(13))},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0});var f=o(0),s=f.__importDefault(o(2)),O=f.__importStar(o(1)),C=f.__importDefault(o(24)),T=f.__importDefault(o(4)),x=f.__importDefault(o(45)),M=o(11),R=f.__importDefault(o(19)),b=f.__importDefault(o(14)),a=f.__importDefault(o(3)),m=f.__importDefault(o(15)),S=Math.pow(2,17);function A(){}function y(){return("000000"+Math.floor(Math.random()*1e16)).slice(-16)}function p(D){return!!D.connection}function v(D){return O.isErrorInfoOrPartialErrorInfo(D)?(D.code||(D.statusCode===403?D.code=40300:(D.code=40170,D.statusCode=401)),D):new T.default(O.inspectError(D),D.code||40170,D.statusCode||401)}var u=function(D,I){if(a.default.Config.createHmac){var P=a.default.Config.createHmac("SHA256",I);return P.update(D),P.digest("base64")}return(0,M.stringify)((0,x.default)(D,I))};function c(D){if(!D)return"";typeof D=="string"&&(D=JSON.parse(D));var I=Object.create(null),P=O.keysArray(D,!0);if(!P)return"";P.sort();for(var w=0;w<P.length;w++)I[P[w]]=D[P[w]].sort();return JSON.stringify(I)}function l(D){if(D.authCallback)s.default.logAction(s.default.LOG_MINOR,"Auth()","using token auth with authCallback");else if(D.authUrl)s.default.logAction(s.default.LOG_MINOR,"Auth()","using token auth with authUrl");else if(D.key)s.default.logAction(s.default.LOG_MINOR,"Auth()","using token auth with client-side signing");else if(D.tokenDetails)s.default.logAction(s.default.LOG_MINOR,"Auth()","using token auth with supplied token only");else{var I="authOptions must include valid authentication parameters";throw s.default.logAction(s.default.LOG_ERROR,"Auth()",I),new Error(I)}}function i(D){return"useTokenAuth"in D&&!D.useTokenAuth}function h(D){return D.useTokenAuth||!i(D)&&(D.authCallback||D.authUrl||D.token||D.tokenDetails)}function d(D){return!D.key&&!D.authCallback&&!D.authUrl}var g=0;function L(){return g++}var _=function(){function D(I,P){if(this.authOptions={},this.client=I,this.tokenParams=P.defaultTokenParams||{},this.currentTokenRequestId=null,this.waitingForTokenRequest=null,h(P)){if(P.key&&!u){var w="client-side token request signing not supported";throw s.default.logAction(s.default.LOG_ERROR,"Auth()",w),new Error(w)}d(P)&&s.default.logAction(s.default.LOG_ERROR,"Auth()","Warning: library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),this._saveTokenOptions(P.defaultTokenParams,P),l(this.authOptions)}else{if(!P.key){var w="No authentication options provided; need one of: key, authUrl, or authCallback (or for testing only, token or tokenDetails)";throw s.default.logAction(s.default.LOG_ERROR,"Auth()",w),new T.default(w,40160,401)}s.default.logAction(s.default.LOG_MINOR,"Auth()","anonymous, using basic auth"),this._saveBasicOptions(P)}}return D.prototype.authorize=function(I,P,w){var U=this,j;if(typeof I=="function"&&!w?(w=I,j=I=null):typeof P=="function"&&!w?(w=P,j=null):j=P,!w&&this.client.options.promises)return O.promisify(this,"authorize",arguments);if(j&&j.key&&this.authOptions.key!==j.key)throw new T.default("Unable to update auth options with incompatible key",40102,401);j&&"force"in j&&(s.default.deprecated("The `force` auth option","If you’re using this option to force `authorize()` to fetch a new token even if the current token has not expired, this is no longer necessary, as `authorize()` now always fetches a new token. Update your code to no longer pass the `force` auth option. Note that, in general, passing an auth options argument to `authorize()` will overwrite the library’s stored auth options, which may not be what you want. The library currently contains a special case behavior where passing an auth options object which only contains `{ force: true }` will _not_ overwrite the stored options. This special case behavior will be removed alongside support for the `force` option, so if you’re currently passing `authorize()` an auth options object which only contains `{ force: true }`, you should stop passing it an auth options object entirely."),O.isOnlyPropIn(j,"force")&&(j=null)),this._forceNewToken(I,j,function(G,z){if(G){U.client.connection&&G.statusCode===b.default.Forbidden&&U.client.connection.connectionManager.actOnErrorFromAuthorize(G),w==null||w(G);return}p(U.client)?U.client.connection.connectionManager.onAuthUpdated(z,w||A):w==null||w(null,z)})},D.prototype.authorise=function(I,P,w){s.default.renamedMethod("Auth","authorise","authorize"),this.authorize(I,P,w)},D.prototype._forceNewToken=function(I,P,w){var U=this;this.tokenDetails=null,this._saveTokenOptions(I,P),l(this.authOptions),this._ensureValidAuthCredentials(!0,function(j,G){delete U.tokenParams.timestamp,delete U.authOptions.queryTime,w(j,G)})},D.prototype.requestToken=function(I,P,w){var U=this;if(typeof I=="function"&&!w?(w=I,P=I=null):typeof P=="function"&&!w&&(w=P,P=null),!w&&this.client.options.promises)return O.promisify(this,"requestToken",arguments);P=P||this.authOptions,I=I||O.copy(this.tokenParams);var j=w||A,G,z=this.client;if(P.authCallback)s.default.logAction(s.default.LOG_MINOR,"Auth.requestToken()","using token auth with authCallback"),G=P.authCallback;else if(P.authUrl)s.default.logAction(s.default.LOG_MINOR,"Auth.requestToken()","using token auth with authUrl"),G=function(k,V){var K=O.mixin({accept:"application/json, text/plain"},P.authHeaders),J=P.authMethod&&P.authMethod.toLowerCase()==="post",Z,ee=P.authUrl.indexOf("?");ee>-1&&(Z=O.parseQueryString(P.authUrl.slice(ee)),P.authUrl=P.authUrl.slice(0,ee),J||(P.authParams=O.mixin(Z,P.authParams)));var re=O.mixin({},P.authParams||{},k),Q=function(fe,ae,Re,Ge){var ge;if(fe?s.default.logAction(s.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received Error: "+O.inspectError(fe)):(ge=Re["content-type"],s.default.logAction(s.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received; content-type: "+ge+"; body: "+O.inspectBody(ae))),fe||Ge)return V(fe,ae);if(a.default.BufferUtils.isBuffer(ae)&&(ae=ae.toString()),!ge){V(new T.default("authUrl response is missing a content-type header",40170,401));return}var Fe=ge.indexOf("application/json")>-1,it=ge.indexOf("text/plain")>-1||ge.indexOf("application/jwt")>-1;if(!Fe&&!it){V(new T.default("authUrl responded with unacceptable content-type "+ge+", should be either text/plain, application/jwt or application/json",40170,401));return}if(Fe){if(ae.length>S){V(new T.default("authUrl response exceeded max permitted length",40170,401));return}try{ae=JSON.parse(ae)}catch(ot){V(new T.default("Unexpected error processing authURL response; err = "+ot.message,40170,401));return}}V(null,ae,ge)};if(s.default.logAction(s.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Requesting token from "+P.authUrl+"; Params: "+JSON.stringify(re)+"; method: "+(J?"POST":"GET")),J){var oe=K||{};oe["content-type"]="application/x-www-form-urlencoded";var ce=O.toQueryString(re).slice(1);U.client.http.doUri(R.default.Post,z,P.authUrl,oe,ce,Z,Q)}else U.client.http.doUri(R.default.Get,z,P.authUrl,K||{},null,re,Q)};else if(P.key)s.default.logAction(s.default.LOG_MINOR,"Auth.requestToken()","using token auth with client-side signing"),G=function(k,V){U.createTokenRequest(k,P,V)};else{var W="Need a new token, but authOptions does not include any way to request one (no authUrl, authCallback, or key)";s.default.logAction(s.default.LOG_ERROR,"Auth()","library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),j(new T.default(W,40171,403));return}"capability"in I&&(I.capability=c(I.capability));var F=function(k,V){var K=k.keyName,J="/keys/"+K+"/requestToken",Z=function(re){return z.baseUri(re)+J},ee=O.defaultPostHeaders(U.client.options);P.requestHeaders&&O.mixin(ee,P.requestHeaders),s.default.logAction(s.default.LOG_MICRO,"Auth.requestToken().requestToken","Sending POST to "+J+"; Token params: "+JSON.stringify(k)),U.client.http.do(R.default.Post,z,Z,ee,JSON.stringify(k),null,V)},E=!1,N=this.client.options.timeouts.realtimeRequestTimeout,B=setTimeout(function(){E=!0;var k="Token request callback timed out after "+N/1e3+" seconds";s.default.logAction(s.default.LOG_ERROR,"Auth.requestToken()",k),j(new T.default(k,40170,401))},N);G(I,function(k,V,K){if(!E){if(clearTimeout(B),k){s.default.logAction(s.default.LOG_ERROR,"Auth.requestToken()","token request signing call returned error; err = "+O.inspectError(k)),j(v(k));return}if(typeof V=="string"){V.length===0?j(new T.default("Token string is empty",40170,401)):V.length>S?j(new T.default("Token string exceeded max permitted length (was "+V.length+" bytes)",40170,401)):V==="undefined"||V==="null"?j(new T.default("Token string was literal null/undefined",40170,401)):V[0]==="{"&&!(K&&K.indexOf("application/jwt")>-1)?j(new T.default("Token was double-encoded; make sure you're not JSON-encoding an already encoded token request or details",40170,401)):j(null,{token:V});return}if(typeof V!="object"){var J="Expected token request callback to call back with a token string or token request/details object, but got a "+typeof V;s.default.logAction(s.default.LOG_ERROR,"Auth.requestToken()",J),j(new T.default(J,40170,401));return}var Z=JSON.stringify(V).length;if(Z>S&&!P.suppressMaxLengthCheck){j(new T.default("Token request/details object exceeded max permitted stringified size (was "+Z+" bytes)",40170,401));return}if("issued"in V){j(null,V);return}if(!("keyName"in V)){var J="Expected token request callback to call back with a token string, token request object, or token details object";s.default.logAction(s.default.LOG_ERROR,"Auth.requestToken()",J),j(new T.default(J,40170,401));return}F(V,function(ee,re,Q,oe){if(ee){s.default.logAction(s.default.LOG_ERROR,"Auth.requestToken()","token request API call returned error; err = "+O.inspectError(ee)),j(v(ee));return}oe||(re=JSON.parse(re)),s.default.logAction(s.default.LOG_MINOR,"Auth.getToken()","token received"),j(null,re)})}})},D.prototype.createTokenRequest=function(I,P,w){var U=this;if(typeof I=="function"&&!w?(w=I,P=I=null):typeof P=="function"&&!w&&(w=P,P=null),!w&&this.client.options.promises)return O.promisify(this,"createTokenRequest",arguments);P=P||this.authOptions,I=I||O.copy(this.tokenParams);var j=P.key;if(!j){w(new T.default("No key specified",40101,403));return}var G=j.split(":"),z=G[0],W=G[1];if(!W){w(new T.default("Invalid key specified",40101,403));return}if(I.clientId===""){w(new T.default("clientId can’t be an empty string",40012,400));return}"capability"in I&&(I.capability=c(I.capability));var F=O.mixin({keyName:z},I),E=I.clientId||"",N=I.ttl||"",B=I.capability||"";(function(k){if(F.timestamp){k();return}U.getTimestamp(P&&P.queryTime,function(V,K){if(V){w(V);return}F.timestamp=K,k()})})(function(){var k=F.nonce||(F.nonce=y()),V=F.timestamp,K=F.keyName+`
`+N+`
`+B+`
`+E+`
`+V+`
`+k+`
`;F.mac=F.mac||u(K,W),s.default.logAction(s.default.LOG_MINOR,"Auth.getTokenRequest()","generated signed request"),w(null,F)})},D.prototype.getAuthParams=function(I){this.method=="basic"?I(null,{key:this.key}):this._ensureValidAuthCredentials(!1,function(P,w){if(P){I(P);return}if(!w)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");I(null,{access_token:w.token})})},D.prototype.getAuthHeaders=function(I){this.method=="basic"?I(null,{authorization:"Basic "+this.basicKey}):this._ensureValidAuthCredentials(!1,function(P,w){if(P){I(P);return}if(!w)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");I(null,{authorization:"Bearer "+O.toBase64(w.token)})})},D.prototype.getTimestamp=function(I,P){!this.isTimeOffsetSet()&&(I||this.authOptions.queryTime)?this.client.time(P):P(null,this.getTimestampUsingOffset())},D.prototype.getTimestampUsingOffset=function(){return O.now()+(this.client.serverTimeOffset||0)},D.prototype.isTimeOffsetSet=function(){return this.client.serverTimeOffset!==null},D.prototype._saveBasicOptions=function(I){this.method="basic",this.key=I.key,this.basicKey=O.toBase64(I.key),this.authOptions=I||{},"clientId"in I&&this._userSetClientId(I.clientId)},D.prototype._saveTokenOptions=function(I,P){this.method="token",I&&(this.tokenParams=I),P&&(P.token&&(P.tokenDetails=typeof P.token=="string"?{token:P.token}:P.token),P.tokenDetails&&(this.tokenDetails=P.tokenDetails),"clientId"in P&&this._userSetClientId(P.clientId),this.authOptions=P)},D.prototype._ensureValidAuthCredentials=function(I,P){var w=this,U=this.tokenDetails;if(U){if(this._tokenClientIdMismatch(U.clientId)){P(new T.default("Mismatch between clientId in token ("+U.clientId+") and current clientId ("+this.clientId+")",40102,403));return}if(!this.isTimeOffsetSet()||!U.expires||U.expires>=this.getTimestampUsingOffset()){s.default.logAction(s.default.LOG_MINOR,"Auth.getToken()","using cached token; expires = "+U.expires),P(null,U);return}s.default.logAction(s.default.LOG_MINOR,"Auth.getToken()","deleting expired token"),this.tokenDetails=null}if((this.waitingForTokenRequest||(this.waitingForTokenRequest=C.default.create())).push(P),!(this.currentTokenRequestId!==null&&!I)){var j=this.currentTokenRequestId=L();this.requestToken(this.tokenParams,this.authOptions,function(G,z){if(w.currentTokenRequestId>j){s.default.logAction(s.default.LOG_MINOR,"Auth._ensureValidAuthCredentials()","Discarding token request response; overtaken by newer one");return}w.currentTokenRequestId=null;var W=w.waitingForTokenRequest||A;if(w.waitingForTokenRequest=null,G){W(G);return}W(null,w.tokenDetails=z)})}},D.prototype._userSetClientId=function(I){if(typeof I=="string"||I===null){if(I==="*")throw new T.default('Can’t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, instantiate the library with {defaultTokenParams: {clientId: "*"}}), or if calling authorize(), pass it in as a tokenParam: authorize({clientId: "*"}, authOptions)',40012,400);var P=this._uncheckedSetClientId(I);if(P)throw P}else throw new T.default("clientId must be either a string or null",40012,400)},D.prototype._uncheckedSetClientId=function(I){if(this._tokenClientIdMismatch(I)){var P="Unexpected clientId mismatch: client has "+this.clientId+", requested "+I,w=new T.default(P,40102,401);return s.default.logAction(s.default.LOG_ERROR,"Auth._uncheckedSetClientId()",P),w}else return this.clientId=this.tokenParams.clientId=I,null},D.prototype._tokenClientIdMismatch=function(I){return!!(this.clientId&&this.clientId!=="*"&&I&&I!=="*"&&this.clientId!==I)},D.isTokenErr=function(I){return I.code&&I.code>=40140&&I.code<40150},D.prototype.revokeTokens=function(I,P,w){if(h(this.client.options))throw new T.default("Cannot revoke tokens when using token auth",40162,401);var U=this.client.options.keyName,j;if(typeof P=="function"?(w=P,j={}):j=P??{},w===void 0){if(this.client.options.promises)return O.promisify(this,"revokeTokens",[I,j]);w=A}var G=w,z=f.__assign({targets:I.map(function(N){return"".concat(N.type,":").concat(N.value)})},j),W=this.client.options.useBinaryProtocol?O.Format.msgpack:O.Format.json,F=O.defaultPostHeaders(this.client.options,W);this.client.options.headers&&O.mixin(F,this.client.options.headers);var E=O.encodeBody(z,W);m.default.post(this.client,"/keys/".concat(U,"/revokeTokens"),E,F,{newBatchResponse:"true"},null,function(N,B,k,V){if(N){G(N);return}var K=V?B:O.decodeBody(B,W);G(null,K)})},D}();e.default=_},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0});var f;(function(s){s.Get="get",s.Delete="delete",s.Post="post",s.Put="put",s.Patch="patch"})(f||(f={})),e.default=f},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0}),e.HttpPaginatedResponse=e.PaginatedResult=void 0;var f=o(0),s=f.__importStar(o(1)),O=f.__importDefault(o(2)),C=f.__importDefault(o(15)),T=f.__importDefault(o(14));function x(S){var A=S.match(/^\.\/(\w+)\?(.*)$/);return A&&A[2]&&s.parseQueryString(A[2])}function M(S){typeof S=="string"&&(S=S.split(","));for(var A={},y=0;y<S.length;y++){var p=S[y].match(/^\s*<(.+)>;\s*rel="(\w+)"$/);if(p){var v=x(p[1]);v&&(A[p[2]]=v)}}return A}function R(S,A,y){return!(y&&(A||typeof S.code=="number"))}var b=function(){function S(A,y,p,v,u,c){this.rest=A,this.path=y,this.headers=p,this.envelope=v??null,this.bodyHandler=u,this.useHttpPaginatedResponse=c||!1}return S.prototype.get=function(A,y){var p=this;C.default.get(this.rest,this.path,this.headers,A,this.envelope,function(v,u,c,l,i){p.handlePage(v,u,c,l,i,y)})},S.prototype.delete=function(A,y){var p=this;C.default.delete(this.rest,this.path,this.headers,A,this.envelope,function(v,u,c,l,i){p.handlePage(v,u,c,l,i,y)})},S.prototype.post=function(A,y,p){var v=this;C.default.post(this.rest,this.path,y,this.headers,A,this.envelope,function(u,c,l,i,h){p&&v.handlePage(u,c,l,i,h,p)})},S.prototype.put=function(A,y,p){var v=this;C.default.put(this.rest,this.path,y,this.headers,A,this.envelope,function(u,c,l,i,h){p&&v.handlePage(u,c,l,i,h,p)})},S.prototype.patch=function(A,y,p){var v=this;C.default.patch(this.rest,this.path,y,this.headers,A,this.envelope,function(u,c,l,i,h){p&&v.handlePage(u,c,l,i,h,p)})},S.prototype.handlePage=function(A,y,p,v,u,c){if(A&&R(A,y,this.useHttpPaginatedResponse)){O.default.logAction(O.default.LOG_ERROR,"PaginatedResource.handlePage()","Unexpected error getting resource: err = "+s.inspectError(A)),c==null||c(A);return}var l,i,h;try{l=u==T.default.NoContent?[]:this.bodyHandler(y,p||{},v)}catch(d){c==null||c(A||d);return}p&&(i=p.Link||p.link)&&(h=M(i)),this.useHttpPaginatedResponse?c(null,new m(this,l,p||{},u,h,A)):c(null,new a(this,l,h))},S}(),a=function(){function S(A,y,p){var v=this;this.resource=A,this.items=y;var u=this;p&&("first"in p&&(this.first=function(c){if(!c&&u.resource.rest.options.promises)return s.promisify(u,"first",[]);u.get(p.first,c)}),"current"in p&&(this.current=function(c){if(!c&&u.resource.rest.options.promises)return s.promisify(u,"current",[]);u.get(p.current,c)}),this.next=function(c){if(!c&&u.resource.rest.options.promises)return s.promisify(u,"next",[]);"next"in p?u.get(p.next,c):c(null,null)},this.hasNext=function(){return"next"in p},this.isLast=function(){var c;return!(!((c=v.hasNext)===null||c===void 0)&&c.call(v))})}return S.prototype.get=function(A,y){var p=this.resource;C.default.get(p.rest,p.path,p.headers,A,p.envelope,function(v,u,c,l,i){p.handlePage(v,u,c,l,i,y)})},S}();e.PaginatedResult=a;var m=function(S){f.__extends(A,S);function A(y,p,v,u,c,l){var i=S.call(this,y,p,c)||this;return i.statusCode=u,i.success=u<300&&u>=200,i.headers=v,i.errorCode=l&&l.code,i.errorMessage=l&&l.message,i}return A.prototype.toJSON=function(){return{items:this.items,statusCode:this.statusCode,success:this.success,headers:this.headers,errorCode:this.errorCode,errorMessage:this.errorMessage}},A}(a);e.HttpPaginatedResponse=m,e.default=b},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0}),e.isRetriable=void 0;var f=o(0),s=f.__importDefault(o(4)),O={DISCONNECTED:80003,SUSPENDED:80002,FAILED:8e4,CLOSING:80017,CLOSED:80017,UNKNOWN_CONNECTION_ERR:50002,UNKNOWN_CHANNEL_ERR:50001},C={disconnected:function(){return s.default.fromValues({statusCode:400,code:O.DISCONNECTED,message:"Connection to server temporarily unavailable"})},suspended:function(){return s.default.fromValues({statusCode:400,code:O.SUSPENDED,message:"Connection to server unavailable"})},failed:function(){return s.default.fromValues({statusCode:400,code:O.FAILED,message:"Connection failed or disconnected by server"})},closing:function(){return s.default.fromValues({statusCode:400,code:O.CLOSING,message:"Connection closing"})},closed:function(){return s.default.fromValues({statusCode:400,code:O.CLOSED,message:"Connection closed"})},unknownConnectionErr:function(){return s.default.fromValues({statusCode:500,code:O.UNKNOWN_CONNECTION_ERR,message:"Internal connection error"})},unknownChannelErr:function(){return s.default.fromValues({statusCode:500,code:O.UNKNOWN_CONNECTION_ERR,message:"Internal channel error"})}};function T(x){return!x.statusCode||!x.code||x.statusCode>=500?!0:Object.values(O).includes(x.code)}e.isRetriable=T,e.default=C},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0});var f;(function(s){s[s.REQ_SEND=0]="REQ_SEND",s[s.REQ_RECV=1]="REQ_RECV",s[s.REQ_RECV_POLL=2]="REQ_RECV_POLL",s[s.REQ_RECV_STREAM=3]="REQ_RECV_STREAM"})(f||(f={})),e.default=f},function(n,e,o){(function(f,s){n.exports=s(o(6),o(5),o(58),o(11),o(40),o(32),o(25),o(27),o(28),o(59),o(60))})(this,function(f){return f})},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0});var f=o(0),s=f.__importDefault(o(2)),O=function(){function C(T){this.members=T||[]}return C.prototype.call=function(){for(var T=[],x=0;x<arguments.length;x++)T[x]=arguments[x];for(var M=0,R=this.members;M<R.length;M++){var b=R[M];if(b)try{b.apply(void 0,T)}catch(a){s.default.logAction(s.default.LOG_ERROR,"Multicaster multiple callback handler","Unexpected exception: "+a+"; stack = "+a.stack)}}},C.prototype.push=function(){for(var T,x=[],M=0;M<arguments.length;M++)x[M]=arguments[M];(T=this.members).push.apply(T,x)},C.create=function(T){var x=new C(T);return Object.assign(function(){for(var M=[],R=0;R<arguments.length;R++)M[R]=arguments[R];return x.call.apply(x,M)},{push:function(M){return x.push(M)}})},C}();e.default=O},function(n,e,o){(function(f,s){n.exports=s(o(6))})(this,function(f){(function(){var s=f,O=s.lib,C=O.Base,T=s.enc,x=T.Utf8,M=s.algo;M.HMAC=C.extend({init:function(R,b){R=this._hasher=new R.init,typeof b=="string"&&(b=x.parse(b));var a=R.blockSize,m=a*4;b.sigBytes>m&&(b=R.finalize(b)),b.clamp();for(var S=this._oKey=b.clone(),A=this._iKey=b.clone(),y=S.words,p=A.words,v=0;v<a;v++)y[v]^=1549556828,p[v]^=909522486;S.sigBytes=A.sigBytes=m,this.reset()},reset:function(){var R=this._hasher;R.reset(),R.update(this._iKey)},update:function(R){return this._hasher.update(R),this},finalize:function(R){var b=this._hasher,a=b.finalize(R);b.reset();var m=b.finalize(this._oKey.clone().concat(a));return m}})})()})},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0});var f=o(0),s=f.__importDefault(o(10)),O=f.__importStar(o(1)),C=f.__importDefault(o(7)),T=f.__importDefault(o(2)),x=f.__importDefault(o(21)),M=f.__importDefault(o(4)),R=f.__importDefault(o(3)),b=s.default.Action,a=s.default.fromValues({action:b.CLOSE}),m=s.default.fromValues({action:b.DISCONNECT}),S=function(A){f.__extends(y,A);function y(p,v,u,c){var l=A.call(this)||this;return c&&(u.format=void 0,u.heartbeats=!0),l.connectionManager=p,p.registerProposedTransport(l),l.auth=v,l.params=u,l.timeouts=u.options.timeouts,l.format=u.format,l.isConnected=!1,l.isFinished=!1,l.isDisposed=!1,l.maxIdleInterval=null,l.idleTimer=null,l.lastActivity=null,l}return y.prototype.connect=function(){},y.prototype.close=function(){this.isConnected&&this.requestClose(),this.finish("closed",x.default.closed())},y.prototype.disconnect=function(p){this.isConnected&&this.requestDisconnect(),this.finish("disconnected",p||x.default.disconnected())},y.prototype.fail=function(p){this.isConnected&&this.requestDisconnect(),this.finish("failed",p||x.default.failed())},y.prototype.finish=function(p,v){var u;this.isFinished||(this.isFinished=!0,this.isConnected=!1,this.maxIdleInterval=null,clearTimeout((u=this.idleTimer)!==null&&u!==void 0?u:void 0),this.idleTimer=null,this.emit(p,v),this.dispose())},y.prototype.onProtocolMessage=function(p){switch(T.default.shouldLog(T.default.LOG_MICRO)&&T.default.logAction(T.default.LOG_MICRO,"Transport.onProtocolMessage()","received on "+this.shortName+": "+s.default.stringify(p)+"; connectionId = "+this.connectionManager.connectionId),this.onActivity(),p.action){case b.HEARTBEAT:T.default.logAction(T.default.LOG_MICRO,"Transport.onProtocolMessage()",this.shortName+" heartbeat; connectionId = "+this.connectionManager.connectionId),this.emit("heartbeat",p.id);break;case b.CONNECTED:this.onConnect(p),this.emit("connected",p.error,p.connectionId,p.connectionDetails,p);break;case b.CLOSED:this.onClose(p);break;case b.DISCONNECTED:this.onDisconnect(p);break;case b.ACK:this.emit("ack",p.msgSerial,p.count);break;case b.NACK:this.emit("nack",p.msgSerial,p.count,p.error);break;case b.SYNC:this.connectionManager.onChannelMessage(p,this);break;case b.ACTIVATE:break;case b.AUTH:this.auth.authorize(function(v){v&&T.default.logAction(T.default.LOG_ERROR,"Transport.onProtocolMessage()","Ably requested re-authentication, but unable to obtain a new token: "+O.inspectError(v))});break;case b.ERROR:if(T.default.logAction(T.default.LOG_MINOR,"Transport.onProtocolMessage()","received error action; connectionId = "+this.connectionManager.connectionId+"; err = "+R.default.Config.inspect(p.error)+(p.channel?", channel: "+p.channel:"")),p.channel===void 0){this.onFatalError(p);break}this.connectionManager.onChannelMessage(p,this);break;default:this.connectionManager.onChannelMessage(p,this)}},y.prototype.onConnect=function(p){if(this.isConnected=!0,!p.connectionDetails)throw new Error("Transport.onConnect(): Connect message recieved without connectionDetails");var v=p.connectionDetails.maxIdleInterval;v&&(this.maxIdleInterval=v+this.timeouts.realtimeRequestTimeout,this.onActivity())},y.prototype.onDisconnect=function(p){var v=p&&p.error;T.default.logAction(T.default.LOG_MINOR,"Transport.onDisconnect()","err = "+O.inspectError(v)),this.finish("disconnected",v)},y.prototype.onFatalError=function(p){var v=p&&p.error;T.default.logAction(T.default.LOG_MINOR,"Transport.onFatalError()","err = "+O.inspectError(v)),this.finish("failed",v)},y.prototype.onClose=function(p){var v=p&&p.error;T.default.logAction(T.default.LOG_MINOR,"Transport.onClose()","err = "+O.inspectError(v)),this.finish("closed",v)},y.prototype.requestClose=function(){T.default.logAction(T.default.LOG_MINOR,"Transport.requestClose()",""),this.send(a)},y.prototype.requestDisconnect=function(){T.default.logAction(T.default.LOG_MINOR,"Transport.requestDisconnect()",""),this.send(m)},y.prototype.ping=function(p){var v={action:s.default.Action.HEARTBEAT};p&&(v.id=p),this.send(s.default.fromValues(v))},y.prototype.dispose=function(){T.default.logAction(T.default.LOG_MINOR,"Transport.dispose()",""),this.isDisposed=!0,this.off()},y.prototype.onActivity=function(){this.maxIdleInterval&&(this.lastActivity=this.connectionManager.lastActivity=O.now(),this.setIdleTimer(this.maxIdleInterval+100))},y.prototype.setIdleTimer=function(p){var v=this;this.idleTimer||(this.idleTimer=setTimeout(function(){v.onIdleTimerExpire()},p))},y.prototype.onIdleTimerExpire=function(){if(!this.lastActivity||!this.maxIdleInterval)throw new Error("Transport.onIdleTimerExpire(): lastActivity/maxIdleInterval not set");this.idleTimer=null;var p=O.now()-this.lastActivity,v=this.maxIdleInterval-p;if(v<=0){var u="No activity seen from realtime in "+p+"ms; assuming connection has dropped";T.default.logAction(T.default.LOG_ERROR,"Transport.onIdleTimerExpire()",u),this.disconnect(new M.default(u,80003,408))}else this.setIdleTimer(v+100)},y.tryConnect=function(p,v,u,c,l){var i=new p(v,u,c),h,d=function(L){clearTimeout(h),l({event:this.event,error:L})},g=v.options.timeouts.realtimeRequestTimeout;h=setTimeout(function(){i.off(["preconnect","disconnected","failed"]),i.dispose(),d.call({event:"disconnected"},new M.default("Timeout waiting for transport to indicate itself viable",5e4,500))},g),i.on(["failed","disconnected"],d),i.on("preconnect",function(){T.default.logAction(T.default.LOG_MINOR,"Transport.tryConnect()","viable transport "+i),clearTimeout(h),i.off(["failed","disconnected"],d),l(null,i)}),i.connect()},y}(C.default);e.default=S},function(n,e,o){(function(f,s){n.exports=s(o(6),o(40),o(25))})(this,function(f){return function(){var s=f,O=s.lib,C=O.Base,T=O.WordArray,x=s.algo,M=x.MD5,R=x.EvpKDF=C.extend({cfg:C.extend({keySize:128/32,hasher:M,iterations:1}),init:function(b){this.cfg=this.cfg.extend(b)},compute:function(b,a){for(var m,S=this.cfg,A=S.hasher.create(),y=T.create(),p=y.words,v=S.keySize,u=S.iterations;p.length<v;){m&&A.update(m),m=A.update(b).finalize(a),A.reset();for(var c=1;c<u;c++)m=A.finalize(m),A.reset();y.concat(m)}return y.sigBytes=v*4,y}});s.EvpKDF=function(b,a,m){return R.create(m).compute(b,a)}}(),f.EvpKDF})},function(n,e,o){(function(f,s){n.exports=s(o(6),o(27))})(this,function(f){f.lib.Cipher||function(s){var O=f,C=O.lib,T=C.Base,x=C.WordArray,M=C.BufferedBlockAlgorithm,R=O.enc;R.Utf8;var b=R.Base64,a=O.algo,m=a.EvpKDF,S=C.Cipher=M.extend({cfg:T.extend(),createEncryptor:function(_,D){return this.create(this._ENC_XFORM_MODE,_,D)},createDecryptor:function(_,D){return this.create(this._DEC_XFORM_MODE,_,D)},init:function(_,D,I){this.cfg=this.cfg.extend(I),this._xformMode=_,this._key=D,this.reset()},reset:function(){M.reset.call(this),this._doReset()},process:function(_){return this._append(_),this._process()},finalize:function(_){_&&this._append(_);var D=this._doFinalize();return D},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function _(D){return typeof D=="string"?L:h}return function(D){return{encrypt:function(I,P,w){return _(P).encrypt(D,I,P,w)},decrypt:function(I,P,w){return _(P).decrypt(D,I,P,w)}}}}()});C.StreamCipher=S.extend({_doFinalize:function(){var _=this._process(!0);return _},blockSize:1});var A=O.mode={},y=C.BlockCipherMode=T.extend({createEncryptor:function(_,D){return this.Encryptor.create(_,D)},createDecryptor:function(_,D){return this.Decryptor.create(_,D)},init:function(_,D){this._cipher=_,this._iv=D}}),p=A.CBC=function(){var _=y.extend();_.Encryptor=_.extend({processBlock:function(I,P){var w=this._cipher,U=w.blockSize;D.call(this,I,P,U),w.encryptBlock(I,P),this._prevBlock=I.slice(P,P+U)}}),_.Decryptor=_.extend({processBlock:function(I,P){var w=this._cipher,U=w.blockSize,j=I.slice(P,P+U);w.decryptBlock(I,P),D.call(this,I,P,U),this._prevBlock=j}});function D(I,P,w){var U,j=this._iv;j?(U=j,this._iv=s):U=this._prevBlock;for(var G=0;G<w;G++)I[P+G]^=U[G]}return _}(),v=O.pad={},u=v.Pkcs7={pad:function(_,D){for(var I=D*4,P=I-_.sigBytes%I,w=P<<24|P<<16|P<<8|P,U=[],j=0;j<P;j+=4)U.push(w);var G=x.create(U,P);_.concat(G)},unpad:function(_){var D=_.words[_.sigBytes-1>>>2]&255;_.sigBytes-=D}};C.BlockCipher=S.extend({cfg:S.cfg.extend({mode:p,padding:u}),reset:function(){var _;S.reset.call(this);var D=this.cfg,I=D.iv,P=D.mode;this._xformMode==this._ENC_XFORM_MODE?_=P.createEncryptor:(_=P.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==_?this._mode.init(this,I&&I.words):(this._mode=_.call(P,this,I&&I.words),this._mode.__creator=_)},_doProcessBlock:function(_,D){this._mode.processBlock(_,D)},_doFinalize:function(){var _,D=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(D.pad(this._data,this.blockSize),_=this._process(!0)):(_=this._process(!0),D.unpad(_)),_},blockSize:128/32});var c=C.CipherParams=T.extend({init:function(_){this.mixIn(_)},toString:function(_){return(_||this.formatter).stringify(this)}}),l=O.format={},i=l.OpenSSL={stringify:function(_){var D,I=_.ciphertext,P=_.salt;return P?D=x.create([1398893684,1701076831]).concat(P).concat(I):D=I,D.toString(b)},parse:function(_){var D,I=b.parse(_),P=I.words;return P[0]==1398893684&&P[1]==1701076831&&(D=x.create(P.slice(2,4)),P.splice(0,4),I.sigBytes-=16),c.create({ciphertext:I,salt:D})}},h=C.SerializableCipher=T.extend({cfg:T.extend({format:i}),encrypt:function(_,D,I,P){P=this.cfg.extend(P);var w=_.createEncryptor(I,P),U=w.finalize(D),j=w.cfg;return c.create({ciphertext:U,key:I,iv:j.iv,algorithm:_,mode:j.mode,padding:j.padding,blockSize:_.blockSize,formatter:P.format})},decrypt:function(_,D,I,P){P=this.cfg.extend(P),D=this._parse(D,P.format);var w=_.createDecryptor(I,P).finalize(D.ciphertext);return w},_parse:function(_,D){return typeof _=="string"?D.parse(_,this):_}}),d=O.kdf={},g=d.OpenSSL={execute:function(_,D,I,P){P||(P=x.random(64/8));var w=m.create({keySize:D+I}).compute(_,P),U=x.create(w.words.slice(D),I*4);return w.sigBytes=D*4,c.create({key:w,iv:U,salt:P})}},L=C.PasswordBasedCipher=h.extend({cfg:h.cfg.extend({kdf:g}),encrypt:function(_,D,I,P){P=this.cfg.extend(P);var w=P.kdf.execute(I,_.keySize,_.ivSize);P.iv=w.iv;var U=h.encrypt.call(this,_,D,w.key,P);return U.mixIn(w),U},decrypt:function(_,D,I,P){P=this.cfg.extend(P),D=this._parse(D,P.format);var w=P.kdf.execute(I,_.keySize,_.ivSize,D.salt);P.iv=w.iv;var U=h.decrypt.call(this,_,D,w.key,P);return U}})}()})},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0}),e.Request=e.createRequest=void 0;var f=o(0),s=f.__importStar(o(1)),O=f.__importDefault(o(12)),C=f.__importDefault(o(3)),T=f.__importDefault(o(7)),x=o(4),M=f.__importDefault(o(8)),R=f.__importDefault(o(2)),b=f.__importDefault(o(22)),a=s.getGlobalObject(),m=function(){},S=a._ablyjs_jsonp={};S._=function(l){return S["_"+l]||m};var A=1,y="jsonp";function p(l,i,h,d,g,L,_){return L=L||M.default.TIMEOUTS,new u(void 0,l,i,s.copy(h),d,g,L,_)}e.createRequest=p;var v=function(l){f.__extends(i,l);function i(h,d,g){var L=l.call(this,h,d,g)||this;return L.shortName=y,g.stream=!1,L}return i.isAvailable=function(){return C.default.Config.jsonpSupported&&C.default.Config.allowComet},i.prototype.toString=function(){return"JSONPTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},i.prototype.createRequest=function(h,d,g,L,_,D,I){return D=(this===null||this===void 0?void 0:this.timeouts)||D||M.default.TIMEOUTS,p(h,d,g,L,_,D,I)},i}(O.default),u=function(l){f.__extends(i,l);function i(h,d,g,L,_,D,I,P){var w=l.call(this)||this;return h===void 0&&(h=A++),w.id=h,w.uri=d,w.params=L||{},w.params.rnd=s.cheapRandStr(),g&&(g["X-Ably-Version"]&&(w.params.v=g["X-Ably-Version"]),g["X-Ably-Lib"]&&(w.params.lib=g["X-Ably-Lib"])),w.body=_,w.method=P,w.requestMode=D,w.timeouts=I,w.requestComplete=!1,w}return i.prototype.exec=function(){var h=this,d=this.id,g=this.body,L=this.method,_=this.uri,D=this.params;D.callback="_ablyjs_jsonp._("+d+")",D.envelope="jsonp",g&&(D.body=g),L&&L!=="get"&&(D.method=L);var I=this.script=document.createElement("script"),P=_+s.toQueryString(D);I.src=P,I.src.split("/").slice(-1)[0]!==P.split("/").slice(-1)[0]&&R.default.logAction(R.default.LOG_ERROR,"JSONP Request.exec()","Warning: the browser appears to have truncated the script URI. This will likely result in the request failing due to an unparseable body param"),I.async=!0,I.type="text/javascript",I.charset="UTF-8",I.onerror=function(j){h.complete(new x.PartialErrorInfo("JSONP script error (event: "+C.default.Config.inspect(j)+")",null,400))},S["_"+d]=function(j){if(j.statusCode){var G=j.response;if(j.statusCode==204)h.complete(null,null,null,j.statusCode);else if(!G)h.complete(new x.PartialErrorInfo("Invalid server response: no envelope detected",null,500));else if(j.statusCode<400||s.isArray(G))h.complete(null,G,j.headers,j.statusCode);else{var z=G.error||new x.PartialErrorInfo("Error response received from server",null,j.statusCode);h.complete(z)}}else h.complete(null,j)};var w=this.requestMode==b.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout;this.timer=setTimeout(this.abort.bind(this),w);var U=document.getElementsByTagName("head")[0];U.insertBefore(I,U.firstChild)},i.prototype.complete=function(h,d,g,L){if(g=g||{},!this.requestComplete){this.requestComplete=!0;var _=void 0;d&&(_=typeof d=="string"?"text/plain":"application/json",g["content-type"]=_,this.emit("data",d)),this.emit("complete",h,d,g,!0,L),this.dispose()}},i.prototype.abort=function(){this.dispose()},i.prototype.dispose=function(){var h=this.timer;h&&(clearTimeout(h),this.timer=null);var d=this.script;d.parentNode&&d.parentNode.removeChild(d),delete S[this.id],this.emit("disposed")},i}(T.default);e.Request=u;function c(l){return a.JSONPTransport=v,v.isAvailable()&&(l.supportedTransports[y]=v),v}e.default=c},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0});var f=o(0),s=f.__importStar(o(1)),O=f.__importDefault(o(2)),C=f.__importDefault(o(8)),T=f.__importDefault(o(18)),x=f.__importDefault(o(46)),M=f.__importDefault(o(20)),R=f.__importDefault(o(33)),b=f.__importDefault(o(4)),a=f.__importDefault(o(49)),m=f.__importDefault(o(19)),S=f.__importDefault(o(3)),A=f.__importDefault(o(9)),y=f.__importDefault(o(16)),p=f.__importDefault(o(15)),v=function(){},u=function(){function l(i){if(!i){var h="no options provided";throw O.default.logAction(O.default.LOG_ERROR,"Rest()",h),new Error(h)}var d=C.default.objectifyOptions(i);d.log?(O.default.setLog(d.log.level,d.log.handler),O.default.deprecated("The `log` client option","Equivalent functionality is provided by the `logLevel` and `logHandler` client options. Update your client options code of the form `{ log: { level: logLevel, handler: logHandler } }` to instead be `{ logLevel, logHandler }`.")):O.default.setLog(d.logLevel,d.logHandler),O.default.logAction(O.default.LOG_MICRO,"Rest()","initialized with clientOptions "+S.default.Config.inspect(i));var g=this.options=C.default.normaliseOptions(d);if(g.key){var L=g.key.match(/^([^:\s]+):([^:.\s]+)$/);if(!L){var h="invalid key parameter";throw O.default.logAction(O.default.LOG_ERROR,"Rest()",h),new b.default(h,40400,404)}g.keyName=L[1],g.keySecret=L[2]}if("clientId"in g)if(typeof g.clientId=="string"||g.clientId===null){if(g.clientId==="*")throw new b.default('Can’t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, use {defaultTokenParams: {clientId: "*"}})',40012,400)}else throw new b.default("clientId must be either a string or null",40012,400);O.default.logAction(O.default.LOG_MINOR,"Rest()","started; version = "+C.default.version),this.baseUri=this.authority=function(_){return C.default.getHttpScheme(g)+_+":"+C.default.getPort(g,!1)},this._currentFallback=null,this.serverTimeOffset=null,this.http=new S.default.Http(g),this.auth=new T.default(this,g),this.channels=new c(this),this.push=new x.default(this)}return l.prototype.stats=function(i,h){if(h===void 0)if(typeof i=="function")h=i,i=null;else{if(this.options.promises)return s.promisify(this,"stats",[i]);h=v}var d=s.defaultGetHeaders(this.options),g=this.options.useBinaryProtocol?s.Format.msgpack:s.Format.json,L=this.http.supportsLinkHeaders?void 0:g;this.options.headers&&s.mixin(d,this.options.headers),new M.default(this,"/stats",d,L,function(_,D,I){for(var P=I?_:JSON.parse(_),w=0;w<P.length;w++)P[w]=a.default.fromValues(P[w]);return P}).get(i,h)},l.prototype.time=function(i,h){var d=this;if(h===void 0){if(typeof i=="function")h=i,i=null;else if(this.options.promises)return s.promisify(this,"time",[i])}var g=h||v,L=s.defaultGetHeaders(this.options);this.options.headers&&s.mixin(L,this.options.headers);var _=function(D){return d.authority(D)+"/time"};this.http.do(m.default.Get,this,_,L,null,i,function(D,I,P,w){if(D){g(D);return}w||(I=JSON.parse(I));var U=I[0];if(!U){g(new b.default("Internal error (unexpected result type from GET /time)",5e4,500));return}d.serverTimeOffset=U-s.now(),g(null,U)})},l.prototype.request=function(i,h,d,g,L,_){var D=this.options.useBinaryProtocol,I=D?S.default.Config.msgpack.encode:JSON.stringify,P=D?S.default.Config.msgpack.decode:JSON.parse,w=D?s.Format.msgpack:s.Format.json,U=this.http.supportsLinkHeaders?void 0:w;d=d||{};var j=i.toLowerCase(),G=j=="get"?s.defaultGetHeaders(this.options,w):s.defaultPostHeaders(this.options,w);if(_===void 0){if(this.options.promises)return s.promisify(this,"request",[i,h,d,g,L]);_=v}typeof g!="string"&&(g=I(g)),this.options.headers&&s.mixin(G,this.options.headers),L&&s.mixin(G,L);var z=new M.default(this,h,G,U,function(W,F,E){return s.ensureArray(E?W:P(W))},!0);if(!s.arrIn(S.default.Http.methods,j))throw new b.default("Unsupported method "+j,40500,405);s.arrIn(S.default.Http.methodsWithBody,j)?z[j](d,g,_):z[j](d,_)},l.prototype.batchPublish=function(i,h){if(h===void 0){if(this.options.promises)return s.promisify(this,"batchPublish",[i]);h=v}var d=h,g,L;s.isArray(i)?(g=i,L=!1):(g=[i],L=!0);var _=this.options.useBinaryProtocol?s.Format.msgpack:s.Format.json,D=s.defaultPostHeaders(this.options,_);this.options.headers&&s.mixin(D,this.options.headers);var I=s.encodeBody(g,_);p.default.post(this,"/messages",I,D,{newBatchResponse:"true"},null,function(P,w,U,j){if(P){d(P);return}var G=j?w:s.decodeBody(w,_);L?d(null,G[0]):d(null,G)})},l.prototype.batchPresence=function(i,h){if(h===void 0){if(this.options.promises)return s.promisify(this,"batchPresence",[i]);h=v}var d=h,g=this.options.useBinaryProtocol?s.Format.msgpack:s.Format.json,L=s.defaultPostHeaders(this.options,g);this.options.headers&&s.mixin(L,this.options.headers);var _=i.join(",");p.default.get(this,"/presence",L,{newBatchResponse:"true",channels:_},null,function(D,I,P,w){if(D){d(D);return}var U=w?I:s.decodeBody(I,g);d(null,U)})},l.prototype.setLog=function(i){O.default.setLog(i.level,i.handler)},l.Promise=function(i){return i=C.default.objectifyOptions(i),i.promises=!0,new l(i)},l.Callbacks=l,l.Platform=S.default,l.Message=A.default,l.PresenceMessage=y.default,l}(),c=function(){function l(i){this.rest=i,this.all=Object.create(null)}return l.prototype.get=function(i,h){i=String(i);var d=this.all[i];return d?h&&d.setOptions(h):this.all[i]=d=new R.default(this.rest,i,h),d},l.prototype.release=function(i){delete this.all[String(i)]},l}();e.default=u},function(n,e,o){(function(f,s){n.exports=s(o(6))})(this,function(f){return f.enc.Utf8})},function(n,e,o){(function(f,s){n.exports=s(o(6))})(this,function(f){return function(s){var O=f,C=O.lib,T=C.WordArray,x=C.Hasher,M=O.algo,R=[],b=[];(function(){function S(v){for(var u=s.sqrt(v),c=2;c<=u;c++)if(!(v%c))return!1;return!0}function A(v){return(v-(v|0))*4294967296|0}for(var y=2,p=0;p<64;)S(y)&&(p<8&&(R[p]=A(s.pow(y,1/2))),b[p]=A(s.pow(y,1/3)),p++),y++})();var a=[],m=M.SHA256=x.extend({_doReset:function(){this._hash=new T.init(R.slice(0))},_doProcessBlock:function(S,A){for(var y=this._hash.words,p=y[0],v=y[1],u=y[2],c=y[3],l=y[4],i=y[5],h=y[6],d=y[7],g=0;g<64;g++){if(g<16)a[g]=S[A+g]|0;else{var L=a[g-15],_=(L<<25|L>>>7)^(L<<14|L>>>18)^L>>>3,D=a[g-2],I=(D<<15|D>>>17)^(D<<13|D>>>19)^D>>>10;a[g]=_+a[g-7]+I+a[g-16]}var P=l&i^~l&h,w=p&v^p&u^v&u,U=(p<<30|p>>>2)^(p<<19|p>>>13)^(p<<10|p>>>22),j=(l<<26|l>>>6)^(l<<21|l>>>11)^(l<<7|l>>>25),G=d+j+P+b[g]+a[g],z=U+w;d=h,h=i,i=l,l=c+G|0,c=u,u=v,v=p,p=G+z|0}y[0]=y[0]+p|0,y[1]=y[1]+v|0,y[2]=y[2]+u|0,y[3]=y[3]+c|0,y[4]=y[4]+l|0,y[5]=y[5]+i|0,y[6]=y[6]+h|0,y[7]=y[7]+d|0},_doFinalize:function(){var S=this._data,A=S.words,y=this._nDataBytes*8,p=S.sigBytes*8;return A[p>>>5]|=128<<24-p%32,A[(p+64>>>9<<4)+14]=s.floor(y/4294967296),A[(p+64>>>9<<4)+15]=y,S.sigBytes=A.length*4,this._process(),this._hash},clone:function(){var S=x.clone.call(this);return S._hash=this._hash.clone(),S}});O.SHA256=x._createHelper(m),O.HmacSHA256=x._createHmacHelper(m)}(Math),f.SHA256})},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0});var f=o(0),s=f.__importStar(o(1)),O=f.__importDefault(o(7)),C=f.__importDefault(o(2)),T=f.__importDefault(o(34)),x=f.__importDefault(o(9)),M=f.__importDefault(o(4)),R=f.__importDefault(o(20)),b=f.__importDefault(o(15)),a=f.__importDefault(o(3));function m(){}var S=9;function A(v){return s.arrEvery(v,function(u){return!u.id})}function y(v){var u=v||{};if(u.cipher){if(!a.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var c=a.default.Crypto.getCipher(u.cipher);u.cipher=c.cipherParams,u.channelCipher=c.cipher}else"cipher"in u&&(u.cipher=void 0,u.channelCipher=null);return u}var p=function(v){f.__extends(u,v);function u(c,l,i){var h=v.call(this)||this;return C.default.logAction(C.default.LOG_MINOR,"Channel()","started; name = "+l),h.rest=c,h.name=l,h.basePath="/channels/"+encodeURIComponent(l),h.presence=new T.default(h),h.channelOptions=y(i),h}return u.prototype.setOptions=function(c){this.channelOptions=y(c)},u.prototype.history=function(c,l){if(C.default.logAction(C.default.LOG_MICRO,"Channel.history()","channel = "+this.name),l===void 0)if(typeof c=="function")l=c,c=null;else{if(this.rest.options.promises)return s.promisify(this,"history",arguments);l=m}this._history(c,l)},u.prototype._history=function(c,l){var i=this.rest,h=i.options.useBinaryProtocol?s.Format.msgpack:s.Format.json,d=this.rest.http.supportsLinkHeaders?void 0:h,g=s.defaultGetHeaders(i.options,h);i.options.headers&&s.mixin(g,i.options.headers);var L=this.channelOptions;new R.default(i,this.basePath+"/messages",g,d,function(_,D,I){return x.default.fromResponseBody(_,L,I?void 0:h)}).get(c,l)},u.prototype.publish=function(){var c=this,l=arguments.length,i=arguments[0],h=arguments[1],d=arguments[l-1],g,L;if(typeof d!="function"){if(this.rest.options.promises)return s.promisify(this,"publish",arguments);d=m}if(typeof i=="string"||i===null)g=[x.default.fromValues({name:i,data:h})],L=arguments[2];else if(s.isObject(i))g=[x.default.fromValues(i)],L=arguments[1];else if(s.isArray(i))g=x.default.fromValuesArray(i),L=arguments[1];else throw new M.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);(typeof L!="object"||!L)&&(L={});var _=this.rest,D=_.options,I=D.useBinaryProtocol?s.Format.msgpack:s.Format.json,P=_.options.idempotentRestPublishing,w=s.defaultPostHeaders(_.options,I);if(D.headers&&s.mixin(w,D.headers),P&&A(g)){var U=s.randomString(S);s.arrForEach(g,function(j,G){j.id=U+":"+G.toString()})}x.default.encodeArray(g,this.channelOptions,function(j){if(j){d(j);return}var G=x.default.getMessagesSize(g),z=D.maxMessageSize;if(G>z){d(new M.default("Maximum size of messages that can be published at once exceeded ( was "+G+" bytes; limit is "+z+" bytes)",40009,400));return}c._publish(x.default.serialize(g,I),w,L,d)})},u.prototype._publish=function(c,l,i,h){b.default.post(this.rest,this.basePath+"/messages",c,l,i,null,h)},u.prototype.status=function(c){if(typeof c!="function"&&this.rest.options.promises)return s.promisify(this,"status",[]);var l=this.rest.options.useBinaryProtocol?s.Format.msgpack:s.Format.json,i=s.defaultPostHeaders(this.rest.options,l);b.default.get(this.rest,this.basePath,i,{},l,c||m)},u}(O.default);e.default=p},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0});var f=o(0),s=f.__importStar(o(1)),O=f.__importDefault(o(7)),C=f.__importDefault(o(2)),T=f.__importDefault(o(20)),x=f.__importDefault(o(16));function M(){}var R=function(b){f.__extends(a,b);function a(m){var S=b.call(this)||this;return S.channel=m,S.basePath=m.basePath+"/presence",S}return a.prototype.get=function(m,S){if(C.default.logAction(C.default.LOG_MICRO,"Presence.get()","channel = "+this.channel.name),S===void 0)if(typeof m=="function")S=m,m=null;else{if(this.channel.rest.options.promises)return s.promisify(this,"get",arguments);S=M}var A=this.channel.rest,y=A.options.useBinaryProtocol?s.Format.msgpack:s.Format.json,p=this.channel.rest.http.supportsLinkHeaders?void 0:y,v=s.defaultGetHeaders(A.options,y);A.options.headers&&s.mixin(v,A.options.headers);var u=this.channel.channelOptions;new T.default(A,this.basePath,v,p,function(c,l,i){return x.default.fromResponseBody(c,u,i?void 0:y)}).get(m,S)},a.prototype.history=function(m,S){return C.default.logAction(C.default.LOG_MICRO,"Presence.history()","channel = "+this.channel.name),this._history(m,S)},a.prototype._history=function(m,S){if(S===void 0)if(typeof m=="function")S=m,m=null;else{if(this.channel.rest.options.promises)return s.promisify(this,"_history",[m]);S=M}var A=this.channel.rest,y=A.options.useBinaryProtocol?s.Format.msgpack:s.Format.json,p=this.channel.rest.http.supportsLinkHeaders?void 0:y,v=s.defaultGetHeaders(A.options,y);A.options.headers&&s.mixin(v,A.options.headers);var u=this.channel.channelOptions;new T.default(A,this.basePath+"/history",v,p,function(c,l,i){return x.default.fromResponseBody(c,u,i?void 0:y)}).get(m,S)},a}(O.default);e.default=R},function(n,e,o){(function(f){Object.defineProperty(e,"__esModule",{value:!0}),e.TransportParams=void 0;var s=o(0),O=s.__importDefault(o(10)),C=s.__importStar(o(1)),T=s.__importStar(o(52)),x=s.__importStar(o(8)),M=s.__importDefault(o(3)),R=s.__importDefault(o(7)),b=s.__importDefault(o(36)),a=s.__importDefault(o(2)),m=s.__importDefault(o(37)),S=s.__importStar(o(21)),A=s.__importStar(o(4)),y=s.__importDefault(o(18)),p=s.__importDefault(o(9)),v=s.__importDefault(o(24)),u=s.__importDefault(o(53)),c=s.__importDefault(o(26)),l=s.__importDefault(o(14)),i=function(){var W;return typeof M.default.WebStorage<"u"&&((W=M.default.WebStorage)===null||W===void 0?void 0:W.localSupported)},h=function(){var W;return typeof M.default.WebStorage<"u"&&((W=M.default.WebStorage)===null||W===void 0?void 0:W.sessionSupported)},d=O.default.Action,g=function(){},L="ably-transport-preference",_="ably-connection-recovery";function D(){var W,F;return h()&&((F=(W=M.default.WebStorage)===null||W===void 0?void 0:W.getSession)===null||F===void 0?void 0:F.call(W,_))}function I(W){var F,E;return h()&&((E=(F=M.default.WebStorage)===null||F===void 0?void 0:F.setSession)===null||E===void 0?void 0:E.call(F,_,W))}function P(){var W,F;return h()&&((F=(W=M.default.WebStorage)===null||W===void 0?void 0:W.removeSession)===null||F===void 0?void 0:F.call(W,_))}function w(W,F){return C.arrIndexOf(M.default.Defaults.transportPreferenceOrder,W.shortName)>C.arrIndexOf(M.default.Defaults.transportPreferenceOrder,F.shortName)}function U(W,F,E){var N;if(W.channel!==F.channel||(N=W.action)!==d.PRESENCE&&N!==d.MESSAGE||N!==F.action)return!1;var B=N===d.PRESENCE?"presence":"messages",k=W[B].concat(F[B]),V=p.default.getMessagesSize(k);return V>E||!C.allSame(k,"clientId")||!C.arrEvery(k,function(K){return!K.id})?!1:(W[B]=k,!0)}function j(W){try{return JSON.parse(W)}catch{return null}}var G=function(){function W(F,E,N,B){this.options=F,this.host=E,this.mode=N,this.connectionKey=B,this.format=F.useBinaryProtocol?C.Format.msgpack:C.Format.json}return W.prototype.getConnectParams=function(F){var E=F?C.copy(F):{},N=this.options;switch(this.mode){case"upgrade":E.upgrade=this.connectionKey;break;case"resume":E.resume=this.connectionKey;break;case"recover":{var B=j(N.recover);B&&(E.recover=B.connectionKey);break}}return N.clientId!==void 0&&(E.clientId=N.clientId),N.echoMessages===!1&&(E.echo="false"),this.format!==void 0&&(E.format=this.format),this.stream!==void 0&&(E.stream=this.stream),this.heartbeats!==void 0&&(E.heartbeats=this.heartbeats),E.v=x.default.protocolVersion,E.agent=(0,x.getAgentString)(this.options),N.transportParams!==void 0&&C.mixin(E,N.transportParams),E},W.prototype.toString=function(){var F="[mode="+this.mode;return this.host&&(F+=",host="+this.host),this.connectionKey&&(F+=",connectionKey="+this.connectionKey),this.format&&(F+=",format="+this.format),F+="]",F},W}();e.TransportParams=G;var z=function(W){s.__extends(F,W);function F(E,N){var B=W.call(this)||this;B.disconnectedRetryCount=0,F.initTransports(),B.realtime=E,B.options=N;var k=N.timeouts,V=k.preferenceConnectTimeout+k.realtimeRequestTimeout;if(B.states={initialized:{state:"initialized",terminal:!1,queueEvents:!0,sendEvents:!1,failState:"disconnected"},connecting:{state:"connecting",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:V,failState:"disconnected"},connected:{state:"connected",terminal:!1,queueEvents:!1,sendEvents:!0,failState:"disconnected"},synchronizing:{state:"connected",terminal:!1,queueEvents:!0,sendEvents:!1,forceQueueEvents:!0,failState:"disconnected"},disconnected:{state:"disconnected",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:k.disconnectedRetryTimeout,failState:"disconnected"},suspended:{state:"suspended",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:k.suspendedRetryTimeout,failState:"suspended"},closing:{state:"closing",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:k.realtimeRequestTimeout,failState:"closed"},closed:{state:"closed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"closed"},failed:{state:"failed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"failed"}},B.state=B.states.initialized,B.errorReason=null,B.queuedMessages=new b.default,B.msgSerial=0,B.connectionDetails=void 0,B.connectionId=void 0,B.connectionKey=void 0,B.connectionStateTtl=k.connectionStateTtl,B.maxIdleInterval=null,B.transports=C.intersect(N.transports||x.default.defaultTransports,F.supportedTransports),B.baseTransport=C.intersect(x.default.baseTransportOrder,B.transports)[0],B.upgradeTransports=C.intersect(B.transports,x.default.upgradeTransports),B.transportPreference=null,B.httpHosts=x.default.getHosts(N),B.activeProtocol=null,B.proposedTransports=[],B.pendingTransports=[],B.host=null,B.lastAutoReconnectAttempt=null,B.lastActivity=null,B.forceFallbackHost=!1,B.connectCounter=0,a.default.logAction(a.default.LOG_MINOR,"Realtime.ConnectionManager()","started"),a.default.logAction(a.default.LOG_MICRO,"Realtime.ConnectionManager()","requested transports = ["+(N.transports||x.default.defaultTransports)+"]"),a.default.logAction(a.default.LOG_MICRO,"Realtime.ConnectionManager()","available transports = ["+B.transports+"]"),a.default.logAction(a.default.LOG_MICRO,"Realtime.ConnectionManager()","http hosts = ["+B.httpHosts+"]"),!B.transports.length){var K="no requested transports available";throw a.default.logAction(a.default.LOG_ERROR,"realtime.ConnectionManager()",K),new Error(K)}var J=M.default.Config.addEventListener;return J&&(h()&&typeof N.recover=="function"&&J("beforeunload",B.persistConnection.bind(B)),N.closeOnUnload===!0&&J("beforeunload",function(){a.default.logAction(a.default.LOG_MAJOR,"Realtime.ConnectionManager()","beforeunload event has triggered the connection to close as closeOnUnload is true"),B.requestState({state:"closing"})}),J("online",function(){B.state==B.states.disconnected||B.state==B.states.suspended?(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager caught browser ‘online’ event","reattempting connection"),B.requestState({state:"connecting"})):B.state==B.states.connecting&&(B.pendingTransports.forEach(function(Z){Z.off()}),B.disconnectAllTransports(),B.startConnect())}),J("offline",function(){B.state==B.states.connected&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager caught browser ‘offline’ event","disconnecting active transport"),B.disconnectAllTransports())})),B}return F.initTransports=function(){(0,u.default)(F),C.arrForEach(M.default.Transports,function(E){E(F)})},F.prototype.createTransportParams=function(E,N){return new G(this.options,E,N,this.connectionKey)},F.prototype.getTransportParams=function(E){var N=this,B=function(k){if(N.connectionKey){k("resume");return}if(typeof N.options.recover=="string"){k("recover");return}var V=N.options.recover,K=D();if(K&&typeof V=="function"){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Calling clientOptions-provided recover function with last session data"),V(K,function(J){J?(N.options.recover=K.recoveryKey,k("recover")):k("clean")});return}k("clean")};B(function(k){var V=N.createTransportParams(null,k);if(k==="recover"){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport recovery mode = recover; recoveryKey = "+N.options.recover);var K=j(N.options.recover);K&&(N.msgSerial=K.msgSerial)}else a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport params = "+V.toString());E(V)})},F.prototype.tryATransport=function(E,N,B){var k=this;a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.tryATransport()","trying "+N),c.default.tryConnect(F.supportedTransports[N],this,this.realtime.auth,E,function(V,K){var J=k.state;if(J==k.states.closing||J==k.states.closed||J==k.states.failed){K&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.tryATransport()","connection "+J.state+" while we were attempting the transport; closing "+K),K.close()),B(!0);return}if(V){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.tryATransport()","transport "+N+" "+V.event+", err: "+V.error.toString()),y.default.isTokenErr(V.error)&&!(k.errorReason&&y.default.isTokenErr(k.errorReason))?(k.errorReason=V.error,k.realtime.auth._forceNewToken(null,null,function(Z){if(Z){k.actOnErrorFromAuthorize(Z);return}k.tryATransport(E,N,B)})):V.event==="failed"?(k.notifyState({state:"failed",error:V.error}),B(!0)):V.event==="disconnected"&&((0,S.isRetriable)(V.error)?B(!1):(k.notifyState({state:k.states.connecting.failState,error:V.error}),B(!0)));return}a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.tryATransport()","viable transport "+N+"; setting pending"),k.setTransportPending(K,E),B(null,K)})},F.prototype.setTransportPending=function(E,N){var B=this,k=N.mode;a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.setTransportPending()","transport = "+E+"; mode = "+k),C.arrDeleteValue(this.proposedTransports,E),this.pendingTransports.push(E);var V=M.default.Defaults.transportPreferenceOrder[M.default.Defaults.transportPreferenceOrder.length-1];E.once("connected",function(J,Z,ee){k=="upgrade"&&B.activeProtocol?E.shortName!==V&&C.arrIn(B.getUpgradePossibilities(),V)&&B.activeProtocol?setTimeout(function(){B.scheduleTransportActivation(J,E,Z,ee)},B.options.timeouts.parallelUpgradeDelay):B.scheduleTransportActivation(J,E,Z,ee):(B.activateTransport(J,E,Z,ee),M.default.Config.nextTick(function(){B.connectImpl(N)})),k==="recover"&&B.options.recover&&(B.options.recover=null,B.unpersistConnection())});var K=this;E.on(["disconnected","closed","failed"],function(J){K.deactivateTransport(E,this.event,J)}),this.emit("transport.pending",E)},F.prototype.scheduleTransportActivation=function(E,N,B,k){var V=this,K=this.activeProtocol&&this.activeProtocol.getTransport(),J=function(){N.disconnect(),C.arrDeleteValue(V.pendingTransports,N)};if(this.state!==this.states.connected&&this.state!==this.states.connecting){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+N.shortName),J();return}if(K&&!w(N,K)){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+N.shortName+" is no better than current active transport "+K.shortName+" - abandoning upgrade"),J();return}a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Scheduling transport upgrade; transport = "+N);var Z=null;if(!N.isConnected){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+N.shortName+"is no longer connected; abandoning upgrade"),J();return}if(this.state===this.states.connected)a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Currently connected, so temporarily pausing events until the upgrade is complete"),this.state=this.states.synchronizing,Z=this.activeProtocol;else if(this.state!==this.states.connecting){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+N.shortName),J();return}a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Syncing transport; transport = "+N);var ee=function(){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Activating transport; transport = "+N),N.send(O.default.fromValues({action:d.ACTIVATE})),V.activateTransport(E,N,B,k),V.state===V.states.synchronizing?(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, sending queued messages on upgraded transport; transport = "+N),V.state=V.states.connected):a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, but state is now "+V.state.state+", so leaving unchanged"),V.state.sendEvents&&V.sendQueuedMessages()};Z?Z.onceIdle(ee):ee()},F.prototype.activateTransport=function(E,N,B,k){var V=this;a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.activateTransport()","transport = "+N),E&&a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.activateTransport()","error = "+E),B&&a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionId =  "+B),k&&a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionDetails =  "+JSON.stringify(k)),this.persistTransportPreference(N);var K=this.state,J=this.states.connected.state;if(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.activateTransport()","current state = "+K.state),K.state==this.states.closing.state||K.state==this.states.closed.state||K.state==this.states.failed.state)return a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.activateTransport()","Disconnecting transport and abandoning"),N.disconnect(),!1;if(C.arrDeleteValue(this.pendingTransports,N),!N.isConnected)return a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.activateTransport()","Declining to activate transport "+N+" since it appears to no longer be connected"),!1;var Z=this.activeProtocol;this.activeProtocol=new T.default(N),this.host=N.params.host;var ee=k.connectionKey;if(ee&&this.connectionKey!=ee&&this.setConnection(B,k,!!E),this.onConnectionDetailsUpdate(k,N),M.default.Config.nextTick(function(){N.on("connected",function(Q,oe,ce){V.onConnectionDetailsUpdate(ce,N),V.emit("update",new m.default(J,J,null,Q))})}),K.state===this.states.connected.state?E&&(this.errorReason=this.realtime.connection.errorReason=E,this.emit("update",new m.default(J,J,null,E))):(this.notifyState({state:"connected",error:E}),this.errorReason=this.realtime.connection.errorReason=E||null),this.emit("transport.active",N),Z)if(Z.messageQueue.count()>0&&a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.activateTransport()","Previous active protocol (for transport "+Z.transport.shortName+", new one is "+N.shortName+") finishing with "+Z.messageQueue.count()+" messages still pending"),Z.transport===N){var re="Assumption violated: activating a transport that was also the transport for the previous active protocol; transport = "+N.shortName+"; stack = "+new Error().stack;a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.activateTransport()",re)}else Z.finish();return C.safeArrForEach(this.pendingTransports,function(Q){if(Q===N){var oe="Assumption violated: activating a transport that is still marked as a pending transport; transport = "+N.shortName+"; stack = "+new Error().stack;a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.activateTransport()",oe),C.arrDeleteValue(V.pendingTransports,N)}else Q.disconnect()}),C.safeArrForEach(this.proposedTransports,function(Q){Q===N?(a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.activateTransport()","Assumption violated: activating a transport that is still marked as a proposed transport; transport = "+N.shortName+"; stack = "+new Error().stack),C.arrDeleteValue(V.proposedTransports,N)):Q.dispose()}),!0},F.prototype.deactivateTransport=function(E,N,B){var k=this.activeProtocol,V=k&&k.getTransport()===E,K=C.arrDeleteValue(this.pendingTransports,E),J=C.arrDeleteValue(this.proposedTransports,E),Z=this.noTransportsScheduledForActivation();if(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","transport = "+E),a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","state = "+N+(V?"; was active":K?"; was pending":J?"; was proposed":"")+(Z?"":"; another transport is scheduled for activation")),B&&B.message&&a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","reason =  "+B.message),V&&(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","Getting, clearing, and requeuing "+this.activeProtocol.messageQueue.count()+" pending messages"),this.queuePendingMessages(k.getPendingMessages()),M.default.Config.nextTick(function(){k.clearPendingMessages()}),this.activeProtocol=this.host=null),this.emit("transport.inactive",E),V&&Z||V&&N==="failed"||N==="closed"||k===null&&K&&this.pendingTransports.length===0){if(N==="disconnected"&&B&&B.statusCode>500&&this.httpHosts.length>1){this.unpersistTransportPreference(),this.forceFallbackHost=!0,this.notifyState({state:N,error:B,retryImmediately:!0});return}var ee=N==="failed"&&y.default.isTokenErr(B)?"disconnected":N;this.notifyState({state:ee,error:B});return}V&&N==="disconnected"&&this.state!==this.states.synchronizing&&(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","wasActive but another transport is connected and scheduled for activation, so going into the connecting state until it activates"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),this.notifyState({state:"connecting",error:B}))},F.prototype.noTransportsScheduledForActivation=function(){return C.isEmpty(this.pendingTransports)||this.pendingTransports.every(function(E){return!E.isConnected})},F.prototype.setConnection=function(E,N,B){var k=this.connectionId,V=k&&k!==E,K=!k&&B;(V||K)&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.setConnection()","Resetting msgSerial"),this.msgSerial=0,this.queuedMessages.resetSendAttempted()),this.connectionId!==E&&a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.setConnection()","New connectionId; reattaching any attached channels"),this.realtime.connection.id=this.connectionId=E,this.realtime.connection.key=this.connectionKey=N.connectionKey},F.prototype.clearConnection=function(){this.realtime.connection.id=this.connectionId=void 0,this.realtime.connection.key=this.connectionKey=void 0,this.msgSerial=0,this.unpersistConnection()},F.prototype.createRecoveryKey=function(){return this.connectionKey?JSON.stringify({connectionKey:this.connectionKey,msgSerial:this.msgSerial,channelSerials:this.realtime.channels.channelSerials()}):null},F.prototype.checkConnectionStateFreshness=function(){if(!(!this.lastActivity||!this.connectionId)){var E=C.now()-this.lastActivity;E>this.connectionStateTtl+this.maxIdleInterval&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.checkConnectionStateFreshness()","Last known activity from realtime was "+E+"ms ago; discarding connection state"),this.clearConnection(),this.states.connecting.failState="suspended")}},F.prototype.persistConnection=function(){if(h()){var E=this.createRecoveryKey();E&&I({recoveryKey:E,disconnectedAt:C.now(),location:f.location,clientId:this.realtime.auth.clientId})}},F.prototype.unpersistConnection=function(){P()},F.prototype.getError=function(){return this.errorReason||this.getStateError()},F.prototype.getStateError=function(){var E,N;return(N=(E=S.default)[this.state.state])===null||N===void 0?void 0:N.call(E)},F.prototype.activeState=function(){return this.state.queueEvents||this.state.sendEvents},F.prototype.enactStateChange=function(E){var N=E.current==="failed"?a.default.LOG_ERROR:a.default.LOG_MAJOR;a.default.logAction(N,"Connection state",E.current+(E.reason?"; reason: "+E.reason:"")),a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.enactStateChange","setting new state: "+E.current+"; reason = "+(E.reason&&E.reason.message));var B=this.state=this.states[E.current];E.reason&&(this.errorReason=E.reason,this.realtime.connection.errorReason=E.reason),(B.terminal||B.state==="suspended")&&this.clearConnection(),this.emit("connectionstate",E)},F.prototype.startTransitionTimer=function(E){var N=this;a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","transitionState: "+E.state),this.transitionTimer&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","clearing already-running timer"),clearTimeout(this.transitionTimer)),this.transitionTimer=setTimeout(function(){N.transitionTimer&&(N.transitionTimer=null,a.default.logAction(a.default.LOG_MINOR,"ConnectionManager "+E.state+" timer expired","requesting new state: "+E.failState),N.notifyState({state:E.failState}))},E.retryDelay)},F.prototype.cancelTransitionTimer=function(){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.cancelTransitionTimer()",""),this.transitionTimer&&(clearTimeout(this.transitionTimer),this.transitionTimer=null)},F.prototype.startSuspendTimer=function(){var E=this;this.suspendTimer||(this.suspendTimer=setTimeout(function(){E.suspendTimer&&(E.suspendTimer=null,a.default.logAction(a.default.LOG_MINOR,"ConnectionManager suspend timer expired","requesting new state: suspended"),E.states.connecting.failState="suspended",E.notifyState({state:"suspended"}))},this.connectionStateTtl))},F.prototype.checkSuspendTimer=function(E){E!=="disconnected"&&E!=="suspended"&&E!=="connecting"&&this.cancelSuspendTimer()},F.prototype.cancelSuspendTimer=function(){this.states.connecting.failState="disconnected",this.suspendTimer&&(clearTimeout(this.suspendTimer),this.suspendTimer=null)},F.prototype.startRetryTimer=function(E){var N=this;this.retryTimer=setTimeout(function(){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager retry timer expired","retrying"),N.retryTimer=null,N.requestState({state:"connecting"})},E)},F.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},F.prototype.notifyState=function(E){var N=this,B,k,V=E.state,K=V==="disconnected"&&(this.state===this.states.connected||this.state===this.states.synchronizing||E.retryImmediately||this.state===this.states.connecting&&E.error&&y.default.isTokenErr(E.error)&&!(this.errorReason&&y.default.isTokenErr(this.errorReason)));if(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.notifyState()","new state: "+V+(K?"; will retry connection immediately":"")),V!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(E.state),(V==="suspended"||V==="connected")&&(this.disconnectedRetryCount=0),!this.state.terminal)){var J=this.states[E.state],Z=J.retryDelay;J.state==="disconnected"&&(this.disconnectedRetryCount++,Z=C.getRetryTime(J.retryDelay,this.disconnectedRetryCount));var ee=new m.default(this.state.state,J.state,Z,E.error||((k=(B=S.default)[J.state])===null||k===void 0?void 0:k.call(B)));if(K){var re=function(){N.state===N.states.disconnected&&(N.lastAutoReconnectAttempt=C.now(),N.requestState({state:"connecting"}))},Q=this.lastAutoReconnectAttempt&&C.now()-this.lastAutoReconnectAttempt+1;Q&&Q<1e3?(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.notifyState()","Last reconnect attempt was only "+Q+"ms ago, waiting another "+(1e3-Q)+"ms before trying again"),setTimeout(re,1e3-Q)):M.default.Config.nextTick(re)}else(V==="disconnected"||V==="suspended")&&this.startRetryTimer(Z);(V==="disconnected"&&!K||V==="suspended"||J.terminal)&&M.default.Config.nextTick(function(){N.disconnectAllTransports()}),V=="connected"&&!this.activeProtocol&&a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.notifyState()","Broken invariant: attempted to go into connected state, but there is no active protocol"),this.enactStateChange(ee),this.state.sendEvents?this.sendQueuedMessages():this.state.queueEvents||(this.realtime.channels.propogateConnectionInterruption(V,ee.reason),this.failQueuedMessages(ee.reason))}},F.prototype.requestState=function(E){var N=this,B,k,V=E.state;if(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.requestState()","requested state: "+V+"; current state: "+this.state.state),V!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(V),!(V=="connecting"&&this.state.state=="connected")&&!(V=="closing"&&this.state.state=="closed"))){var K=this.states[V],J=new m.default(this.state.state,K.state,null,E.error||((k=(B=S.default)[K.state])===null||k===void 0?void 0:k.call(B)));this.enactStateChange(J),V=="connecting"&&M.default.Config.nextTick(function(){N.startConnect()}),V=="closing"&&this.closeImpl()}},F.prototype.startConnect=function(){var E=this;if(this.state!==this.states.connecting){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.startConnect()","Must be in connecting state to connect, but was "+this.state.state);return}var N=this.realtime.auth,B=++this.connectCounter,k=function(){E.checkConnectionStateFreshness(),E.getTransportParams(function(K){if(K.mode==="recover"&&K.options.recover){var J=j(K.options.recover);J&&E.realtime.channels.recoverChannels(J.channelSerials)}B===E.connectCounter&&E.connectImpl(K,B)})};if(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.startConnect()","starting connection"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),N.method==="basic")k();else{var V=function(K){B===E.connectCounter&&(K?E.actOnErrorFromAuthorize(K):k())};this.errorReason&&y.default.isTokenErr(this.errorReason)?N._forceNewToken(null,null,V):N._ensureValidAuthCredentials(!1,V)}},F.prototype.connectImpl=function(E,N){var B=this.state.state;B!==this.states.connecting.state&&B!==this.states.connected.state?a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.connectImpl()","Must be in connecting state to connect (or connected to upgrade), but was "+B):this.pendingTransports.length?a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.connectImpl()","Transports "+this.pendingTransports[0].toString()+" currently pending; taking no action"):B==this.states.connected.state?this.upgradeIfNeeded(E):this.transports.length>1&&this.getTransportPreference()?this.connectPreference(E,N):this.connectBase(E,N)},F.prototype.connectPreference=function(E,N){var B=this,k=this.getTransportPreference(),V=!1;C.arrIn(this.transports,k)||(this.unpersistTransportPreference(),this.connectImpl(E,N)),a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.connectPreference()","Trying to connect with stored transport preference "+k);var K=setTimeout(function(){V=!0,B.state.state!==B.states.connected.state&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.connectPreference()","Shortcircuit connection attempt with "+k+" failed; clearing preference and trying from scratch"),B.disconnectAllTransports(),B.unpersistTransportPreference()),B.connectImpl(E,N)},this.options.timeouts.preferenceConnectTimeout);E.host=this.httpHosts[0],this.tryATransport(E,k,function(J,Z){clearTimeout(K),V&&Z?(Z.off(),Z.disconnect(),C.arrDeleteValue(B.pendingTransports,Z)):!Z&&!J&&(B.unpersistTransportPreference(),B.connectImpl(E,N))})},F.prototype.connectBase=function(E,N){var B=this,k=function(ee){B.notifyState({state:B.states.connecting.failState,error:ee})},V=this.httpHosts.slice(),K=function(ee,re){N===B.connectCounter&&!re&&!ee&&Z()};a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.connectBase()","Trying to connect with base transport "+this.baseTransport);var J=V.shift();if(!J){k(new A.default("Unable to connect (no available host)",80003,404));return}E.host=J;var Z=function(){if(!V.length){k(new A.default("Unable to connect (and no more fallback hosts to try)",80003,404));return}if(!B.realtime.http.checkConnectivity){k(new A.PartialErrorInfo("Internal error: Http.checkConnectivity not set",null,500));return}B.realtime.http.checkConnectivity(function(ee,re){if(N===B.connectCounter){if(ee){k(ee);return}if(!re){k(new A.default("Unable to connect (network unreachable)",80003,404));return}E.host=C.arrPopRandomElement(V),B.tryATransport(E,B.baseTransport,K)}})};if(this.forceFallbackHost&&V.length){this.forceFallbackHost=!1,Z();return}this.tryATransport(E,this.baseTransport,K)},F.prototype.getUpgradePossibilities=function(){var E=this.activeProtocol.getTransport().shortName,N=C.arrIndexOf(this.upgradeTransports,E);return this.upgradeTransports.slice(N+1)},F.prototype.upgradeIfNeeded=function(E){var N=this,B=this.getUpgradePossibilities();a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.upgradeIfNeeded()","upgrade possibilities: "+M.default.Config.inspect(B)),B.length&&C.arrForEach(B,function(k){var V=N.createTransportParams(E.host,"upgrade");N.tryATransport(V,k,g)})},F.prototype.closeImpl=function(){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.closeImpl()","closing connection"),this.cancelSuspendTimer(),this.startTransitionTimer(this.states.closing),C.safeArrForEach(this.pendingTransports,function(E){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing pending transport: "+E),E&&E.close()}),C.safeArrForEach(this.proposedTransports,function(E){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.closeImpl()","Disposing of proposed transport: "+E),E&&E.dispose()}),this.activeProtocol&&(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().close()),this.notifyState({state:"closed"})},F.prototype.onAuthUpdated=function(E,N){var B=this,k;switch(this.state.state){case"connected":{if(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Sending AUTH message on active transport"),(this.pendingTransports.length||this.proposedTransports.length)&&this.state!==this.states.synchronizing){this.disconnectAllTransports(!0);var V=this.activeProtocol.getTransport().params;M.default.Config.nextTick(function(){B.state.state==="connected"&&B.upgradeIfNeeded(V)})}var K=(k=this.activeProtocol)===null||k===void 0?void 0:k.getTransport();K&&K.onAuthUpdated&&K.onAuthUpdated(E);var J=O.default.fromValues({action:d.AUTH,auth:{accessToken:E.token}});this.send(J);var Z=function(){B.off(ee),N(null,E)},ee=function(Q){Q.current==="failed"&&(B.off(Z),B.off(ee),N(Q.reason||B.getStateError()))};this.once("connectiondetails",Z),this.on("connectionstate",ee);break}case"connecting":a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Aborting current connection attempts in order to start again with the new auth details"),this.disconnectAllTransports();default:{a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Connection state is "+this.state.state+"; waiting until either connected or failed");var re=function(Q){switch(Q.current){case"connected":B.off(re),N(null,E);break;case"failed":case"closed":case"suspended":B.off(re),N(Q.reason||B.getStateError());break}};this.on("connectionstate",re),this.state.state==="connecting"?this.startConnect():this.requestState({state:"connecting"})}}},F.prototype.disconnectAllTransports=function(E){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.disconnectAllTransports()","Disconnecting all transports"+(E?" except the active transport":"")),this.connectCounter++,C.safeArrForEach(this.pendingTransports,function(N){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting pending transport: "+N),N&&N.disconnect()}),this.pendingTransports=[],C.safeArrForEach(this.proposedTransports,function(N){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disposing of proposed transport: "+N),N&&N.dispose()}),this.proposedTransports=[],this.activeProtocol&&!E&&(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().disconnect())},F.prototype.send=function(E,N,B){B=B||g;var k=this.state;if(k.sendEvents){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.send()","sending event"),this.sendImpl(new T.PendingMessage(E,B));return}var V=N&&k.queueEvents||k.forceQueueEvents;if(!V){var K="rejecting event, queueEvent was "+N+", state was "+k.state;a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.send()",K),B(this.errorReason||new A.default(K,9e4,400));return}a.default.shouldLog(a.default.LOG_MICRO)&&a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.send()","queueing msg; "+O.default.stringify(E)),this.queue(E,B)},F.prototype.sendImpl=function(E){var N=E.message;E.ackRequired&&!E.sendAttempted&&(N.msgSerial=this.msgSerial++);try{this.activeProtocol.send(E)}catch(B){a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.sendImpl()","Unexpected exception in transport.send(): "+B.stack)}},F.prototype.queue=function(E,N){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.queue()","queueing event");var B=this.queuedMessages.last(),k=this.options.maxMessageSize;B&&!B.sendAttempted&&U(B.message,E,k)?(B.merged||(B.callback=v.default.create([B.callback]),B.merged=!0),B.callback.push(N)):this.queuedMessages.push(new T.PendingMessage(E,N))},F.prototype.sendQueuedMessages=function(){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.sendQueuedMessages()","sending "+this.queuedMessages.count()+" queued messages");for(var E;E=this.queuedMessages.shift();)this.sendImpl(E)},F.prototype.queuePendingMessages=function(E){E&&E.length&&(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.queuePendingMessages()","queueing "+E.length+" pending messages"),this.queuedMessages.prepend(E))},F.prototype.failQueuedMessages=function(E){var N=this.queuedMessages.count();N>0&&(a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.failQueuedMessages()","failing "+N+" queued messages, err = "+C.inspectError(E)),this.queuedMessages.completeAllMessages(E))},F.prototype.onChannelMessage=function(E,N){var B=this.activeProtocol&&N===this.activeProtocol.getTransport(),k=C.arrIn(this.pendingTransports,N)&&this.state==this.states.synchronizing;B||k?this.realtime.channels.onChannelMessage(E):C.arrIndexOf([d.ACK,d.NACK,d.ERROR],E.action)>-1?this.realtime.channels.onChannelMessage(E):a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.onChannelMessage()","received message "+JSON.stringify(E)+"on defunct transport; discarding")},F.prototype.ping=function(E,N){var B=this;if(E){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.ping()","transport = "+E);var k=function(){E.off("heartbeat",J),N(new A.default("Timeout waiting for heartbeat response",5e4,500))},V=C.now(),K=C.cheapRandStr(),J=function(oe){if(oe===K){E.off("heartbeat",J),clearTimeout(Z);var ce=C.now()-V;N(null,ce)}},Z=setTimeout(k,this.options.timeouts.realtimeRequestTimeout);E.on("heartbeat",J),E.ping(K);return}if(this.state.state!=="connected"){N(new A.default("Unable to ping service; not connected",4e4,400));return}var ee=!1,re=function(oe,ce){B.off("transport.active",Q),ee||(ee=!0,N(oe,ce))},Q=function(){ee||(ee=!0,M.default.Config.nextTick(function(){B.ping(null,N)}))};this.on("transport.active",Q),this.ping(this.activeProtocol.getTransport(),re)},F.prototype.abort=function(E){this.activeProtocol.getTransport().fail(E)},F.prototype.registerProposedTransport=function(E){this.proposedTransports.push(E)},F.prototype.getTransportPreference=function(){var E,N;return this.transportPreference||i()&&((N=(E=M.default.WebStorage)===null||E===void 0?void 0:E.get)===null||N===void 0?void 0:N.call(E,L))},F.prototype.persistTransportPreference=function(E){var N,B;C.arrIn(x.default.upgradeTransports,E.shortName)&&(this.transportPreference=E.shortName,i()&&((B=(N=M.default.WebStorage)===null||N===void 0?void 0:N.set)===null||B===void 0||B.call(N,L,E.shortName)))},F.prototype.unpersistTransportPreference=function(){var E,N;this.transportPreference=null,i()&&((N=(E=M.default.WebStorage)===null||E===void 0?void 0:E.remove)===null||N===void 0||N.call(E,L))},F.prototype.actOnErrorFromAuthorize=function(E){if(E.code===40171)this.notifyState({state:"failed",error:E});else if(E.code===40102)this.notifyState({state:"failed",error:E});else if(E.statusCode===l.default.Forbidden){var N="Client configured authentication provider returned 403; failing the connection";a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.actOnErrorFromAuthorize()",N),this.notifyState({state:"failed",error:new A.default(N,80019,403,E)})}else{var N="Client configured authentication provider request failed";a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.actOnErrorFromAuthorize",N),this.notifyState({state:this.state.failState,error:new A.default(N,80019,401,E)})}},F.prototype.onConnectionDetailsUpdate=function(E,N){if(E){this.connectionDetails=E,E.maxMessageSize&&(this.options.maxMessageSize=E.maxMessageSize);var B=E.clientId;if(B){var k=this.realtime.auth._uncheckedSetClientId(B);if(k){a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.onConnectionDetailsUpdate()",k.message),N.fail(k);return}}var V=E.connectionStateTtl;V&&(this.connectionStateTtl=V),this.maxIdleInterval=E.maxIdleInterval,this.emit("connectiondetails",E)}},F.supportedTransports={},F}(R.default);e.default=z}).call(this,o(13))},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0});var f=o(0),s=f.__importDefault(o(7)),O=f.__importDefault(o(2)),C=function(T){f.__extends(x,T);function x(){var M=T.call(this)||this;return M.messages=[],M}return x.prototype.count=function(){return this.messages.length},x.prototype.push=function(M){this.messages.push(M)},x.prototype.shift=function(){return this.messages.shift()},x.prototype.last=function(){return this.messages[this.messages.length-1]},x.prototype.copyAll=function(){return this.messages.slice()},x.prototype.append=function(M){this.messages.push.apply(this.messages,M)},x.prototype.prepend=function(M){this.messages.unshift.apply(this.messages,M)},x.prototype.completeMessages=function(M,R,b){O.default.logAction(O.default.LOG_MICRO,"MessageQueue.completeMessages()","serial = "+M+"; count = "+R),b=b||null;var a=this.messages;if(a.length===0)throw new Error("MessageQueue.completeMessages(): completeMessages called on any empty MessageQueue");var m=a[0];if(m){var S=m.message.msgSerial,A=M+R;if(A>S)for(var y=a.splice(0,A-S),p=0,v=y;p<v.length;p++){var u=v[p];u.callback(b)}a.length==0&&this.emit("idle")}},x.prototype.completeAllMessages=function(M){this.completeMessages(0,Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,M)},x.prototype.resetSendAttempted=function(){for(var M=0,R=this.messages;M<R.length;M++){var b=R[M];b.sendAttempted=!1}},x.prototype.clear=function(){O.default.logAction(O.default.LOG_MICRO,"MessageQueue.clear()","clearing "+this.messages.length+" messages"),this.messages=[],this.emit("idle")},x}(s.default);e.default=C},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0});var f=function(){function s(O,C,T,x){this.previous=O,this.current=C,T&&(this.retryIn=T),x&&(this.reason=x)}return s}();e.default=f},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0});var f=o(0),s=f.__importDefault(o(10)),O=f.__importDefault(o(7)),C=f.__importStar(o(1)),T=f.__importDefault(o(33)),x=f.__importDefault(o(2)),M=f.__importDefault(o(54)),R=f.__importDefault(o(9)),b=f.__importDefault(o(39)),a=f.__importStar(o(4)),m=f.__importDefault(o(16)),S=f.__importDefault(o(21)),A=s.default.Action,y=function(){};function p(c){if(c&&"params"in c&&!C.isObject(c.params))return new a.default("options.params must be an object",4e4,400);if(c&&"modes"in c){if(!C.isArray(c.modes))return new a.default("options.modes must be an array",4e4,400);for(var l=0;l<c.modes.length;l++){var i=c.modes[l];if(!i||typeof i!="string"||!C.arrIn(s.default.channelModes,String.prototype.toUpperCase.call(i)))return new a.default("Invalid channel mode: "+i,4e4,400)}}}var v=function(c){f.__extends(l,c);function l(i,h,d){var g=c.call(this,i,h,d)||this;return g.retryCount=0,g.history=function(L,_){if(x.default.logAction(x.default.LOG_MICRO,"RealtimeChannel.history()","channel = "+this.name),_===void 0)if(typeof L=="function")_=L,L=null;else{if(this.rest.options.promises)return C.promisify(this,"history",arguments);_=y}if(L&&L.untilAttach){if(this.state!=="attached"){_(new a.default("option untilAttach requires the channel to be attached",4e4,400));return}if(!this.properties.attachSerial){_(new a.default("untilAttach was specified and channel is attached, but attachSerial is not defined",4e4,400));return}delete L.untilAttach,L.from_serial=this.properties.attachSerial}T.default.prototype._history.call(this,L,_)},g.whenState=function(L,_){return O.default.prototype.whenState.call(g,L,g.state,_)},x.default.logAction(x.default.LOG_MINOR,"RealtimeChannel()","started; name = "+h),g.realtime=i,g.presence=new M.default(g),g.connectionManager=i.connection.connectionManager,g.state="initialized",g.subscriptions=new O.default,g.syncChannelSerial=void 0,g.properties={attachSerial:void 0,channelSerial:void 0},g.setOptions(d),g.errorReason=null,g._requestedFlags=null,g._mode=null,g._attachResume=!1,g._decodingContext={channelOptions:g.channelOptions,plugins:i.options.plugins||{},baseEncodedPreviousPayload:void 0},g._lastPayload={messageId:null,protocolMessageChannelSerial:null,decodeFailureRecoveryInProgress:null},g._allChannelChanges=new O.default,g}return l.prototype.invalidStateError=function(){return new a.default("Channel operation failed as channel state is "+this.state,90001,400,this.errorReason||void 0)},l.processListenerArgs=function(i){return i=Array.prototype.slice.call(i),typeof i[0]=="function"&&i.unshift(null),i[i.length-1]==null&&i.pop(),i},l.prototype.setOptions=function(i,h){var d=this.channelOptions;if(!h&&this.rest.options.promises)return C.promisify(this,"setOptions",arguments);var g=h||function(_){_&&x.default.logAction(x.default.LOG_ERROR,"RealtimeChannel.setOptions()","Set options failed: "+_.toString())},L=p(i);if(L){g(L);return}T.default.prototype.setOptions.call(this,i),this._decodingContext&&(this._decodingContext.channelOptions=this.channelOptions),this._shouldReattachToSetOptions(i,d)?(this.attachImpl(),this._allChannelChanges.once(["attached","update","detached","failed"],function(_){switch(this.event){case"update":case"attached":g==null||g(null);return;default:g==null||g(_.reason);return}})):g()},l.prototype._shouldReattachToSetOptions=function(i,h){if(!(this.state==="attached"||this.state==="attaching"))return!1;if(i!=null&&i.params){var d=u(i.params),g=u(h.params);if(Object.keys(d).length!==Object.keys(g).length||!C.shallowEquals(g,d))return!0}return!!(i!=null&&i.modes&&(!h.modes||!C.arrEquals(i.modes,h.modes)))},l.prototype.publish=function(){for(var i=this,h=[],d=0;d<arguments.length;d++)h[d]=arguments[d];var g=h[0],L=h.length,_=h[L-1];if(typeof _!="function"){if(this.realtime.options.promises)return C.promisify(this,"publish",arguments);_=y,++L}if(!this.connectionManager.activeState()){_(this.connectionManager.getError());return}if(L==2)if(C.isObject(g))g=[R.default.fromValues(g)];else if(C.isArray(g))g=R.default.fromValuesArray(g);else throw new a.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);else g=[R.default.fromValues({name:h[0],data:h[1]})];var D=this.realtime.options.maxMessageSize;R.default.encodeArray(g,this.channelOptions,function(I){if(I){_(I);return}var P=R.default.getMessagesSize(g);if(P>D){_(new a.default("Maximum size of messages that can be published at once exceeded ( was "+P+" bytes; limit is "+D+" bytes)",40009,400));return}i.__publish(g,_)})},l.prototype.__publish=function(i,h){x.default.logAction(x.default.LOG_MICRO,"RealtimeChannel.publish()","message count = "+i.length);var d=this.state;switch(d){case"failed":case"suspended":h(a.default.fromValues(this.invalidStateError()));break;default:{x.default.logAction(x.default.LOG_MICRO,"RealtimeChannel.publish()","sending message; channel state is "+d);var g=new s.default;g.action=A.MESSAGE,g.channel=this.name,g.messages=i,this.sendMessage(g,h);break}}},l.prototype.onEvent=function(i){x.default.logAction(x.default.LOG_MICRO,"RealtimeChannel.onEvent()","received message");for(var h=this.subscriptions,d=0;d<i.length;d++){var g=i[d];h.emit(g.name,g)}},l.prototype.attach=function(i,h){var d;if(typeof i=="function"?(h=i,d=null):d=i,!h){if(this.realtime.options.promises)return C.promisify(this,"attach",arguments);h=function(g){g&&x.default.logAction(x.default.LOG_MAJOR,"RealtimeChannel.attach()","Channel attach failed: "+g.toString())}}if(d)x.default.deprecated("The ability to pass an array of channel mode flags as the first argument of `RealtimeChannel.attach()`","To set channel mode flags, populate the `modes` property of the channel options object that you pass to `Channels.get()` or `RealtimeChannel.setOptions()`."),this._requestedFlags=d;else if(this.state==="attached"){h(null,null);return}this._attach(!1,null,h)},l.prototype._attach=function(i,h,d){d||(d=function(L){L&&x.default.logAction(x.default.LOG_ERROR,"RealtimeChannel._attach()","Channel attach failed: "+L.toString())});var g=this.connectionManager;if(!g.activeState()){d(g.getError());return}(this.state!=="attaching"||i)&&this.requestState("attaching",h),this.once(function(L){switch(this.event){case"attached":d==null||d(null,L);break;case"detached":case"suspended":case"failed":d==null||d(L.reason||g.getError()||new a.default("Unable to attach; reason unknown; state = "+this.event,9e4,500));break;case"detaching":d==null||d(new a.default("Attach request superseded by a subsequent detach request",9e4,409));break}})},l.prototype.attachImpl=function(){x.default.logAction(x.default.LOG_MICRO,"RealtimeChannel.attachImpl()","sending ATTACH message");var i=s.default.fromValues({action:A.ATTACH,channel:this.name,params:this.channelOptions.params,channelSerial:this.properties.channelSerial});this._requestedFlags?i.encodeModesToFlags(this._requestedFlags):this.channelOptions.modes&&i.encodeModesToFlags(C.allToUpperCase(this.channelOptions.modes)),this._attachResume&&i.setFlag("ATTACH_RESUME"),this._lastPayload.decodeFailureRecoveryInProgress&&(i.channelSerial=this._lastPayload.protocolMessageChannelSerial),this.sendMessage(i,y)},l.prototype.detach=function(i){if(!i){if(this.realtime.options.promises)return C.promisify(this,"detach",arguments);i=y}var h=this.connectionManager;if(!h.activeState()){i(h.getError());return}switch(this.state){case"suspended":this.notifyState("detached"),i();break;case"detached":i();break;case"failed":i(new a.default("Unable to detach; channel state = failed",90001,400));break;default:this.requestState("detaching");case"detaching":this.once(function(d){switch(this.event){case"detached":i();break;case"attached":case"suspended":case"failed":i(d.reason||h.getError()||new a.default("Unable to detach; reason unknown; state = "+this.event,9e4,500));break;case"attaching":i(new a.default("Detach request superseded by a subsequent attach request",9e4,409));break}})}},l.prototype.detachImpl=function(i){x.default.logAction(x.default.LOG_MICRO,"RealtimeChannel.detach()","sending DETACH message");var h=s.default.fromValues({action:A.DETACH,channel:this.name});this.sendMessage(h,i||y)},l.prototype.subscribe=function(){for(var i=[],h=0;h<arguments.length;h++)i[h]=arguments[h];var d=l.processListenerArgs(i),g=d[0],L=d[1],_=d[2];if(!_&&this.realtime.options.promises)return C.promisify(this,"subscribe",[g,L]);if(this.state==="failed"){_==null||_(a.default.fromValues(this.invalidStateError()));return}return g&&typeof g=="object"&&!Array.isArray(g)?this._subscribeFilter(g,L):this.subscriptions.on(g,L),this.attach(_||y)},l.prototype._subscribeFilter=function(i,h){var d=function(g){var L,_,D,I,P,w,U={name:g.name,refTimeserial:(_=(L=g.extras)===null||L===void 0?void 0:L.ref)===null||_===void 0?void 0:_.timeserial,refType:(I=(D=g.extras)===null||D===void 0?void 0:D.ref)===null||I===void 0?void 0:I.type,isRef:!!(!((w=(P=g.extras)===null||P===void 0?void 0:P.ref)===null||w===void 0)&&w.timeserial),clientId:g.clientId};Object.entries(i).find(function(j){var G=j[0],z=j[1];return z!==void 0?U[G]!==z:!1})||h(g)};this._addFilteredSubscription(i,h,d),this.subscriptions.on(d)},l.prototype._addFilteredSubscription=function(i,h,d){var g;if(this.filteredSubscriptions||(this.filteredSubscriptions=new Map),this.filteredSubscriptions.has(h)){var L=this.filteredSubscriptions.get(h);L.set(i,((g=L==null?void 0:L.get(i))===null||g===void 0?void 0:g.concat(d))||[d])}else this.filteredSubscriptions.set(h,new Map([[i,[d]]]))},l.prototype._getAndDeleteFilteredSubscriptions=function(i,h){var d=this;if(!this.filteredSubscriptions)return[];if(!h&&i)return Array.from(this.filteredSubscriptions.entries()).map(function(D){var I,P=D[0],w=D[1],U=w.get(i);return w.delete(i),w.size===0&&((I=d.filteredSubscriptions)===null||I===void 0||I.delete(P)),U}).reduce(function(D,I){var P;return I?(P=D).concat.apply(P,I):D},[]);if(!h||!this.filteredSubscriptions.has(h))return[];var g=this.filteredSubscriptions.get(h);if(!i){var L=Array.from(g.values()).reduce(function(D,I){return D.concat.apply(D,I)},[]);return this.filteredSubscriptions.delete(h),L}var _=g.get(i);return g.delete(i),_||[]},l.prototype.unsubscribe=function(){for(var i=this,h,d=[],g=0;g<arguments.length;g++)d[g]=arguments[g];var L=l.processListenerArgs(d),_=L[0],D=L[1];if(typeof _=="object"&&!D||!((h=this.filteredSubscriptions)===null||h===void 0)&&h.has(D)){this._getAndDeleteFilteredSubscriptions(_,D).forEach(function(I){return i.subscriptions.off(I)});return}this.subscriptions.off(_,D)},l.prototype.sync=function(){switch(this.state){case"initialized":case"detaching":case"detached":throw new a.PartialErrorInfo("Unable to sync to channel; not attached",4e4)}var i=this.connectionManager;if(!i.activeState())throw i.getError();var h=s.default.fromValues({action:A.SYNC,channel:this.name});this.syncChannelSerial&&(h.channelSerial=this.syncChannelSerial),i.send(h)},l.prototype.sendMessage=function(i,h){this.connectionManager.send(i,this.realtime.options.queueMessages,h)},l.prototype.sendPresence=function(i,h){var d=s.default.fromValues({action:A.PRESENCE,channel:this.name,presence:C.isArray(i)?m.default.fromValuesArray(i):[m.default.fromValues(i)]});this.sendMessage(d,h)},l.prototype.onMessage=function(i){(i.action===A.ATTACHED||i.action===A.MESSAGE||i.action===A.PRESENCE)&&this.setChannelSerial(i.channelSerial);var h,d=!1;switch(i.action){case A.ATTACHED:{this.properties.attachSerial=i.channelSerial,this._mode=i.getMode(),this.params=i.params||{};var g=i.decodeModesFromFlags();this.modes=g&&C.allToLowerCase(g)||void 0;var L=i.hasFlag("RESUMED"),_=i.hasFlag("HAS_PRESENCE"),D=i.hasFlag("HAS_BACKLOG");if(this.state==="attached"){L||this.presence.onAttached(_);var I=new b.default(this.state,this.state,L,D,i.error);this._allChannelChanges.emit("update",I),(!L||this.channelOptions.updateOnAttached)&&this.emit("update",I)}else this.state==="detaching"?this.checkPendingState():this.notifyState("attached",i.error,L,_,D);break}case A.DETACHED:{var P=i.error?a.default.fromValues(i.error):new a.default("Channel detached",90001,404);this.state==="detaching"?this.notifyState("detached",P):this.state==="attaching"?this.notifyState("suspended",P):this.requestState("attaching",P);break}case A.SYNC:if(d=!0,h=this.syncChannelSerial=i.channelSerial,!i.presence)break;case A.PRESENCE:{for(var w=i.presence,U=i.id,j=i.connectionId,G=i.timestamp,z=this.channelOptions,W=void 0,F=0;F<w.length;F++)try{W=w[F],m.default.decode(W,z),W.connectionId||(W.connectionId=j),W.timestamp||(W.timestamp=G),W.id||(W.id=U+":"+F)}catch(K){x.default.logAction(x.default.LOG_ERROR,"RealtimeChannel.onMessage()",K.toString())}this.presence.setPresence(w,d,h);break}case A.MESSAGE:{if(this.state!=="attached"){x.default.logAction(x.default.LOG_MAJOR,"RealtimeChannel.onMessage()",'Message "'+i.id+'" skipped as this channel "'+this.name+'" state is not "attached" (state is "'+this.state+'").');return}var E=i.messages,N=E[0],B=E[E.length-1],U=i.id,j=i.connectionId,G=i.timestamp;if(N.extras&&N.extras.delta&&N.extras.delta.from!==this._lastPayload.messageId){var k='Delta message decode failure - previous message not available for message "'+i.id+'" on this channel "'+this.name+'".';x.default.logAction(x.default.LOG_ERROR,"RealtimeChannel.onMessage()",k),this._startDecodeFailureRecovery(new a.default(k,40018,400));break}for(var F=0;F<E.length;F++){var k=E[F];try{R.default.decode(k,this._decodingContext)}catch(Q){switch(x.default.logAction(x.default.LOG_ERROR,"RealtimeChannel.onMessage()",Q.toString()),Q.code){case 40018:this._startDecodeFailureRecovery(Q);return;case 40019:case 40021:this.notifyState("failed",Q);return}}k.connectionId||(k.connectionId=j),k.timestamp||(k.timestamp=G),k.id||(k.id=U+":"+F)}this._lastPayload.messageId=B.id,this._lastPayload.protocolMessageChannelSerial=i.channelSerial,this.onEvent(E);break}case A.ERROR:{var V=i.error;V&&V.code==80016?this.checkPendingState():this.notifyState("failed",a.default.fromValues(V));break}default:x.default.logAction(x.default.LOG_ERROR,"RealtimeChannel.onMessage()","Fatal protocol error: unrecognised action ("+i.action+")"),this.connectionManager.abort(S.default.unknownChannelErr())}},l.prototype._startDecodeFailureRecovery=function(i){var h=this;this._lastPayload.decodeFailureRecoveryInProgress||(x.default.logAction(x.default.LOG_MAJOR,"RealtimeChannel.onMessage()","Starting decode failure recovery process."),this._lastPayload.decodeFailureRecoveryInProgress=!0,this._attach(!0,i,function(){h._lastPayload.decodeFailureRecoveryInProgress=!1}))},l.prototype.onAttached=function(){x.default.logAction(x.default.LOG_MINOR,"RealtimeChannel.onAttached","activating channel; name = "+this.name)},l.prototype.notifyState=function(i,h,d,g,L){if(x.default.logAction(x.default.LOG_MICRO,"RealtimeChannel.notifyState","name = "+this.name+", current state = "+this.state+", notifying state "+i),this.clearStateTimer(),C.arrIn(["detached","suspended","failed"],i)&&(this.properties.channelSerial=null),i!==this.state){this.presence.actOnChannelState(i,g,h),i==="suspended"&&this.connectionManager.state.sendEvents?this.startRetryTimer():this.cancelRetryTimer(),h&&(this.errorReason=h);var _=new b.default(this.state,i,d,L,h),D=i==="failed"?x.default.LOG_ERROR:x.default.LOG_MAJOR;x.default.logAction(D,'Channel state for channel "'+this.name+'"',i+(h?"; reason: "+h:"")),i!=="attaching"&&i!=="suspended"&&(this.retryCount=0),i==="attached"&&this.onAttached(),i==="attached"?this._attachResume=!0:(i==="detaching"||i==="failed")&&(this._attachResume=!1),this.state=i,this._allChannelChanges.emit(i,_),this.emit(i,_)}},l.prototype.requestState=function(i,h){x.default.logAction(x.default.LOG_MINOR,"RealtimeChannel.requestState","name = "+this.name+", state = "+i),this.notifyState(i,h),this.checkPendingState()},l.prototype.checkPendingState=function(){var i=this.connectionManager.state;if(!(i.sendEvents||i.forceQueueEvents)){x.default.logAction(x.default.LOG_MINOR,"RealtimeChannel.checkPendingState","sendEvents is false; state is "+this.connectionManager.state.state);return}switch(x.default.logAction(x.default.LOG_MINOR,"RealtimeChannel.checkPendingState","name = "+this.name+", state = "+this.state),this.state){case"attaching":this.startStateTimerIfNotRunning(),this.attachImpl();break;case"detaching":this.startStateTimerIfNotRunning(),this.detachImpl();break;case"attached":this.sync();break}},l.prototype.timeoutPendingState=function(){switch(this.state){case"attaching":{var i=new a.default("Channel attach timed out",90007,408);this.notifyState("suspended",i);break}case"detaching":{var i=new a.default("Channel detach timed out",90007,408);this.notifyState("attached",i);break}default:this.checkPendingState();break}},l.prototype.startStateTimerIfNotRunning=function(){var i=this;this.stateTimer||(this.stateTimer=setTimeout(function(){x.default.logAction(x.default.LOG_MINOR,"RealtimeChannel.startStateTimerIfNotRunning","timer expired"),i.stateTimer=null,i.timeoutPendingState()},this.realtime.options.timeouts.realtimeRequestTimeout))},l.prototype.clearStateTimer=function(){var i=this.stateTimer;i&&(clearTimeout(i),this.stateTimer=null)},l.prototype.startRetryTimer=function(){var i=this;if(!this.retryTimer){this.retryCount++;var h=C.getRetryTime(this.realtime.options.timeouts.channelRetryTimeout,this.retryCount);this.retryTimer=setTimeout(function(){i.state==="suspended"&&i.connectionManager.state.sendEvents&&(i.retryTimer=null,x.default.logAction(x.default.LOG_MINOR,"RealtimeChannel retry timer expired","attempting a new attach"),i.requestState("attaching"))},h)}},l.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},l.prototype.getReleaseErr=function(){var i=this.state;return i==="initialized"||i==="detached"||i==="failed"?null:new a.default("Can only release a channel in a state where there is no possibility of further updates from the server being received (initialized, detached, or failed); was "+i,90001,400)},l.prototype.setChannelSerial=function(i){x.default.logAction(x.default.LOG_MICRO,"RealtimeChannel.setChannelSerial()","Updating channel serial; serial = "+i+"; previous = "+this.properties.channelSerial),i&&(this.properties.channelSerial=i)},l}(T.default);function u(c){var l=c||{};l.agent;var i=f.__rest(l,["agent"]);return i}e.default=v},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0});var f=function(){function s(O,C,T,x,M){this.previous=O,this.current=C,C==="attached"&&(this.resumed=T,this.hasBacklog=x),M&&(this.reason=M)}return s}();e.default=f},function(n,e,o){(function(f,s){n.exports=s(o(6))})(this,function(f){return function(){var s=f,O=s.lib,C=O.WordArray,T=O.Hasher,x=s.algo,M=[],R=x.SHA1=T.extend({_doReset:function(){this._hash=new C.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(b,a){for(var m=this._hash.words,S=m[0],A=m[1],y=m[2],p=m[3],v=m[4],u=0;u<80;u++){if(u<16)M[u]=b[a+u]|0;else{var c=M[u-3]^M[u-8]^M[u-14]^M[u-16];M[u]=c<<1|c>>>31}var l=(S<<5|S>>>27)+v+M[u];u<20?l+=(A&y|~A&p)+1518500249:u<40?l+=(A^y^p)+1859775393:u<60?l+=(A&y|A&p|y&p)-1894007588:l+=(A^y^p)-899497514,v=p,p=y,y=A<<30|A>>>2,A=S,S=l}m[0]=m[0]+S|0,m[1]=m[1]+A|0,m[2]=m[2]+y|0,m[3]=m[3]+p|0,m[4]=m[4]+v|0},_doFinalize:function(){var b=this._data,a=b.words,m=this._nDataBytes*8,S=b.sigBytes*8;return a[S>>>5]|=128<<24-S%32,a[(S+64>>>9<<4)+14]=Math.floor(m/4294967296),a[(S+64>>>9<<4)+15]=m,b.sigBytes=a.length*4,this._process(),this._hash},clone:function(){var b=T.clone.call(this);return b._hash=this._hash.clone(),b}});s.SHA1=T._createHelper(R),s.HmacSHA1=T._createHmacHelper(R)}(),f.SHA1})},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0});function f(u){if(u===void 0)return"undefined";var c,l;if(u instanceof ArrayBuffer?(l="ArrayBuffer",c=new DataView(u)):u instanceof DataView&&(l="DataView",c=u),!c)return JSON.stringify(u);for(var i=[],h=0;h<u.byteLength;h++){if(h>20){i.push("...");break}var d=c.getUint8(h).toString(16);d.length===1&&(d="0"+d),i.push(d)}return"<"+l+" "+i.join(" ")+">"}function s(u,c,l){for(var i=0,h=l.length;i<h;i++){var d=l.charCodeAt(i);if(d<128){u.setUint8(c++,d>>>0&127|0);continue}if(d<2048){u.setUint8(c++,d>>>6&31|192),u.setUint8(c++,d>>>0&63|128);continue}if(d<65536){u.setUint8(c++,d>>>12&15|224),u.setUint8(c++,d>>>6&63|128),u.setUint8(c++,d>>>0&63|128);continue}if(d<1114112){u.setUint8(c++,d>>>18&7|240),u.setUint8(c++,d>>>12&63|128),u.setUint8(c++,d>>>6&63|128),u.setUint8(c++,d>>>0&63|128);continue}throw new Error("bad codepoint "+d)}}function O(u,c,l){for(var i="",h=c,d=c+l;h<d;h++){var g=u.getUint8(h);if(!(g&128)){i+=String.fromCharCode(g);continue}if((g&224)===192){i+=String.fromCharCode((g&15)<<6|u.getUint8(++h)&63);continue}if((g&240)===224){i+=String.fromCharCode((g&15)<<12|(u.getUint8(++h)&63)<<6|(u.getUint8(++h)&63)<<0);continue}if((g&248)===240){i+=String.fromCharCode((g&7)<<18|(u.getUint8(++h)&63)<<12|(u.getUint8(++h)&63)<<6|(u.getUint8(++h)&63)<<0);continue}throw new Error("Invalid byte "+g.toString(16))}return i}function C(u){for(var c=0,l=0,i=u.length;l<i;l++){var h=u.charCodeAt(l);if(h<128){c+=1;continue}if(h<2048){c+=2;continue}if(h<65536){c+=3;continue}if(h<1114112){c+=4;continue}throw new Error("bad codepoint "+h)}return c}function T(u,c){var l=v(u,c);if(l!==0){var i=new ArrayBuffer(l),h=new DataView(i);return p(u,h,0,c),i}}var x=65536*65536,M=1/x;function R(u,c){return c=c||0,u.getInt32(c)*x+u.getUint32(c+4)}function b(u,c){return c=c||0,u.getUint32(c)*x+u.getUint32(c+4)}function a(u,c,l){l<9223372036854776e3?(u.setInt32(c,Math.floor(l*M)),u.setInt32(c+4,l&-1)):(u.setUint32(c,2147483647),u.setUint32(c+4,2147483647))}function m(u,c,l){l<18446744073709552e3?(u.setUint32(c,Math.floor(l*M)),u.setInt32(c+4,l&-1)):(u.setUint32(c,4294967295),u.setUint32(c+4,4294967295))}var S=function(){function u(c,l){var i=this;this.map=function(h){for(var d={},g=0;g<h;g++){var L=i.parse();d[L]=i.parse()}return d},this.bin=function(h){var d=new ArrayBuffer(h);return new Uint8Array(d).set(new Uint8Array(i.view.buffer,i.offset,h),0),i.offset+=h,d},this.buf=this.bin,this.str=function(h){var d=O(i.view,i.offset,h);return i.offset+=h,d},this.array=function(h){for(var d=new Array(h),g=0;g<h;g++)d[g]=i.parse();return d},this.ext=function(h){return i.offset+=h,{type:i.view.getInt8(i.offset),data:i.buf(h)}},this.parse=function(){var h=i.view.getUint8(i.offset),d,g;if(!(h&128))return i.offset++,h;if((h&240)===128)return g=h&15,i.offset++,i.map(g);if((h&240)===144)return g=h&15,i.offset++,i.array(g);if((h&224)===160)return g=h&31,i.offset++,i.str(g);if((h&224)===224)return d=i.view.getInt8(i.offset),i.offset++,d;switch(h){case 192:return i.offset++,null;case 193:i.offset++;return;case 194:return i.offset++,!1;case 195:return i.offset++,!0;case 196:return g=i.view.getUint8(i.offset+1),i.offset+=2,i.bin(g);case 197:return g=i.view.getUint16(i.offset+1),i.offset+=3,i.bin(g);case 198:return g=i.view.getUint32(i.offset+1),i.offset+=5,i.bin(g);case 199:return g=i.view.getUint8(i.offset+1),i.offset+=2,i.ext(g);case 200:return g=i.view.getUint16(i.offset+1),i.offset+=3,i.ext(g);case 201:return g=i.view.getUint32(i.offset+1),i.offset+=5,i.ext(g);case 202:return d=i.view.getFloat32(i.offset+1),i.offset+=5,d;case 203:return d=i.view.getFloat64(i.offset+1),i.offset+=9,d;case 204:return d=i.view.getUint8(i.offset+1),i.offset+=2,d;case 205:return d=i.view.getUint16(i.offset+1),i.offset+=3,d;case 206:return d=i.view.getUint32(i.offset+1),i.offset+=5,d;case 207:return d=b(i.view,i.offset+1),i.offset+=9,d;case 208:return d=i.view.getInt8(i.offset+1),i.offset+=2,d;case 209:return d=i.view.getInt16(i.offset+1),i.offset+=3,d;case 210:return d=i.view.getInt32(i.offset+1),i.offset+=5,d;case 211:return d=R(i.view,i.offset+1),i.offset+=9,d;case 212:return g=1,i.offset++,i.ext(g);case 213:return g=2,i.offset++,i.ext(g);case 214:return g=4,i.offset++,i.ext(g);case 215:return g=8,i.offset++,i.ext(g);case 216:return g=16,i.offset++,i.ext(g);case 217:return g=i.view.getUint8(i.offset+1),i.offset+=2,i.str(g);case 218:return g=i.view.getUint16(i.offset+1),i.offset+=3,i.str(g);case 219:return g=i.view.getUint32(i.offset+1),i.offset+=5,i.str(g);case 220:return g=i.view.getUint16(i.offset+1),i.offset+=3,i.array(g);case 221:return g=i.view.getUint32(i.offset+1),i.offset+=5,i.array(g);case 222:return g=i.view.getUint16(i.offset+1),i.offset+=3,i.map(g);case 223:return g=i.view.getUint32(i.offset+1),i.offset+=5,i.map(g)}throw new Error("Unknown type 0x"+h.toString(16))},this.offset=l||0,this.view=c}return u}();function A(u){var c=new DataView(u),l=new S(c),i=l.parse();if(l.offset!==u.byteLength)throw new Error(u.byteLength-l.offset+" trailing bytes");return i}function y(u,c){return Object.keys(u).filter(function(l){var i=u[l],h=typeof i;return(!c||i!=null)&&(h!=="function"||!!i.toJSON)})}function p(u,c,l,i){var h=typeof u;if(typeof u=="string"){var d=C(u);if(d<32)return c.setUint8(l,d|160),s(c,l+1,u),1+d;if(d<256)return c.setUint8(l,217),c.setUint8(l+1,d),s(c,l+2,u),2+d;if(d<65536)return c.setUint8(l,218),c.setUint16(l+1,d),s(c,l+3,u),3+d;if(d<4294967296)return c.setUint8(l,219),c.setUint32(l+1,d),s(c,l+5,u),5+d}if(ArrayBuffer.isView&&ArrayBuffer.isView(u)&&(u=u.buffer),u instanceof ArrayBuffer){var g=u.byteLength;if(g<256)return c.setUint8(l,196),c.setUint8(l+1,g),new Uint8Array(c.buffer).set(new Uint8Array(u),l+2),2+g;if(g<65536)return c.setUint8(l,197),c.setUint16(l+1,g),new Uint8Array(c.buffer).set(new Uint8Array(u),l+3),3+g;if(g<4294967296)return c.setUint8(l,198),c.setUint32(l+1,g),new Uint8Array(c.buffer).set(new Uint8Array(u),l+5),5+g}if(typeof u=="number"){if(Math.floor(u)!==u)return c.setUint8(l,203),c.setFloat64(l+1,u),9;if(u>=0){if(u<128)return c.setUint8(l,u),1;if(u<256)return c.setUint8(l,204),c.setUint8(l+1,u),2;if(u<65536)return c.setUint8(l,205),c.setUint16(l+1,u),3;if(u<4294967296)return c.setUint8(l,206),c.setUint32(l+1,u),5;if(u<18446744073709552e3)return c.setUint8(l,207),m(c,l+1,u),9;throw new Error("Number too big 0x"+u.toString(16))}if(u>=-32)return c.setInt8(l,u),1;if(u>=-128)return c.setUint8(l,208),c.setInt8(l+1,u),2;if(u>=-32768)return c.setUint8(l,209),c.setInt16(l+1,u),3;if(u>=-2147483648)return c.setUint8(l,210),c.setInt32(l+1,u),5;if(u>=-9223372036854776e3)return c.setUint8(l,211),a(c,l+1,u),9;throw new Error("Number too small -0x"+(-u).toString(16).substr(1))}if(h==="undefined")return i?0:(c.setUint8(l,212),c.setUint8(l+1,0),c.setUint8(l+2,0),3);if(u===null)return i?0:(c.setUint8(l,192),1);if(h==="boolean")return c.setUint8(l,u?195:194),1;if(typeof u.toJSON=="function")return p(u.toJSON(),c,l,i);if(h==="object"){var L,_=0,D=void 0,I=Array.isArray(u);if(I?L=u.length:(D=y(u,i),L=D.length),L<16?(c.setUint8(l,L|(I?144:128)),_=1):L<65536?(c.setUint8(l,I?220:222),c.setUint16(l+1,L),_=3):L<4294967296&&(c.setUint8(l,I?221:223),c.setUint32(l+1,L),_=5),I)for(var P=0;P<L;P++)_+=p(u[P],c,l+_,i);else if(D)for(var P=0;P<L;P++){var w=D[P];_+=p(w,c,l+_),_+=p(u[w],c,l+_,i)}return _}if(h==="function")return 0;throw new Error("Unknown type "+h)}function v(u,c){var l=typeof u;if(l==="string"){var i=C(u);if(i<32)return 1+i;if(i<256)return 2+i;if(i<65536)return 3+i;if(i<4294967296)return 5+i}if(ArrayBuffer.isView&&ArrayBuffer.isView(u)&&(u=u.buffer),u instanceof ArrayBuffer){var h=u.byteLength;if(h<256)return 2+h;if(h<65536)return 3+h;if(h<4294967296)return 5+h}if(typeof u=="number"){if(Math.floor(u)!==u)return 9;if(u>=0){if(u<128)return 1;if(u<256)return 2;if(u<65536)return 3;if(u<4294967296)return 5;if(u<18446744073709552e3)return 9;throw new Error("Number too big 0x"+u.toString(16))}if(u>=-32)return 1;if(u>=-128)return 2;if(u>=-32768)return 3;if(u>=-2147483648)return 5;if(u>=-9223372036854776e3)return 9;throw new Error("Number too small -0x"+u.toString(16).substr(1))}if(l==="boolean")return 1;if(u===null)return c?0:1;if(u===void 0)return c?0:3;if(typeof u.toJSON=="function")return v(u.toJSON(),c);if(l==="object"){var d,g=0;if(Array.isArray(u)){d=u.length;for(var L=0;L<d;L++)g+=v(u[L],c)}else{var _=y(u,c);d=_.length;for(var L=0;L<d;L++){var D=_[L];g+=v(D)+v(u[D],c)}}if(d<16)return 1+g;if(d<65536)return 3+g;if(d<4294967296)return 5+g;throw new Error("Array or object too long 0x"+d.toString(16))}if(l==="function")return 0;throw new Error("Unknown type "+l)}e.default={encode:T,decode:A,inspect:f,utf8Write:s,utf8Read:O,utf8ByteCount:C}},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0});var f=o(0),s=f.__importDefault(o(30)),O=f.__importDefault(o(50)),C=f.__importDefault(o(3)),T=f.__importDefault(o(4)),x=f.__importDefault(o(55)),M=f.__importDefault(o(57)),R=f.__importDefault(o(62)),b=f.__importDefault(o(64)),a=f.__importDefault(o(68)),m=f.__importDefault(o(2)),S=o(8),A=f.__importDefault(o(65)),y=f.__importDefault(o(66)),p=f.__importDefault(o(41)),v=(0,M.default)(b.default,x.default);C.default.Crypto=v,C.default.BufferUtils=x.default,C.default.Http=R.default,C.default.Config=b.default,C.default.Transports=a.default,C.default.WebStorage=A.default,s.default.Crypto=v,O.default.Crypto=v,m.default.initLogHandlers(),C.default.Defaults=(0,S.getDefaults)(y.default),C.default.Config.agent&&(C.default.Defaults.agent+=" "+C.default.Config.agent),C.default.Config.noUpgrade&&(C.default.Defaults.upgradeTransports=[]),e.default={ErrorInfo:T.default,Rest:s.default,Realtime:O.default,msgpack:p.default}},function(n){n.exports=JSON.parse('{"name":"ably","description":"Realtime client library for Ably, the realtime messaging service","version":"1.2.50","license":"Apache-2.0","bugs":{"url":"https://github.com/ably/ably-js/issues","email":"support@ably.com"},"main":"./build/ably-node.js","typings":"./ably.d.ts","react-native":{"./build/ably-node.js":"./build/ably-reactnative.js"},"browser":{"./build/ably-node.js":"./build/ably-commonjs.js"},"files":["build/**","ably.d.ts","callbacks.d.ts","callbacks.js","promises.d.ts","promises.js","resources/**","src/**","react/**"],"dependencies":{"@ably/msgpack-js":"^0.4.0","got":"^11.8.5","ws":"^8.14.2"},"peerDependencies":{"react":">=16.8.0","react-dom":">=16.8.0"},"peerDependenciesMeta":{"react":{"optional":true},"react-dom":{"optional":true}},"devDependencies":{"@ably/vcdiff-decoder":"1.0.4","@arethetypeswrong/cli":"^0.13.1","@babel/preset-env":"^7.23.6","@testing-library/react":"^13.3.0","@types/crypto-js":"^4.0.1","@types/jmespath":"^0.15.2","@types/node":"^15.0.0","@types/request":"^2.48.7","@types/ws":"^8.2.0","@typescript-eslint/eslint-plugin":"^5.14.0","@typescript-eslint/parser":"^5.14.0","@vitejs/plugin-react":"^1.3.2","async":"ably-forks/async#requirejs","aws-sdk":"^2.1413.0","babel-loader":"^8.3.0","chai":"^4.2.0","copy-webpack-plugin":"^6.4.1","cors":"^2.8.5","crypto-js":"ably-forks/crypto-js#crypto-lite","eslint":"^7.13.0","eslint-plugin-import":"^2.28.0","eslint-plugin-jsdoc":"^40.0.0","eslint-plugin-react":"^7.32.2","eslint-plugin-react-hooks":"^4.6.0","eslint-plugin-security":"^1.4.0","express":"^4.17.1","glob":"~4.4","google-closure-compiler":"^20180610.0.1","grunt":"^1.6.1","grunt-bump":"^0.3.1","grunt-cli":"~1.2.0","grunt-closure-tools":"^1.0.0","grunt-contrib-concat":"~0.5","grunt-shell":"~1.1","grunt-webpack":"^4.0.2","hexy":"~0.2","jmespath":"^0.16.0","jsdom":"^20.0.0","kexec":"ably-forks/node-kexec#update-for-node-12","minimist":"^1.2.5","mocha":"^8.1.3","mocha-junit-reporter":"^2.2.1","null-loader":"^4.0.1","playwright":"^1.39.0","prettier":"^2.5.1","react":">=18.1.0","react-dom":">=18.1.0","requirejs":"~2.1","shelljs":"~0.8","source-map-explorer":"^2.5.2","ts-loader":"^8.2.0","tsconfig-paths-webpack-plugin":"^4.0.1","tslib":"^2.3.1","typedoc":"^0.23.8","typescript":"^4.6.4","vite":"^4.4.9","vitest":"^0.18.0","webpack":"^4.44.2","webpack-cli":"^4.2.0","webpack-node-externals":"^3.0.0"},"engines":{"node":">=5.10.x"},"repository":"ably/ably-js","jspm":{"registry":"npm","directories":{"lib":"build"},"main":"ably"},"scripts":{"start:react":"npx vite serve","grunt":"grunt","test":"grunt test","test:node":"grunt test:node","test:node:skip-build":"grunt mocha","test:webserver":"grunt test:webserver","test:playwright":"node test/support/runPlaywrightTests.js","test:react":"vitest run","concat":"grunt concat","build":"grunt build:all && npm run build:react","build:node":"grunt build:node","build:browser":"grunt build:browser","build:react":"npm run build:react:mjs && npm run build:react:cjs && cp src/platform/react-hooks/res/package.react.json react/package.json","build:react:mjs":"tsc --project src/platform/react-hooks/tsconfig.mjs.json && cp src/platform/react-hooks/res/package.mjs.json react/mjs/package.json","build:react:cjs":"tsc --project src/platform/react-hooks/tsconfig.cjs.json && cp src/platform/react-hooks/res/package.cjs.json react/cjs/package.json","requirejs":"grunt requirejs","lint":"eslint .","lint:fix":"eslint --fix .","check-closure-compiler":"grunt check-closure-compiler","prepare":"npm run build","format":"prettier --write --ignore-path .gitignore --ignore-path .prettierignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js docs/chrome-mv3.md","format:check":"prettier --check --ignore-path .gitignore --ignore-path .prettierignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","sourcemap":"source-map-explorer build/ably.min.js","sourcemap:noencryption":"source-map-explorer build/ably.noencryption.min.js","docs":"typedoc --entryPoints ably.d.ts --out docs/generated/default --readme docs/landing-pages/default.md && typedoc --entryPoints promises.d.ts --out docs/generated/promises --name \\"ably (Promise-based)\\" --readme docs/landing-pages/promises.md && cp docs/landing-pages/choose-library.html docs/generated/index.html"}}')},function(n,e){},function(n,e,o){(function(f,s){n.exports=s(o(6),o(32),o(25))})(this,function(f){return f.HmacSHA256})},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0});var f=o(0),s=f.__importStar(o(1)),O=f.__importDefault(o(47)),C=f.__importDefault(o(15)),T=f.__importDefault(o(20)),x=f.__importDefault(o(4)),M=f.__importDefault(o(48)),R=function(){},b=function(){function A(y){this.rest=y,this.admin=new a(y)}return A}(),a=function(){function A(y){this.rest=y,this.deviceRegistrations=new m(y),this.channelSubscriptions=new S(y)}return A.prototype.publish=function(y,p,v){var u=this.rest,c=u.options.useBinaryProtocol?s.Format.msgpack:s.Format.json,l=s.defaultPostHeaders(u.options,c),i={},h=s.mixin({recipient:y},p);if(typeof v!="function"){if(this.rest.options.promises)return s.promisify(this,"publish",arguments);v=R}u.options.headers&&s.mixin(l,u.options.headers),u.options.pushFullWait&&s.mixin(i,{fullWait:"true"});var d=s.encodeBody(h,c);C.default.post(u,"/push/publish",d,l,i,null,function(g){return v(g)})},A}(),m=function(){function A(y){this.rest=y}return A.prototype.save=function(y,p){var v=this.rest,u=O.default.fromValues(y),c=v.options.useBinaryProtocol?s.Format.msgpack:s.Format.json,l=s.defaultPostHeaders(v.options,c),i={};if(typeof p!="function"){if(this.rest.options.promises)return s.promisify(this,"save",arguments);p=R}v.options.headers&&s.mixin(l,v.options.headers),v.options.pushFullWait&&s.mixin(i,{fullWait:"true"});var h=s.encodeBody(u,c);C.default.put(v,"/push/deviceRegistrations/"+encodeURIComponent(y.id),h,l,i,null,function(d,g,L,_){p(d,d?void 0:O.default.fromResponseBody(g,_?void 0:c))})},A.prototype.get=function(y,p){var v=this.rest,u=v.options.useBinaryProtocol?s.Format.msgpack:s.Format.json,c=s.defaultGetHeaders(v.options,u),l=y.id||y;if(typeof p!="function"){if(this.rest.options.promises)return s.promisify(this,"get",arguments);p=R}if(typeof l!="string"||!l.length){p(new x.default("First argument to DeviceRegistrations#get must be a deviceId string or DeviceDetails",4e4,400));return}v.options.headers&&s.mixin(c,v.options.headers),C.default.get(v,"/push/deviceRegistrations/"+encodeURIComponent(l),c,{},null,function(i,h,d,g){p(i,i?void 0:O.default.fromResponseBody(h,g?void 0:u))})},A.prototype.list=function(y,p){var v=this.rest,u=v.options.useBinaryProtocol?s.Format.msgpack:s.Format.json,c=this.rest.http.supportsLinkHeaders?void 0:u,l=s.defaultGetHeaders(v.options,u);if(typeof p!="function"){if(this.rest.options.promises)return s.promisify(this,"list",arguments);p=R}v.options.headers&&s.mixin(l,v.options.headers),new T.default(v,"/push/deviceRegistrations",l,c,function(i,h,d){return O.default.fromResponseBody(i,d?void 0:u)}).get(y,p)},A.prototype.remove=function(y,p){var v=this.rest,u=v.options.useBinaryProtocol?s.Format.msgpack:s.Format.json,c=s.defaultGetHeaders(v.options,u),l={},i=y.id||y;if(typeof p!="function"){if(this.rest.options.promises)return s.promisify(this,"remove",arguments);p=R}if(typeof i!="string"||!i.length){p(new x.default("First argument to DeviceRegistrations#remove must be a deviceId string or DeviceDetails",4e4,400));return}v.options.headers&&s.mixin(c,v.options.headers),v.options.pushFullWait&&s.mixin(l,{fullWait:"true"}),C.default.delete(v,"/push/deviceRegistrations/"+encodeURIComponent(i),c,l,null,function(h){return p(h)})},A.prototype.removeWhere=function(y,p){var v=this.rest,u=v.options.useBinaryProtocol?s.Format.msgpack:s.Format.json,c=s.defaultGetHeaders(v.options,u);if(typeof p!="function"){if(this.rest.options.promises)return s.promisify(this,"removeWhere",arguments);p=R}v.options.headers&&s.mixin(c,v.options.headers),v.options.pushFullWait&&s.mixin(y,{fullWait:"true"}),C.default.delete(v,"/push/deviceRegistrations",c,y,null,function(l){return p(l)})},A}(),S=function(){function A(y){this.remove=A.prototype.removeWhere,this.rest=y}return A.prototype.save=function(y,p){var v=this.rest,u=M.default.fromValues(y),c=v.options.useBinaryProtocol?s.Format.msgpack:s.Format.json,l=s.defaultPostHeaders(v.options,c),i={};if(typeof p!="function"){if(this.rest.options.promises)return s.promisify(this,"save",arguments);p=R}v.options.headers&&s.mixin(l,v.options.headers),v.options.pushFullWait&&s.mixin(i,{fullWait:"true"});var h=s.encodeBody(u,c);C.default.post(v,"/push/channelSubscriptions",h,l,i,null,function(d,g,L,_){p(d,!d&&M.default.fromResponseBody(g,_?void 0:c))})},A.prototype.list=function(y,p){var v=this.rest,u=v.options.useBinaryProtocol?s.Format.msgpack:s.Format.json,c=this.rest.http.supportsLinkHeaders?void 0:u,l=s.defaultGetHeaders(v.options,u);if(typeof p!="function"){if(this.rest.options.promises)return s.promisify(this,"list",arguments);p=R}v.options.headers&&s.mixin(l,v.options.headers),new T.default(v,"/push/channelSubscriptions",l,c,function(i,h,d){return M.default.fromResponseBody(i,d?void 0:u)}).get(y,p)},A.prototype.removeWhere=function(y,p){var v=this.rest,u=v.options.useBinaryProtocol?s.Format.msgpack:s.Format.json,c=s.defaultGetHeaders(v.options,u);if(typeof p!="function"){if(this.rest.options.promises)return s.promisify(this,"removeWhere",arguments);p=R}v.options.headers&&s.mixin(c,v.options.headers),v.options.pushFullWait&&s.mixin(y,{fullWait:"true"}),C.default.delete(v,"/push/channelSubscriptions",c,y,null,function(l){return p(l)})},A.prototype.listChannels=function(y,p){var v=this.rest,u=v.options.useBinaryProtocol?s.Format.msgpack:s.Format.json,c=this.rest.http.supportsLinkHeaders?void 0:u,l=s.defaultGetHeaders(v.options,u);if(typeof p!="function"){if(this.rest.options.promises)return s.promisify(this,"listChannels",arguments);p=R}v.options.headers&&s.mixin(l,v.options.headers),v.options.pushFullWait&&s.mixin(y,{fullWait:"true"}),new T.default(v,"/push/channels",l,c,function(i,h,d){for(var g=!d&&u?s.decodeBody(i,u):i,L=0;L<g.length;L++)g[L]=String(g[L]);return g}).get(y,p)},A}();e.default=b},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0});var f=o(0),s=f.__importStar(o(1)),O=f.__importDefault(o(4)),C;(function(M){M.Phone="phone",M.Tablet="tablet",M.Desktop="desktop",M.TV="tv",M.Watch="watch",M.Car="car",M.Embedded="embedded",M.Other="other"})(C||(C={}));var T;(function(M){M.Android="android",M.IOS="ios",M.Browser="browser"})(T||(T={}));var x=function(){function M(){}return M.prototype.toJSON=function(){var R,b,a;return{id:this.id,deviceSecret:this.deviceSecret,platform:this.platform,formFactor:this.formFactor,clientId:this.clientId,metadata:this.metadata,deviceIdentityToken:this.deviceIdentityToken,push:{recipient:(R=this.push)===null||R===void 0?void 0:R.recipient,state:(b=this.push)===null||b===void 0?void 0:b.state,error:(a=this.push)===null||a===void 0?void 0:a.error}}},M.prototype.toString=function(){var R,b,a,m,S="[DeviceDetails";return this.id&&(S+="; id="+this.id),this.platform&&(S+="; platform="+this.platform),this.formFactor&&(S+="; formFactor="+this.formFactor),this.clientId&&(S+="; clientId="+this.clientId),this.metadata&&(S+="; metadata="+this.metadata),this.deviceIdentityToken&&(S+="; deviceIdentityToken="+JSON.stringify(this.deviceIdentityToken)),!((R=this.push)===null||R===void 0)&&R.recipient&&(S+="; push.recipient="+JSON.stringify(this.push.recipient)),!((b=this.push)===null||b===void 0)&&b.state&&(S+="; push.state="+this.push.state),!((a=this.push)===null||a===void 0)&&a.error&&(S+="; push.error="+JSON.stringify(this.push.error)),!((m=this.push)===null||m===void 0)&&m.metadata&&(S+="; push.metadata="+this.push.metadata),S+="]",S},M.fromResponseBody=function(R,b){return b&&(R=s.decodeBody(R,b)),s.isArray(R)?M.fromValuesArray(R):M.fromValues(R)},M.fromValues=function(R){return R.error=R.error&&O.default.fromValues(R.error),Object.assign(new M,R)},M.fromValuesArray=function(R){for(var b=R.length,a=new Array(b),m=0;m<b;m++)a[m]=M.fromValues(R[m]);return a},M.toRequestBody=s.encodeBody,M}();e.default=x},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0});var f=o(0),s=f.__importStar(o(1)),O=function(){function C(){}return C.prototype.toJSON=function(){return{channel:this.channel,deviceId:this.deviceId,clientId:this.clientId}},C.prototype.toString=function(){var T="[PushChannelSubscription";return this.channel&&(T+="; channel="+this.channel),this.deviceId&&(T+="; deviceId="+this.deviceId),this.clientId&&(T+="; clientId="+this.clientId),T+="]",T},C.fromResponseBody=function(T,x){return x&&(T=s.decodeBody(T,x)),s.isArray(T)?C.fromValuesArray(T):C.fromValues(T)},C.fromValues=function(T){return Object.assign(new C,T)},C.fromValuesArray=function(T){for(var x=T.length,M=new Array(x),R=0;R<x;R++)M[R]=C.fromValues(T[R]);return M},C.toRequestBody=s.encodeBody,C}();e.default=O},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0});var f=o(0),s=f.__importStar(o(1)),O=function(){function v(u){this.count=u&&u.count||0,this.data=u&&u.data||0,this.uncompressedData=u&&u.uncompressedData||0,this.failed=u&&u.failed||0,this.refused=u&&u.refused||0}return v}(),C=function(v){f.__extends(u,v);function u(c){var l=v.call(this,c)||this;return c&&c.category&&(l.category={},s.forInOwnNonNullProperties(c.category,function(i){l.category[i]=new O(c.category[i])})),l}return u}(O),T=function(){function v(u){this.peak=u&&u.peak||0,this.min=u&&u.min||0,this.mean=u&&u.mean||0,this.opened=u&&u.opened||0,this.refused=u&&u.refused||0}return v}(),x=function(){function v(u){this.succeeded=u&&u.succeeded||0,this.failed=u&&u.failed||0,this.refused=u&&u.refused||0}return v}(),M=function(){function v(u){this.plain=new T(u&&u.plain),this.tls=new T(u&&u.tls),this.all=new T(u&&u.all)}return v}(),R=function(){function v(u){this.messages=new C(u&&u.messages),this.presence=new C(u&&u.presence),this.all=new C(u&&u.all)}return v}(),b=function(){function v(u){this.realtime=new R(u&&u.realtime),this.rest=new R(u&&u.rest),this.webhook=new R(u&&u.webhook),this.sharedQueue=new R(u&&u.sharedQueue),this.externalQueue=new R(u&&u.externalQueue),this.httpEvent=new R(u&&u.httpEvent),this.push=new R(u&&u.push),this.all=new R(u&&u.all)}return v}(),a=function(){function v(u){this.all=new R(u&&u.all),this.inbound=new b(u&&u.inbound),this.outbound=new b(u&&u.outbound)}return v}(),m=function(){function v(u){this.all=new R(u&&u.all),this.producerPaid=new a(u&&u.producerPaid),this.consumerPaid=new a(u&&u.consumerPaid)}return v}(),S=function(){function v(u){this.messages=u&&u.messages||0;var c=u&&u.notifications;this.notifications={invalid:c&&c.invalid||0,attempted:c&&c.attempted||0,successful:c&&c.successful||0,failed:c&&c.failed||0},this.directPublishes=u&&u.directPublishes||0}return v}(),A=function(){function v(u){this.succeeded=u&&u.succeeded||0,this.skipped=u&&u.skipped||0,this.failed=u&&u.failed||0}return v}(),y=function(){function v(u){var c=this;this.delta=void 0,u&&u.delta&&(this.delta={},s.forInOwnNonNullProperties(u.delta,function(l){c.delta[l]=new A(u.delta[l])}))}return v}(),p=function(v){f.__extends(u,v);function u(c){var l=v.call(this,c)||this;return l.persisted=new R(c&&c.persisted),l.connections=new M(c&&c.connections),l.channels=new T(c&&c.channels),l.apiRequests=new x(c&&c.apiRequests),l.tokenRequests=new x(c&&c.tokenRequests),l.xchgProducer=new m(c&&c.xchgProducer),l.xchgConsumer=new m(c&&c.xchgConsumer),l.push=new S(c&&c.pushStats),l.processed=new y(c&&c.processed),l.inProgress=c&&c.inProgress||void 0,l.unit=c&&c.unit||void 0,l.intervalId=c&&c.intervalId||void 0,l}return u.fromValues=function(c){return new u(c)},u}(a);e.default=p},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0});var f=o(0),s=f.__importStar(o(1)),O=f.__importDefault(o(30)),C=f.__importDefault(o(7)),T=f.__importDefault(o(2)),x=f.__importDefault(o(51)),M=f.__importDefault(o(38)),R=f.__importDefault(o(8)),b=f.__importDefault(o(4)),a=f.__importDefault(o(10)),m=f.__importDefault(o(35)),S=f.__importDefault(o(3)),A=f.__importDefault(o(9)),y=function(v){f.__extends(u,v);function u(c){var l=v.call(this,c)||this;return T.default.logAction(T.default.LOG_MINOR,"Realtime()",""),l.connection=new x.default(l,l.options),l.channels=new p(l),c.autoConnect!==!1&&l.connect(),l}return u.prototype.connect=function(){T.default.logAction(T.default.LOG_MINOR,"Realtime.connect()",""),this.connection.connect()},u.prototype.close=function(){T.default.logAction(T.default.LOG_MINOR,"Realtime.close()",""),this.connection.close()},u.Promise=function(c){return c=R.default.objectifyOptions(c),c.promises=!0,new u(c)},u.Callbacks=u,u.Utils=s,u.ConnectionManager=m.default,u.Platform=S.default,u.ProtocolMessage=a.default,u.Message=A.default,u}(O.default),p=function(v){f.__extends(u,v);function u(c){var l=v.call(this)||this;return l.realtime=c,l.all=Object.create(null),c.connection.connectionManager.on("transport.active",function(){l.onTransportActive()}),l}return u.prototype.channelSerials=function(){for(var c={},l=0,i=s.keysArray(this.all,!0);l<i.length;l++){var h=i[l],d=this.all[h];d.properties.channelSerial&&(c[h]=d.properties.channelSerial)}return c},u.prototype.recoverChannels=function(c){for(var l=0,i=s.keysArray(c,!0);l<i.length;l++){var h=i[l],d=this.get(h);d.properties.channelSerial=c[h]}},u.prototype.onChannelMessage=function(c){var l=c.channel;if(l===void 0){T.default.logAction(T.default.LOG_ERROR,"Channels.onChannelMessage()","received event unspecified channel, action = "+c.action);return}var i=this.all[l];if(!i){T.default.logAction(T.default.LOG_ERROR,"Channels.onChannelMessage()","received event for non-existent channel: "+l);return}i.onMessage(c)},u.prototype.onTransportActive=function(){for(var c in this.all){var l=this.all[c];l.state==="attaching"||l.state==="detaching"?l.checkPendingState():l.state==="suspended"?l._attach(!1,null):l.state==="attached"&&l.requestState("attaching")}},u.prototype.propogateConnectionInterruption=function(c,l){var i={closing:"detached",closed:"detached",failed:"failed",suspended:"suspended"},h=["attaching","attached","detaching","suspended"],d=i[c];for(var g in this.all){var L=this.all[g];s.arrIn(h,L.state)&&L.notifyState(d,l)}},u.prototype.get=function(c,l){c=String(c);var i=this.all[c];if(!i)i=this.all[c]=new M.default(this.realtime,c,l);else if(l){if(i._shouldReattachToSetOptions(l,i.channelOptions))throw new b.default("Channels.get() cannot be used to set channel options that would cause the channel to reattach. Please, use RealtimeChannel.setOptions() instead.",4e4,400);i.setOptions(l)}return i},u.prototype.getDerived=function(c,l,i){if(l.filter){var h=s.toBase64(l.filter),d=s.matchDerivedChannel(c);c="[filter=".concat(h).concat(d.qualifierParam,"]").concat(d.channelName)}return this.get(c,i)},u.prototype.release=function(c){c=String(c);var l=this.all[c];if(l){var i=l.getReleaseErr();if(i)throw i;delete this.all[c]}},u}(C.default);e.default=y},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0});var f=o(0),s=f.__importStar(o(1)),O=f.__importDefault(o(7)),C=f.__importDefault(o(35)),T=f.__importDefault(o(2)),x=f.__importDefault(o(37)),M=f.__importDefault(o(3));function R(){}var b=function(a){f.__extends(m,a);function m(S,A){var y=a.call(this)||this;return y.whenState=function(p,v){return O.default.prototype.whenState.call(y,p,y.state,v,new x.default(void 0,p))},y.ably=S,y.connectionManager=new C.default(S,A),y.state=y.connectionManager.state.state,y.key=void 0,y.id=void 0,y.errorReason=null,y.connectionManager.on("connectionstate",function(p){var v=y.state=p.current;M.default.Config.nextTick(function(){y.emit(v,p)})}),y.connectionManager.on("update",function(p){M.default.Config.nextTick(function(){y.emit("update",p)})}),y}return m.prototype.connect=function(){T.default.logAction(T.default.LOG_MINOR,"Connection.connect()",""),this.connectionManager.requestState({state:"connecting"})},m.prototype.ping=function(S){if(T.default.logAction(T.default.LOG_MINOR,"Connection.ping()",""),!S){if(this.ably.options.promises)return s.promisify(this,"ping",arguments);S=R}this.connectionManager.ping(null,S)},m.prototype.close=function(){T.default.logAction(T.default.LOG_MINOR,"Connection.close()","connectionKey = "+this.key),this.connectionManager.requestState({state:"closing"})},Object.defineProperty(m.prototype,"recoveryKey",{get:function(){return this.createRecoveryKey()},enumerable:!1,configurable:!0}),m.prototype.createRecoveryKey=function(){return this.connectionManager.createRecoveryKey()},m}(O.default);e.default=b},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0}),e.PendingMessage=void 0;var f=o(0),s=f.__importDefault(o(10)),O=f.__importStar(o(1)),C=f.__importDefault(o(7)),T=f.__importDefault(o(2)),x=f.__importDefault(o(36)),M=f.__importDefault(o(4)),R=s.default.Action,b=function(){function m(S,A){this.message=S,this.callback=A,this.merged=!1;var y=S.action;this.sendAttempted=!1,this.ackRequired=y==R.MESSAGE||y==R.PRESENCE}return m}();e.PendingMessage=b;var a=function(m){f.__extends(S,m);function S(A){var y=m.call(this)||this;return y.transport=A,y.messageQueue=new x.default,A.on("ack",function(p,v){y.onAck(p,v)}),A.on("nack",function(p,v,u){y.onNack(p,v,u)}),y}return S.prototype.onAck=function(A,y){T.default.logAction(T.default.LOG_MICRO,"Protocol.onAck()","serial = "+A+"; count = "+y),this.messageQueue.completeMessages(A,y)},S.prototype.onNack=function(A,y,p){T.default.logAction(T.default.LOG_ERROR,"Protocol.onNack()","serial = "+A+"; count = "+y+"; err = "+O.inspectError(p)),p||(p=new M.default("Unable to send message; channel not responding",50001,500)),this.messageQueue.completeMessages(A,y,p)},S.prototype.onceIdle=function(A){var y=this.messageQueue;if(y.count()===0){A();return}y.once("idle",A)},S.prototype.send=function(A){A.ackRequired&&this.messageQueue.push(A),T.default.shouldLog(T.default.LOG_MICRO)&&T.default.logAction(T.default.LOG_MICRO,"Protocol.send()","sending msg; "+s.default.stringify(A.message)),A.sendAttempted=!0,this.transport.send(A.message)},S.prototype.getTransport=function(){return this.transport},S.prototype.getPendingMessages=function(){return this.messageQueue.copyAll()},S.prototype.clearPendingMessages=function(){return this.messageQueue.clear()},S.prototype.finish=function(){var A=this.transport;this.onceIdle(function(){A.disconnect()})},S}(C.default);e.default=a},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0});var f=o(0),s=f.__importDefault(o(3)),O=f.__importStar(o(1)),C=f.__importDefault(o(26)),T=f.__importDefault(o(8)),x=f.__importDefault(o(2)),M=f.__importDefault(o(10)),R=f.__importDefault(o(4)),b="web_socket";function a(A){return!!A.on}var m=function(A){f.__extends(y,A);function y(p,v,u){var c=A.call(this,p,v,u)||this;return c.shortName=b,u.heartbeats=s.default.Config.useProtocolHeartbeats,c.wsHost=T.default.getHost(u.options,u.host,!0),c}return y.isAvailable=function(){return!!s.default.Config.WebSocket},y.prototype.createWebSocket=function(p,v){return this.uri=p+O.toQueryString(v),new s.default.Config.WebSocket(this.uri)},y.prototype.toString=function(){return"WebSocketTransport; uri="+this.uri},y.prototype.connect=function(){x.default.logAction(x.default.LOG_MINOR,"WebSocketTransport.connect()","starting"),C.default.prototype.connect.call(this);var p=this,v=this.params,u=v.options,c=u.tls?"wss://":"ws://",l=c+this.wsHost+":"+T.default.getPort(u)+"/";x.default.logAction(x.default.LOG_MINOR,"WebSocketTransport.connect()","uri: "+l),this.auth.getAuthParams(function(i,h){if(!p.isDisposed){var d="";for(var g in h)d+=" "+g+": "+h[g]+";";if(x.default.logAction(x.default.LOG_MINOR,"WebSocketTransport.connect()","authParams:"+d+" err: "+i),i){p.disconnect(i);return}var L=v.getConnectParams(h);try{var _=p.wsConnection=p.createWebSocket(l,L);_.binaryType=s.default.Config.binaryType,_.onopen=function(){p.onWsOpen()},_.onclose=function(D){p.onWsClose(D)},_.onmessage=function(D){p.onWsData(D.data)},_.onerror=function(D){p.onWsError(D)},a(_)&&_.on("ping",function(){p.onActivity()})}catch(D){x.default.logAction(x.default.LOG_ERROR,"WebSocketTransport.connect()","Unexpected exception creating websocket: err = "+(D.stack||D.message)),p.disconnect(D)}}})},y.prototype.send=function(p){var v=this.wsConnection;if(!v){x.default.logAction(x.default.LOG_ERROR,"WebSocketTransport.send()","No socket connection");return}try{v.send(M.default.serialize(p,this.params.format))}catch(c){var u="Exception from ws connection when trying to send: "+O.inspectError(c);x.default.logAction(x.default.LOG_ERROR,"WebSocketTransport.send()",u),this.finish("disconnected",new R.default(u,5e4,500))}},y.prototype.onWsData=function(p){x.default.logAction(x.default.LOG_MICRO,"WebSocketTransport.onWsData()","data received; length = "+p.length+"; type = "+typeof p);try{this.onProtocolMessage(M.default.deserialize(p,this.format))}catch(v){x.default.logAction(x.default.LOG_ERROR,"WebSocketTransport.onWsData()","Unexpected exception handing channel message: "+v.stack)}},y.prototype.onWsOpen=function(){x.default.logAction(x.default.LOG_MINOR,"WebSocketTransport.onWsOpen()","opened WebSocket"),this.emit("preconnect")},y.prototype.onWsClose=function(p){var v,u;if(typeof p=="object"?(u=p.code,v=p.wasClean||u===1e3):(u=p,v=u==1e3),delete this.wsConnection,v){x.default.logAction(x.default.LOG_MINOR,"WebSocketTransport.onWsClose()","Cleanly closed WebSocket");var c=new R.default("Websocket closed",80003,400);this.finish("disconnected",c)}else{var l="Unclean disconnection of WebSocket ; code = "+u,c=new R.default(l,80003,400);x.default.logAction(x.default.LOG_MINOR,"WebSocketTransport.onWsClose()",l),this.finish("disconnected",c)}this.emit("disposed")},y.prototype.onWsError=function(p){var v=this;x.default.logAction(x.default.LOG_MINOR,"WebSocketTransport.onError()","Error from WebSocket: "+p.message),s.default.Config.nextTick(function(){v.disconnect(Error(p.message))})},y.prototype.dispose=function(){x.default.logAction(x.default.LOG_MINOR,"WebSocketTransport.dispose()",""),this.isDisposed=!0;var p=this.wsConnection;p&&(p.onmessage=function(){},delete this.wsConnection,s.default.Config.nextTick(function(){if(x.default.logAction(x.default.LOG_MICRO,"WebSocketTransport.dispose()","closing websocket"),!p)throw new Error("WebSocketTransport.dispose(): wsConnection is not defined");p.close()}))},y}(C.default);function S(A){return m.isAvailable()&&(A.supportedTransports[b]=m),m}e.default=S},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0});var f=o(0),s=f.__importStar(o(1)),O=f.__importDefault(o(34)),C=f.__importDefault(o(7)),T=f.__importDefault(o(2)),x=f.__importDefault(o(16)),M=f.__importStar(o(4)),R=f.__importDefault(o(38)),b=f.__importDefault(o(24)),a=f.__importDefault(o(39)),m=function(){};function S(c){return c.channel.realtime.auth.clientId}function A(c){var l=c.channel.realtime,i=l.auth.clientId;return(!i||i==="*")&&l.connection.state==="connected"}function y(c,l,i){switch(c.state){case"attached":case"suspended":i();break;case"initialized":case"detached":case"detaching":case"attaching":c.attach(function(h){h?l(h):i()});break;default:l(M.default.fromValues(c.invalidStateError()))}}function p(c,l){if(c.isSynthesized()||l.isSynthesized())return c.timestamp>=l.timestamp;var i=c.parseId(),h=l.parseId();return i.msgSerial===h.msgSerial?i.index>h.index:i.msgSerial>h.msgSerial}var v=function(c){f.__extends(l,c);function l(i){var h=c.call(this,i)||this;return h.channel=i,h.syncComplete=!1,h.members=new u(h,function(d){return d.clientId+":"+d.connectionId}),h._myMembers=new u(h,function(d){return d.clientId}),h.subscriptions=new C.default,h.pendingPresence=[],h}return l.prototype.enter=function(i,h){if(A(this))throw new M.default("clientId must be specified to enter a presence channel",40012,400);return this._enterOrUpdateClient(void 0,void 0,i,"enter",h)},l.prototype.update=function(i,h){if(A(this))throw new M.default("clientId must be specified to update presence data",40012,400);return this._enterOrUpdateClient(void 0,void 0,i,"update",h)},l.prototype.enterClient=function(i,h,d){return this._enterOrUpdateClient(void 0,i,h,"enter",d)},l.prototype.updateClient=function(i,h,d){return this._enterOrUpdateClient(void 0,i,h,"update",d)},l.prototype._enterOrUpdateClient=function(i,h,d,g,L){var _=this;if(!L)if(typeof d=="function")L=d,d=null;else{if(this.channel.realtime.options.promises)return s.promisify(this,"_enterOrUpdateClient",[i,h,d,g]);L=m}var D=this.channel;if(!D.connectionManager.activeState()){L(D.connectionManager.getError());return}T.default.logAction(T.default.LOG_MICRO,"RealtimePresence."+g+"Client()","channel = "+D.name+", id = "+i+", client = "+(h||"(implicit) "+S(this)));var I=x.default.fromData(d);I.action=g,i&&(I.id=i),h&&(I.clientId=h),x.default.encode(I,D.channelOptions,function(P){if(P){L(P);return}switch(D.state){case"attached":D.sendPresence(I,L);break;case"initialized":case"detached":D.attach();case"attaching":_.pendingPresence.push({presence:I,callback:L});break;default:P=new M.PartialErrorInfo("Unable to "+g+" presence channel while in "+D.state+" state",90001),P.code=90001,L(P)}})},l.prototype.leave=function(i,h){if(A(this))throw new M.default("clientId must have been specified to enter or leave a presence channel",40012,400);return this.leaveClient(void 0,i,h)},l.prototype.leaveClient=function(i,h,d){if(!d)if(typeof h=="function")d=h,h=null;else{if(this.channel.realtime.options.promises)return s.promisify(this,"leaveClient",[i,h]);d=m}var g=this.channel;if(!g.connectionManager.activeState()){d==null||d(g.connectionManager.getError());return}T.default.logAction(T.default.LOG_MICRO,"RealtimePresence.leaveClient()","leaving; channel = "+this.channel.name+", client = "+i);var L=x.default.fromData(h);switch(L.action="leave",i&&(L.clientId=i),g.state){case"attached":g.sendPresence(L,d);break;case"attaching":this.pendingPresence.push({presence:L,callback:d});break;case"initialized":case"failed":{var _=new M.PartialErrorInfo("Unable to leave presence channel (incompatible state)",90001);d==null||d(_);break}default:d==null||d(g.invalidStateError())}},l.prototype.get=function(i,h){var d=this,g=Array.prototype.slice.call(arguments);g.length==1&&typeof g[0]=="function"&&g.unshift(null),i=g[0],h=g[1];var L=!i||("waitForSync"in i?i.waitForSync:!0);if(!h){if(this.channel.realtime.options.promises)return s.promisify(this,"get",g);h=m}function _(D){h(null,i?D.list(i):D.values())}if(this.channel.state==="suspended"){L?h(M.default.fromValues({statusCode:400,code:91005,message:"Presence state is out of sync due to channel being in the SUSPENDED state"})):_(this.members);return}y(this.channel,h,function(){var D=d.members;L?D.waitSync(function(){_(D)}):_(D)})},l.prototype.history=function(i,h){if(T.default.logAction(T.default.LOG_MICRO,"RealtimePresence.history()","channel = "+this.name),h===void 0)if(typeof i=="function")h=i,i=null;else{if(this.channel.realtime.options.promises)return s.promisify(this,"history",arguments);h=m}i&&i.untilAttach&&(this.channel.state==="attached"?(delete i.untilAttach,i.from_serial=this.channel.properties.attachSerial):h(new M.default("option untilAttach requires the channel to be attached, was: "+this.channel.state,4e4,400))),O.default.prototype._history.call(this,i,h)},l.prototype.setPresence=function(i,h,d){T.default.logAction(T.default.LOG_MICRO,"RealtimePresence.setPresence()","received presence for "+i.length+" participants; syncChannelSerial = "+d);var g,L,_=this.members,D=this._myMembers,I=[],P=this.channel.connectionManager.connectionId;h&&(this.members.startSync(),d&&(L=d.match(/^[\w-]+:(.*)$/))&&(g=L[1]));for(var w=0;w<i.length;w++){var U=x.default.fromValues(i[w]);switch(U.action){case"leave":_.remove(U)&&I.push(U),U.connectionId===P&&!U.isSynthesized()&&D.remove(U);break;case"enter":case"present":case"update":_.put(U)&&I.push(U),U.connectionId===P&&D.put(U);break}}h&&!g&&(_.endSync(),this.channel.syncChannelSerial=null);for(var w=0;w<I.length;w++){var U=I[w];this.subscriptions.emit(U.action,U)}},l.prototype.onAttached=function(i){T.default.logAction(T.default.LOG_MINOR,"RealtimePresence.onAttached()","channel = "+this.channel.name+", hasPresence = "+i),i?this.members.startSync():(this._synthesizeLeaves(this.members.values()),this.members.clear()),this._ensureMyMembersPresent();var h=this.pendingPresence,d=h.length;if(d){this.pendingPresence=[];var g=[],L=b.default.create();T.default.logAction(T.default.LOG_MICRO,"RealtimePresence.onAttached","sending "+d+" queued presence messages");for(var _=0;_<d;_++){var D=h[_];g.push(D.presence),L.push(D.callback)}this.channel.sendPresence(g,L)}},l.prototype.actOnChannelState=function(i,h,d){switch(i){case"attached":this.onAttached(h);break;case"detached":case"failed":this._clearMyMembers(),this.members.clear();case"suspended":this.failPendingPresence(d);break}},l.prototype.failPendingPresence=function(i){if(this.pendingPresence.length){T.default.logAction(T.default.LOG_MINOR,"RealtimeChannel.failPendingPresence","channel; name = "+this.channel.name+", err = "+s.inspectError(i));for(var h=0;h<this.pendingPresence.length;h++)try{this.pendingPresence[h].callback(i)}catch{}this.pendingPresence=[]}},l.prototype._clearMyMembers=function(){this._myMembers.clear()},l.prototype._ensureMyMembersPresent=function(){var i=this,h=this._myMembers,d=function(_){if(_){var D="Presence auto-re-enter failed: "+_.toString(),I=new M.default(D,91004,400);T.default.logAction(T.default.LOG_ERROR,"RealtimePresence._ensureMyMembersPresent()",D);var P=new a.default(i.channel.state,i.channel.state,!0,!1,I);i.channel.emit("update",P)}};for(var g in h.map){var L=h.map[g];T.default.logAction(T.default.LOG_MICRO,"RealtimePresence._ensureMyMembersPresent()",'Auto-reentering clientId "'+L.clientId+'" into the presence set'),this._enterOrUpdateClient(L.id,L.clientId,L.data,"enter",d)}},l.prototype._synthesizeLeaves=function(i){var h=this.subscriptions;s.arrForEach(i,function(d){var g=x.default.fromValues({action:"leave",connectionId:d.connectionId,clientId:d.clientId,data:d.data,encoding:d.encoding,timestamp:s.now()});h.emit("leave",g)})},l.prototype.on=function(){for(var i=[],h=0;h<arguments.length;h++)i[h]=arguments[h];T.default.renamedMethod("RealtimePresence","on","subscribe"),this.subscribe.apply(this,i)},l.prototype.off=function(){for(var i=[],h=0;h<arguments.length;h++)i[h]=arguments[h];T.default.renamedMethod("RealtimePresence","off","unsubscribe"),this.unsubscribe.apply(this,i)},l.prototype.subscribe=function(){for(var i=[],h=0;h<arguments.length;h++)i[h]=arguments[h];var d=R.default.processListenerArgs(i),g=d[0],L=d[1],_=d[2],D=this.channel;if(!_){if(this.channel.realtime.options.promises)return s.promisify(this,"subscribe",[g,L]);_=m}if(D.state==="failed"){_(M.default.fromValues(D.invalidStateError()));return}this.subscriptions.on(g,L),D.attach(_)},l.prototype.unsubscribe=function(){for(var i=[],h=0;h<arguments.length;h++)i[h]=arguments[h];var d=R.default.processListenerArgs(i),g=d[0],L=d[1];this.subscriptions.off(g,L)},l}(O.default),u=function(c){f.__extends(l,c);function l(i,h){var d=c.call(this)||this;return d.presence=i,d.map=Object.create(null),d.syncInProgress=!1,d.residualMembers=null,d.memberKey=h,d}return l.prototype.get=function(i){return this.map[i]},l.prototype.getClient=function(i){var h=this.map,d=[];for(var g in h){var L=h[g];L.clientId==i&&L.action!="absent"&&d.push(L)}return d},l.prototype.list=function(i){var h=this.map,d=i&&i.clientId,g=i&&i.connectionId,L=[];for(var _ in h){var D=h[_];D.action!=="absent"&&(d&&d!=D.clientId||g&&g!=D.connectionId||L.push(D))}return L},l.prototype.put=function(i){(i.action==="enter"||i.action==="update")&&(i=x.default.fromValues(i),i.action="present");var h=this.map,d=this.memberKey(i);this.residualMembers&&delete this.residualMembers[d];var g=h[d];return g&&!p(i,g)?!1:(h[d]=i,!0)},l.prototype.values=function(){var i=this.map,h=[];for(var d in i){var g=i[d];g.action!="absent"&&h.push(g)}return h},l.prototype.remove=function(i){var h=this.map,d=this.memberKey(i),g=h[d];return g&&!p(i,g)?!1:(this.syncInProgress?(i=x.default.fromValues(i),i.action="absent",h[d]=i):delete h[d],!0)},l.prototype.startSync=function(){var i=this.map,h=this.syncInProgress;T.default.logAction(T.default.LOG_MINOR,"PresenceMap.startSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+h),this.syncInProgress||(this.residualMembers=s.copy(i),this.setInProgress(!0))},l.prototype.endSync=function(){var i=this.map,h=this.syncInProgress;if(T.default.logAction(T.default.LOG_MINOR,"PresenceMap.endSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+h),h){for(var d in i){var g=i[d];g.action==="absent"&&delete i[d]}this.presence._synthesizeLeaves(s.valuesArray(this.residualMembers));for(var d in this.residualMembers)delete i[d];this.residualMembers=null,this.setInProgress(!1)}this.emit("sync")},l.prototype.waitSync=function(i){var h=this.syncInProgress;if(T.default.logAction(T.default.LOG_MINOR,"PresenceMap.waitSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+h),!h){i();return}this.once("sync",i)},l.prototype.clear=function(){this.map={},this.setInProgress(!1),this.residualMembers=null},l.prototype.setInProgress=function(i){T.default.logAction(T.default.LOG_MICRO,"PresenceMap.setInProgress()","inProgress = "+i),this.syncInProgress=i,this.presence.syncComplete=!i},l}(C.default);e.default=v},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0});var f=o(0),s=o(56),O=o(31),C=o(11),T=f.__importDefault(o(5)),x=f.__importDefault(o(3)),M=function(){function R(){this.base64CharSet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this.hexCharSet="0123456789abcdef"}return R.prototype.isWordArray=function(b){return b!=null&&b.sigBytes!==void 0},R.prototype.isArrayBuffer=function(b){return b!=null&&b.constructor===ArrayBuffer},R.prototype.isTypedArray=function(b){return!!ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(b)},R.prototype.uint8ViewToBase64=function(b){for(var a="",m=this.base64CharSet,S=b.byteLength,A=S%3,y=S-A,p,v,u,c,l,i=0;i<y;i=i+3)l=b[i]<<16|b[i+1]<<8|b[i+2],p=(l&16515072)>>18,v=(l&258048)>>12,u=(l&4032)>>6,c=l&63,a+=m[p]+m[v]+m[u]+m[c];return A==1?(l=b[y],p=(l&252)>>2,v=(l&3)<<4,a+=m[p]+m[v]+"=="):A==2&&(l=b[y]<<8|b[y+1],p=(l&64512)>>10,v=(l&1008)>>4,u=(l&15)<<2,a+=m[p]+m[v]+m[u]+"="),a},R.prototype.base64ToArrayBuffer=function(b){for(var a=atob==null?void 0:atob(b),m=a.length,S=new Uint8Array(m),A=0;A<m;A++){var y=a.charCodeAt(A);S[A]=y}return S.buffer},R.prototype.isBuffer=function(b){return this.isArrayBuffer(b)||this.isWordArray(b)||this.isTypedArray(b)},R.prototype.toBuffer=function(b){if(!ArrayBuffer)throw new Error("Can't convert to Buffer: browser does not support the necessary types");if(this.isArrayBuffer(b))return new Uint8Array(b);if(this.isTypedArray(b))return new Uint8Array(b.buffer);if(this.isWordArray(b)){for(var a=new ArrayBuffer(b.sigBytes),m=new Uint8Array(a),S=0;S<b.sigBytes;S++)m[S]=b.words[S>>>2]>>>24-S%4*8&255;return m}throw new Error("BufferUtils.toBuffer expected an arraybuffer, typed array, or CryptoJS wordarray")},R.prototype.toArrayBuffer=function(b){return this.isArrayBuffer(b)?b:this.toBuffer(b).buffer},R.prototype.toWordArray=function(b){return this.isTypedArray(b)&&(b=b.buffer),this.isWordArray(b)?b:T.default.create(b)},R.prototype.base64Encode=function(b){return this.isWordArray(b)?(0,C.stringify)(b):this.uint8ViewToBase64(this.toBuffer(b))},R.prototype.base64Decode=function(b){return ArrayBuffer&&x.default.Config.atob?this.base64ToArrayBuffer(b):(0,C.parse)(b)},R.prototype.hexEncode=function(b){return(0,s.stringify)(this.toWordArray(b))},R.prototype.hexDecode=function(b){var a=(0,s.parse)(b);return ArrayBuffer?this.toArrayBuffer(a):a},R.prototype.utf8Encode=function(b){return x.default.Config.TextEncoder?new x.default.Config.TextEncoder().encode(b).buffer:(0,O.parse)(b)},R.prototype.utf8Decode=function(b){if(!this.isBuffer(b))throw new Error("Expected input of utf8decode to be an arraybuffer, typed array, or CryptoJS wordarray");return TextDecoder&&!this.isWordArray(b)?new TextDecoder().decode(b):(b=this.toWordArray(b),(0,O.stringify)(b))},R.prototype.bufferCompare=function(b,a){if(!b)return-1;if(!a)return 1;var m=this.toWordArray(b),S=this.toWordArray(a);m.clamp(),S.clamp();var A=m.sigBytes-S.sigBytes;if(A!=0)return A;for(var y=m.words,p=S.words,v=0;v<y.length;v++)if(A=y[v]-p[v],A!=0)return A;return 0},R.prototype.byteLength=function(b){return this.isArrayBuffer(b)||this.isTypedArray(b)?b.byteLength:this.isWordArray(b)?b.sigBytes:-1},R.prototype.typedArrayToBuffer=function(b){return b.buffer},R}();e.default=new M},function(n,e,o){(function(f,s){n.exports=s(o(6))})(this,function(f){return f.enc.Hex})},function(n,e,o){o.r(e);var f=o(5),s=o.n(f),O=o(11),C=o(23),T=o.n(C),x=o(2),M=o.n(x),R=o(4),b=o.n(R),a=function(m,S){var A="aes",y=256,p="cbc",v=16,u=4,c=4294967296,l=2147483648,i;if(m.getRandomWordArray)i=m.getRandomWordArray;else if(typeof Uint32Array<"u"&&m.getRandomValues){var h=new Uint32Array(u);i=function(w,U){var j=w/4,G=j==u?h:new Uint32Array(j);m.getRandomValues(G,function(z){typeof U<"u"&&U(z,S.toWordArray(G))})}}else i=function(w,U){M.a.logAction(M.a.LOG_MAJOR,"Ably.Crypto.generateRandom()","Warning: the browser you are using does not support secure cryptographically secure randomness generation; falling back to insecure Math.random()");for(var j=w/4,G=new Array(j),z=0;z<j;z++)G[z]=Math.floor(Math.random()*c)-l;U(null,s.a.create(G))};function d(w){return w+v&-16}function g(w){if(w.algorithm==="aes"&&w.mode==="cbc"){if(w.keyLength===128||w.keyLength===256)return;throw new Error("Unsupported key length "+w.keyLength+" for aes-cbc encryption. Encryption key must be 128 or 256 bits (16 or 32 ASCII characters)")}}function L(w){return w.replace("_","/").replace("-","+")}var _=[s.a.create([269488144,269488144,269488144,269488144],16),s.a.create([16777216],1),s.a.create([33685504],2),s.a.create([50529024],3),s.a.create([67372036],4),s.a.create([84215045,83886080],5),s.a.create([101058054,101056512],6),s.a.create([117901063,117901056],7),s.a.create([134744072,134744072],8),s.a.create([151587081,151587081,150994944],9),s.a.create([168430090,168430090,168427520],10),s.a.create([185273099,185273099,185273088],11),s.a.create([202116108,202116108,202116108],12),s.a.create([218959117,218959117,218959117,218103808],13),s.a.create([235802126,235802126,235802126,235798528],14),s.a.create([252645135,252645135,252645135,252645135],15),s.a.create([269488144,269488144,269488144,269488144],16)];function D(){}function I(){this.algorithm=null,this.keyLength=null,this.mode=null,this.key=null}D.CipherParams=I,D.getDefaultParams=function(w){var U;if(typeof w=="function"||typeof w=="string"){if(M.a.deprecated("The ability to pass a callback to `Crypto.getDefaultParams()`","This method now directly returns its result, instead of returning it asynchronously via a callback. Please update your code so that it uses the return value of this method instead of passing a callback."),typeof w=="function")M.a.deprecated("The ability to call `Crypto.getDefaultParams()` without specifying an encryption key","Please update your code so that it instead passes an object whose `key` property contains an encryption key. That is, replace `Crypto.getDefaultParams()` with `Crypto.getDefaultParams({ key })`, where `key` is an encryption key that you have generated (for example from the `Crypto.generateRandomKey()` method)."),D.generateRandomKey(function(G){w(null,D.getDefaultParams({key:G}))});else if(typeof arguments[1]=="function")M.a.deprecated("The ability to pass the encryption key as the first argument of `Crypto.getDefaultParams()`","Please update your code so that it instead passes an object whose `key` property contains the key. That is, replace `Crypto.getDefaultParams(key)` with `Crypto.getDefaultParams({ key })`."),arguments[1](null,D.getDefaultParams({key:w}));else throw new Error("Invalid arguments for Crypto.getDefaultParams");return}if(!w.key)throw new Error("Crypto.getDefaultParams: a key is required");typeof w.key=="string"?U=Object(O.parse)(L(w.key)):U=S.toWordArray(w.key);var j=new I;if(j.key=U,j.algorithm=w.algorithm||A,j.keyLength=U.words.length*(4*8),j.mode=w.mode||p,w.keyLength&&w.keyLength!==j.keyLength)throw new Error("Crypto.getDefaultParams: a keyLength of "+w.keyLength+" was specified, but the key actually has length "+j.keyLength);return g(j),j},D.generateRandomKey=function(w,U){arguments.length==1&&typeof w=="function"&&(U=w,w=void 0),i((w||y)/8,function(j,G){U!==void 0&&U(j?b.a.fromValues(j):null,G)})},D.getCipher=function(w){var U=w instanceof I?w:D.getDefaultParams(w);return{cipherParams:U,cipher:new P(U,u,w.iv)}};function P(w,U,j){this.algorithm=w.algorithm+"-"+String(w.keyLength)+"-"+w.mode,this.cjsAlgorithm=w.algorithm.toUpperCase().replace(/-\d+$/,""),this.key=S.toWordArray(w.key),j&&(this.iv=S.toWordArray(j).clone()),this.blockLengthWords=U}return P.prototype.encrypt=function(w,U){M.a.logAction(M.a.LOG_MICRO,"CBCCipher.encrypt()",""),w=S.toWordArray(w);var j=w.sigBytes,G=d(j),z=this,W=function(){z.getIv(function(F,E){if(F){U(F);return}var N=z.encryptCipher.process(w.concat(_[G-j])),B=E.concat(N);U(null,B)})};this.encryptCipher?W():this.iv?(this.encryptCipher=T.a.algo[this.cjsAlgorithm].createEncryptor(this.key,{iv:this.iv}),W()):i(v,function(F,E){if(F){U(F);return}z.encryptCipher=T.a.algo[z.cjsAlgorithm].createEncryptor(z.key,{iv:E}),z.iv=E,W()})},P.prototype.decrypt=function(w){M.a.logAction(M.a.LOG_MICRO,"CBCCipher.decrypt()",""),w=S.toWordArray(w);var U=this.blockLengthWords,j=w.words,G=s.a.create(j.slice(0,U)),z=s.a.create(j.slice(U)),W=T.a.algo[this.cjsAlgorithm].createDecryptor(this.key,{iv:G}),F=W.process(z),E=W.finalize();return W.reset(),E&&E.sigBytes&&F.concat(E),F},P.prototype.getIv=function(w){if(this.iv){var U=this.iv;this.iv=null,w(null,U);return}var j=this;i(v,function(G,z){if(G){w(G);return}w(null,j.encryptCipher.process(z))})},D};e.default=a},function(n,e,o){(function(f,s){n.exports=s(o(6))})(this,function(f){return function(){var s=f,O=s.lib,C=O.WordArray,T=s.enc;T.Utf16=T.Utf16BE={stringify:function(M){for(var R=M.words,b=M.sigBytes,a=[],m=0;m<b;m+=2){var S=R[m>>>2]>>>16-m%4*8&65535;a.push(String.fromCharCode(S))}return a.join("")},parse:function(M){for(var R=M.length,b=[],a=0;a<R;a++)b[a>>>1]|=M.charCodeAt(a)<<16-a%2*16;return C.create(b,R*2)}},T.Utf16LE={stringify:function(M){for(var R=M.words,b=M.sigBytes,a=[],m=0;m<b;m+=2){var S=x(R[m>>>2]>>>16-m%4*8&65535);a.push(String.fromCharCode(S))}return a.join("")},parse:function(M){for(var R=M.length,b=[],a=0;a<R;a++)b[a>>>1]|=x(M.charCodeAt(a)<<16-a%2*16);return C.create(b,R*2)}};function x(M){return M<<8&4278255360|M>>>8&16711935}}(),f.enc.Utf16})},function(n,e,o){(function(f,s){n.exports=s(o(6),o(28))})(this,function(f){return function(s){var O=f,C=O.lib,T=C.CipherParams,x=O.enc,M=x.Hex,R=O.format;R.Hex={stringify:function(b){return b.ciphertext.toString(M)},parse:function(b){var a=M.parse(b);return T.create({ciphertext:a})}}}(),f.format.Hex})},function(n,e,o){(function(f,s){n.exports=s(o(6),o(11),o(61),o(27),o(28))})(this,function(f){return function(){var s=f,O=s.lib,C=O.BlockCipher,T=s.algo,x=[],M=[],R=[],b=[],a=[],m=[],S=[],A=[],y=[],p=[];(function(){for(var c=[],l=0;l<256;l++)l<128?c[l]=l<<1:c[l]=l<<1^283;for(var i=0,h=0,l=0;l<256;l++){var d=h^h<<1^h<<2^h<<3^h<<4;d=d>>>8^d&255^99,x[i]=d,M[d]=i;var g=c[i],L=c[g],_=c[L],D=c[d]*257^d*16843008;R[i]=D<<24|D>>>8,b[i]=D<<16|D>>>16,a[i]=D<<8|D>>>24,m[i]=D;var D=_*16843009^L*65537^g*257^i*16843008;S[d]=D<<24|D>>>8,A[d]=D<<16|D>>>16,y[d]=D<<8|D>>>24,p[d]=D,i?(i=g^c[c[c[_^g]]],h^=c[c[h]]):i=h=1}})();var v=[0,1,2,4,8,16,32,64,128,27,54],u=T.AES=C.extend({_doReset:function(){var c;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var l=this._keyPriorReset=this._key,i=l.words,h=l.sigBytes/4,d=this._nRounds=h+6,g=(d+1)*4,L=this._keySchedule=[],_=0;_<g;_++)_<h?L[_]=i[_]:(c=L[_-1],_%h?h>6&&_%h==4&&(c=x[c>>>24]<<24|x[c>>>16&255]<<16|x[c>>>8&255]<<8|x[c&255]):(c=c<<8|c>>>24,c=x[c>>>24]<<24|x[c>>>16&255]<<16|x[c>>>8&255]<<8|x[c&255],c^=v[_/h|0]<<24),L[_]=L[_-h]^c);for(var D=this._invKeySchedule=[],I=0;I<g;I++){var _=g-I;if(I%4)var c=L[_];else var c=L[_-4];I<4||_<=4?D[I]=c:D[I]=S[x[c>>>24]]^A[x[c>>>16&255]]^y[x[c>>>8&255]]^p[x[c&255]]}}},encryptBlock:function(c,l){this._doCryptBlock(c,l,this._keySchedule,R,b,a,m,x)},decryptBlock:function(c,l){var i=c[l+1];c[l+1]=c[l+3],c[l+3]=i,this._doCryptBlock(c,l,this._invKeySchedule,S,A,y,p,M);var i=c[l+1];c[l+1]=c[l+3],c[l+3]=i},_doCryptBlock:function(c,l,i,h,d,g,L,_){for(var D=this._nRounds,I=c[l]^i[0],P=c[l+1]^i[1],w=c[l+2]^i[2],U=c[l+3]^i[3],j=4,G=1;G<D;G++){var z=h[I>>>24]^d[P>>>16&255]^g[w>>>8&255]^L[U&255]^i[j++],W=h[P>>>24]^d[w>>>16&255]^g[U>>>8&255]^L[I&255]^i[j++],F=h[w>>>24]^d[U>>>16&255]^g[I>>>8&255]^L[P&255]^i[j++],E=h[U>>>24]^d[I>>>16&255]^g[P>>>8&255]^L[w&255]^i[j++];I=z,P=W,w=F,U=E}var z=(_[I>>>24]<<24|_[P>>>16&255]<<16|_[w>>>8&255]<<8|_[U&255])^i[j++],W=(_[P>>>24]<<24|_[w>>>16&255]<<16|_[U>>>8&255]<<8|_[I&255])^i[j++],F=(_[w>>>24]<<24|_[U>>>16&255]<<16|_[I>>>8&255]<<8|_[P&255])^i[j++],E=(_[U>>>24]<<24|_[I>>>16&255]<<16|_[P>>>8&255]<<8|_[w&255])^i[j++];c[l]=z,c[l+1]=W,c[l+2]=F,c[l+3]=E},keySize:256/32});s.AES=C._createHelper(u)}(),f.AES})},function(n,e,o){(function(f,s){n.exports=s(o(6))})(this,function(f){return function(s){var O=f,C=O.lib,T=C.WordArray,x=C.Hasher,M=O.algo,R=[];(function(){for(var y=0;y<64;y++)R[y]=s.abs(s.sin(y+1))*4294967296|0})();var b=M.MD5=x.extend({_doReset:function(){this._hash=new T.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(y,p){for(var v=0;v<16;v++){var u=p+v,c=y[u];y[u]=(c<<8|c>>>24)&16711935|(c<<24|c>>>8)&4278255360}var l=this._hash.words,i=y[p+0],h=y[p+1],d=y[p+2],g=y[p+3],L=y[p+4],_=y[p+5],D=y[p+6],I=y[p+7],P=y[p+8],w=y[p+9],U=y[p+10],j=y[p+11],G=y[p+12],z=y[p+13],W=y[p+14],F=y[p+15],E=l[0],N=l[1],B=l[2],k=l[3];E=a(E,N,B,k,i,7,R[0]),k=a(k,E,N,B,h,12,R[1]),B=a(B,k,E,N,d,17,R[2]),N=a(N,B,k,E,g,22,R[3]),E=a(E,N,B,k,L,7,R[4]),k=a(k,E,N,B,_,12,R[5]),B=a(B,k,E,N,D,17,R[6]),N=a(N,B,k,E,I,22,R[7]),E=a(E,N,B,k,P,7,R[8]),k=a(k,E,N,B,w,12,R[9]),B=a(B,k,E,N,U,17,R[10]),N=a(N,B,k,E,j,22,R[11]),E=a(E,N,B,k,G,7,R[12]),k=a(k,E,N,B,z,12,R[13]),B=a(B,k,E,N,W,17,R[14]),N=a(N,B,k,E,F,22,R[15]),E=m(E,N,B,k,h,5,R[16]),k=m(k,E,N,B,D,9,R[17]),B=m(B,k,E,N,j,14,R[18]),N=m(N,B,k,E,i,20,R[19]),E=m(E,N,B,k,_,5,R[20]),k=m(k,E,N,B,U,9,R[21]),B=m(B,k,E,N,F,14,R[22]),N=m(N,B,k,E,L,20,R[23]),E=m(E,N,B,k,w,5,R[24]),k=m(k,E,N,B,W,9,R[25]),B=m(B,k,E,N,g,14,R[26]),N=m(N,B,k,E,P,20,R[27]),E=m(E,N,B,k,z,5,R[28]),k=m(k,E,N,B,d,9,R[29]),B=m(B,k,E,N,I,14,R[30]),N=m(N,B,k,E,G,20,R[31]),E=S(E,N,B,k,_,4,R[32]),k=S(k,E,N,B,P,11,R[33]),B=S(B,k,E,N,j,16,R[34]),N=S(N,B,k,E,W,23,R[35]),E=S(E,N,B,k,h,4,R[36]),k=S(k,E,N,B,L,11,R[37]),B=S(B,k,E,N,I,16,R[38]),N=S(N,B,k,E,U,23,R[39]),E=S(E,N,B,k,z,4,R[40]),k=S(k,E,N,B,i,11,R[41]),B=S(B,k,E,N,g,16,R[42]),N=S(N,B,k,E,D,23,R[43]),E=S(E,N,B,k,w,4,R[44]),k=S(k,E,N,B,G,11,R[45]),B=S(B,k,E,N,F,16,R[46]),N=S(N,B,k,E,d,23,R[47]),E=A(E,N,B,k,i,6,R[48]),k=A(k,E,N,B,I,10,R[49]),B=A(B,k,E,N,W,15,R[50]),N=A(N,B,k,E,_,21,R[51]),E=A(E,N,B,k,G,6,R[52]),k=A(k,E,N,B,g,10,R[53]),B=A(B,k,E,N,U,15,R[54]),N=A(N,B,k,E,h,21,R[55]),E=A(E,N,B,k,P,6,R[56]),k=A(k,E,N,B,F,10,R[57]),B=A(B,k,E,N,D,15,R[58]),N=A(N,B,k,E,z,21,R[59]),E=A(E,N,B,k,L,6,R[60]),k=A(k,E,N,B,j,10,R[61]),B=A(B,k,E,N,d,15,R[62]),N=A(N,B,k,E,w,21,R[63]),l[0]=l[0]+E|0,l[1]=l[1]+N|0,l[2]=l[2]+B|0,l[3]=l[3]+k|0},_doFinalize:function(){var y=this._data,p=y.words,v=this._nDataBytes*8,u=y.sigBytes*8;p[u>>>5]|=128<<24-u%32;var c=s.floor(v/4294967296),l=v;p[(u+64>>>9<<4)+15]=(c<<8|c>>>24)&16711935|(c<<24|c>>>8)&4278255360,p[(u+64>>>9<<4)+14]=(l<<8|l>>>24)&16711935|(l<<24|l>>>8)&4278255360,y.sigBytes=(p.length+1)*4,this._process();for(var i=this._hash,h=i.words,d=0;d<4;d++){var g=h[d];h[d]=(g<<8|g>>>24)&16711935|(g<<24|g>>>8)&4278255360}return i},clone:function(){var y=x.clone.call(this);return y._hash=this._hash.clone(),y}});function a(y,p,v,u,c,l,i){var h=y+(p&v|~p&u)+c+i;return(h<<l|h>>>32-l)+p}function m(y,p,v,u,c,l,i){var h=y+(p&u|v&~u)+c+i;return(h<<l|h>>>32-l)+p}function S(y,p,v,u,c,l,i){var h=y+(p^v^u)+c+i;return(h<<l|h>>>32-l)+p}function A(y,p,v,u,c,l,i){var h=y+(v^(p|~u))+c+i;return(h<<l|h>>>32-l)+p}O.MD5=x._createHelper(b),O.HmacMD5=x._createHmacHelper(b)}(Math),f.MD5})},function(n,e,o){var f;Object.defineProperty(e,"__esModule",{value:!0});var s=o(0),O=s.__importDefault(o(3)),C=s.__importStar(o(1)),T=s.__importDefault(o(8)),x=o(4),M=s.__importDefault(o(19)),R=s.__importDefault(o(17)),b=s.__importDefault(o(22)),a=s.__importDefault(o(2)),m=o(29),S=s.__importDefault(o(63)),A=o(14);function y(u){var c=u.statusCode;return c===408&&!u.code||c===400&&!u.code||c>=500&&c<=504}function p(u){var c=u.connection,l=c&&c.connectionManager.host;return l?[l].concat(T.default.getFallbackHosts(u.options)):T.default.getHosts(u.options)}var v=(f=function(){function u(c){this.checksInProgress=null,this.checkConnectivity=void 0,this.supportsAuthHeaders=!1,this.supportsLinkHeaders=!1,this._getHosts=p,this.options=c||{};var l=this.options.connectivityCheckUrl||T.default.connectivityCheckUrl,i=this.options.connectivityCheckParams,h=!this.options.connectivityCheckUrl;O.default.Config.xhrSupported?(this.supportsAuthHeaders=!0,this.Request=function(d,g,L,_,D,I,P){var w=R.default.createRequest(L,_,D,I,b.default.REQ_SEND,g&&g.options.timeouts,d);return w.once("complete",P),w.exec(),w},this.options.disableConnectivityCheck?this.checkConnectivity=function(d){d(null,!0)}:this.checkConnectivity=function(d){a.default.logAction(a.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Sending; "+l),this.doUri(M.default.Get,null,l,null,null,i,function(g,L,_,D,I){var P=!1;h?P=!g&&(L==null?void 0:L.replace(/\n/,""))=="yes":P=!g&&(0,A.isSuccessCode)(I),a.default.logAction(a.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Result: "+P),d(null,P)})}):O.default.Config.jsonpSupported?(this.Request=function(d,g,L,_,D,I,P){var w=(0,m.createRequest)(L,_,D,I,b.default.REQ_SEND,g&&g.options.timeouts,d);return w.once("complete",P),O.default.Config.nextTick(function(){w.exec()}),w},this.options.disableConnectivityCheck?this.checkConnectivity=function(d){d(null,!0)}:this.checkConnectivity=function(d){var g=this,L=T.default.jsonpInternetUpUrl;if(this.checksInProgress){this.checksInProgress.push(d);return}this.checksInProgress=[d],a.default.logAction(a.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Sending; "+L);var _=new m.Request("isTheInternetUp",L,null,null,null,b.default.REQ_SEND,T.default.TIMEOUTS);_.once("complete",function(D,I){var P=!D&&I;a.default.logAction(a.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Result: "+P);for(var w=0;w<g.checksInProgress.length;w++)g.checksInProgress[w](null,P);g.checksInProgress=null}),O.default.Config.nextTick(function(){_.exec()})}):O.default.Config.fetchSupported?(this.supportsAuthHeaders=!0,this.Request=S.default,this.checkConnectivity=function(d){a.default.logAction(a.default.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Sending; "+l),this.doUri(M.default.Get,null,l,null,null,null,function(g,L){var _=!g&&(L==null?void 0:L.replace(/\n/,""))=="yes";a.default.logAction(a.default.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Result: "+_),d(null,_)})}):this.Request=function(d,g,L,_,D,I,P){P(new x.PartialErrorInfo("no supported HTTP transports available",null,400),null)}}return u.prototype.do=function(c,l,i,h,d,g,L){var _=this,D=typeof i=="function"?i:function(U){return l.baseUri(U)+i},I=l._currentFallback;if(I)if(I.validUntil>C.now()){if(!this.Request){L==null||L(new x.PartialErrorInfo("Request invoked before assigned to",null,500));return}this.Request(c,l,D(I.host),h,g,d,function(U){for(var j=[],G=1;G<arguments.length;G++)j[G-1]=arguments[G];if(U&&y(U)){l._currentFallback=null,_.do(c,l,i,h,d,g,L);return}L==null||L.apply(void 0,s.__spreadArray([U],j,!1))});return}else l._currentFallback=null;var P=p(l);if(P.length===1){this.doUri(c,l,D(P[0]),h,d,g,L);return}var w=function(U,j){var G=U.shift();_.doUri(c,l,D(G),h,d,g,function(z){for(var W=[],F=1;F<arguments.length;F++)W[F-1]=arguments[F];if(z&&y(z)&&U.length){w(U,!0);return}j&&(l._currentFallback={host:G,validUntil:C.now()+l.options.timeouts.fallbackRetryTimeout}),L==null||L.apply(void 0,s.__spreadArray([z],W,!1))})};w(P)},u.prototype.doUri=function(c,l,i,h,d,g,L){if(!this.Request){L(new x.PartialErrorInfo("Request invoked before assigned to",null,500));return}this.Request(c,l,i,h,g,d,L)},u}(),f.methods=[M.default.Get,M.default.Delete,M.default.Post,M.default.Put,M.default.Patch],f.methodsWithoutBody=[M.default.Get,M.default.Delete],f.methodsWithBody=[M.default.Post,M.default.Put,M.default.Patch],f);e.default=v},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0});var f=o(0),s=f.__importStar(o(4)),O=f.__importDefault(o(3)),C=f.__importDefault(o(8)),T=f.__importStar(o(1)),x=o(1);function M(a,m){return!!m.get("x-ably-errorcode")}function R(a,m){if(M(a,m))return a.error&&s.default.fromValues(a.error)}function b(a,m,S,A,y,p,v){var u=new Headers(A||{}),c=a?a.toUpperCase():T.isEmptyArg(p)?"GET":"POST",l=new AbortController,i=setTimeout(function(){l.abort(),v(new s.PartialErrorInfo("Request timed out",null,408))},m?m.options.timeouts.httpRequestTimeout:C.default.TIMEOUTS.httpRequestTimeout),h={method:c,headers:u,body:p};O.default.Config.isWebworker||(h.credentials=u.has("authorization")?"include":"same-origin"),(0,x.getGlobalObject)().fetch(S+"?"+new URLSearchParams(y||{}),h).then(function(d){clearTimeout(i);var g=d.headers.get("Content-Type"),L;g&&g.indexOf("application/x-msgpack")>-1?L=d.arrayBuffer():g&&g.indexOf("application/json")>-1?L=d.json():L=d.text(),L.then(function(_){var D=!!g&&g.indexOf("application/x-msgpack")===-1;if(d.ok)v(null,_,d.headers,D,d.status);else{var I=R(_,d.headers)||new s.PartialErrorInfo("Error response received from server: "+d.status+" body was: "+O.default.Config.inspect(_),null,d.status);v(I,_,d.headers,D,d.status)}})}).catch(function(d){clearTimeout(i),v(d)})}e.default=b},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0});var f=o(0),s=f.__importDefault(o(41)),O=f.__importStar(o(1)),C=O.getGlobalObject();typeof Window>"u"&&typeof WorkerGlobalScope>"u"&&console.log("Warning: this distribution of Ably is intended for browsers. On nodejs, please use the 'ably' package on npm");function T(){var b=C.location;return!C.WebSocket||!b||!b.origin||b.origin.indexOf("http")>-1}var x=C.navigator&&C.navigator.userAgent.toString(),M=C.location&&C.location.href,R={agent:"browser",logTimestamps:!0,userAgent:x,currentUrl:M,noUpgrade:x&&!!x.match(/MSIE\s8\.0/),binaryType:"arraybuffer",WebSocket:C.WebSocket,fetchSupported:!!C.fetch,xhrSupported:C.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,jsonpSupported:typeof document<"u",allowComet:T(),streamingSupported:!0,useProtocolHeartbeats:!0,createHmac:null,msgpack:s.default,supportsBinary:!!C.TextDecoder,preferBinary:!1,ArrayBuffer:C.ArrayBuffer,atob:C.atob,nextTick:typeof C.setImmediate<"u"?C.setImmediate.bind(C):function(b){setTimeout(b,0)},addEventListener:C.addEventListener,inspect:JSON.stringify,stringByteSize:function(b){return C.TextDecoder&&new C.TextEncoder().encode(b).length||b.length},TextEncoder:C.TextEncoder,TextDecoder:C.TextDecoder,Promise:C.Promise,getRandomValues:function(b){if(b!==void 0)return function(a,m){b.getRandomValues(a),m&&m(null)}}(C.crypto||msCrypto)};e.default=R},function(n,e,o){(function(f){Object.defineProperty(e,"__esModule",{value:!0});var s=o(0),O=s.__importStar(o(1)),C="ablyjs-storage-test",T=function(){function x(){try{f.sessionStorage.setItem(C,C),f.sessionStorage.removeItem(C),this.sessionSupported=!0}catch{this.sessionSupported=!1}try{f.localStorage.setItem(C,C),f.localStorage.removeItem(C),this.localSupported=!0}catch{this.localSupported=!1}}return x.prototype.get=function(M){return this._get(M,!1)},x.prototype.getSession=function(M){return this._get(M,!0)},x.prototype.remove=function(M){return this._remove(M,!1)},x.prototype.removeSession=function(M){return this._remove(M,!0)},x.prototype.set=function(M,R,b){return this._set(M,R,b,!1)},x.prototype.setSession=function(M,R,b){return this._set(M,R,b,!0)},x.prototype._set=function(M,R,b,a){var m={value:R};return b&&(m.expires=O.now()+b),this.storageInterface(a).setItem(M,JSON.stringify(m))},x.prototype._get=function(M,R){if(R&&!this.sessionSupported)throw new Error("Session Storage not supported");if(!R&&!this.localSupported)throw new Error("Local Storage not supported");var b=this.storageInterface(R).getItem(M);if(!b)return null;var a=JSON.parse(b);return a.expires&&a.expires<O.now()?(this.storageInterface(R).removeItem(M),null):a.value},x.prototype._remove=function(M,R){return this.storageInterface(R).removeItem(M)},x.prototype.storageInterface=function(M){return M?f.sessionStorage:f.localStorage},x}();e.default=new T}).call(this,o(13))},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0});var f=o(0),s=f.__importDefault(o(67)),O={connectivityCheckUrl:"https://internet-up.ably-realtime.com/is-the-internet-up.txt",jsonpInternetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up-0-9.js",defaultTransports:[s.default.XhrPolling,s.default.XhrStreaming,s.default.JsonP,s.default.WebSocket],baseTransportOrder:[s.default.XhrPolling,s.default.XhrStreaming,s.default.JsonP,s.default.WebSocket],transportPreferenceOrder:[s.default.JsonP,s.default.XhrPolling,s.default.XhrStreaming,s.default.WebSocket],upgradeTransports:[s.default.XhrStreaming,s.default.WebSocket]};e.default=O},function(n,e,o){Object.defineProperty(e,"__esModule",{value:!0});var f;(function(s){s.WebSocket="web_socket",s.Comet="comet",s.XhrStreaming="xhr_streaming",s.XhrPolling="xhr_polling",s.JsonP="jsonp"})(f||(f={})),e.default=f},function(n,e,o){o.r(e);var f=o(29),s=o.n(f),O=o(1),C=o(3),T=o.n(C),x=o(12),M=o.n(x),R=o(17),b=o.n(R),a=function(y){var p="xhr_polling";function v(u,c,l){l.stream=!1,M.a.call(this,u,c,l),this.shortName=p}return O.inherits(v,M.a),v.isAvailable=function(){return T.a.Config.xhrSupported&&T.a.Config.allowComet},v.prototype.toString=function(){return"XHRPollingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},v.prototype.createRequest=function(u,c,l,i,h){return b.a.createRequest(u,c,l,i,h,this.timeouts)},typeof y<"u"&&v.isAvailable()&&(y.supportedTransports[p]=v),v},m=a,S=function(y){var p="xhr_streaming";function v(u,c,l){M.a.call(this,u,c,l),this.shortName=p}return O.inherits(v,M.a),v.isAvailable=function(){return T.a.Config.xhrSupported&&T.a.Config.streamingSupported&&T.a.Config.allowComet},v.prototype.toString=function(){return"XHRStreamingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},v.prototype.createRequest=function(u,c,l,i,h){return b.a.createRequest(u,c,l,i,h,this.timeouts)},typeof y<"u"&&v.isAvailable()&&(y.supportedTransports[p]=v),v},A=S;e.default=[s.a,m,A]}]).default})})(Cn);var pi=Cn.exports;function On(r){return typeof r=="string"&&(r=r.indexOf(":")==-1?{token:r}:{key:r}),r.promises=!0,r}var He=pi,gi=function(r,t,n,e){return new He.ErrorInfo(r,t,n,e)},Rn=function(r){return new He.Rest(On(r))};Object.assign(Rn,He.Rest);var Sn=function(r){return new He.Realtime(On(r))};Object.assign(Sn,He.Realtime);var mi={ErrorInfo:gi,Rest:Rn,Realtime:Sn};const yi=ln(mi),vi=r=>({subscribe:({channel:t,types:n,params:e,callback:o})=>{const f=r.channels.get(t),s=O=>{var C,T;(n.includes("*")||n.includes(O.data.type))&&(O.data.type!=="created"&&(e==null?void 0:e.ids)!==void 0&&((T=(C=O.data)==null?void 0:C.payload)==null?void 0:T.ids)!==void 0?e.ids.map(String).filter(x=>{var M;return(M=O.data.payload.ids)==null?void 0:M.map(String).includes(x)}).length>0&&o(O.data):o(O.data))};return f.subscribe(s),{channelInstance:f,listener:s}},unsubscribe:t=>{const{channelInstance:n,listener:e}=t;n.unsubscribe(e)},publish:t=>{r.channels.get(t.channel).publish(t.type,t)}});function Ci(r){return r.charAt(0).toLowerCase()+r.slice(1)}let Ee=null,ct=null;const At={login:async({providerName:r,email:t,password:n,redirectTo:e=gn})=>{const o=new FormData;o.append("email",t),o.append("password",n);const f=await fetch(`${he}/auth/${r}`,{method:"POST",body:o}),s=await f.json();return f.ok&&s.id?{success:!0,redirectTo:e,user:s}:{success:!1,error:{message:s.message||"登录失败",name:"Invalid credentials"}}},logout:async()=>{mn(null);const r=encodeURIComponent(window.location.href);return window.location.href=`/api/auth/logout?redirectTo=${r}`,{success:!0,redirectTo:`/login?redirectTo=${r}`}},check:async()=>{const r=`/login?redirectTo=${window.location.href}`,t=await fetch(`${he}/auth/me`),{data:n}=await t.json();return n&&n.id?{authenticated:!0}:{authenticated:!1,error:{message:"未登录",name:"Not authenticated"},logout:!0,redirectTo:r}},getIdentity:async()=>{if(ct)return ct;const r=await fetch(`${he}/auth/me`),{data:t}=await r.json();return t&&t.id?(ct=t,t):null},onError:async r=>r.status===401||r.status===403?{logout:!0,redirectTo:"/login",error:r}:{error:r},setPermissions:async r=>{Ee=r},getPermissions:async()=>{if(Ee!=null&&Ee.length)return Ee;if(hn()&&window.__PERMISSIONS_DATA__){const{permissions:r,signature:t}=window.__PERMISSIONS_DATA__;if(!(r!=null&&r.length))return[];if(await Vr({data:r},t))return Ee=r,Ee;console.error("@authProvider.getPermissions - 权限数据验证失败，可能被篡改")}return[]}},Oi={can:async({resource:r="",action:t,params:n})=>{try{r=Ci(r),r||(r="*"),t||(t=De.list);const e=await At.getPermissions();if(!(e!=null&&e.length))return{can:!1,reason:"No permission rules found"};t===De.delete||t===De.edit||t===De.show?r=`${r}/${n==null?void 0:n.id}`:t===De.field&&(r=`${r}/${n==null?void 0:n.field}`);const o=e.filter(C=>(C.object==="*"||Ri(r,C.object))&&(C.action==="*"||An(t,C.action)));if(o.length===0)return{can:!1,reason:"Permission denied"};const O=o.sort((C,T)=>{const x=(C.object.match(/\*/g)||[]).length,M=(T.object.match(/\*/g)||[]).length;return x-M})[0].effect!=="deny";return{can:O,reason:O?void 0:"You are not allowed to perform this action"}}catch(e){return console.error("@accessControlProvider - Permission check failed:",e),{can:!1,reason:"Permission check failed"}}},options:{buttons:{enableAccessControl:!0,hideIfUnauthorized:!1},queryOptions:{cacheTime:5*60*1e3,staleTime:0}}};function Ri(r,t){const n=t.split("/*");if(n.length===1)return r===t;const e=n[0];return r.startsWith(e)}function An(r,t){try{return t.includes("|")?t.split("|").filter(Boolean).some(o=>An(r,o)):new RegExp("^"+t+"$").test(r)}catch{return r===t}}class Si{constructor(){this.keyToValue=new Map,this.valueToKey=new Map}set(t,n){this.keyToValue.set(t,n),this.valueToKey.set(n,t)}getByKey(t){return this.keyToValue.get(t)}getByValue(t){return this.valueToKey.get(t)}clear(){this.keyToValue.clear(),this.valueToKey.clear()}}class bn{constructor(t){this.generateIdentifier=t,this.kv=new Si}register(t,n){this.kv.getByValue(t)||(n||(n=this.generateIdentifier(t)),this.kv.set(n,t))}clear(){this.kv.clear()}getIdentifier(t){return this.kv.getByValue(t)}getValue(t){return this.kv.getByKey(t)}}class Ai extends bn{constructor(){super(t=>t.name),this.classToAllowedProps=new Map}register(t,n){typeof n=="object"?(n.allowProps&&this.classToAllowedProps.set(t,n.allowProps),super.register(t,n.identifier)):super.register(t,n)}getAllowedProps(t){return this.classToAllowedProps.get(t)}}function bi(r){if("values"in Object)return Object.values(r);const t=[];for(const n in r)r.hasOwnProperty(n)&&t.push(r[n]);return t}function Ei(r,t){const n=bi(r);if("find"in n)return n.find(t);const e=n;for(let o=0;o<e.length;o++){const f=e[o];if(t(f))return f}}function Pe(r,t){Object.entries(r).forEach(([n,e])=>t(e,n))}function Ke(r,t){return r.indexOf(t)!==-1}function Kt(r,t){for(let n=0;n<r.length;n++){const e=r[n];if(t(e))return e}}class Ti{constructor(){this.transfomers={}}register(t){this.transfomers[t.name]=t}findApplicable(t){return Ei(this.transfomers,n=>n.isApplicable(t))}findByName(t){return this.transfomers[t]}}const wi=r=>Object.prototype.toString.call(r).slice(8,-1),En=r=>typeof r>"u",Ii=r=>r===null,Ue=r=>typeof r!="object"||r===null||r===Object.prototype?!1:Object.getPrototypeOf(r)===null?!0:Object.getPrototypeOf(r)===Object.prototype,bt=r=>Ue(r)&&Object.keys(r).length===0,be=r=>Array.isArray(r),Pi=r=>typeof r=="string",xi=r=>typeof r=="number"&&!isNaN(r),Mi=r=>typeof r=="boolean",Di=r=>r instanceof RegExp,ke=r=>r instanceof Map,je=r=>r instanceof Set,Tn=r=>wi(r)==="Symbol",_i=r=>r instanceof Date&&!isNaN(r.valueOf()),Li=r=>r instanceof Error,$t=r=>typeof r=="number"&&isNaN(r),Ni=r=>Mi(r)||Ii(r)||En(r)||xi(r)||Pi(r)||Tn(r),Bi=r=>typeof r=="bigint",Ui=r=>r===1/0||r===-1/0,ki=r=>ArrayBuffer.isView(r)&&!(r instanceof DataView),ji=r=>r instanceof URL,wn=r=>r.replace(/\./g,"\\."),lt=r=>r.map(String).map(wn).join("."),Be=r=>{const t=[];let n="";for(let o=0;o<r.length;o++){let f=r.charAt(o);if(f==="\\"&&r.charAt(o+1)==="."){n+=".",o++;continue}if(f==="."){t.push(n),n="";continue}n+=f}const e=n;return t.push(e),t};function ve(r,t,n,e){return{isApplicable:r,annotation:t,transform:n,untransform:e}}const In=[ve(En,"undefined",()=>null,()=>{}),ve(Bi,"bigint",r=>r.toString(),r=>typeof BigInt<"u"?BigInt(r):(console.error("Please add a BigInt polyfill."),r)),ve(_i,"Date",r=>r.toISOString(),r=>new Date(r)),ve(Li,"Error",(r,t)=>{const n={name:r.name,message:r.message};return t.allowedErrorProps.forEach(e=>{n[e]=r[e]}),n},(r,t)=>{const n=new Error(r.message);return n.name=r.name,n.stack=r.stack,t.allowedErrorProps.forEach(e=>{n[e]=r[e]}),n}),ve(Di,"regexp",r=>""+r,r=>{const t=r.slice(1,r.lastIndexOf("/")),n=r.slice(r.lastIndexOf("/")+1);return new RegExp(t,n)}),ve(je,"set",r=>[...r.values()],r=>new Set(r)),ve(ke,"map",r=>[...r.entries()],r=>new Map(r)),ve(r=>$t(r)||Ui(r),"number",r=>$t(r)?"NaN":r>0?"Infinity":"-Infinity",Number),ve(r=>r===0&&1/r===-1/0,"number",()=>"-0",Number),ve(ji,"URL",r=>r.toString(),r=>new URL(r))];function tt(r,t,n,e){return{isApplicable:r,annotation:t,transform:n,untransform:e}}const Pn=tt((r,t)=>Tn(r)?!!t.symbolRegistry.getIdentifier(r):!1,(r,t)=>["symbol",t.symbolRegistry.getIdentifier(r)],r=>r.description,(r,t,n)=>{const e=n.symbolRegistry.getValue(t[1]);if(!e)throw new Error("Trying to deserialize unknown symbol");return e}),Hi=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,Uint8ClampedArray].reduce((r,t)=>(r[t.name]=t,r),{}),xn=tt(ki,r=>["typed-array",r.constructor.name],r=>[...r],(r,t)=>{const n=Hi[t[1]];if(!n)throw new Error("Trying to deserialize unknown typed array");return new n(r)});function Mn(r,t){return r!=null&&r.constructor?!!t.classRegistry.getIdentifier(r.constructor):!1}const Dn=tt(Mn,(r,t)=>["class",t.classRegistry.getIdentifier(r.constructor)],(r,t)=>{const n=t.classRegistry.getAllowedProps(r.constructor);if(!n)return{...r};const e={};return n.forEach(o=>{e[o]=r[o]}),e},(r,t,n)=>{const e=n.classRegistry.getValue(t[1]);if(!e)throw new Error(`Trying to deserialize unknown class '${t[1]}' - check https://github.com/blitz-js/superjson/issues/116#issuecomment-773996564`);return Object.assign(Object.create(e.prototype),r)}),_n=tt((r,t)=>!!t.customTransformerRegistry.findApplicable(r),(r,t)=>["custom",t.customTransformerRegistry.findApplicable(r).name],(r,t)=>t.customTransformerRegistry.findApplicable(r).serialize(r),(r,t,n)=>{const e=n.customTransformerRegistry.findByName(t[1]);if(!e)throw new Error("Trying to deserialize unknown custom value");return e.deserialize(r)}),Gi=[Dn,Pn,_n,xn],Jt=(r,t)=>{const n=Kt(Gi,o=>o.isApplicable(r,t));if(n)return{value:n.transform(r,t),type:n.annotation(r,t)};const e=Kt(In,o=>o.isApplicable(r,t));if(e)return{value:e.transform(r,t),type:e.annotation}},Ln={};In.forEach(r=>{Ln[r.annotation]=r});const Fi=(r,t,n)=>{if(be(t))switch(t[0]){case"symbol":return Pn.untransform(r,t,n);case"class":return Dn.untransform(r,t,n);case"custom":return _n.untransform(r,t,n);case"typed-array":return xn.untransform(r,t,n);default:throw new Error("Unknown transformation: "+t)}else{const e=Ln[t];if(!e)throw new Error("Unknown transformation: "+t);return e.untransform(r,n)}},Ie=(r,t)=>{if(t>r.size)throw new Error("index out of bounds");const n=r.keys();for(;t>0;)n.next(),t--;return n.next().value};function Nn(r){if(Ke(r,"__proto__"))throw new Error("__proto__ is not allowed as a property");if(Ke(r,"prototype"))throw new Error("prototype is not allowed as a property");if(Ke(r,"constructor"))throw new Error("constructor is not allowed as a property")}const Vi=(r,t)=>{Nn(t);for(let n=0;n<t.length;n++){const e=t[n];if(je(r))r=Ie(r,+e);else if(ke(r)){const o=+e,f=+t[++n]==0?"key":"value",s=Ie(r,o);switch(f){case"key":r=s;break;case"value":r=r.get(s);break}}else r=r[e]}return r},Et=(r,t,n)=>{if(Nn(t),t.length===0)return n(r);let e=r;for(let f=0;f<t.length-1;f++){const s=t[f];if(be(e)){const O=+s;e=e[O]}else if(Ue(e))e=e[s];else if(je(e)){const O=+s;e=Ie(e,O)}else if(ke(e)){if(f===t.length-2)break;const C=+s,T=+t[++f]==0?"key":"value",x=Ie(e,C);switch(T){case"key":e=x;break;case"value":e=e.get(x);break}}}const o=t[t.length-1];if(be(e)?e[+o]=n(e[+o]):Ue(e)&&(e[o]=n(e[o])),je(e)){const f=Ie(e,+o),s=n(f);f!==s&&(e.delete(f),e.add(s))}if(ke(e)){const f=+t[t.length-2],s=Ie(e,f);switch(+o==0?"key":"value"){case"key":{const C=n(s);e.set(C,e.get(s)),C!==s&&e.delete(s);break}case"value":{e.set(s,n(e.get(s)));break}}}return r};function Tt(r,t,n=[]){if(!r)return;if(!be(r)){Pe(r,(f,s)=>Tt(f,t,[...n,...Be(s)]));return}const[e,o]=r;o&&Pe(o,(f,s)=>{Tt(f,t,[...n,...Be(s)])}),t(e,n)}function Wi(r,t,n){return Tt(t,(e,o)=>{r=Et(r,o,f=>Fi(f,e,n))}),r}function zi(r,t){function n(e,o){const f=Vi(r,Be(o));e.map(Be).forEach(s=>{r=Et(r,s,()=>f)})}if(be(t)){const[e,o]=t;e.forEach(f=>{r=Et(r,Be(f),()=>r)}),o&&Pe(o,n)}else Pe(t,n);return r}const qi=(r,t)=>Ue(r)||be(r)||ke(r)||je(r)||Mn(r,t);function Ki(r,t,n){const e=n.get(r);e?e.push(t):n.set(r,[t])}function $i(r,t){const n={};let e;return r.forEach(o=>{if(o.length<=1)return;t||(o=o.map(O=>O.map(String)).sort((O,C)=>O.length-C.length));const[f,...s]=o;f.length===0?e=s.map(lt):n[lt(f)]=s.map(lt)}),e?bt(n)?[e]:[e,n]:bt(n)?void 0:n}const Bn=(r,t,n,e,o=[],f=[],s=new Map)=>{const O=Ni(r);if(!O){Ki(r,o,t);const b=s.get(r);if(b)return e?{transformedValue:null}:b}if(!qi(r,n)){const b=Jt(r,n),a=b?{transformedValue:b.value,annotations:[b.type]}:{transformedValue:r};return O||s.set(r,a),a}if(Ke(f,r))return{transformedValue:null};const C=Jt(r,n),T=(C==null?void 0:C.value)??r,x=be(T)?[]:{},M={};Pe(T,(b,a)=>{if(a==="__proto__"||a==="constructor"||a==="prototype")throw new Error(`Detected property ${a}. This is a prototype pollution risk, please remove it from your object.`);const m=Bn(b,t,n,e,[...o,a],[...f,r],s);x[a]=m.transformedValue,be(m.annotations)?M[a]=m.annotations:Ue(m.annotations)&&Pe(m.annotations,(S,A)=>{M[wn(a)+"."+A]=S})});const R=bt(M)?{transformedValue:x,annotations:C?[C.type]:void 0}:{transformedValue:x,annotations:C?[C.type,M]:M};return O||s.set(r,R),R};function Un(r){return Object.prototype.toString.call(r).slice(8,-1)}function Qt(r){return Un(r)==="Array"}function Ji(r){if(Un(r)!=="Object")return!1;const t=Object.getPrototypeOf(r);return!!t&&t.constructor===Object&&t===Object.prototype}function Qi(r,t,n,e,o){const f={}.propertyIsEnumerable.call(e,t)?"enumerable":"nonenumerable";f==="enumerable"&&(r[t]=n),o&&f==="nonenumerable"&&Object.defineProperty(r,t,{value:n,enumerable:!1,writable:!0,configurable:!0})}function wt(r,t={}){if(Qt(r))return r.map(o=>wt(o,t));if(!Ji(r))return r;const n=Object.getOwnPropertyNames(r),e=Object.getOwnPropertySymbols(r);return[...n,...e].reduce((o,f)=>{if(Qt(t.props)&&!t.props.includes(f))return o;const s=r[f],O=wt(s,t);return Qi(o,f,O,r,t.nonenumerable),o},{})}class ie{constructor({dedupe:t=!1}={}){this.classRegistry=new Ai,this.symbolRegistry=new bn(n=>n.description??""),this.customTransformerRegistry=new Ti,this.allowedErrorProps=[],this.dedupe=t}serialize(t){const n=new Map,e=Bn(t,n,this,this.dedupe),o={json:e.transformedValue};e.annotations&&(o.meta={...o.meta,values:e.annotations});const f=$i(n,this.dedupe);return f&&(o.meta={...o.meta,referentialEqualities:f}),o}deserialize(t){const{json:n,meta:e}=t;let o=wt(n);return e!=null&&e.values&&(o=Wi(o,e.values,this)),e!=null&&e.referentialEqualities&&(o=zi(o,e.referentialEqualities)),o}stringify(t){return JSON.stringify(this.serialize(t))}parse(t){return this.deserialize(JSON.parse(t))}registerClass(t,n){this.classRegistry.register(t,n)}registerSymbol(t,n){this.symbolRegistry.register(t,n)}registerCustom(t,n){this.customTransformerRegistry.register({name:n,...t})}allowErrorProps(...t){this.allowedErrorProps.push(...t)}}ie.defaultInstance=new ie;ie.serialize=ie.defaultInstance.serialize.bind(ie.defaultInstance);ie.deserialize=ie.defaultInstance.deserialize.bind(ie.defaultInstance);ie.stringify=ie.defaultInstance.stringify.bind(ie.defaultInstance);ie.parse=ie.defaultInstance.parse.bind(ie.defaultInstance);ie.registerClass=ie.defaultInstance.registerClass.bind(ie.defaultInstance);ie.registerSymbol=ie.defaultInstance.registerSymbol.bind(ie.defaultInstance);ie.registerCustom=ie.defaultInstance.registerCustom.bind(ie.defaultInstance);ie.allowErrorProps=ie.defaultInstance.allowErrorProps.bind(ie.defaultInstance);const Ut=ie.serialize,Xi=ie.deserialize,Xt=r=>{if(!r||typeof r!="string")return!1;try{const t=new Date(r);return!isNaN(t.getTime())&&r.includes("T")}catch{return!1}},ft=(r,t)=>{if(Array.isArray(r)){const n=r.map(o=>typeof o=="string"&&Xt(o)?new Date(o):o);if(n.every(o=>o instanceof Date)&&n.length){if(t==="gte")return{gte:n[0]};if(t==="lte")return{lte:n[1]};const o={gte:n[0]};return n[1]&&(o.lte=n[1]),o}return n}return typeof r=="string"&&Xt(r)?new Date(r):r},Yi=r=>r&&Object.entries(r).reduce((t,[n,e])=>{if(e&&typeof e=="object")if(e.in&&Array.isArray(e.in)){const o=ft(e.in);o&&typeof o=="object"&&"gte"in o?t[n]=o:t[n]=e}else t[n]=Object.entries(e).reduce((o,[f,s])=>{const O=ft(s,f);return{...o,[f]:O}},{});else t[n]=ft(e);return t},{});function Zi(r=[]){return r.reduce((t,n)=>{const e=n.meta;switch((e==null?void 0:e.filterOperator)||n.operator){case"eq":return{...t,[n.field]:n.value};case"contains":return{...t,[n.field]:{contains:n.value}};case"gt":return{...t,[n.field]:{gt:n.value}};case"lt":return{...t,[n.field]:{lt:n.value}};case"gte":return{...t,[n.field]:{gte:n.value}};case"lte":return{...t,[n.field]:{lte:n.value}};case"in":{const f=Array.isArray(n.value)?n.value:n.value.toString().split(","),s=n.field==="id"?f:f.map(O=>{const C=Number(O);return isNaN(C)?O:C});return{...t,[n.field]:{in:s}}}default:return t}},{})}function eo(r=[]){return r.reduce((t,n)=>({...t,[n.field]:n.order}),{})}function to(r){return r.map(t=>{if(t.field.startsWith("filter[")){const[n,e,o]=t.value.split("||");return{field:n,operator:e.replace("$",""),value:o}}return t})}function Yt({pagination:r,filters:t,sorters:n,meta:e}){const o={};e!=null&&e.include&&(o.include=e.include),e!=null&&e.select&&(o.select=e.select);const{current:f=1,pageSize:s}=r??{},O=s?(Number(f)-1)*Number(s):void 0;s&&(o.skip=O,o.take=Number(s));const C=t?to(t):[],T=C.length>0?Zi(C):{},x=Object.entries(T).reduce((b,[a,m])=>{if(a.includes(".")){const[S,A]=a.split(".");return{...b,[S]:{[A]:m}}}return{...b,[a]:m}},{}),M=Yi(x);Object.keys(M).length&&(o.where=M);const R=n?eo(n):{};return Object.keys(R).length&&(o.orderBy=R),o}function no(r){const{json:t,meta:n}=Ut(r),e=new URLSearchParams;return e.append("q",JSON.stringify(t)),n&&e.append("meta",JSON.stringify({serialization:n})),e.toString()}function kn(r){const{json:t,meta:n}=Ut(r),e={...t};return n&&(e.meta={serialization:n}),e}function et(r){var t;return(t=r.meta)!=null&&t.serialization?Xi({json:r.data,meta:r.meta.serialization}):r}function _e(r,t){if(!t)return r;const n={...r};return t.include&&(n.include=t.include),t.select&&(n.select=t.select),n}async function dt(r,t){const n=no(t),{data:e}=await Ze.get(`${r}?${n}`);return et(e)}async function we(r,t){const n=kn(t),{data:e}=await Ze.post(r,n);return et(e)}const $e={getList:async({resource:r,pagination:t,filters:n,sorters:e,meta:o})=>{(t==null?void 0:t.mode)==="off"&&delete t.pageSize;const f=`${he}/${r}/findMany`,s=Yt({pagination:t,filters:n,sorters:e,meta:o});return dt(f,s)},getMany:async({resource:r,ids:t,meta:n})=>{const e=`${he}/${r}/findMany`,o=_e({where:{id:{in:t}}},n);return dt(e,o)},create:async({resource:r,variables:t,meta:n})=>{const e=`${he}/${r}/create`,o=_e({data:t},n);return we(e,o)},update:async({resource:r,id:t,variables:n,meta:e})=>{const o=`${he}/${r}/update`,f=_e({where:{id:t},data:n},e);return we(o,f)},updateMany:async({resource:r,ids:t,variables:n})=>{const e=`${he}/${r}/updateMany`;return we(e,{where:{id:{in:t}},data:n})},createMany:async({resource:r,variables:t})=>{const n=`${he}/${r}/createMany`;return we(n,{data:t})},getOne:async({resource:r,id:t,meta:n})=>{const e=`${he}/${r}/findUnique`,o=_e({where:{id:t}},n);return dt(e,o)},deleteOne:async({resource:r,id:t,meta:n})=>{const e=`${he}/${r}/delete`,o=_e({where:{id:t}},n);return we(e,o)},deleteMany:async({resource:r,ids:t})=>{const n=`${he}/${r}/deleteMany`;return we(n,{where:{id:{in:t}}})},getApiUrl:()=>he,custom:async({url:r,method:t,meta:n,filters:e,sorters:o,payload:f,query:s,headers:O})=>{const C=Yt({filters:e,sorters:o,meta:n}),T=new URLSearchParams;s&&Object.entries(s).forEach(([M,R])=>{T.append(M,R)});const x=`${r}?${T.toString()}`;if(t==="get"){const{json:M,meta:R}=Ut(C);T.append("q",JSON.stringify(M)),R&&T.append("meta",JSON.stringify({serialization:R}));const{data:b}=await Ze.get(x,{headers:O});return et(b)}else{const M={...f||{},...C},R=kn(M),{data:b}=await Ze({url:x,method:t,headers:O,data:R});return et(b)}}},ro={get:async r=>{const{resource:t,action:n,meta:e,author:o,metaData:f}=r,s=[{field:"resource",operator:"eq",value:t}];n&&s.push({field:"action",operator:"eq",value:n}),e!=null&&e.id&&s.push({field:"meta.id",operator:"eq",value:e.id}),o!=null&&o.id&&s.push({field:"userId",operator:"eq",value:o.id});const{data:O}=await $e.getList({resource:at.log,filters:s,pagination:f==null?void 0:f.pagination,sort:f==null?void 0:f.sort});return O},create:async r=>{const{resource:t,action:n,data:e,previousData:o,meta:f}=r,{AUDIT_LOG_CUSTOM_OLD:s={},AUDIT_LOG_CUSTOM_NEW:O={},...C}=e||{},T={resource:t,action:n,meta:f},x={...C,...O};Object.keys(x).length&&(T.data=x);const M={...o,...s};return Object.keys(M).length&&(T.dataPrevious=M),(await $e.create({resource:at.log,variables:T})).data},update:async r=>{const{id:t,name:n}=r;return(await $e.update({resource:at.log,id:t,variables:{name:n,updatedAt:Date.now()}})).data}},io=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,oo={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"©","&#169;":"©","&reg;":"®","&#174;":"®","&hellip;":"…","&#8230;":"…","&#x2F;":"/","&#47;":"/"},so=r=>oo[r],ao=r=>r.replace(io,so);let Zt={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:ao};const uo=(r={})=>{Zt={...Zt,...r}},co={type:"3rdParty",init(r){uo(r.options.react)}};var lo=(r,t)=>typeof t=="bigint"?t.toString():t;function ht(r,t=" | "){return r.map(n=>typeof n=="string"?`'${n}'`:n).join(t)}var en=r=>{if(typeof r!="object"||r===null)return!1;for(const t in r)if(!Object.prototype.hasOwnProperty.call(r,t))return!1;return!0},fo=(r,t)=>{if(typeof r=="string")return{key:r,values:{}};if(en(r)){const n="key"in r&&typeof r.key=="string"?r.key:t,e="values"in r&&en(r.values)?r.values:{};return{key:n,values:e}}return{key:t,values:{}}},tn="zod",ho=r=>(t,n)=>{var C;const{t:e,ns:o,handlePath:f}={t:Ye.t,ns:tn,...r,handlePath:{context:"with_path",ns:tn,keyPrefix:void 0,...r==null?void 0:r.handlePath}};let s;s=qr(t,n).message;const O=t.path.length>0&&f?{context:f.context,path:e([f.keyPrefix,t.path.join(".")].filter(Boolean).join("."),{ns:f.ns,defaultValue:t.path.join(".")})}:{};switch(t.code){case le.invalid_type:t.received===Wt.undefined?s=e("errors.invalid_type_received_undefined",{ns:o,defaultValue:s,...O}):t.received===Wt.null?s=e("errors.invalid_type_received_null",{ns:o,defaultValue:s,...O}):s=e("errors.invalid_type",{expected:e(`types.${t.expected}`,{defaultValue:t.expected,ns:o}),received:e(`types.${t.received}`,{defaultValue:t.received,ns:o}),ns:o,defaultValue:s,...O});break;case le.invalid_literal:s=e("errors.invalid_literal",{expected:JSON.stringify(t.expected,lo),ns:o,defaultValue:s,...O});break;case le.unrecognized_keys:s=e("errors.unrecognized_keys",{keys:ht(t.keys,", "),count:t.keys.length,ns:o,defaultValue:s,...O});break;case le.invalid_union:s=e("errors.invalid_union",{ns:o,defaultValue:s,...O});break;case le.invalid_union_discriminator:s=e("errors.invalid_union_discriminator",{options:ht(t.options),ns:o,defaultValue:s,...O});break;case le.invalid_enum_value:s=e("errors.invalid_enum_value",{options:ht(t.options),received:t.received,ns:o,defaultValue:s,...O});break;case le.invalid_arguments:s=e("errors.invalid_arguments",{ns:o,defaultValue:s,...O});break;case le.invalid_return_type:s=e("errors.invalid_return_type",{ns:o,defaultValue:s,...O});break;case le.invalid_date:s=e("errors.invalid_date",{ns:o,defaultValue:s,...O});break;case le.invalid_string:typeof t.validation=="object"?"startsWith"in t.validation?s=e("errors.invalid_string.startsWith",{startsWith:t.validation.startsWith,ns:o,defaultValue:s,...O}):"endsWith"in t.validation&&(s=e("errors.invalid_string.endsWith",{endsWith:t.validation.endsWith,ns:o,defaultValue:s,...O})):s=e(`errors.invalid_string.${t.validation}`,{validation:e(`validations.${t.validation}`,{defaultValue:t.validation,ns:o}),ns:o,defaultValue:s,...O});break;case le.too_small:const T=t.type==="date"?new Date(t.minimum):t.minimum;s=e(`errors.too_small.${t.type}.${t.exact?"exact":t.inclusive?"inclusive":"not_inclusive"}`,{minimum:T,count:typeof T=="number"?T:void 0,ns:o,defaultValue:s,...O});break;case le.too_big:const x=t.type==="date"?new Date(t.maximum):t.maximum;s=e(`errors.too_big.${t.type}.${t.exact?"exact":t.inclusive?"inclusive":"not_inclusive"}`,{maximum:x,count:typeof x=="number"?x:void 0,ns:o,defaultValue:s,...O});break;case le.custom:const{key:M,values:R}=fo((C=t.params)==null?void 0:C.i18n,"errors.custom");s=e(M,{...R,ns:o,defaultValue:s,...O});break;case le.invalid_intersection_types:s=e("errors.invalid_intersection_types",{ns:o,defaultValue:s,...O});break;case le.not_multiple_of:s=e("errors.not_multiple_of",{multipleOf:t.multipleOf,ns:o,defaultValue:s,...O});break;case le.not_finite:s=e("errors.not_finite",{ns:o,defaultValue:s,...O});break}return{message:s}},po=ho();const go={invalid_type:"预期输入为{{expected}}，而输入为{{received}}",invalid_type_received_undefined:"必填",invalid_type_received_null:"必填",invalid_literal:"错误的字面量值，请输入 {{expected}}",unrecognized_keys:"对象中的键无法识别: {{- keys}}",invalid_union:"不满足联合类型中的选项",invalid_union_discriminator:"标识值无法被区分。请输入 {{- options}}",invalid_enum_value:"错误的枚举值 '{{received}}'。请输入 {{- options}}",invalid_arguments:"错误的函数参数格式",invalid_return_type:"错误的函数返回值格式",invalid_date:"错误的日期格式",custom:"错误的输入格式",invalid_intersection_types:"交叉类型结果无法被合并",not_multiple_of:"数值必须是 {{multipleOf}} 的倍数",not_finite:"数值必须有限",invalid_string:{email:"错误的{{validation}}格式",url:"错误的{{validation}}格式",uuid:"错误的{{validation}}格式",cuid:"错误的{{validation}}格式",regex:"错误的格式",datetime:"错误的{{validation}}格式",startsWith:'文本必须以 "{{startsWith}}" 开头',endsWith:'文本必须以 "{{endsWith}}" 结尾'},too_small:{array:{exact:"数组元素必须为 {{minimum}} 个",inclusive:"数组元素不得少于 {{minimum}} 个",not_inclusive:"数组元素必须超过 {{minimum}} 个"},string:{exact:"文本长度必须为 {{minimum}} 个字符",inclusive:"文本长度不得少于 {{minimum}} 个字符",not_inclusive:"文本长度必须超过 {{minimum}} 个字符"},number:{exact:"数值必须为 {{minimum}}",inclusive:"数值不得小于 {{minimum}}",not_inclusive:"数值必须大于 {{minimum}}"},set:{exact:"错误的输入格式",inclusive:"错误的输入格式",not_inclusive:"错误的输入格式"},date:{exact:"日期必须为 {{- minimum, datetime}}",inclusive:"日期不得晚于 {{- minimum, datetime}}",not_inclusive:"日期必须早于 {{- minimum, datetime}}"}},too_big:{array:{exact:"数组元素必须为 {{maximum}} 个",inclusive:"数组元素不得多于 {{maximum}} 个",not_inclusive:"数组元素必须少于 {{maximum}} 个"},string:{exact:"文本长度必须为 {{maximum}} 个字符",inclusive:"文本长度不得多于 {{maximum}} 个字符",not_inclusive:"文本长度必须少于 {{maximum}} 个字符"},number:{exact:"数值必须为 {{maximum}}",inclusive:"数值不得大于 {{maximum}}",not_inclusive:"数值必须小于 {{maximum}}"},set:{exact:"错误的输入格式",inclusive:"错误的输入格式",not_inclusive:"错误的输入格式"},date:{exact:"日期必须为 {{- maximum, datetime}}",inclusive:"日期不得早于 {{- maximum, datetime}}",not_inclusive:"日期必须晚于 {{- maximum, datetime}}"}}},mo={email:"邮件",url:"链接",uuid:"uuid",cuid:"cuid",regex:"正则表达式",datetime:"日期时间"},yo={function:"函数",number:"数字",string:"字符串",nan:"非数",integer:"整数",float:"浮点数",boolean:"布尔值",date:"日期",bigint:"大整数",undefined:"未定义",symbol:"符号",null:"空对象",array:"数组",object:"对象",unknown:"未知",promise:"Promise",void:"空",never:"不存在",map:"字典",set:"集合"},vo={errors:go,validations:mo,types:yo},Co={backHome:"Back to home",deleteAlert:"This action cannot be undone!",menus:{playground:"playground",dashboard:"dashboard",about:"about",demo:"demo",demoViewTransition:"demo ViewTransition",article:"article",post:"post",category:"category",system:"system",account:"account",user:"user",role:"role",admin:"admin",casbinRule:"permission",log:"log",frontRoute:"front route",frontRouteProject:"project",frontRouteModule:"module","auditRecord/applyRole":"applyRole"},pages:{about:{title:"Full-stack WEB framework",description:"Focus on building data-intensive web applications more quickly and easily, while providing a fast, smooth user experience.",features1:"Front-back unified architecture",features2:"SSR server-side rendering",features3:"Parallel routing loading",features4:"CRUD development simplified",features5:"State persistence",features6:"Authentication",features7:"Access control",features8:"Audit log",features9:"Real-time data",features10:"Multi-language",features11:"Theme switch"},login:{title:"Welcome back",description:"Login to your OSS Inc. account",signin:"Sign in",signup:"Sign up",divider:"or",noAccount:"Don’t have an account?",fields:{email:"Email",password:"Password"},buttons:{submit:"Login",submitWithTcsk:"Continue with TCSK",forgotPassword:"Forgot password?",rememberMe:"Remember me"},errors:{validEmail:"Invalid email address",requiredEmail:"Email is required",requiredPassword:"Password is required"}},forgotPassword:{title:"Forgot your password?",fields:{email:"Email"},errors:{validEmail:"Invalid email address",requiredEmail:"Email is required"},buttons:{submit:"Send reset instructions"}},register:{title:"Sign up for your account",haveAccount:"Already have an account?",signin:"Sign in",fields:{email:"Email",validateCode:"Validation Code",password:"Password"},errors:{validEmail:"Invalid email address",requiredEmail:"Email is required",requiredPassword:"Password is required"},buttons:{submit:"Register"}},updatePassword:{title:"Update password",fields:{password:"New Password",confirmPassword:"Confirm new password"},errors:{confirmPasswordNotMatch:"Passwords do not match",requiredPassword:"Password required",requiredConfirmPassword:"Confirm password is required"},buttons:{submit:"Update"}},error:{info:"You may have forgotten to add the {{action}} component to {{resource}} resource.",404:"Sorry, the page you visited does not exist.",resource404:"Are you sure you have created the {{resource}} resource."}},actions:{list:"List",create:"Create",edit:"Edit",show:"Show"},buttons:{create:"Create",save:"Save",logout:"Logout",delete:"Delete",edit:"Edit",cancel:"Cancel",confirm:"Are you sure?",filter:"Filter",clear:"Clear",refresh:"Refresh",show:"Show",undo:"Undo",import:"Import",export:"Export",clone:"Clone",notAccessTitle:"You don't have permission to access",back:"Back",columns:"Columns",toggleColumns:"Toggle Columns",activeToggle:"Active / Disable"},warnWhenUnsavedChanges:"Are you sure you want to leave? You have unsaved changes.",notifications:{success:"Successful",error:"Error (status code: {{statusCode}})",undoable:"You have {{seconds}} seconds to undo",createSuccess:"Successfully created {{resource}}",createError:"There was an error creating {{resource}} ({{statusCode}})",deleteSuccess:"Successfully deleted {{resource}}",deleteError:"Error when deleting {{resource}} ({{statusCode}})",editSuccess:"Successfully edited {{resource}}",editError:"Error when editing {{resource}} ({{statusCode}})",importProgress:"Importing: {{processed}}/{{total}}"},loading:"Loading",tags:{clone:"Clone"},dashboard:{title:"Dashboard"},post:{posts:"Posts",fields:{id:"Id",title:"Title",category:"Category",status:{title:"Status",published:"Published",draft:"Draft",rejected:"Rejected"},content:"Content",createdAt:"Created At"},titles:{create:"Create Post",edit:"Edit Post",list:"Posts",show:"Show Post"}},table:{actions:"Actions"},documentTitle:{default:"Inc",suffix:" | Inc",post:{list:"Posts | Inc",show:"#{{id}} Show Post | Inc",edit:"#{{id}} Edit Post | Inc",create:"Create new Post | Inc",clone:"#{{id}} Clone Post | Inc"}},autoSave:{success:"saved",error:"auto save failed",loading:"saving ...",idle:"waiting for changes ..."}},Oo={backHome:"返回首页",deleteAlert:"此操作不可撤销！",menus:{playground:"演示",dashboard:"仪表板",about:"关于",demo:"示例",demoViewTransition:"示例 viewTransition",article:"文档管理",post:"文章",category:"分类",system:"系统",account:"账户管理",user:"用户",role:"角色",admin:"其他",casbinRule:"权限",log:"审计日志",frontRoute:"前端路由",frontRouteProject:"项目",frontRouteModule:"模块",auditRecord:"审核记录","auditRecord/applyRole":"角色申请",discover:"发现",menu:"菜单",dynamicPage:"配置化CRUD"},menusSecondary:{"API Docs":"接口文档","Service Health Check":"服务健康检查","Report a Bug":"提交缺陷"},pages:{about:{title:"全栈式 WEB 框架",description:"专注于更快速、轻松的构建数据密集型 Web 应用程序，同时提供快速、流畅的用户体验。",features1:"前后端一体化架构",features2:"SSR 服务端渲染",features3:"路由并行加载",features4:"CRUD 增删改查开发简化",features5:"状态持久化",features6:"身份验证",features7:"访问控制",features8:"审计日志",features9:"实时数据",features10:"多国语言",features11:"主题切换"},login:{title:"欢迎回来",description:"登录到您的 OSS Inc. 账户",signup:"注册",divider:"或",noAccount:"没有账户？",fields:{email:"邮箱",password:"密码"},buttons:{submit:"登录",submitWithTcsk:"猎户座 - 联合登录",forgotPassword:"忘记密码？",rememberMe:"记住我"},errors:{validEmail:"无效的邮箱地址",requiredEmail:"邮箱是必填项",requiredPassword:"密码是必填项"}},forgotPassword:{title:"忘记密码？",fields:{email:"邮箱"},errors:{validEmail:"无效的邮箱地址",requiredEmail:"邮箱是必填项"},buttons:{submit:"发送重置说明"}},register:{title:"注册账户",haveAccount:"已有账户？",signin:"登录",fields:{email:"邮箱",validateCode:"验证码",password:"密码"},errors:{validEmail:"无效的邮箱地址",requiredEmail:"邮箱是必填项",requiredPassword:"密码是必填项"},buttons:{submit:"注册"}},updatePassword:{title:"更新密码",fields:{password:"新密码",confirmPassword:"确认新密码"},errors:{confirmPasswordNotMatch:"密码不匹配",requiredPassword:"密码是必填项",requiredConfirmPassword:"确认密码是必填项"},buttons:{submit:"更新"}},error:{info:"您可能忘记将 {{action}} 组件添加到 {{resource}} 资源中。",404:"抱歉，您访问的页面不存在。",resource404:"请确认您是否已创建 {{resource}} 资源。"}},actions:{list:"列表",create:"创建",edit:"编辑",show:"查看"},buttons:{create:"创建",save:"保存",logout:"退出登录",delete:"删除",edit:"编辑",cancel:"取消",confirm:"确定吗？",filter:"筛选",clear:"清除",refresh:"刷新",show:"查看",undo:"撤销",import:"导入",export:"导出",clone:"克隆",notAccessTitle:"您没有访问权限",back:"返回",columns:"表格列",toggleColumns:"切换列显示 / 不显示",activeToggle:"激活 / 禁用"},warnWhenUnsavedChanges:"确定要离开吗？您有未保存的更改。",notifications:{success:"操作成功",error:"错误（状态码：{{statusCode}}）",undoable:"您有 {{seconds}} 秒可以撤销",createSuccess:"成功创建 {{resource}}",createError:"创建 {{resource}} 时出错（状态码：{{statusCode}}）",deleteSuccess:"成功删除 {{resource}}",deleteError:"删除 {{resource}} 时出错（状态码：{{statusCode}}）",editSuccess:"成功编辑 {{resource}}",editError:"编辑 {{resource}} 时出错（状态码：{{statusCode}}）",importProgress:"导入进度：{{processed}}/{{total}}"},loading:"加载中",tags:{clone:"克隆"},dashboard:{title:"仪表盘"},post:{posts:"文章",fields:{id:"编号",title:"标题",category:"分类",status:{title:"状态",published:"已发布",draft:"草稿",rejected:"已拒绝"},content:"内容",createdAt:"创建时间"},titles:{create:"创建文章",edit:"编辑文章",list:"文章列表",show:"查看文章"}},table:{actions:"操作"},documentTitle:{default:"Inc",suffix:" | Inc",post:{list:"文章列表 | Inc",show:"#{{id}} 查看文章 | Inc",edit:"#{{id}} 编辑文章 | Inc",create:"创建新文章 | Inc",clone:"#{{id}} 克隆文章 | Inc"}},autoSave:{success:"已保存",error:"自动保存失败",loading:"保存中...",idle:"等待更改"}},jn=["zh","en"],nn=jn[0],It="translation",Ro={zh:{[It]:Oo,zod:vo},en:{[It]:Co}};Kr.setErrorMap(po);const So=()=>{var r;try{const t=oi.get("preferences");return t?(r=JSON.parse(t))==null?void 0:r.locale:null}catch(t){return console.error("@getCookieLocale",t),null}},pt=hn()&&So()||nn;Ye.isInitialized?Ye.language!==pt&&pn(pt):_r(co).init({resources:Ro,supportedLngs:jn,lng:pt,ns:[It],react:{useSuspense:!1}});const Ao={translate:(r,t)=>dn(r,t||r),changeLocale:async r=>{await pn(r);const t=new FormData;t.append("locale",r);const n=await fetch(`${he}/set-preferences`,{method:"POST",body:t}),{data:e}=await n.json();return Promise.resolve(e)},getLocale:()=>Ye.language},Oe=Object.create(null);Oe.open="0";Oe.close="1";Oe.ping="2";Oe.pong="3";Oe.message="4";Oe.upgrade="5";Oe.noop="6";const Je=Object.create(null);Object.keys(Oe).forEach(r=>{Je[Oe[r]]=r});const Pt={type:"error",data:"parser error"},Hn=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Gn=typeof ArrayBuffer=="function",Fn=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r&&r.buffer instanceof ArrayBuffer,kt=({type:r,data:t},n,e)=>Hn&&t instanceof Blob?n?e(t):rn(t,e):Gn&&(t instanceof ArrayBuffer||Fn(t))?n?e(t):rn(new Blob([t]),e):e(Oe[r]+(t||"")),rn=(r,t)=>{const n=new FileReader;return n.onload=function(){const e=n.result.split(",")[1];t("b"+(e||""))},n.readAsDataURL(r)};function on(r){return r instanceof Uint8Array?r:r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r.buffer,r.byteOffset,r.byteLength)}let gt;function bo(r,t){if(Hn&&r.data instanceof Blob)return r.data.arrayBuffer().then(on).then(t);if(Gn&&(r.data instanceof ArrayBuffer||Fn(r.data)))return t(on(r.data));kt(r,!1,n=>{gt||(gt=new TextEncoder),t(gt.encode(n))})}const sn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ne=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let r=0;r<sn.length;r++)Ne[sn.charCodeAt(r)]=r;const Eo=r=>{let t=r.length*.75,n=r.length,e,o=0,f,s,O,C;r[r.length-1]==="="&&(t--,r[r.length-2]==="="&&t--);const T=new ArrayBuffer(t),x=new Uint8Array(T);for(e=0;e<n;e+=4)f=Ne[r.charCodeAt(e)],s=Ne[r.charCodeAt(e+1)],O=Ne[r.charCodeAt(e+2)],C=Ne[r.charCodeAt(e+3)],x[o++]=f<<2|s>>4,x[o++]=(s&15)<<4|O>>2,x[o++]=(O&3)<<6|C&63;return T},To=typeof ArrayBuffer=="function",jt=(r,t)=>{if(typeof r!="string")return{type:"message",data:Vn(r,t)};const n=r.charAt(0);return n==="b"?{type:"message",data:wo(r.substring(1),t)}:Je[n]?r.length>1?{type:Je[n],data:r.substring(1)}:{type:Je[n]}:Pt},wo=(r,t)=>{if(To){const n=Eo(r);return Vn(n,t)}else return{base64:!0,data:r}},Vn=(r,t)=>{switch(t){case"blob":return r instanceof Blob?r:new Blob([r]);case"arraybuffer":default:return r instanceof ArrayBuffer?r:r.buffer}},Wn="",Io=(r,t)=>{const n=r.length,e=new Array(n);let o=0;r.forEach((f,s)=>{kt(f,!1,O=>{e[s]=O,++o===n&&t(e.join(Wn))})})},Po=(r,t)=>{const n=r.split(Wn),e=[];for(let o=0;o<n.length;o++){const f=jt(n[o],t);if(e.push(f),f.type==="error")break}return e};function xo(){return new TransformStream({transform(r,t){bo(r,n=>{const e=n.length;let o;if(e<126)o=new Uint8Array(1),new DataView(o.buffer).setUint8(0,e);else if(e<65536){o=new Uint8Array(3);const f=new DataView(o.buffer);f.setUint8(0,126),f.setUint16(1,e)}else{o=new Uint8Array(9);const f=new DataView(o.buffer);f.setUint8(0,127),f.setBigUint64(1,BigInt(e))}r.data&&typeof r.data!="string"&&(o[0]|=128),t.enqueue(o),t.enqueue(n)})}})}let mt;function ze(r){return r.reduce((t,n)=>t+n.length,0)}function qe(r,t){if(r[0].length===t)return r.shift();const n=new Uint8Array(t);let e=0;for(let o=0;o<t;o++)n[o]=r[0][e++],e===r[0].length&&(r.shift(),e=0);return r.length&&e<r[0].length&&(r[0]=r[0].slice(e)),n}function Mo(r,t){mt||(mt=new TextDecoder);const n=[];let e=0,o=-1,f=!1;return new TransformStream({transform(s,O){for(n.push(s);;){if(e===0){if(ze(n)<1)break;const C=qe(n,1);f=(C[0]&128)===128,o=C[0]&127,o<126?e=3:o===126?e=1:e=2}else if(e===1){if(ze(n)<2)break;const C=qe(n,2);o=new DataView(C.buffer,C.byteOffset,C.length).getUint16(0),e=3}else if(e===2){if(ze(n)<8)break;const C=qe(n,8),T=new DataView(C.buffer,C.byteOffset,C.length),x=T.getUint32(0);if(x>Math.pow(2,21)-1){O.enqueue(Pt);break}o=x*Math.pow(2,32)+T.getUint32(4),e=3}else{if(ze(n)<o)break;const C=qe(n,o);O.enqueue(jt(f?C:mt.decode(C),t)),e=0}if(o===0||o>r){O.enqueue(Pt);break}}}})}const zn=4;function se(r){if(r)return Do(r)}function Do(r){for(var t in se.prototype)r[t]=se.prototype[t];return r}se.prototype.on=se.prototype.addEventListener=function(r,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+r]=this._callbacks["$"+r]||[]).push(t),this};se.prototype.once=function(r,t){function n(){this.off(r,n),t.apply(this,arguments)}return n.fn=t,this.on(r,n),this};se.prototype.off=se.prototype.removeListener=se.prototype.removeAllListeners=se.prototype.removeEventListener=function(r,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var n=this._callbacks["$"+r];if(!n)return this;if(arguments.length==1)return delete this._callbacks["$"+r],this;for(var e,o=0;o<n.length;o++)if(e=n[o],e===t||e.fn===t){n.splice(o,1);break}return n.length===0&&delete this._callbacks["$"+r],this};se.prototype.emit=function(r){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+r],e=1;e<arguments.length;e++)t[e-1]=arguments[e];if(n){n=n.slice(0);for(var e=0,o=n.length;e<o;++e)n[e].apply(this,t)}return this};se.prototype.emitReserved=se.prototype.emit;se.prototype.listeners=function(r){return this._callbacks=this._callbacks||{},this._callbacks["$"+r]||[]};se.prototype.hasListeners=function(r){return!!this.listeners(r).length};const nt=typeof Promise=="function"&&typeof Promise.resolve=="function"?t=>Promise.resolve().then(t):(t,n)=>n(t,0),pe=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),_o="arraybuffer";function qn(r,...t){return t.reduce((n,e)=>(r.hasOwnProperty(e)&&(n[e]=r[e]),n),{})}const Lo=pe.setTimeout,No=pe.clearTimeout;function rt(r,t){t.useNativeTimers?(r.setTimeoutFn=Lo.bind(pe),r.clearTimeoutFn=No.bind(pe)):(r.setTimeoutFn=pe.setTimeout.bind(pe),r.clearTimeoutFn=pe.clearTimeout.bind(pe))}const Bo=1.33;function Uo(r){return typeof r=="string"?ko(r):Math.ceil((r.byteLength||r.size)*Bo)}function ko(r){let t=0,n=0;for(let e=0,o=r.length;e<o;e++)t=r.charCodeAt(e),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(e++,n+=4);return n}function Kn(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function jo(r){let t="";for(let n in r)r.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(r[n]));return t}function Ho(r){let t={},n=r.split("&");for(let e=0,o=n.length;e<o;e++){let f=n[e].split("=");t[decodeURIComponent(f[0])]=decodeURIComponent(f[1])}return t}class Go extends Error{constructor(t,n,e){super(t),this.description=n,this.context=e,this.type="TransportError"}}class Ht extends se{constructor(t){super(),this.writable=!1,rt(this,t),this.opts=t,this.query=t.query,this.socket=t.socket,this.supportsBinary=!t.forceBase64}onError(t,n,e){return super.emitReserved("error",new Go(t,n,e)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(t){this.readyState==="open"&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const n=jt(t,this.socket.binaryType);this.onPacket(n)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}createUri(t,n={}){return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(n)}_hostname(){const t=this.opts.hostname;return t.indexOf(":")===-1?t:"["+t+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(t){const n=jo(t);return n.length?"?"+n:""}}class Fo extends Ht{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(t){this.readyState="pausing";const n=()=>{this.readyState="paused",t()};if(this._polling||!this.writable){let e=0;this._polling&&(e++,this.once("pollComplete",function(){--e||n()})),this.writable||(e++,this.once("drain",function(){--e||n()}))}else n()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){const n=e=>{if(this.readyState==="opening"&&e.type==="open"&&this.onOpen(),e.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)};Po(t,this.socket.binaryType).forEach(n),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const t=()=>{this.write([{type:"close"}])};this.readyState==="open"?t():this.once("open",t)}write(t){this.writable=!1,Io(t,n=>{this.doWrite(n,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const t=this.opts.secure?"https":"http",n=this.query||{};return this.opts.timestampRequests!==!1&&(n[this.opts.timestampParam]=Kn()),!this.supportsBinary&&!n.sid&&(n.b64=1),this.createUri(t,n)}}let $n=!1;try{$n=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Vo=$n;function Wo(){}class zo extends Fo{constructor(t){if(super(t),typeof location<"u"){const n=location.protocol==="https:";let e=location.port;e||(e=n?"443":"80"),this.xd=typeof location<"u"&&t.hostname!==location.hostname||e!==t.port}}doWrite(t,n){const e=this.request({method:"POST",data:t});e.on("success",n),e.on("error",(o,f)=>{this.onError("xhr post error",o,f)})}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(n,e)=>{this.onError("xhr poll error",n,e)}),this.pollXhr=t}}class Ce extends se{constructor(t,n,e){super(),this.createRequest=t,rt(this,e),this._opts=e,this._method=e.method||"GET",this._uri=n,this._data=e.data!==void 0?e.data:null,this._create()}_create(){var t;const n=qn(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");n.xdomain=!!this._opts.xd;const e=this._xhr=this.createRequest(n);try{e.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){e.setDisableHeaderCheck&&e.setDisableHeaderCheck(!0);for(let o in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(o)&&e.setRequestHeader(o,this._opts.extraHeaders[o])}}catch{}if(this._method==="POST")try{e.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{e.setRequestHeader("Accept","*/*")}catch{}(t=this._opts.cookieJar)===null||t===void 0||t.addCookies(e),"withCredentials"in e&&(e.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(e.timeout=this._opts.requestTimeout),e.onreadystatechange=()=>{var o;e.readyState===3&&((o=this._opts.cookieJar)===null||o===void 0||o.parseCookies(e.getResponseHeader("set-cookie"))),e.readyState===4&&(e.status===200||e.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof e.status=="number"?e.status:0)},0))},e.send(this._data)}catch(o){this.setTimeoutFn(()=>{this._onError(o)},0);return}typeof document<"u"&&(this._index=Ce.requestsCount++,Ce.requests[this._index]=this)}_onError(t){this.emitReserved("error",t,this._xhr),this._cleanup(!0)}_cleanup(t){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=Wo,t)try{this._xhr.abort()}catch{}typeof document<"u"&&delete Ce.requests[this._index],this._xhr=null}}_onLoad(){const t=this._xhr.responseText;t!==null&&(this.emitReserved("data",t),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}Ce.requestsCount=0;Ce.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",an);else if(typeof addEventListener=="function"){const r="onpagehide"in pe?"pagehide":"unload";addEventListener(r,an,!1)}}function an(){for(let r in Ce.requests)Ce.requests.hasOwnProperty(r)&&Ce.requests[r].abort()}const qo=function(){const r=Jn({xdomain:!1});return r&&r.responseType!==null}();class Ko extends zo{constructor(t){super(t);const n=t&&t.forceBase64;this.supportsBinary=qo&&!n}request(t={}){return Object.assign(t,{xd:this.xd},this.opts),new Ce(Jn,this.uri(),t)}}function Jn(r){const t=r.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!t||Vo))return new XMLHttpRequest}catch{}if(!t)try{return new pe[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const Qn=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class $o extends Ht{get name(){return"websocket"}doOpen(){const t=this.uri(),n=this.opts.protocols,e=Qn?{}:qn(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(e.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(t,n,e)}catch(o){return this.emitReserved("error",o)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let n=0;n<t.length;n++){const e=t[n],o=n===t.length-1;kt(e,this.supportsBinary,f=>{try{this.doWrite(e,f)}catch{}o&&nt(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const t=this.opts.secure?"wss":"ws",n=this.query||{};return this.opts.timestampRequests&&(n[this.opts.timestampParam]=Kn()),this.supportsBinary||(n.b64=1),this.createUri(t,n)}}const yt=pe.WebSocket||pe.MozWebSocket;class Jo extends $o{createSocket(t,n,e){return Qn?new yt(t,n,e):n?new yt(t,n):new yt(t)}doWrite(t,n){this.ws.send(n)}}class Qo extends Ht{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(t){return this.emitReserved("error",t)}this._transport.closed.then(()=>{this.onClose()}).catch(t=>{this.onError("webtransport error",t)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(t=>{const n=Mo(Number.MAX_SAFE_INTEGER,this.socket.binaryType),e=t.readable.pipeThrough(n).getReader(),o=xo();o.readable.pipeTo(t.writable),this._writer=o.writable.getWriter();const f=()=>{e.read().then(({done:O,value:C})=>{O||(this.onPacket(C),f())}).catch(O=>{})};f();const s={type:"open"};this.query.sid&&(s.data=`{"sid":"${this.query.sid}"}`),this._writer.write(s).then(()=>this.onOpen())})})}write(t){this.writable=!1;for(let n=0;n<t.length;n++){const e=t[n],o=n===t.length-1;this._writer.write(e).then(()=>{o&&nt(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var t;(t=this._transport)===null||t===void 0||t.close()}}const Xo={websocket:Jo,webtransport:Qo,polling:Ko},Yo=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Zo=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function xt(r){if(r.length>8e3)throw"URI too long";const t=r,n=r.indexOf("["),e=r.indexOf("]");n!=-1&&e!=-1&&(r=r.substring(0,n)+r.substring(n,e).replace(/:/g,";")+r.substring(e,r.length));let o=Yo.exec(r||""),f={},s=14;for(;s--;)f[Zo[s]]=o[s]||"";return n!=-1&&e!=-1&&(f.source=t,f.host=f.host.substring(1,f.host.length-1).replace(/;/g,":"),f.authority=f.authority.replace("[","").replace("]","").replace(/;/g,":"),f.ipv6uri=!0),f.pathNames=es(f,f.path),f.queryKey=ts(f,f.query),f}function es(r,t){const n=/\/{2,9}/g,e=t.replace(n,"/").split("/");return(t.slice(0,1)=="/"||t.length===0)&&e.splice(0,1),t.slice(-1)=="/"&&e.splice(e.length-1,1),e}function ts(r,t){const n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(e,o,f){o&&(n[o]=f)}),n}const Mt=typeof addEventListener=="function"&&typeof removeEventListener=="function",Qe=[];Mt&&addEventListener("offline",()=>{Qe.forEach(r=>r())},!1);class Ae extends se{constructor(t,n){if(super(),this.binaryType=_o,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,t&&typeof t=="object"&&(n=t,t=null),t){const e=xt(t);n.hostname=e.host,n.secure=e.protocol==="https"||e.protocol==="wss",n.port=e.port,e.query&&(n.query=e.query)}else n.host&&(n.hostname=xt(n.host).host);rt(this,n),this.secure=n.secure!=null?n.secure:typeof location<"u"&&location.protocol==="https:",n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},n.transports.forEach(e=>{const o=e.prototype.name;this.transports.push(o),this._transportsByName[o]=e}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},n),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Ho(this.opts.query)),Mt&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},Qe.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(t){const n=Object.assign({},this.opts.query);n.EIO=zn,n.transport=t,this.id&&(n.sid=this.id);const e=Object.assign({},this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new this._transportsByName[t](e)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const t=this.opts.rememberUpgrade&&Ae.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const n=this.createTransport(t);n.open(),this.setTransport(n)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",n=>this._onClose("transport close",n))}onOpen(){this.readyState="open",Ae.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const n=new Error("server error");n.code=t.data,this._onError(n);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this._pingInterval=t.pingInterval,this._pingTimeout=t.pingTimeout,this._maxPayload=t.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const t=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+t,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},t),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this._getWritablePackets();this.transport.send(t),this._prevBufferLen=t.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let e=0;e<this.writeBuffer.length;e++){const o=this.writeBuffer[e].data;if(o&&(n+=Uo(o)),e>0&&n>this._maxPayload)return this.writeBuffer.slice(0,e);n+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const t=Date.now()>this._pingTimeoutTime;return t&&(this._pingTimeoutTime=0,nt(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),t}write(t,n,e){return this._sendPacket("message",t,n,e),this}send(t,n,e){return this._sendPacket("message",t,n,e),this}_sendPacket(t,n,e,o){if(typeof n=="function"&&(o=n,n=void 0),typeof e=="function"&&(o=e,e=null),this.readyState==="closing"||this.readyState==="closed")return;e=e||{},e.compress=e.compress!==!1;const f={type:t,data:n,options:e};this.emitReserved("packetCreate",f),this.writeBuffer.push(f),o&&this.once("flush",o),this.flush()}close(){const t=()=>{this._onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),t()},e=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?e():t()}):this.upgrading?e():t()),this}_onError(t){if(Ae.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",t),this._onClose("transport error",t)}_onClose(t,n){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),Mt&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const e=Qe.indexOf(this._offlineEventListener);e!==-1&&Qe.splice(e,1)}this.readyState="closed",this.id=null,this.emitReserved("close",t,n),this.writeBuffer=[],this._prevBufferLen=0}}}Ae.protocol=zn;class ns extends Ae{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let t=0;t<this._upgrades.length;t++)this._probe(this._upgrades[t])}_probe(t){let n=this.createTransport(t),e=!1;Ae.priorWebsocketSuccess=!1;const o=()=>{e||(n.send([{type:"ping",data:"probe"}]),n.once("packet",M=>{if(!e)if(M.type==="pong"&&M.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;Ae.priorWebsocketSuccess=n.name==="websocket",this.transport.pause(()=>{e||this.readyState!=="closed"&&(x(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{const R=new Error("probe error");R.transport=n.name,this.emitReserved("upgradeError",R)}}))};function f(){e||(e=!0,x(),n.close(),n=null)}const s=M=>{const R=new Error("probe error: "+M);R.transport=n.name,f(),this.emitReserved("upgradeError",R)};function O(){s("transport closed")}function C(){s("socket closed")}function T(M){n&&M.name!==n.name&&f()}const x=()=>{n.removeListener("open",o),n.removeListener("error",s),n.removeListener("close",O),this.off("close",C),this.off("upgrading",T)};n.once("open",o),n.once("error",s),n.once("close",O),this.once("close",C),this.once("upgrading",T),this._upgrades.indexOf("webtransport")!==-1&&t!=="webtransport"?this.setTimeoutFn(()=>{e||n.open()},200):n.open()}onHandshake(t){this._upgrades=this._filterUpgrades(t.upgrades),super.onHandshake(t)}_filterUpgrades(t){const n=[];for(let e=0;e<t.length;e++)~this.transports.indexOf(t[e])&&n.push(t[e]);return n}}let rs=class extends ns{constructor(t,n={}){const e=typeof t=="object"?t:n;(!e.transports||e.transports&&typeof e.transports[0]=="string")&&(e.transports=(e.transports||["polling","websocket","webtransport"]).map(o=>Xo[o]).filter(o=>!!o)),super(t,e)}};function is(r,t="",n){let e=r;n=n||typeof location<"u"&&location,r==null&&(r=n.protocol+"//"+n.host),typeof r=="string"&&(r.charAt(0)==="/"&&(r.charAt(1)==="/"?r=n.protocol+r:r=n.host+r),/^(https?|wss?):\/\//.test(r)||(typeof n<"u"?r=n.protocol+"//"+r:r="https://"+r),e=xt(r)),e.port||(/^(http|ws)$/.test(e.protocol)?e.port="80":/^(http|ws)s$/.test(e.protocol)&&(e.port="443")),e.path=e.path||"/";const f=e.host.indexOf(":")!==-1?"["+e.host+"]":e.host;return e.id=e.protocol+"://"+f+":"+e.port+t,e.href=e.protocol+"://"+f+(n&&n.port===e.port?"":":"+e.port),e}const os=typeof ArrayBuffer=="function",ss=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r.buffer instanceof ArrayBuffer,Xn=Object.prototype.toString,as=typeof Blob=="function"||typeof Blob<"u"&&Xn.call(Blob)==="[object BlobConstructor]",us=typeof File=="function"||typeof File<"u"&&Xn.call(File)==="[object FileConstructor]";function Gt(r){return os&&(r instanceof ArrayBuffer||ss(r))||as&&r instanceof Blob||us&&r instanceof File}function Xe(r,t){if(!r||typeof r!="object")return!1;if(Array.isArray(r)){for(let n=0,e=r.length;n<e;n++)if(Xe(r[n]))return!0;return!1}if(Gt(r))return!0;if(r.toJSON&&typeof r.toJSON=="function"&&arguments.length===1)return Xe(r.toJSON(),!0);for(const n in r)if(Object.prototype.hasOwnProperty.call(r,n)&&Xe(r[n]))return!0;return!1}function cs(r){const t=[],n=r.data,e=r;return e.data=Dt(n,t),e.attachments=t.length,{packet:e,buffers:t}}function Dt(r,t){if(!r)return r;if(Gt(r)){const n={_placeholder:!0,num:t.length};return t.push(r),n}else if(Array.isArray(r)){const n=new Array(r.length);for(let e=0;e<r.length;e++)n[e]=Dt(r[e],t);return n}else if(typeof r=="object"&&!(r instanceof Date)){const n={};for(const e in r)Object.prototype.hasOwnProperty.call(r,e)&&(n[e]=Dt(r[e],t));return n}return r}function ls(r,t){return r.data=_t(r.data,t),delete r.attachments,r}function _t(r,t){if(!r)return r;if(r&&r._placeholder===!0){if(typeof r.num=="number"&&r.num>=0&&r.num<t.length)return t[r.num];throw new Error("illegal attachments")}else if(Array.isArray(r))for(let n=0;n<r.length;n++)r[n]=_t(r[n],t);else if(typeof r=="object")for(const n in r)Object.prototype.hasOwnProperty.call(r,n)&&(r[n]=_t(r[n],t));return r}const fs=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],ds=5;var ne;(function(r){r[r.CONNECT=0]="CONNECT",r[r.DISCONNECT=1]="DISCONNECT",r[r.EVENT=2]="EVENT",r[r.ACK=3]="ACK",r[r.CONNECT_ERROR=4]="CONNECT_ERROR",r[r.BINARY_EVENT=5]="BINARY_EVENT",r[r.BINARY_ACK=6]="BINARY_ACK"})(ne||(ne={}));class hs{constructor(t){this.replacer=t}encode(t){return(t.type===ne.EVENT||t.type===ne.ACK)&&Xe(t)?this.encodeAsBinary({type:t.type===ne.EVENT?ne.BINARY_EVENT:ne.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id}):[this.encodeAsString(t)]}encodeAsString(t){let n=""+t.type;return(t.type===ne.BINARY_EVENT||t.type===ne.BINARY_ACK)&&(n+=t.attachments+"-"),t.nsp&&t.nsp!=="/"&&(n+=t.nsp+","),t.id!=null&&(n+=t.id),t.data!=null&&(n+=JSON.stringify(t.data,this.replacer)),n}encodeAsBinary(t){const n=cs(t),e=this.encodeAsString(n.packet),o=n.buffers;return o.unshift(e),o}}function un(r){return Object.prototype.toString.call(r)==="[object Object]"}class Ft extends se{constructor(t){super(),this.reviver=t}add(t){let n;if(typeof t=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");n=this.decodeString(t);const e=n.type===ne.BINARY_EVENT;e||n.type===ne.BINARY_ACK?(n.type=e?ne.EVENT:ne.ACK,this.reconstructor=new ps(n),n.attachments===0&&super.emitReserved("decoded",n)):super.emitReserved("decoded",n)}else if(Gt(t)||t.base64)if(this.reconstructor)n=this.reconstructor.takeBinaryData(t),n&&(this.reconstructor=null,super.emitReserved("decoded",n));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+t)}decodeString(t){let n=0;const e={type:Number(t.charAt(0))};if(ne[e.type]===void 0)throw new Error("unknown packet type "+e.type);if(e.type===ne.BINARY_EVENT||e.type===ne.BINARY_ACK){const f=n+1;for(;t.charAt(++n)!=="-"&&n!=t.length;);const s=t.substring(f,n);if(s!=Number(s)||t.charAt(n)!=="-")throw new Error("Illegal attachments");e.attachments=Number(s)}if(t.charAt(n+1)==="/"){const f=n+1;for(;++n&&!(t.charAt(n)===","||n===t.length););e.nsp=t.substring(f,n)}else e.nsp="/";const o=t.charAt(n+1);if(o!==""&&Number(o)==o){const f=n+1;for(;++n;){const s=t.charAt(n);if(s==null||Number(s)!=s){--n;break}if(n===t.length)break}e.id=Number(t.substring(f,n+1))}if(t.charAt(++n)){const f=this.tryParse(t.substr(n));if(Ft.isPayloadValid(e.type,f))e.data=f;else throw new Error("invalid payload")}return e}tryParse(t){try{return JSON.parse(t,this.reviver)}catch{return!1}}static isPayloadValid(t,n){switch(t){case ne.CONNECT:return un(n);case ne.DISCONNECT:return n===void 0;case ne.CONNECT_ERROR:return typeof n=="string"||un(n);case ne.EVENT:case ne.BINARY_EVENT:return Array.isArray(n)&&(typeof n[0]=="number"||typeof n[0]=="string"&&fs.indexOf(n[0])===-1);case ne.ACK:case ne.BINARY_ACK:return Array.isArray(n)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class ps{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const n=ls(this.reconPack,this.buffers);return this.finishedReconstruction(),n}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const gs=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Ft,Encoder:hs,get PacketType(){return ne},protocol:ds},Symbol.toStringTag,{value:"Module"}));function me(r,t,n){return r.on(t,n),function(){r.off(t,n)}}const ms=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Yn extends se{constructor(t,n,e){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=n,e&&e.auth&&(this.auth=e.auth),this._opts=Object.assign({},e),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[me(t,"open",this.onopen.bind(this)),me(t,"packet",this.onpacket.bind(this)),me(t,"error",this.onerror.bind(this)),me(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...n){var e,o,f;if(ms.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(n.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(n),this;const s={type:ne.EVENT,data:n};if(s.options={},s.options.compress=this.flags.compress!==!1,typeof n[n.length-1]=="function"){const x=this.ids++,M=n.pop();this._registerAckCallback(x,M),s.id=x}const O=(o=(e=this.io.engine)===null||e===void 0?void 0:e.transport)===null||o===void 0?void 0:o.writable,C=this.connected&&!(!((f=this.io.engine)===null||f===void 0)&&f._hasPingExpired());return this.flags.volatile&&!O||(C?(this.notifyOutgoingListeners(s),this.packet(s)):this.sendBuffer.push(s)),this.flags={},this}_registerAckCallback(t,n){var e;const o=(e=this.flags.timeout)!==null&&e!==void 0?e:this._opts.ackTimeout;if(o===void 0){this.acks[t]=n;return}const f=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let O=0;O<this.sendBuffer.length;O++)this.sendBuffer[O].id===t&&this.sendBuffer.splice(O,1);n.call(this,new Error("operation has timed out"))},o),s=(...O)=>{this.io.clearTimeoutFn(f),n.apply(this,O)};s.withError=!0,this.acks[t]=s}emitWithAck(t,...n){return new Promise((e,o)=>{const f=(s,O)=>s?o(s):e(O);f.withError=!0,n.push(f),this.emit(t,...n)})}_addToQueue(t){let n;typeof t[t.length-1]=="function"&&(n=t.pop());const e={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push((o,...f)=>e!==this._queue[0]?void 0:(o!==null?e.tryCount>this._opts.retries&&(this._queue.shift(),n&&n(o)):(this._queue.shift(),n&&n(null,...f)),e.pending=!1,this._drainQueue())),this._queue.push(e),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||this._queue.length===0)return;const n=this._queue[0];n.pending&&!t||(n.pending=!0,n.tryCount++,this.flags=n.flags,this.emit.apply(this,n.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){typeof this.auth=="function"?this.auth(t=>{this._sendConnectPacket(t)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:ne.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,n){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,n),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(t=>{if(!this.sendBuffer.some(e=>String(e.id)===t)){const e=this.acks[t];delete this.acks[t],e.withError&&e.call(this,new Error("socket has been disconnected"))}})}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case ne.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case ne.EVENT:case ne.BINARY_EVENT:this.onevent(t);break;case ne.ACK:case ne.BINARY_ACK:this.onack(t);break;case ne.DISCONNECT:this.ondisconnect();break;case ne.CONNECT_ERROR:this.destroy();const e=new Error(t.data.message);e.data=t.data.data,this.emitReserved("connect_error",e);break}}onevent(t){const n=t.data||[];t.id!=null&&n.push(this.ack(t.id)),this.connected?this.emitEvent(n):this.receiveBuffer.push(Object.freeze(n))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const n=this._anyListeners.slice();for(const e of n)e.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&typeof t[t.length-1]=="string"&&(this._lastOffset=t[t.length-1])}ack(t){const n=this;let e=!1;return function(...o){e||(e=!0,n.packet({type:ne.ACK,id:t,data:o}))}}onack(t){const n=this.acks[t.id];typeof n=="function"&&(delete this.acks[t.id],n.withError&&t.data.unshift(null),n.apply(this,t.data))}onconnect(t,n){this.id=t,this.recovered=n&&this._pid===n,this._pid=n,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:ne.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const n=this._anyListeners;for(let e=0;e<n.length;e++)if(t===n[e])return n.splice(e,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const n=this._anyOutgoingListeners;for(let e=0;e<n.length;e++)if(t===n[e])return n.splice(e,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const n=this._anyOutgoingListeners.slice();for(const e of n)e.apply(this,t.data)}}}function xe(r){r=r||{},this.ms=r.min||100,this.max=r.max||1e4,this.factor=r.factor||2,this.jitter=r.jitter>0&&r.jitter<=1?r.jitter:0,this.attempts=0}xe.prototype.duration=function(){var r=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*r);r=Math.floor(t*10)&1?r+n:r-n}return Math.min(r,this.max)|0};xe.prototype.reset=function(){this.attempts=0};xe.prototype.setMin=function(r){this.ms=r};xe.prototype.setMax=function(r){this.max=r};xe.prototype.setJitter=function(r){this.jitter=r};class Lt extends se{constructor(t,n){var e;super(),this.nsps={},this.subs=[],t&&typeof t=="object"&&(n=t,t=void 0),n=n||{},n.path=n.path||"/socket.io",this.opts=n,rt(this,n),this.reconnection(n.reconnection!==!1),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor((e=n.randomizationFactor)!==null&&e!==void 0?e:.5),this.backoff=new xe({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(n.timeout==null?2e4:n.timeout),this._readyState="closed",this.uri=t;const o=n.parser||gs;this.encoder=new o.Encoder,this.decoder=new o.Decoder,this._autoConnect=n.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,t||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(t){return t===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var n;return t===void 0?this._reconnectionDelay:(this._reconnectionDelay=t,(n=this.backoff)===null||n===void 0||n.setMin(t),this)}randomizationFactor(t){var n;return t===void 0?this._randomizationFactor:(this._randomizationFactor=t,(n=this.backoff)===null||n===void 0||n.setJitter(t),this)}reconnectionDelayMax(t){var n;return t===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,(n=this.backoff)===null||n===void 0||n.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new rs(this.uri,this.opts);const n=this.engine,e=this;this._readyState="opening",this.skipReconnect=!1;const o=me(n,"open",function(){e.onopen(),t&&t()}),f=O=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",O),t?t(O):this.maybeReconnectOnOpen()},s=me(n,"error",f);if(this._timeout!==!1){const O=this._timeout,C=this.setTimeoutFn(()=>{o(),f(new Error("timeout")),n.close()},O);this.opts.autoUnref&&C.unref(),this.subs.push(()=>{this.clearTimeoutFn(C)})}return this.subs.push(o),this.subs.push(s),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(me(t,"ping",this.onping.bind(this)),me(t,"data",this.ondata.bind(this)),me(t,"error",this.onerror.bind(this)),me(t,"close",this.onclose.bind(this)),me(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(n){this.onclose("parse error",n)}}ondecoded(t){nt(()=>{this.emitReserved("packet",t)},this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,n){let e=this.nsps[t];return e?this._autoConnect&&!e.active&&e.connect():(e=new Yn(this,t,n),this.nsps[t]=e),e}_destroy(t){const n=Object.keys(this.nsps);for(const e of n)if(this.nsps[e].active)return;this._close()}_packet(t){const n=this.encoder.encode(t);for(let e=0;e<n.length;e++)this.engine.write(n[e],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(t,n){var e;this.cleanup(),(e=this.engine)===null||e===void 0||e.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,n),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const n=this.backoff.duration();this._reconnecting=!0;const e=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open(o=>{o?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",o)):t.onreconnect()}))},n);this.opts.autoUnref&&e.unref(),this.subs.push(()=>{this.clearTimeoutFn(e)})}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const Le={};function vt(r,t){typeof r=="object"&&(t=r,r=void 0),t=t||{};const n=is(r,t.path||"/socket.io"),e=n.source,o=n.id,f=n.path,s=Le[o]&&f in Le[o].nsps,O=t.forceNew||t["force new connection"]||t.multiplex===!1||s;let C;return O?C=new Lt(e,t):(Le[o]||(Le[o]=new Lt(e,t)),C=Le[o]),n.query&&!t.query&&(t.query=n.queryKey),C.socket(n.path,t)}Object.assign(vt,{Manager:Lt,Socket:Yn,io:vt,connect:vt});const Zn=new yi.Realtime("BPxcXA.E1bxAw:T4H-_uL4SC0WfJfZUlRnXZ_XPgZkN8N_DNmGVsH8JNs");Zn.connection.once("connected",()=>{console.log("Connected to Ably!")});let Ct;const ys={open:({key:r,message:t,description:n,type:e})=>{Ct=r;const o=r===Ct?r:void 0;e==="success"?Ve.success(t,{description:n,id:o}):e==="error"?Ve.error(t,{description:n,id:o}):e==="progress"&&Ve.loading(t,{description:n,id:o})},close:r=>{Ve.dismiss(r),Ct=void 0}},vs="/assets/base-CNccC1ql.css",Cs="/assets/tailwind-vd8WQBu7.css",Ys=()=>[{property:"og:title",content:"This app is the best."},{name:"description",content:"Welcome to Remix!"}],Zs=()=>[{rel:"stylesheet",href:Cs,id:"tailwind-styles"},{rel:"stylesheet",href:vs,id:"base-styles"},{rel:"stylesheet",href:ri,id:"nprogress-styles"}],ea={i18n:["translation"]};function ta(){return Y.jsx("h1",{className:"bg-background fixed inset-0 z-10 flex items-center justify-center",children:Y.jsx(Nr,{className:"animate-spin"})})}function Os({children:r,title:t,specifiedTheme:n,script:e=!0,locale:o}){const{permissions:f,permissionsSignature:s,user:O,menus:C}=fn();return mn({email:O==null?void 0:O.email,username:(O==null?void 0:O.name)||"?",id:O==null?void 0:O.id}),At.setPermissions(f),Y.jsxs("html",{lang:o,className:Fr(n??"light"),suppressHydrationWarning:!0,children:[Y.jsxs("head",{children:[Y.jsx("meta",{charSet:"utf-8"}),Y.jsx("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),Y.jsx(wr,{}),t&&Y.jsx("title",{children:t}),Y.jsx(Bt.PreventFlashOnWrongTheme,{ssrTheme:!!n}),Y.jsx(Ir,{})]}),Y.jsxs("body",{children:[Y.jsx(Mr,{children:Y.jsxs(pr,{resources:C,routerProvider:ei,dataProvider:$e,authProvider:At,accessControlProvider:Oi,notificationProvider:ys,i18nProvider:Ao,auditLogProvider:ro,liveProvider:vi(Zn),options:{disableTelemetry:!0,mutationMode:"pessimistic",syncWithLocation:!0,warnWhenUnsavedChanges:!0,liveMode:"auto",reactQuery:{clientConfig:{defaultOptions:{queries:{networkMode:"always"},mutations:{networkMode:"always"}}}},projectId:"WYVW2v-jZ8p3m-yjM2Ba"},onLiveEvent:T=>{console.log("@root.onLiveEvent",T)},children:[r,Y.jsx(ti,{}),Y.jsx(di,{})]})}),Y.jsx(Jr,{}),e&&Y.jsx(Pr,{crossOrigin:"anonymous"}),Y.jsx("script",{dangerouslySetInnerHTML:{__html:`
              window.__PERMISSIONS_DATA__ = {
                permissions: ${JSON.stringify(f)},
                signature: "${s}"
              };
              window.__MENUS__ = ${JSON.stringify(C)};
            `}})]})]})}function Nt({children:r,title:t,script:n=!0}){const{theme:e,locale:o}=fn()||{};return Y.jsx(Bt.ThemeProvider,{specifiedTheme:e,themeAction:"/api/set-preferences",children:Y.jsxs(Os,{title:t,specifiedTheme:e,script:n,locale:o,children:[r,Y.jsx(hi,{richColors:!0,position:"top-right"})]})})}function Rs(){const r=Rr();return ut.configure({showSpinner:!1}),ye.useEffect(()=>{r.state==="idle"?ut.done():ut.start()},[r.state]),Y.jsx(Nt,{children:Y.jsx(Sr,{})})}const na=zr(Rs);function ra(){const r=Cr();return Xr(r),Or(r)?Y.jsx(Nt,{title:`${r.status} ${r.statusText}`,script:!1,children:r.status===404?Y.jsx(Dr,{}):Y.jsx(Vt,{error:{message:r.data}})}):Y.jsx(Nt,{title:"Oh no!",script:!1,children:Y.jsx(Vt,{error:r})})}export{ra as ErrorBoundary,ta as HydrateFallback,na as default,ea as handle,Zs as links,Ys as meta};
