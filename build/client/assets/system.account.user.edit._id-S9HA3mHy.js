import{j as o}from"./jsx-runtime-C-_spy54.js";import{t as F}from"./form-CvgtEUdj.js";import{a as I}from"./index-Cr0IeYe7.js";import{C as y,F as p}from"./field-C2fXiMPB.js";import{r as O}from"./index-aGVi9Z7h.js";import{z as t}from"./index-Cb7h-Ku-.js";import{P as T}from"./500-Bi-8cWwO.js";import{D as C}from"./delete-Bb7Ih5Bg.js";import{F as N}from"./form-CgbINn9k.js";import{S as _}from"./select-multi-xQoT5VS_.js";import{I as x}from"./input-3H16G6Wh.js";import{E as w}from"./action-DSYjqVEc.js";import{A as R,b as S}from"./log-Dv4uGBGl.js";import{E as L,r as h}from"./roles-DiwHkXNk.js";import{g as M}from"./form-BJoh7EuQ.js";import{g as P}from"./get-default-title-CrVGbO9H.js";import{u as q,c as z}from"./components-BZV9jaWy.js";import"./button-BExhSn8V.js";import"./label-CIvoefGy.js";import"./index-hdGzps5C.js";import"./tslib.es6-DDzNqjJ8.js";import"./index-DN0hhrBY.js";import"./index-CzMdUKCZ.js";import"./i18next-BaiEmIpz.js";import"./alert-dialog-Dm01bm4B.js";import"./index-BTG9THwZ.js";import"./index-DtQLeWK5.js";import"./index-Bm0JEqyb.js";import"./index-oFZnn4P-.js";import"./index-Bo1Sjtdr.js";import"./x-Dffv_lKo.js";import"./check-zjuh9tfK.js";import"./trash-2-DSHqGTsk.js";import"./dayjs.min-CHrC0Ux9.js";import"./create-CmiFHpun.js";import"./circle-plus-B2Q_hRa7.js";import"./check-check-C26Dx8eK.js";import"./card-B99DATJd.js";import"./command-BYE4BpMC.js";import"./search-G3Oj3KZ-.js";import"./badge-CojvZVMK.js";import"./popover-CYP-dzmY.js";import"./index-Cl449RIc.js";import"./resources-nPXTaVLM.js";import"./capitalize-first-letter-B7Vzw64t.js";const B=t.object({name:t.string().min(1,"用户名不能为空"),email:t.string().email("请输入有效的邮箱地址"),avatar:t.string().optional().nullable()}),Mr=({matches:r})=>[{title:P(r)}],Pr={uiTools:r=>o.jsx(G,{match:r})};function qr(){const{initialData:r,rolesData:s}=q();return o.jsx(V,{initialData:r,rolesData:s})}function G({match:r}){const{data:s}=r||{},{initialData:c}=s||{},{data:m}=c||{};return o.jsx("div",{className:"flex items-center gap-1 text-sm",children:o.jsx(C,{disabled:m==null?void 0:m.roles.some(u=>u.label===L.administrator),variant:"ghost",size:"icon",className:"text-destructive!"})})}function zr(){return o.jsx(T,{})}const W=r=>({avatar:r==null?void 0:r.avatar,name:(r==null?void 0:r.name)||"",email:(r==null?void 0:r.email)||"",roles:(r==null?void 0:r.roles)||[]}),Q=B.extend({roles:t.array(t.object({label:t.string(),value:t.string()}))}),V=({className:r,redirect:s=w.list,initialData:c,rolesData:m,action:u})=>{const{data:e}=c||{},{formAction:b,id:g=e==null?void 0:e.id,identifier:v}=I({action:u}),{data:j}=m||{},D=z(),d=W(e),n=y({resolver:F(Q),defaultValues:d,warnWhenUnsavedChanges:!0,mode:"onChange",refineCoreProps:{resource:v,action:b,id:g,queryOptions:M(d),redirect:s}}),E=async i=>{const{roles:l,...A}=i,f=new FormData;return f.append("userId",e.id),f.append("roleIds",l.map(a=>a.value).join(",")),await D.submit(f,{method:"post"}),{...A,[R]:{permissions:e.roles.map(a=>a.label).join(", ")},[S]:{permissions:l.map(a=>a.label).join(", ")}}},U=O.useMemo(()=>j.sort((i,l)=>h[i.title]-h[l.title]).map(i=>({label:i.title,value:i.id})),[j]);return o.jsxs(N,{...n,beforeSubmit:E,className:r,recordItemId:e==null?void 0:e.id,children:[o.jsx(p,{...n,name:"name",label:"Name",children:o.jsx(x,{placeholder:"Name"})}),o.jsx(p,{...n,name:"email",label:"Email",children:o.jsx(x,{placeholder:"Email"})}),o.jsx(p,{...n,name:"avatar",label:"Avatar",children:o.jsx(x,{placeholder:"Avatar"})}),o.jsx(p,{...n,name:"roles",label:"Roles",children:o.jsx(_,{options:U})})]})};export{zr as ErrorBoundary,qr as default,Pr as handle,Mr as meta};
