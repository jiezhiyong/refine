{"version":3,"file":"login-J-dFGqQo.js","sources":["../../../app/components/form-login.tsx","../../../app/routes/login.tsx"],"sourcesContent":["import { Form, Link, useActionData, useNavigation, useSearchParams } from '@remix-run/react';\n\nimport { Button } from '~/components-shadcn/button';\nimport { Card, CardContent } from '~/components-shadcn/card';\nimport { Input } from '~/components-shadcn/input';\nimport { Label } from '~/components-shadcn/label';\n\nimport { ErrorMessage } from './error';\nimport { PrivacyPolicy } from './privacy-policy';\nimport { TcskOAuth2 } from './tcsk-oauth2';\n\n// 定义错误类型\ninterface ActionData {\n  errors?: {\n    email?: string[];\n    password?: string[];\n    default?: string[];\n  };\n}\n\n// 登录表单\nexport function LoginForm() {\n  const { errors } = useActionData<ActionData>() || {};\n  const [searchParams] = useSearchParams();\n  const redirectTo = searchParams.get('redirectTo') || '/';\n  const navigation = useNavigation();\n\n  return (\n    <div className=\"flex flex-col gap-6\">\n      <Card className=\"overflow-hidden\">\n        <CardContent className=\"grid p-0 md:grid-cols-2\">\n          <Form method=\"post\" className=\"p-6 md:p-8\">\n            <input type=\"hidden\" name=\"redirectTo\" value={redirectTo} />\n\n            <div className=\"flex flex-col gap-6\">\n              <div className=\"flex flex-col\">\n                <h1 className=\"flex items-center text-2xl font-bold\">Welcome back</h1>\n                <p className=\"text-muted-foreground text-balance\">Login to your OSS Inc. account</p>\n              </div>\n\n              <div className=\"grid gap-2\">\n                <Label htmlFor=\"email\">Email</Label>\n                <Input\n                  name=\"email\"\n                  id=\"email\"\n                  type=\"email\"\n                  placeholder=\"Goodman@example.com\"\n                  defaultValue={searchParams.get('email') || 'administrator@goodman.com'}\n                  required\n                  autoFocus\n                  autoComplete=\"email\"\n                />\n                <ErrorMessage error={errors?.email?.[0]} />\n              </div>\n\n              <div className=\"grid gap-2\">\n                <div className=\"flex items-center\">\n                  <Label htmlFor=\"password\">Password</Label>\n                  <Link\n                    prefetch=\"intent\"\n                    viewTransition\n                    to=\"#\"\n                    className=\"ml-auto text-sm underline-offset-2 hover:underline\"\n                  >\n                    Forgot your password?\n                  </Link>\n                </div>\n                <Input\n                  name=\"password\"\n                  id=\"password\"\n                  type=\"password\"\n                  required\n                  autoComplete=\"current-password\"\n                  minLength={6}\n                  maxLength={50}\n                  defaultValue=\"Abc@12345678\"\n                />\n                <ErrorMessage error={errors?.password?.[0]} />\n              </div>\n\n              <div className=\"grid gap-2\">\n                <Button type=\"submit\" className=\"w-full\" disabled={navigation.state === 'submitting'}>\n                  Login\n                </Button>\n                <ErrorMessage error={errors?.default?.[0]} />\n              </div>\n\n              <div className=\"after:border-border relative text-center text-sm after:absolute after:inset-0 after:top-1/2 after:z-0 after:flex after:items-center after:border-t\">\n                <span className=\"bg-background text-muted-foreground relative z-10 px-2\">or</span>\n              </div>\n\n              <TcskOAuth2 redirectTo={redirectTo} />\n\n              <div className=\"text-center text-sm\">\n                {`Don't have an account? `}\n                <Link prefetch=\"intent\" viewTransition to=\"/register\" replace className=\"underline underline-offset-4\">\n                  Sign up\n                </Link>\n              </div>\n            </div>\n          </Form>\n          <div className=\"bg-muted relative hidden md:block\">\n            <img src=\"/logo.png\" alt=\"\" className=\"absolute inset-0 h-full w-full object-cover dark:brightness-[0.3]\" />\n          </div>\n        </CardContent>\n      </Card>\n\n      <PrivacyPolicy />\n    </div>\n  );\n}\n","import type { ActionFunctionArgs, LoaderFunctionArgs, MetaFunction } from '@remix-run/node';\nimport { redirect } from '@remix-run/node';\nimport { z } from 'zod';\n\nimport { LoginForm } from '~/components';\nimport { EnumAuthProvider } from '~/constants';\nimport { authProvider } from '~/providers';\nimport { commitSession, getSession, getUser } from '~/services';\nimport { typedFormError } from '~/utils/typed-form-error';\n\n// 定义表单验证 schema\nconst loginSchema = z.object({\n  email: z.string().email('请输入有效的邮箱地址'),\n  password: z.string().min(6, '密码至少需要6个字符').max(50, '密码不能超过50个字符'),\n  redirectTo: z.string().optional(),\n});\n\n// 元数据\nexport const meta: MetaFunction = () => {\n  return [{ title: 'Login' }];\n};\n\n// 加载器\nexport async function loader({ request }: LoaderFunctionArgs) {\n  const user = await getUser(request);\n\n  if (user && user.id) {\n    return redirect('/');\n  }\n\n  return {};\n}\n\n// Action 处理函数\nexport async function action({ request }: ActionFunctionArgs) {\n  try {\n    const form = await request.formData();\n    const formData = Object.fromEntries(form) as z.infer<typeof loginSchema>;\n\n    const { email, password, redirectTo } = loginSchema.parse(formData);\n    const { error, success, user } = await authProvider.login({\n      providerName: EnumAuthProvider.userpass,\n      email,\n      password,\n      redirectTo,\n    });\n\n    if (error) {\n      throw { default: [error.message] };\n    }\n\n    if (success && user?.id) {\n      const session = await getSession(request.headers.get('Cookie'));\n      session.set('user', user);\n\n      return redirect(redirectTo!, {\n        headers: {\n          'Set-Cookie': await commitSession(session),\n        },\n      });\n    }\n  } catch (error) {\n    return typedFormError(error);\n  }\n}\n\n// UI\nexport default function Login() {\n  return (\n    <div className=\"bg-background flex min-h-svh flex-col items-center justify-center p-6 md:p-10\">\n      <div className=\"w-full max-w-sm md:max-w-3xl\">\n        <LoginForm />\n      </div>\n    </div>\n  );\n}\n"],"names":["LoginForm","errors","useActionData","searchParams","useSearchParams","redirectTo","navigation","useNavigation","jsxs","jsx","Card","CardContent","Form","Label","Input","ErrorMessage","_a","Link","_b","Button","_c","TcskOAuth2","PrivacyPolicy","meta","title","Login","className","children"],"mappings":"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"}