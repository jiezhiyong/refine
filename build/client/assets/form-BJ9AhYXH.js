import{j as e}from"./jsx-runtime-C-_spy54.js";import{z as w,t as k,k as N,c as B,M as E}from"./index-hdkCHUwo.js";import{t as p}from"./i18next-BaiEmIpz.js";import{r as D}from"./index-aGVi9Z7h.js";import{d as L}from"./dayjs.min-CHrC0Ux9.js";import{c as j,B as b}from"./button-iwFMjRuO.js";import{C as A}from"./create-fK7H8lSG.js";import H from"./check-check-CEnaKdmQ.js";import{C as M,a as R,e as _}from"./card-BCWlu2o6.js";import{a as z}from"./form-DJOXBopy.js";import{E as v}from"./action-DSYjqVEc.js";import I from"./undo-2-BRfwUAsI.js";const K=({status:a,elements:{success:s=e.jsx(l,{translationKey:"autoSave.success",defaultMessage:"saved"}),error:r=e.jsx(l,{translationKey:"autoSave.error",defaultMessage:"auto save failed"}),loading:o=e.jsx(l,{translationKey:"autoSave.loading",defaultMessage:"saving ..."}),idle:i=e.jsx(l,{translationKey:"autoSave.idle",defaultMessage:"waiting for changes ..."})}={}})=>{switch(a){case"success":return e.jsx(e.Fragment,{children:s});case"error":return e.jsx(e.Fragment,{children:r});case"loading":return e.jsx(e.Fragment,{children:o});default:return e.jsx(e.Fragment,{children:i})}},l=({translationKey:a,defaultMessage:s})=>{const r=w();return e.jsxs("span",{className:j("text-muted-foreground text-sm",{"text-destructive":a==="autoSave.error","text-green-500":a==="autoSave.success"}),children:[r(a,s),a==="autoSave.success"&&` - ${L().format("HH:mm:ss")}`]})},y=({hideText:a=!1,children:s,accessControl:r,access:o,resource:i,recordItemId:n,disabled:m,...f})=>{const{label:x}=k(),{data:t}=N({resource:i,action:"edit",params:{id:n}}),c=!(t!=null&&t.can)||m;return e.jsx(b,{icon:e.jsx(H,{}),disabled:c,...f,children:!a&&(s??x)})};y.displayName="SaveButton";const te=({autoSave:a,beforeSubmit:s,formProps:r,isWatchable:o,saveButtonProps:i,formModalClose:n,recordItemId:m,className:f,classNameCardContent:x,...t})=>{const c=D.useRef(!1),{resource:P,action:h}=B(),S=E(),C=h!==v.list||typeof h<"u"?S:void 0;o&&!c.current&&(c.current=!0,t.watch());const F=t.handleSubmit(async T=>{var u;let d=t.getValues();if(s)try{d=await s(d)}catch{return}d!==null?await t.refineCore.onFinish(d):((u=t.refineCore)==null?void 0:u.redirect).call(u),n==null||n()}),{disabled:g}=i||{};return e.jsx(z,{...t,children:e.jsx("form",{...r,onSubmit:F,children:e.jsxs(M,{className:j("space-y-8 border-none p-8 shadow-none",f),children:[e.jsx(R,{className:j("space-y-4 p-0",x),children:t.children}),e.jsxs(_,{className:"flex gap-x-2 p-0",children:[h===v.edit?e.jsx(y,{type:"submit",recordItemId:m,loading:t.refineCore.formLoading,disabled:g||!t.formState.isDirty}):e.jsx(A,{type:"submit",loading:t.refineCore.formLoading,disabled:g||!t.formState.isDirty}),!t.hideCancel&&e.jsx(b,{icon:e.jsx(I,{}),type:"button",onClick:n||C,disabled:t.refineCore.formLoading,variant:"outline",children:p("buttons.cancel")}),a&&e.jsx("div",{className:"ml-auto",children:e.jsx(K,{...t.refineCore.autoSaveProps})})]})]})})})};export{te as F};
