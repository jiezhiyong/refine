import{r as W,R as U}from"./index-aGVi9Z7h.js";import{n as le,r as te,u as re,v as se,w as ie,x as ue,A as oe,z as X,B as Y,R as de,C as K,D as Z,E as fe,F as ce,c as me,G as he,h as ve,T as ye}from"./index-hdkCHUwo.js";import{u as be,b as ge,c as pe,d as z,F as xe,g as Fe,e as Se}from"./form-EOytp2cR.js";import{j}from"./jsx-runtime-C-_spy54.js";import{c as Ce}from"./button-8zOaFnqZ.js";function Ee(e,n,d){n=le(n,e);for(var x=-1,t=n.length,y=!1;++x<t;){var b=te(n[x]);if(!(y=e!=null&&d(e,b)))break;e=e[b]}return y||++x!=t?y:(t=e==null?0:e.length,!!t&&re(t)&&se(b,t)&&(ie(e)||ue(e)))}var Pe=Object.prototype,we=Pe.hasOwnProperty;function ke(e,n){return e!=null&&we.call(e,n)}function Ve(e,n){return e!=null&&Ee(e,n,ke)}var je=Object.defineProperty,E=(e,n)=>je(e,"name",{value:n,configurable:!0}),_=E(({refineCoreProps:e,warnWhenUnsavedChanges:n,disableServerSideValidation:d=!1,...x}={})=>{let{options:t}=oe(),y=(t==null?void 0:t.disableServerSideValidation)||d,b=X(),{warnWhenUnsavedChanges:O,setWarnWhen:F}=Y(),P=n??O,w=be({...x}),{watch:v,setValue:f,getValues:s,handleSubmit:c,setError:m}=w,k=de({...e,onMutationError:(l,a,i)=>{var C,u;if(y){(C=e==null?void 0:e.onMutationError)==null||C.call(e,l,a,i);return}let p=l==null?void 0:l.errors;for(let A in p){if(!Object.keys(K(a)).includes(A))continue;let h=p[A],V="";Array.isArray(h)&&(V=h.join(" ")),typeof h=="string"&&(V=h),typeof h=="boolean"&&h&&(V="Field is not valid."),typeof h=="object"&&"key"in h&&(V=b(h.key,h.message)),m(A,{message:V})}(u=e==null?void 0:e.onMutationError)==null||u.call(e,l,a,i)}}),{query:S,onFinish:g,formLoading:R,onFinishAutoSave:o}=k;W.useEffect(()=>{var l;let a=(l=S==null?void 0:S.data)==null?void 0:l.data;a&&Object.keys(K(s())).forEach(i=>{let C=Ve(a,i),u=Z(a,i);C&&f(i,u)})},[S==null?void 0:S.data,f,s]),W.useEffect(()=>{let l=v((a,{type:i})=>{i==="change"&&N(a)});return()=>l.unsubscribe()},[v]);let N=E(l=>{var a,i;if(P&&F(!0),(a=e==null?void 0:e.autoSave)!=null&&a.enabled){F(!1);let C=((i=e.autoSave)==null?void 0:i.onFinish)??(u=>u);return o(C(l)).catch(u=>u)}return l},"onValuesChange"),$=E((l,a)=>async i=>(F(!1),c(l,a)(i)),"handleSubmit");return{...w,handleSubmit:$,refineCore:k,saveButtonProps:{disabled:R,onClick:l=>{$(a=>g(a).catch(()=>{}),()=>!1)(l)}}}},"useForm"),Be=E(({stepsProps:e,...n}={})=>{let{defaultStep:d=0,isBackValidate:x=!1}=e??{},[t,y]=W.useState(d),b=_({...n}),{trigger:O,getValues:F,setValue:P,formState:{dirtyFields:w},refineCore:{query:v}}=b;W.useEffect(()=>{var s;let c=(s=v==null?void 0:v.data)==null?void 0:s.data;if(!c)return;let m=Object.keys(F());console.log({dirtyFields:w,registeredFields:m,data:c}),Object.entries(c).forEach(([k,S])=>{let g=k;m.includes(g)&&(Z(w,g)||P(g,S))})},[v==null?void 0:v.data,t,P,F]);let f=E(s=>{let c=s;s<0&&(c=0),y(c)},"go");return{...b,steps:{currentStep:t,gotoStep:E(async s=>{if(s!==t){if(s<t&&!x){f(s);return}await O()&&f(s)}},"gotoStep")}}},"useStepsForm"),Me=E(({modalProps:e,refineCoreProps:n,syncWithLocation:d,...x}={})=>{var t,y;let b=fe(),[O,F]=U.useState(!1),P=X(),{resource:w,action:v}=n??{},{resource:f,action:s,identifier:c}=ce(w),m=me(),k=he(),S=ve(),g=v??s??"",R=!(typeof d=="object"&&(d==null?void 0:d.syncId)===!1),o=typeof d=="object"&&"key"in d?d.key:f&&g&&d?`modal-${c}-${g}`:void 0,{defaultVisible:N=!1,autoSubmitClose:$=!0,autoResetForm:l=!0}=e??{},a=_({refineCoreProps:{...n,meta:{...o?{[o]:void 0}:{},...n==null?void 0:n.meta}},...x}),{reset:i,refineCore:{onFinish:C,id:u,setId:p,autoSaveProps:A},saveButtonProps:h,handleSubmit:V}=a,{visible:B,show:M,close:I}=ye({defaultVisible:N});U.useEffect(()=>{var r,H,Q,T;if(O===!1&&o){let q=(H=(r=m==null?void 0:m.params)==null?void 0:r[o])==null?void 0:H.open;if(typeof q=="boolean"?q&&M():typeof q=="string"&&q==="true"&&M(),R){let G=(T=(Q=m==null?void 0:m.params)==null?void 0:Q[o])==null?void 0:T.id;G&&(p==null||p(G))}F(!0)}},[o,m,R,p]),U.useEffect(()=>{var r;O===!0&&(B&&o?k({query:{[o]:{...(r=m==null?void 0:m.params)==null?void 0:r[o],open:!0,...R&&u&&{id:u}}},options:{keepQuery:!0},type:"replace"}):o&&!B&&k({query:{[o]:void 0},options:{keepQuery:!0},type:"replace"}))},[u,B,M,o,R]);let L=E(async r=>{await C(r),$&&I(),l&&i()},"submit"),{warnWhen:D,setWarnWhen:J}=Y(),ee=W.useCallback(()=>{var r;if(A.status==="success"&&(r=n==null?void 0:n.autoSave)!=null&&r.invalidateOnClose&&b({id:u,invalidates:n.invalidates||["list","many","detail"],dataProviderName:n.dataProviderName,resource:c}),D)if(window.confirm(P("warnWhenUnsavedChanges","Are you sure you want to leave? You have unsaved changes.")))J(!1);else return;p==null||p(void 0),I()},[D,A.status]),ne=W.useCallback(r=>{typeof r<"u"&&(p==null||p(r)),(!(g==="edit"||g==="clone")||typeof r<"u"||typeof u<"u")&&M()},[u]),ae=P(`${c}.titles.${v}`,void 0,`${S(`${v} ${((t=f==null?void 0:f.meta)==null?void 0:t.label)??((y=f==null?void 0:f.options)==null?void 0:y.label)??(f==null?void 0:f.label)??c}`,"singular")}`);return{modal:{submit:L,close:ee,show:ne,visible:B,title:ae},...a,saveButtonProps:{...h,onClick:r=>V(L)(r)}}},"useModalForm");const qe=e=>j.jsx(ge,{control:e.control,name:e.name,render:({field:n})=>j.jsxs(pe,{className:Ce(e.className,e.isCheckbox?"flex flex-row items-center space-y-0 space-x-3":""),children:[!e.isCheckbox&&j.jsx(z,{children:e.label}),j.jsx(xe,{children:W.cloneElement(e.children,{...n,...e.children.props})}),e.isCheckbox&&j.jsx(z,{className:"text-sm font-normal",children:e.label}),e.description&&j.jsx(Fe,{children:e.description}),j.jsx(Se,{})]})});export{_ as C,qe as F,Be as l,Me as x};
