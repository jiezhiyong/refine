import{j as e}from"./jsx-runtime-C-_spy54.js";import{t as F}from"./form-EOytp2cR.js";import{a as I}from"./index-hdkCHUwo.js";import{C as y,F as p}from"./field-RlHc_fdj.js";import{r as O}from"./index-aGVi9Z7h.js";import{z as t}from"./index-Cb7h-Ku-.js";import{P as T}from"./500-CvlJQvp0.js";import{D as C}from"./delete-Ut9SK8Xu.js";import{F as N}from"./form-BJRS087V.js";import{S as _}from"./select-multi-B-0pe142.js";import{I as x}from"./input-CWsqa6a4.js";import{E as w}from"./action-DSYjqVEc.js";import{A as R,b as S}from"./log-Dv4uGBGl.js";import{E as L,r as h}from"./roles-BPHs5haX.js";import{g as M}from"./form-BJoh7EuQ.js";import{g as P}from"./get-default-title-CrVGbO9H.js";import{u as q,c as z}from"./components-CzmxjdGq.js";import"./button-8zOaFnqZ.js";import"./lucide-icons-Cs_6wGxK.js";import"./label-CGr_cgmC.js";import"./index-BJ0lhZ-K.js";import"./tslib.es6-DDzNqjJ8.js";import"./index-DN0hhrBY.js";import"./index-DPZVHeJL.js";import"./i18next-BaiEmIpz.js";import"./alert-dialog-BBz2U9GM.js";import"./index-BTG9THwZ.js";import"./index-BEBrh2Va.js";import"./index-BU-I6paI.js";import"./index-oFZnn4P-.js";import"./index-CmlQ-bcy.js";import"./dayjs.min-CHrC0Ux9.js";import"./create-BR9gIq3J.js";import"./card-BavCCNFE.js";import"./command-DoxM3uwe.js";import"./badge-DliJJe0J.js";import"./popover-Cif6mCbD.js";import"./index-bUQLM8l5.js";import"./resources-nPXTaVLM.js";import"./capitalize-first-letter-B7Vzw64t.js";const B=t.object({name:t.string().min(1,"用户名不能为空"),email:t.string().email("请输入有效的邮箱地址"),avatar:t.string().optional().nullable()}),_r=({matches:r})=>[{title:P(r)}],wr={uiTools:r=>e.jsx(G,{match:r})};function Rr(){const{initialData:r,rolesData:s}=q();return e.jsx(V,{initialData:r,rolesData:s})}function G({match:r}){const{data:s}=r||{},{initialData:c}=s||{},{data:m}=c||{};return e.jsx("div",{className:"flex items-center gap-1 text-sm",children:e.jsx(C,{disabled:m==null?void 0:m.roles.some(u=>u.label===L.administrator),variant:"ghost",size:"icon",className:"text-destructive!"})})}function Sr(){return e.jsx(T,{})}const W=r=>({avatar:r==null?void 0:r.avatar,name:(r==null?void 0:r.name)||"",email:(r==null?void 0:r.email)||"",roles:(r==null?void 0:r.roles)||[]}),Q=B.extend({roles:t.array(t.object({label:t.string(),value:t.string()}))}),V=({className:r,redirect:s=w.list,initialData:c,rolesData:m,action:u})=>{const{data:o}=c||{},{formAction:b,id:g=o==null?void 0:o.id,identifier:v}=I({action:u}),{data:j}=m||{},D=z(),d=W(o),n=y({resolver:F(Q),defaultValues:d,warnWhenUnsavedChanges:!0,mode:"onChange",refineCoreProps:{resource:v,action:b,id:g,queryOptions:M(d),redirect:s}}),E=async i=>{const{roles:l,...A}=i,f=new FormData;return f.append("userId",o.id),f.append("roleIds",l.map(a=>a.value).join(",")),await D.submit(f,{method:"post"}),{...A,[R]:{permissions:o.roles.map(a=>a.label).join(", ")},[S]:{permissions:l.map(a=>a.label).join(", ")}}},U=O.useMemo(()=>j.sort((i,l)=>h[i.title]-h[l.title]).map(i=>({label:i.title,value:i.id})),[j]);return e.jsxs(N,{...n,beforeSubmit:E,className:r,recordItemId:o==null?void 0:o.id,children:[e.jsx(p,{...n,name:"name",label:"Name",children:e.jsx(x,{placeholder:"Name"})}),e.jsx(p,{...n,name:"email",label:"Email",children:e.jsx(x,{placeholder:"Email"})}),e.jsx(p,{...n,name:"avatar",label:"Avatar",children:e.jsx(x,{placeholder:"Avatar"})}),e.jsx(p,{...n,name:"roles",label:"Roles",children:e.jsx(_,{options:U})})]})};export{Sr as ErrorBoundary,Rr as default,wr as handle,_r as meta};
