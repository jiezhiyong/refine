import{j as e}from"./jsx-runtime-C-_spy54.js";import{r as m}from"./index-aGVi9Z7h.js";import{t as p}from"./index-GyqvGh2n.js";import{P as O}from"./500-Bi-8cWwO.js";import{C as z}from"./code-DTTOy2hJ.js";import{a as x,c as f,b as H,B as n}from"./button-BExhSn8V.js";import{A as V,a as $,b as q}from"./avatar-DqSeWAHy.js";import{B as Y}from"./badge-CojvZVMK.js";import{L as T}from"./label-CIvoefGy.js";import{T as K}from"./textarea-CKzgIjgt.js";import{a as Q,b as W,c as X}from"./tooltip-D5jmThYi.js";import{H as Z}from"./typography-BReC1Yg6.js";import{E as u,a as B,A as ee}from"./audit-channel-7xUlZfi7.js";import{E as o}from"./log-Dv4uGBGl.js";import{d as L}from"./deep-parse-CMMvj5PV.js";import{u as te,a as se,b as ae}from"./components-BZV9jaWy.js";import{a as re}from"./index-DN0hhrBY.js";import{L as ie}from"./lightbulb-Cord1U_s.js";import{L as ne}from"./leafy-green-CJ7f0eWs.js";import{C as oe}from"./calendar-D-ZzU-i1.js";import{C as ce}from"./check-check-C26Dx8eK.js";import"./index-Cr0IeYe7.js";import"./tslib.es6-DDzNqjJ8.js";import"./base-url-B9uMRsbQ.js";import"./eye-Bg1C4op6.js";import"./index-BTG9THwZ.js";import"./index-oFZnn4P-.js";import"./index-hdGzps5C.js";import"./index-Bm0JEqyb.js";import"./index-Cl449RIc.js";import"./index-Bo1Sjtdr.js";import"./index-By9-dvAW.js";import"./try-parse-D_xF9tNz.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]],de=x("Ban",le);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],pe=x("CircleAlert",me);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],xe=x("Info",ue),fe=H("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:text-destructive-foreground/80 dark:border-destructive [&>svg]:text-current dark:bg-destructive/50"}},defaultVariants:{variant:"default"}});function he({className:t,variant:a,...r}){return e.jsx("div",{"data-slot":"alert",role:"alert",className:f(fe({variant:a}),t),...r})}function ge({className:t,...a}){return e.jsx("div",{"data-slot":"alert-title",className:f("col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight",t),...a})}function ve({className:t,...a}){return e.jsx("div",{"data-slot":"alert-description",className:f("col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",t),...a})}function Xe(){var A,k,w,D,C,E,S;const{record:t,isAdmin:a}=te(),{status:r,channel:h}=t,i=se(),_=re(),g=ae(),{content:I}=L(t.data||"{}"),{content:R}=L(t.dataPrevious||"{}"),v=t.meta||{},[c,P]=m.useState(""),[j,N]=m.useState(!1),M=a&&r===u.PENDING&&h===B.SELF,l=_.state==="submitting",F=(r===u.PENDING||r===u.FAILED)&&!j,U=![o.delete,o.deleteMany].includes(t.action),y=[o.update,o.updateMany].includes(t.action);m.useEffect(()=>{i&&(i.success?p.success(i.message):p.error(i.message))},[i]);const G=()=>{const s=new FormData;s.append("id",t.id),s.append("action","approve"),g(s,{method:"post"})},J=()=>{if(!c.trim()){p.error("操作有误",{description:"拒绝时必须提供原因"});return}const s=new FormData;s.append("id",t.id),s.append("action","reject"),s.append("reason",c),g(s,{method:"post"})},d=!M||l,b=e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{variant:"destructive",onClick:()=>N(!0),disabled:d,icon:e.jsx(de,{}),children:"拒绝"}),e.jsx(n,{variant:"default",onClick:G,disabled:d,icon:e.jsx(ce,{}),children:"通过"})]})});return e.jsxs("article",{className:"px-8 pt-8 pb-4",children:[e.jsxs("header",{className:"mb-8",children:[e.jsxs(Z,{className:"relative mb-4 inline-flex gap-3 text-4xl font-bold",children:[e.jsxs("span",{children:["Audit Record - ",t.title]}),e.jsx("div",{className:"inline-flex shrink-0 items-start pt-3.5",children:e.jsx(Y,{className:"tracking-wide",variant:(A=ee[r])==null?void 0:A.badge,children:r})})]}),e.jsxs("div",{className:"text-muted-foreground mb-8 flex flex-wrap items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),e.jsxs("span",{children:["ActionType: ",t.action]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(ne,{className:"mr-2 h-4 w-4"}),e.jsxs("span",{children:["Resource: ",v.parent,".",t.resource]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(oe,{className:"mr-2 h-4 w-4"}),e.jsxs("span",{children:["Created: ",new Date(t.createdAt).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"flex flex-1 items-center gap-3",children:[e.jsxs(V,{children:[e.jsx($,{src:(k=t.operatedBy)==null?void 0:k.avatar,alt:((w=t.operatedBy)==null?void 0:w.name)||""}),e.jsx(q,{children:(C=(D=t.operatedBy)==null?void 0:D.name)==null?void 0:C.slice(0,2).toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:(E=t.operatedBy)==null?void 0:E.name}),e.jsx("p",{className:"text-muted-foreground text-sm",children:(S=t.operatedBy)==null?void 0:S.email})]})]}),F&&(d?e.jsxs(Q,{children:[e.jsx(W,{asChild:!0,children:b}),e.jsxs(X,{side:"left",className:"flex items-center gap-1",children:[e.jsx(xe,{className:"h-4 w-4"}),h===B.TIAN_YUAN?"请通知测试人员在天元审核":"请通知管理员进行审核"]})]}):b)]}),j&&e.jsxs("div",{className:"mt-5 flex w-full flex-col gap-2",children:[e.jsx(K,{className:"min-h-20",placeholder:"请输入拒绝原因...",value:c,onChange:s=>P(s.target.value)}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(n,{variant:"outline",onClick:()=>N(!1),disabled:l,children:"取消"}),e.jsx(n,{variant:"destructive",onClick:J,disabled:l,children:"确认拒绝"})]})]})]}),t.error&&e.jsxs(he,{variant:"destructive",className:"mb-6",children:[e.jsx(pe,{className:"size-4"}),e.jsx(ge,{children:"Error: 审核失败"}),e.jsx(ve,{children:t.error||"unknown"})]}),(t.dataPrevious||t.data)&&U&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(T,{children:y?"Previous Resource Data & New Resource Data":"Resource Data"}),e.jsx(z,{language:"json",value:JSON.stringify(R,null,2),modified:JSON.stringify(I,null,2),enableToggleDiff:!1,openDiff:y})]}),e.jsx("div",{className:"mt-6",children:t.meta&&e.jsxs("div",{children:[e.jsx(T,{children:"Meta Data"}),e.jsx("pre",{className:"bg-muted mt-1 overflow-x-auto rounded-lg p-4 text-sm whitespace-pre",children:JSON.stringify(v,null,2)})]})})]})}function Ze(){return e.jsx(O,{})}export{Ze as ErrorBoundary,Xe as default};
