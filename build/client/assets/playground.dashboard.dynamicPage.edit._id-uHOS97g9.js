import{j as e}from"./jsx-runtime-C-_spy54.js";import{S as M,u as De,a as ie,s as $e,K as Ve,P as Pe,D as ze,c as Be,r as Ue,b as He,v as Je,e as Ze,C as Ye,f as Ge}from"./switch-Drwil65T.js";import{t as te,b as x,c as p,d as b,F as u,g as E,e as N,u as ge,a as be}from"./form-jbmkrBBT.js";import{a as Qe}from"./index-Cif3Vfib.js";import{C as We,F as D}from"./field-DWIhesgQ.js";import{r as k}from"./index-aGVi9Z7h.js";import{t as de}from"./index-DJzNQfCY.js";import{z as r}from"./index-Cb7h-Ku-.js";import{P as Ke}from"./500-C3XOm4pH.js";import{C as le}from"./code-DVGvJ8US.js";import{C as fe}from"./combobox-Q9vPxZ9d.js";import{F as _e}from"./form-DXHbSOJg.js";import{B as T}from"./button-fwOzNkKg.js";import{C as B,b as U,c as H,d as J,a as Z}from"./card-gOWiFm61.js";import{D as ye,a as ve,b as Se,c as Ce,d as Ne,f as Xe}from"./dialog-kz50Aa1u.js";import{I as S}from"./input-DOvfwVLE.js";import{L as me}from"./label-Cn5Hhc8O.js";import{S as es,a as ss,b as ns,c as rs,d as se}from"./select-CnvPbg-g.js";import{a as ls}from"./typography-C1jA57zM.js";import{E as Y}from"./action-DSYjqVEc.js";import{g as os,d as ts}from"./get-changed-values-vLde9APN.js";import{g as as}from"./form-BJoh7EuQ.js";import{g as cs}from"./get-default-title-CrVGbO9H.js";import{s as is}from"./base-Dsx3AJoS.js";import{u as ds,a as ms,b as xs}from"./components-BXAOArSq.js";import{i as ne}from"./isEqual-KSD6Iy0l.js";import{L as ps}from"./lightbulb-LnEExiet.js";import{P as oe}from"./plus-ExrUa0aD.js";import{G as Fe,S as ke}from"./square-pen-rywno9sU.js";import{T as ae}from"./trash-2-BY4sV4mk.js";import{C as Ie}from"./check-check-C8Uaujzw.js";const hs=r.object({path:r.string().min(6,"请输入正确的路径, eg: /group/category/name"),title:r.string().min(1,"请输入页面标题"),isActive:r.boolean().optional().nullable(),enableCreate:r.boolean().optional().nullable(),enableDelete:r.boolean().optional().nullable(),enableEdit:r.boolean().optional().nullable(),enableClone:r.boolean().optional().nullable(),tableSql:r.any(),tableRecordLink:r.any().optional().nullable(),tableField:r.any().optional().nullable(),formField:r.any().optional().nullable(),meta:r.any().optional().nullable()});function us(n){if(!n)return"";const m=n.replace(/\s+/g," ").trim().match(/FROM\s+([^\s,]+)(?:\s+([^\s,]+))?/i);return m?m[1].replace(/["`]/g,""):""}function js(n){const d=n.replace(/\s+/g," ").trim(),m=d.match(/^SELECT\s+(.*?)\s+FROM/i),l=d.match(/FROM\s+(.*?)(?:\s+WHERE|\s+ORDER\s+BY|\s+GROUP\s+BY|\s+LIMIT|\s*$)/i),j=d.match(/WHERE\s+(.*?)(?:\s+ORDER\s+BY|\s+GROUP\s+BY|\s+LIMIT|\s*$)/i),g=d.match(/ORDER\s+BY\s+(.*?)(?:\s+LIMIT|\s*$)/i),h=d.match(/LIMIT\s+(.*?)(?:\s+OFFSET|\s*$)/i),t=d.match(/OFFSET\s+(.*?)(?:\s*$)/i);let R="";if(l){const C=l[1].trim().match(/["']?(\w+)["']?\s+(?:AS\s+)?(\w+)/i);C&&(R=C[2])}return{select:m?m[1].trim():"*",from:l?l[1].trim():"",where:j?j[1].trim().replace(/;/g,""):"",orderBy:g?g[1].trim().replace(/;/g,""):"",limit:h?h[1].trim().replace(/;/g,""):"",offset:t?t[1].trim().replace(/;/g,""):"",hasWhere:!!j,hasOrderBy:!!g,hasLimit:!!h,mainTableAlias:R}}function an(n){const{select:d}=js(n);return!d||d==="*"?[]:d.split(",").map(m=>{const l=m.trim(),j=l.match(/.*\s+AS\s+(?:"([^"]+)"|'([^']+)'|(\w+))/i);if(j)return j[1]||j[2]||j[3];const g=l.match(/(?:\w+\.)?"([^"]+)"$/);if(g)return g[1];const h=l.lastIndexOf(".");return h>=0?l.substring(h+1).replace(/["`']/g,""):l.replace(/["`']/g,"")})}const cn=({matches:n})=>[{title:cs(n)}];function dn(){const{initialData:n}=ds();return e.jsx(Ts,{initialData:n})}function mn(){return e.jsx(Ke,{})}const gs=["text","textarea","switch","file","checkbox"],xe=["select","selectMany","radio","checkboxMany"],pe=["date","dateRange","dateMany"],bs=`
SELECT 
  p."id", 
  p."title", 
  c."title" AS "category",
  p."hit",
  p."status",
  p."updatedAt",
  u."name" AS "operatedBy"
FROM 
  "Post" p
JOIN 
  "Category" c ON p."categoryId" = c.id
JOIN 
  "User" u ON p."operatedById" = u.id
WHERE 
  p."deleted" IS NOT TRUE
ORDER BY 
  p."updatedAt" DESC;
`,fs=n=>{const d=Array.isArray(n==null?void 0:n.tableRecordLink)?n==null?void 0:n.tableRecordLink:[],m=Array.isArray(n==null?void 0:n.tableField)?n==null?void 0:n.tableField:[],l=Array.isArray(n==null?void 0:n.formField)?n==null?void 0:n.formField:[];return{path:(n==null?void 0:n.path)||"",title:(n==null?void 0:n.title)||"",isActive:(n==null?void 0:n.isActive)??!0,enableCreate:(n==null?void 0:n.enableCreate)??!0,enableDelete:(n==null?void 0:n.enableDelete)??!0,enableEdit:(n==null?void 0:n.enableEdit)??!0,enableClone:(n==null?void 0:n.enableClone)??!0,db:(n==null?void 0:n.db)||"db1",tableSql:(n==null?void 0:n.tableSql)||bs,tableRecordLink:d,tableField:m,formField:l,meta:JSON.stringify((n==null?void 0:n.meta)||{},null,2)}},Te=r.object({name:r.string().min(1,{message:"请输入按钮名称"}),url:r.string().min(1,{message:"请输入URL"})}),ys=r.object({name:r.string().min(1,{message:"请输入字段名"}),defaultHide:r.boolean().optional()}),L=r.object({name:r.string().min(1,{message:"请输入字段名"}),type:r.string().min(1,{message:"请选择字段类型"}),required:r.boolean().optional(),readonly:r.boolean().optional(),hide:r.boolean().optional(),label:r.string().optional(),description:r.string().optional()}),G=L.extend({optionsType:r.string().optional(),optionsStatic:r.array(r.object({label:r.string().min(1,{message:"标签不能为空"}),value:r.string().min(1,{message:"值不能为空"})})).optional(),optionsSql:r.string().optional(),optionsMap:r.object({key:r.string().optional(),label:r.string().optional(),value:r.string().optional()}).optional()}),he=L.extend({min:r.number().optional(),max:r.number().optional(),step:r.number().optional()}),re=L.extend({start:r.string().optional(),end:r.string().optional()}),vs=L.extend({language:r.string().optional()}),Ss=r.object({name:r.string().min(1,{message:"请输入字段名"}),type:r.string().min(1,{message:"请选择字段类型"}),required:r.boolean().optional(),readonly:r.boolean().optional(),hide:r.boolean().optional(),description:r.string().optional(),optionsType:r.string().optional(),optionsStatic:r.array(r.object({label:r.string().min(1,{message:"标签不能为空"}),value:r.string().min(1,{message:"值不能为空"})})).optional(),optionsSql:r.any().optional(),optionsMap:r.object({label:r.string().optional(),value:r.string().optional()}).optional(),min:r.number().optional(),max:r.number().optional(),step:r.number().optional(),start:r.string().optional(),end:r.string().optional(),language:r.string().optional()}),Cs=r.discriminatedUnion("type",[L.extend({type:r.literal("text")}),L.extend({type:r.literal("textarea")}),L.extend({type:r.literal("switch")}),L.extend({type:r.literal("file")}),G.extend({type:r.literal("select")}),G.extend({type:r.literal("selectMany")}),G.extend({type:r.literal("radio")}),G.extend({type:r.literal("checkbox")}),G.extend({type:r.literal("checkboxMany")}),he.extend({type:r.literal("number")}),he.extend({type:r.literal("slider")}),re.extend({type:r.literal("date")}),re.extend({type:r.literal("dateRange")}),re.extend({type:r.literal("dateMany")}),vs.extend({type:r.literal("code")})]),ue=hs.extend({meta:is,db:r.string(),tableSql:r.string(),tableRecordLink:r.array(Te).optional(),tableField:r.array(ys).optional(),formField:r.array(Ss).optional()}),Re=({id:n,children:d})=>{const{attributes:m,listeners:l,setNodeRef:j,transform:g,transition:h}=Ze({id:n}),t={transform:Ye.Transform.toString(g),transition:h};return e.jsx("div",{ref:j,style:t,className:"relative touch-none",children:d(m,l)})},Ns=({item:n,onEdit:d,onDelete:m})=>e.jsx(Re,{id:n.name,children:(l,j)=>e.jsxs("div",{className:"bg-muted hover:bg-muted/50 hover:border-foreground group mb-2 flex items-center justify-between rounded-md border p-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground cursor-move outline-none",...l,...j,children:e.jsx(Fe,{size:16})}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("span",{className:"font-medium",children:n.name}),e.jsx("span",{className:"text-muted-foreground text-xs",children:n.url})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(T,{type:"button",variant:"ghost",size:"icon",className:"h-7 w-7 opacity-0 transition-opacity group-hover:opacity-100",onClick:()=>d(n),children:e.jsx(ke,{size:14})}),e.jsx(T,{type:"button",variant:"ghost",size:"icon",className:"text-destructive! h-7 w-7 opacity-0 transition-opacity group-hover:opacity-100",onClick:()=>m(n.name),children:e.jsx(ae,{size:14})})]})]})}),Fs=({item:n,onEdit:d,onDelete:m})=>{const l=[`type=${n.type}`];return n.required&&l.push("required=true"),n.readonly&&l.push("readonly=true"),n.hide&&l.push("hide=true"),n.optionsType&&l.push(`optionsType=${n.optionsType}`),n.label&&l.push(`label=${n.label}`),n.description&&l.push(`description=${n.description}`),e.jsx(Re,{id:n.name,children:(j,g)=>e.jsxs("div",{className:"bg-muted hover:bg-muted/50 hover:border-foreground group mb-2 flex items-center justify-between rounded-md border p-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground cursor-move outline-none",...j,...g,children:e.jsx(Fe,{size:16})}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("span",{className:"font-medium",children:n.name}),e.jsx("span",{className:"text-muted-foreground text-xs",children:l.join("、")})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(T,{type:"button",variant:"ghost",size:"icon",className:"h-7 w-7 opacity-0 transition-opacity group-hover:opacity-100",onClick:()=>d(n),children:e.jsx(ke,{size:14})}),e.jsx(T,{type:"button",variant:"ghost",size:"icon",className:"text-destructive! h-7 w-7 opacity-0 transition-opacity group-hover:opacity-100",onClick:()=>m(n.name),children:e.jsx(ae,{size:14})})]})]})})};function je({items:n,renderItem:d,onDragEnd:m}){const l=De(ie(Pe),ie(Ve,{coordinateGetter:$e})),j=g=>{const{active:h,over:t}=g;if(t&&h.id!==t.id){const R=n.findIndex(y=>y.name===h.id),v=n.findIndex(y=>y.name===t.id),C=Ge(n,R,v);m(C)}};return e.jsx(ze,{sensors:l,collisionDetection:Be,onDragEnd:j,modifiers:[Ue],children:e.jsx(He,{items:n.map(g=>g.name),strategy:Je,children:n.map(g=>d(g))})})}const ks=({isOpen:n,onClose:d,onSave:m,initialData:l,resourceTable:j,tableRecordLinkItems:g})=>{const h=Te.superRefine((v,C)=>{if(g.some(y=>y.name===v.name&&y.name!==(l==null?void 0:l.name))){C.addIssue({code:r.ZodIssueCode.custom,message:"字段名已存在",path:["name"]});return}}),t=ge({resolver:te(h),defaultValues:{name:(l==null?void 0:l.name)||"",url:(l==null?void 0:l.url)||""},mode:"onChange"});k.useEffect(()=>{n&&t.reset({name:(l==null?void 0:l.name)||"",url:(l==null?void 0:l.url)||""})},[t,l,n]);const R=v=>{m(v),d()};return e.jsx(ye,{open:n,onOpenChange:v=>!v&&d(),children:e.jsxs(ve,{children:[e.jsxs(Se,{children:[e.jsx(Ce,{children:l?"编辑 Table 表记录链接":"添加 Table 表记录链接"}),e.jsx(Ne,{children:"除增、改、删之外的额外按钮，展示在 Table 表记录的右侧"})]}),e.jsx(be,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(R),className:"space-y-4 py-2",children:[e.jsx(x,{control:t.control,name:"name",render:({field:v})=>e.jsxs(p,{children:[e.jsx(b,{children:"按钮名称 *"}),e.jsx(u,{children:e.jsx(S,{...v})}),e.jsx(E,{className:"text-xs",children:"请确保名称唯一，将作为路由参数"}),e.jsx(N,{})]})}),e.jsx(x,{control:t.control,name:"url",render:({field:v})=>e.jsxs(p,{children:[e.jsx(b,{children:"URL *"}),e.jsx(u,{children:e.jsx(S,{...v,placeholder:"eg: /a/b/c?id={id}&category={category.title}"})}),e.jsxs(E,{className:"text-xs",children:["使用变量 ","{key}"," 引用 `基本配置 - 资源表` 中指定的 `",j||"尚未填写","` 表记录字段"]}),e.jsx(N,{})]})}),e.jsxs(Xe,{children:[e.jsx(T,{variant:"outline",type:"button",onClick:d,children:"取消"}),e.jsx(T,{type:"submit",icon:e.jsx(Ie,{}),children:"保存"})]})]})})]})})},Is=({isOpen:n,onClose:d,onSave:m,initialData:l,formFieldItems:j})=>{var O;const g=Cs.superRefine((s,a)=>{if(j.some(c=>c.name===s.name&&c.name!==(l==null?void 0:l.name))){a.addIssue({code:r.ZodIssueCode.custom,message:"字段名已存在",path:["name"]});return}if(xe.includes(s.type)){const c=s;if(!c.optionsType){a.addIssue({code:r.ZodIssueCode.custom,message:"请选择下拉选项数据来源",path:["optionsType"]});return}if(c.optionsType==="static"){(!c.optionsStatic||!c.optionsStatic.length||!c.optionsStatic.some(w=>w.label&&w.value))&&a.addIssue({code:r.ZodIssueCode.custom,message:"请至少添加一个有效的静态选项",path:["optionsStatic"]});return}if(c.optionsType==="database"&&!c.optionsSql){a.addIssue({code:r.ZodIssueCode.custom,message:"请输入有效的 `SQL` 查询语句",path:["optionsSql"]});return}}if(s.type==="number"||s.type==="slider"){const c=s;c.min!==void 0&&c.max!==void 0&&c.min>c.max&&a.addIssue({code:r.ZodIssueCode.custom,message:"最小值不能大于最大值",path:["min"]})}if(pe.includes(s.type)){const c=s;c.start&&c.end&&c.start>c.end&&a.addIssue({code:r.ZodIssueCode.custom,message:"开始日期不能晚于结束日期",path:["start"]})}}),h=R(l),t=ge({resolver:te(g),defaultValues:h,mode:"onChange"});function R(s){const a={name:(s==null?void 0:s.name)||"",type:(s==null?void 0:s.type)||"",required:(s==null?void 0:s.required)||!1,readonly:(s==null?void 0:s.readonly)||!1,hide:(s==null?void 0:s.hide)||!1,label:(s==null?void 0:s.label)||"",description:(s==null?void 0:s.description)||""};if(!s||gs.includes(s.type))return a;switch(s.type){case"select":case"selectMany":case"radio":case"checkboxMany":return{...a,type:s.type,optionsType:s.optionsType,optionsStatic:s.optionsStatic||(s.optionsType==="static"?[{label:"",value:""}]:void 0),optionsSql:s.optionsSql,optionsMap:s.optionsMap};case"number":case"slider":return{...a,type:s.type,min:s.min,max:s.max,step:s.step};case"date":case"dateRange":case"dateMany":return{...a,type:s.type,start:s.start,end:s.end};case"code":return{...a,type:s.type,language:s.language||"json"};default:return a}}const{watch:v,setValue:C}=t,y=v("type"),$=v("optionsType"),i=xe.includes(y),V=v("optionsStatic"),F=k.useMemo(()=>V||[{label:"",value:""}],[V]);k.useEffect(()=>{F.filter(s=>s.label&&s.value).length>0&&t.clearErrors("optionsStatic")},[F,t]),k.useEffect(()=>{n?t.reset(h):t.reset({})},[n]);const q=()=>{C("optionsStatic",[...F,{label:"",value:""}])},_=s=>{C("optionsStatic",F.filter((a,c)=>c!==s))},A=s=>{m(s),d()};return e.jsx(ye,{open:n,onOpenChange:s=>!s&&d(),children:e.jsxs(ve,{className:"sm:max-w-6xl",children:[e.jsxs(Se,{children:[e.jsx(Ce,{children:l?"编辑 Form 表单字段":"新增 Form 表单字段"}),e.jsx(Ne,{children:"配置表单字段属性"})]}),e.jsx(be,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(A),className:"grid grid-cols-2 gap-4 py-2",children:[e.jsx(x,{control:t.control,name:"name",render:({field:s})=>e.jsxs(p,{children:[e.jsx(b,{children:"字段名 *"}),e.jsx(u,{children:e.jsx(S,{...s})}),e.jsx(E,{className:"text-xs",children:"请确保名称唯一，将作为表单字段的名称"}),e.jsx(N,{})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(me,{className:"block",children:"字段限制 (可选)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"inline-flex flex-row items-center justify-between gap-2 rounded-lg border px-3 py-[7px]",children:e.jsx(x,{control:t.control,name:"required",render:({field:s})=>e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(b,{children:"必填"}),e.jsx(u,{children:e.jsx(M,{checked:s.value,onCheckedChange:s.onChange})})]})})}),e.jsx("div",{className:"inline-flex flex-row items-center justify-between gap-2 rounded-lg border px-3 py-[7px]",children:e.jsx(x,{control:t.control,name:"readonly",render:({field:s})=>e.jsxs(p,{className:"flex flex-row items-center gap-2 space-y-0",children:[e.jsx(b,{children:"只读"}),e.jsx(u,{children:e.jsx(M,{checked:s.value,onCheckedChange:s.onChange})})]})})})]})]}),e.jsx("div",{className:"space-y-2",children:e.jsx(x,{control:t.control,name:"type",render:({field:s})=>e.jsxs(p,{children:[e.jsx(b,{children:"字段类型 *"}),e.jsx(u,{children:e.jsx(fe,{className:"sm:w-full",popoverProps:{modal:!0},options:[{label:"Text - 文本",value:"text"},{label:"Number - 数字",value:"number"},{label:"Slider - 滑块",value:"slider"},{label:"Date - 日期",value:"date"},{label:"DateRange - 日期范围",value:"dateRange"},{label:"DateMany - 日期多选",value:"dateMany"},{label:"Select - 下拉",value:"select"},{label:"SelectMany - 下拉多选",value:"selectMany"},{label:"Checkbox - 复选框",value:"checkbox"},{label:"Radio - 单选",value:"radio"},{label:"Switch - 开关",value:"switch"},{label:"Textarea - 文本域",value:"textarea"},{label:"Code - 代码",value:"code"},{label:"File - 文件",value:"file"}],value:s.value,onChange:s.onChange})}),e.jsx(N,{})]})})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"space-y-2",children:e.jsx(x,{control:t.control,name:"label",render:({field:s})=>e.jsxs(p,{children:[e.jsx(b,{children:"标签 (可选)"}),e.jsx(u,{children:e.jsx(S,{...s})}),e.jsx(N,{})]})})}),e.jsx("div",{className:"space-y-2",children:e.jsx(x,{control:t.control,name:"description",render:({field:s})=>e.jsxs(p,{children:[e.jsx(b,{children:"描述 (可选)"}),e.jsx(u,{children:e.jsx(S,{...s})}),e.jsx(N,{})]})})})]}),i&&e.jsx("div",{className:"col-span-2 space-y-2",children:e.jsx(x,{control:t.control,name:"optionsType",render:({field:s})=>e.jsxs(p,{children:[e.jsx(b,{children:"下拉选项数据来源 *"}),e.jsx(u,{children:e.jsxs(es,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(ss,{className:"w-full",children:e.jsx(ns,{placeholder:"选择 Select 选项数据来源"})}),e.jsxs(rs,{children:[e.jsx(se,{value:"static",children:"Static - 静态"}),e.jsx(se,{value:"database",children:"Database - 数据库"}),e.jsx(se,{value:"api",disabled:!0,children:"API - 接口"})]})]})}),e.jsx(E,{className:"text-xs",children:"静态指手动维护选项数据、数据库指从数据库中动态查询、API指从接口获取数据"}),e.jsx(N,{})]})})}),i&&$==="static"&&e.jsxs("div",{className:"col-span-2",children:[e.jsxs("div",{className:"mb-1 flex items-center justify-between",children:[e.jsx(me,{children:"静态选项 *"}),e.jsxs(T,{type:"button",size:"sm",variant:"link",onClick:q,className:"cursor-pointer gap-1 px-0! text-xs text-green-600",children:[e.jsx(oe,{className:"h-3 w-3"}),"添加静态选项"]})]}),e.jsx("div",{className:"space-y-2",children:F.map((s,a)=>e.jsxs("div",{className:"grid grid-cols-2 items-center gap-4",children:[e.jsx(S,{value:s.label,placeholder:"标签",onChange:c=>{const w=[...F];w[a].label=c.target.value,C("optionsStatic",w)},className:"flex-1"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(S,{value:s.value,placeholder:"值",onChange:c=>{const w=[...F];w[a].value=c.target.value,C("optionsStatic",w)},className:"flex-1"}),e.jsx(T,{type:"button",variant:"outline",className:"text-destructive! h-8 w-8 border-dashed p-0",size:"icon",disabled:F.length===1,onClick:()=>_(a),children:e.jsx(ae,{className:"h-4 w-4"})})]})]},a))}),e.jsx(N,{className:"mt-2",children:i?(O=t.formState.errors.optionsStatic)==null?void 0:O.message:void 0})]}),i&&$==="database"&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"col-span-2 space-y-2",children:e.jsx(x,{control:t.control,name:"optionsSql",render:({field:s})=>e.jsxs(p,{children:[e.jsx(b,{children:"SQL 查询语句"}),e.jsx(u,{children:e.jsx(le,{language:"sql",height:"100px",value:s.value||"",onChange:a=>{C("optionsSql",a.target.value,{shouldValidate:!0,shouldDirty:!0})}})}),e.jsx(E,{className:"text-xs",children:"SQL 查询语句，用于查询选项数据"}),e.jsx(N,{})]})})})}),(y==="number"||y==="slider")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-2",children:e.jsx(x,{control:t.control,name:"min",render:({field:s})=>e.jsxs(p,{children:[e.jsx(b,{children:"最小值"}),e.jsx(u,{children:e.jsx(S,{type:"number",...s,value:s.value===void 0?"":s.value,onChange:a=>{const c=a.target.value?parseInt(a.target.value):void 0;s.onChange(c)}})}),e.jsx(E,{className:"text-xs",children:"限制输入的最小值"}),e.jsx(N,{})]})})}),e.jsx("div",{className:"space-y-2",children:e.jsx(x,{control:t.control,name:"max",render:({field:s})=>e.jsxs(p,{children:[e.jsx(b,{children:"最大值"}),e.jsx(u,{children:e.jsx(S,{type:"number",...s,value:s.value===void 0?"":s.value,onChange:a=>{const c=a.target.value?parseInt(a.target.value):void 0;s.onChange(c)}})}),e.jsx(E,{className:"text-xs",children:"限制输入的最大值"}),e.jsx(N,{})]})})})]}),(y==="slider"||y==="number")&&e.jsx("div",{className:"space-y-2",children:e.jsx(x,{control:t.control,name:"step",render:({field:s})=>e.jsxs(p,{children:[e.jsx(b,{children:"步长 (可选)"}),e.jsx(u,{children:e.jsx(S,{type:"number",min:1,step:1,...s,value:s.value===void 0?"":s.value,onChange:a=>{const c=a.target.value?parseInt(a.target.value):void 0;s.onChange(c)}})}),e.jsx(N,{})]})})}),pe.includes(y)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-2",children:e.jsx(x,{control:t.control,name:"start",render:({field:s})=>e.jsxs(p,{children:[e.jsx(b,{children:"开始日期"}),e.jsx(u,{children:e.jsx(S,{type:"text",...s,placeholder:"2026-01-01"})}),e.jsx(E,{className:"text-xs",children:"限制输入的开始时间"}),e.jsx(N,{})]})})}),e.jsx("div",{className:"space-y-2",children:e.jsx(x,{control:t.control,name:"end",render:({field:s})=>e.jsxs(p,{children:[e.jsx(b,{children:"结束日期"}),e.jsx(u,{children:e.jsx(S,{type:"text",...s,placeholder:"2030-12-31"})}),e.jsx(E,{className:"text-xs",children:"限制输入的结束时间"}),e.jsx(N,{})]})})})]}),y==="code"&&e.jsx("div",{className:"space-y-2",children:e.jsx(x,{control:t.control,name:"language",render:({field:s})=>e.jsxs(p,{children:[e.jsx(b,{children:"程序语言"}),e.jsx(u,{children:e.jsx(S,{...s,placeholder:"如：javascript, python, sql等"})}),e.jsx(N,{})]})})}),e.jsxs("div",{className:"col-span-2 flex justify-end gap-2 pt-4",children:[e.jsx(T,{variant:"outline",type:"button",onClick:d,children:"取消"}),e.jsx(T,{type:"submit",icon:e.jsx(Ie,{}),children:"保存"})]})]})})]})})},Ts=({className:n,redirect:d=Y.list,initialData:m,action:l})=>{const{tableRecordLink:j=[],formField:g=[]}=m||{},{formAction:h,id:t=m==null?void 0:m.id,identifier:R}=Qe({action:l}),v=h===Y.edit,C=fs(m||{}),y=ms(),$=xs(),i=We({resolver:te(ue),defaultValues:C,warnWhenUnsavedChanges:!0,mode:"onChange",refineCoreProps:{resource:R,action:h,id:t,queryOptions:as(C),redirect:d,autoSave:{enabled:v,debounce:2e3,invalidateOnUnmount:!0,onFinish:o=>{try{if(ue.parse(o),ne(o,i.formState.defaultValues))throw new Error("表单内容未变化");return ce(o)}catch{return null}}}}}),V=us(i.watch("tableSql")),[F,q]=k.useState(j),[_,A]=k.useState(!1),[O,s]=k.useState(void 0),[a,c]=k.useState(g),[w,Q]=k.useState(!1),[X,ee]=k.useState(void 0);k.useEffect(()=>{ne(F,i.getValues("tableRecordLink"))||(i.setValue("tableRecordLink",F,{shouldDirty:!0}),h===Y.edit&&i.refineCore.onFinishAutoSave({tableRecordLink:F}))},[F,i,h]),k.useEffect(()=>{ne(a,i.getValues("formField"))||(i.setValue("formField",a,{shouldDirty:!0}),h===Y.edit&&i.refineCore.onFinishAutoSave({formField:a}))},[a,i,h]);const ce=k.useCallback(o=>{const f=h===Y.edit?os(o,C):o;return f.meta&&(f.meta=JSON.parse(f.meta)),ts(f)},[]),we=()=>{s(void 0),A(!0)},Ee=o=>{q(f=>f.filter(I=>I.name!==o))},Le=o=>{q(O?f=>f.map(I=>I.name===O.name?o:I):f=>[...f,o]),A(!1),s(void 0)},Me=()=>{ee(void 0),Q(!0)},qe=o=>{c(f=>f.filter(I=>I.name!==o))},Ae=o=>{c(X?f=>f.map(I=>I.name===X.name?o:I):f=>[...f,o]),Q(!1),ee(void 0)},Oe=k.useCallback(()=>{const o=i.getValues(),f=new FormData;f.append("data",JSON.stringify({path:o.path,title:o.title,isActive:o.isActive})),$(f,{method:"post"})},[$,i]);return k.useEffect(()=>{y&&(y.error?de.error("同步菜单操作失败",{description:y.error}):y.success&&de.success("同步菜单操作成功",{description:"success"}))},[y]),e.jsxs(e.Fragment,{children:[e.jsxs(_e,{...i,autoSave:v,beforeSubmit:ce,className:n,recordItemId:m==null?void 0:m.id,children:[e.jsxs(ls,{className:"flex items-end border-none",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{children:"配置化CRUD页面"}),e.jsx("p",{className:"text-muted-foreground text-sm font-normal",children:"通过配置要展示的数据模型、查询语句、增删改查等交互，自动生成CRUD页面"})]}),e.jsx(T,{icon:e.jsx(ps,{}),type:"button",variant:"outline",onClick:Oe,children:"同步创建、或更新菜单"})]}),e.jsxs(B,{children:[e.jsxs(U,{children:[e.jsx(H,{children:"基本配置"}),e.jsx(J,{children:"配置化CRUD最基本配置"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(x,{control:i.control,name:"path",render:({field:o})=>{const[f="",I="",W="",Rs="",K=""]=o.value.split("/");return e.jsxs(p,{children:[e.jsx(b,{children:"页面路径"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx(x,{control:i.control,name:"path",render:({field:P})=>e.jsx(p,{className:"flex flex-row items-center space-y-0",children:e.jsx(u,{children:e.jsx(S,{placeholder:"eg: playground",value:I,onChange:z=>P.onChange(`/${z.target.value}/${W}/dynamic/${K}`)})})})}),e.jsx(x,{control:i.control,name:"path",render:({field:P})=>e.jsx(p,{className:"flex flex-row items-center space-y-0",children:e.jsx(u,{children:e.jsx(S,{placeholder:"eg: dashboard",value:W,onChange:z=>P.onChange(`/${I}/${z.target.value}/dynamic/${K}`)})})})}),e.jsx(x,{control:i.control,name:"path",render:({field:P})=>e.jsx(p,{className:"flex flex-row items-center space-y-0",children:e.jsx(u,{children:e.jsx(S,{placeholder:"eg: post",value:K,onChange:z=>P.onChange(`/${I}/${W}/dynamic/${z.target.value}`)})})})})]}),e.jsxs(E,{children:["实际地址: ",`/${I||"group"}/${W||"category"}/dynamic/${K||"name"}`]}),e.jsx(N,{})]})}}),e.jsx(D,{...i,name:"title",label:"页面标题",description:"页面、以及菜单展示的标题",children:e.jsx(S,{placeholder:"eg: 文章"})}),e.jsx(D,{...i,name:"db",label:"数据源",children:e.jsx(fe,{className:"sm:w-auto",options:[{label:"数据库 A",value:"db1"},{label:"数据库 B",value:"db2"}]})})]}),e.jsx(D,{...i,name:"tableSql",label:"表SQL查询语句",children:e.jsx(le,{language:"sql",height:"20vh"})}),e.jsx(x,{control:i.control,name:"isActive",render:({field:o})=>e.jsxs(p,{className:"mr-3 inline-flex flex-row items-center justify-between rounded-lg border px-3 py-[5px]",children:[e.jsx("div",{className:"space-y-0.5",children:e.jsx(b,{children:"是否启用"})}),e.jsx(u,{children:e.jsx(M,{checked:!!o.value,onCheckedChange:o.onChange})})]})})]})]}),e.jsxs(B,{children:[e.jsxs(U,{children:[e.jsx(H,{children:"功能控制（可选）"}),e.jsxs(J,{children:["控制是否支持新增、编辑、删除 `基本配置 - 资源表` ",V]})]}),e.jsxs(Z,{className:"flex gap-4",children:[e.jsx(x,{control:i.control,name:"enableCreate",render:({field:o})=>e.jsxs(p,{className:"flex flex-row items-center justify-between rounded-lg border px-3 py-[5px]",children:[e.jsx("div",{className:"space-y-0.5",children:e.jsx(b,{children:"支持新增"})}),e.jsx(u,{children:e.jsx(M,{checked:!!o.value,onCheckedChange:o.onChange})})]})}),e.jsx(x,{control:i.control,name:"enableEdit",render:({field:o})=>e.jsxs(p,{className:"flex flex-row items-center justify-between rounded-lg border px-3 py-[5px]",children:[e.jsx("div",{className:"space-y-0.5",children:e.jsx(b,{children:"支持编辑"})}),e.jsx(u,{children:e.jsx(M,{checked:!!o.value,onCheckedChange:o.onChange})})]})}),e.jsx(x,{control:i.control,name:"enableClone",render:({field:o})=>e.jsxs(p,{className:"flex flex-row items-center justify-between rounded-lg border px-3 py-[5px]",children:[e.jsx("div",{className:"space-y-0.5",children:e.jsx(b,{children:"支持克隆"})}),e.jsx(u,{children:e.jsx(M,{checked:!!o.value,onCheckedChange:o.onChange})})]})}),e.jsx(x,{control:i.control,name:"enableDelete",render:({field:o})=>e.jsxs(p,{className:"flex flex-row items-center justify-between rounded-lg border px-3 py-[5px]",children:[e.jsx("div",{className:"space-y-0.5",children:e.jsx(b,{children:"支持删除"})}),e.jsx(u,{children:e.jsx(M,{checked:!!o.value,onCheckedChange:o.onChange})})]})})]})]}),e.jsxs(B,{children:[e.jsxs(U,{children:[e.jsx(H,{children:"Table 表记录按钮（可选）"}),e.jsx(J,{children:"除增、改、删之外的额外按钮，展示在表记录的右侧"})]}),e.jsx(Z,{className:"space-y-4",children:e.jsx(D,{...i,name:"tableRecordLink",label:"",className:"gap-0",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx(je,{items:F,onDragEnd:o=>q(o),renderItem:o=>e.jsx(Ns,{item:o,onEdit:()=>{s(o),A(!0)},onDelete:Ee},o.name)}),e.jsx(T,{type:"button",variant:"outline",onClick:we,icon:e.jsx(oe,{}),className:"border-dashed hover:border-green-500",children:"添加表记录按钮"})]})})})]}),e.jsxs(B,{children:[e.jsxs(U,{children:[e.jsx(H,{children:"Form 表单字段（可选）"}),e.jsx(J,{children:"控制新增、编辑表单时字段的显示、排序"})]}),e.jsx(Z,{className:"space-y-4",children:e.jsx(D,{...i,name:"formField",label:"",className:"gap-0",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx(je,{items:a,onDragEnd:o=>c(o),renderItem:o=>e.jsx(Fs,{item:o,onDelete:qe,onEdit:()=>{ee(o),Q(!0)}},o.name)}),e.jsx(T,{type:"button",variant:"outline",onClick:Me,icon:e.jsx(oe,{}),className:"border-dashed hover:border-green-500",children:"添加表单字段"})]})})})]}),e.jsxs(B,{children:[e.jsxs(U,{children:[e.jsx(H,{children:"额外配置 - Meta（可选）"}),e.jsx(J,{children:"支持配置自定义的JSON信息"})]}),e.jsx(Z,{className:"space-y-4",children:e.jsx(D,{...i,name:"meta",label:"",className:"gap-0",children:e.jsx(le,{language:"json",height:"20vh"})})})]})]}),e.jsx(ks,{isOpen:_,onClose:()=>A(!1),onSave:Le,initialData:O,resourceTable:V,tableRecordLinkItems:F}),e.jsx(Is,{isOpen:w,onClose:()=>Q(!1),onSave:Ae,initialData:X,formFieldItems:a})]})};export{Ts as D,mn as E,js as a,dn as b,cn as m,an as p,xe as s};
