import{j as e}from"./jsx-runtime-C-_spy54.js";import{r as m}from"./index-aGVi9Z7h.js";import{t as p}from"./index-IcWDtlcJ.js";import{P as J}from"./500-B3AgJgcX.js";import{C as O}from"./code-C41So2C-.js";import{c as x,b as z,B as n}from"./button-iwFMjRuO.js";import{A as H,a as V,b as Y}from"./avatar-BgbBtH3S.js";import{B as q}from"./badge-BhqrVBYW.js";import{L as T}from"./label-BE58PT8g.js";import{T as K}from"./textarea-J2qc-DG5.js";import{T as Q,a as W,b as X}from"./tooltip-DCoz1Ss2.js";import{H as Z}from"./typography-BiEe32js.js";import{E as u,a as S,A as $}from"./audit-channel-7xUlZfi7.js";import{E as o}from"./log-Dv4uGBGl.js";import{d as B}from"./deep-parse-CMMvj5PV.js";import{u as ee,a as te,b as se}from"./components-CzmxjdGq.js";import{a as ae}from"./index-DN0hhrBY.js";import re from"./lightbulb-C84vBiDz.js";import ie from"./leafy-green-DpTEl_Pl.js";import ne from"./calendar-CL3LBVlF.js";import oe from"./info-BnrmSbNz.js";import ce from"./circle-alert-C9bopf0G.js";import le from"./ban-DPfHUeWx.js";import de from"./check-check-CEnaKdmQ.js";import"./index-hdkCHUwo.js";import"./tslib.es6-DDzNqjJ8.js";import"./base-url-B9uMRsbQ.js";import"./eye-3MhyTUfI.js";import"./index-BTG9THwZ.js";import"./index-oFZnn4P-.js";import"./index-DbfaYDfZ.js";import"./index-BdrJvQKk.js";import"./index-BSun3PQE.js";import"./index-BOzQdadW.js";import"./index-QtcXjNAv.js";import"./try-parse-D_xF9tNz.js";const me=z("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:text-destructive-foreground/80 dark:border-destructive [&>svg]:text-current dark:bg-destructive/50"}},defaultVariants:{variant:"default"}});function pe({className:t,variant:a,...r}){return e.jsx("div",{"data-slot":"alert",role:"alert",className:x(me({variant:a}),t),...r})}function ue({className:t,...a}){return e.jsx("div",{"data-slot":"alert-title",className:x("col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight",t),...a})}function xe({className:t,...a}){return e.jsx("div",{"data-slot":"alert-description",className:x("col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",t),...a})}function Xe(){var A,w,y,D,E,C,k;const{record:t,isAdmin:a}=ee(),{status:r,channel:f}=t,i=te(),R=ae(),h=se(),{content:P}=B(t.data||"{}"),{content:I}=B(t.dataPrevious||"{}"),v=t.meta||{},[c,L]=m.useState(""),[j,g]=m.useState(!1),_=a&&r===u.PENDING&&f===S.SELF,l=R.state==="submitting",F=(r===u.PENDING||r===u.FAILED)&&!j,M=![o.delete,o.deleteMany].includes(t.action),N=[o.update,o.updateMany].includes(t.action);m.useEffect(()=>{i&&(i.success?p.success(i.message):p.error(i.message))},[i]);const U=()=>{const s=new FormData;s.append("id",t.id),s.append("action","approve"),h(s,{method:"post"})},G=()=>{if(!c.trim()){p.error("操作有误",{description:"拒绝时必须提供原因"});return}const s=new FormData;s.append("id",t.id),s.append("action","reject"),s.append("reason",c),h(s,{method:"post"})},d=!_||l,b=e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{variant:"destructive",onClick:()=>g(!0),disabled:d,icon:e.jsx(le,{}),children:"拒绝"}),e.jsx(n,{variant:"default",onClick:U,disabled:d,icon:e.jsx(de,{}),children:"通过"})]})});return e.jsxs("article",{className:"px-8 pt-8 pb-4",children:[e.jsxs("header",{className:"mb-8",children:[e.jsxs(Z,{className:"relative mb-4 inline-flex gap-3 text-4xl font-bold",children:[e.jsxs("span",{children:["Audit Record - ",t.title]}),e.jsx("div",{className:"inline-flex shrink-0 items-start pt-3.5",children:e.jsx(q,{className:"tracking-wide",variant:(A=$[r])==null?void 0:A.badge,children:r})})]}),e.jsxs("div",{className:"text-muted-foreground mb-8 flex flex-wrap items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),e.jsxs("span",{children:["ActionType: ",t.action]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),e.jsxs("span",{children:["Resource: ",v.parent,".",t.resource]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(ne,{className:"mr-2 h-4 w-4"}),e.jsxs("span",{children:["Created: ",new Date(t.createdAt).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"flex flex-1 items-center gap-3",children:[e.jsxs(H,{children:[e.jsx(V,{src:(w=t.operatedBy)==null?void 0:w.avatar,alt:((y=t.operatedBy)==null?void 0:y.name)||""}),e.jsx(Y,{children:(E=(D=t.operatedBy)==null?void 0:D.name)==null?void 0:E.slice(0,2).toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:(C=t.operatedBy)==null?void 0:C.name}),e.jsx("p",{className:"text-muted-foreground text-sm",children:(k=t.operatedBy)==null?void 0:k.email})]})]}),F&&(d?e.jsxs(Q,{children:[e.jsx(W,{asChild:!0,children:b}),e.jsxs(X,{side:"left",className:"flex items-center gap-1",children:[e.jsx(oe,{className:"h-4 w-4"}),f===S.TIAN_YUAN?"请通知测试人员在天元审核":"请通知管理员进行审核"]})]}):b)]}),j&&e.jsxs("div",{className:"mt-5 flex w-full flex-col gap-2",children:[e.jsx(K,{className:"min-h-20",placeholder:"请输入拒绝原因...",value:c,onChange:s=>L(s.target.value)}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(n,{variant:"outline",onClick:()=>g(!1),disabled:l,children:"取消"}),e.jsx(n,{variant:"destructive",onClick:G,disabled:l,children:"确认拒绝"})]})]})]}),t.error&&e.jsxs(pe,{variant:"destructive",className:"mb-6",children:[e.jsx(ce,{className:"size-4"}),e.jsx(ue,{children:"Error: 审核失败"}),e.jsx(xe,{children:t.error||"unknown"})]}),(t.dataPrevious||t.data)&&M&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(T,{children:N?"Previous Resource Data & New Resource Data":"Resource Data"}),e.jsx(O,{language:"json",value:JSON.stringify(I,null,2),modified:JSON.stringify(P,null,2),enableToggleDiff:!1,openDiff:N})]}),e.jsx("div",{className:"mt-6",children:t.meta&&e.jsxs("div",{children:[e.jsx(T,{children:"Meta Data"}),e.jsx("pre",{className:"bg-muted mt-1 overflow-x-auto rounded-lg p-4 text-sm whitespace-pre",children:JSON.stringify(v,null,2)})]})})]})}function Ze(){return e.jsx(J,{})}export{Ze as ErrorBoundary,Xe as default};
