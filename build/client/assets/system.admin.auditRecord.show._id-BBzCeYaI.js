import{j as e}from"./jsx-runtime-C-_spy54.js";import{r as m}from"./index-aGVi9Z7h.js";import{t as p}from"./index-DJzNQfCY.js";import{P as J}from"./500-C3XOm4pH.js";import{C as O}from"./code-DVGvJ8US.js";import{c as x,b as z,B as n}from"./button-fwOzNkKg.js";import{A as H,a as V,b as Y}from"./avatar-CKnziAVT.js";import{B as q}from"./badge-Cq8cQ-DO.js";import{L as T}from"./label-Cn5Hhc8O.js";import{T as K}from"./textarea-BaHN5jSR.js";import{T as Q,a as W,b as X}from"./tooltip-BiSwtkgJ.js";import{H as Z}from"./typography-C1jA57zM.js";import{E as u,a as S,A as $}from"./audit-channel-7xUlZfi7.js";import{E as o}from"./log-Dv4uGBGl.js";import{d as B}from"./deep-parse-CMMvj5PV.js";import{u as ee,a as se,b as te}from"./components-BXAOArSq.js";import{a as ae}from"./index-Cj7hasNJ.js";import{L as re}from"./lightbulb-LnEExiet.js";import{L as ie,C as ne}from"./leafy-green-BmdPgLfW.js";import{I as oe,C as ce,B as le}from"./info-CBngYbtn.js";import{C as de}from"./check-check-C8Uaujzw.js";import"./index-Cif3Vfib.js";import"./tslib.es6-DDzNqjJ8.js";import"./base-url-B9uMRsbQ.js";import"./eye-B4mWZ-xV.js";import"./index-BTG9THwZ.js";import"./index-BR3_WpCG.js";import"./index-rNzEV3Eb.js";import"./index-BHPxmX68.js";import"./index-BwO56yqr.js";import"./index-Bxhl55VX.js";import"./try-parse-D_xF9tNz.js";const me=z("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:text-destructive-foreground/80 dark:border-destructive [&>svg]:text-current dark:bg-destructive/50"}},defaultVariants:{variant:"default"}});function pe({className:s,variant:a,...r}){return e.jsx("div",{"data-slot":"alert",role:"alert",className:x(me({variant:a}),s),...r})}function ue({className:s,...a}){return e.jsx("div",{"data-slot":"alert-title",className:x("col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight",s),...a})}function xe({className:s,...a}){return e.jsx("div",{"data-slot":"alert-description",className:x("col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",s),...a})}function qe(){var A,w,y,D,C,E,k;const{record:s,isAdmin:a}=ee(),{status:r,channel:f}=s,i=se(),L=ae(),h=te(),{content:R}=B(s.data||"{}"),{content:I}=B(s.dataPrevious||"{}"),v=s.meta||{},[c,P]=m.useState(""),[j,g]=m.useState(!1),_=a&&r===u.PENDING&&f===S.SELF,l=L.state==="submitting",F=(r===u.PENDING||r===u.FAILED)&&!j,M=![o.delete,o.deleteMany].includes(s.action),N=[o.update,o.updateMany].includes(s.action);m.useEffect(()=>{i&&(i.success?p.success(i.message):p.error(i.message))},[i]);const U=()=>{const t=new FormData;t.append("id",s.id),t.append("action","approve"),h(t,{method:"post"})},G=()=>{if(!c.trim()){p.error("操作有误",{description:"拒绝时必须提供原因"});return}const t=new FormData;t.append("id",s.id),t.append("action","reject"),t.append("reason",c),h(t,{method:"post"})},d=!_||l,b=e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{variant:"destructive",onClick:()=>g(!0),disabled:d,icon:e.jsx(le,{}),children:"拒绝"}),e.jsx(n,{variant:"default",onClick:U,disabled:d,icon:e.jsx(de,{}),children:"通过"})]})});return e.jsxs("article",{className:"px-8 pt-8 pb-4",children:[e.jsxs("header",{className:"mb-8",children:[e.jsxs(Z,{className:"relative mb-4 inline-flex gap-3 text-4xl font-bold",children:[e.jsxs("span",{children:["Audit Record - ",s.title]}),e.jsx("div",{className:"inline-flex shrink-0 items-start pt-3.5",children:e.jsx(q,{className:"tracking-wide",variant:(A=$[r])==null?void 0:A.badge,children:r})})]}),e.jsxs("div",{className:"text-muted-foreground mb-8 flex flex-wrap items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),e.jsxs("span",{children:["ActionType: ",s.action]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),e.jsxs("span",{children:["Resource: ",v.parent,".",s.resource]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(ne,{className:"mr-2 h-4 w-4"}),e.jsxs("span",{children:["Created: ",new Date(s.createdAt).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"flex flex-1 items-center gap-3",children:[e.jsxs(H,{children:[e.jsx(V,{src:(w=s.operatedBy)==null?void 0:w.avatar,alt:((y=s.operatedBy)==null?void 0:y.name)||""}),e.jsx(Y,{children:(C=(D=s.operatedBy)==null?void 0:D.name)==null?void 0:C.slice(0,2).toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:(E=s.operatedBy)==null?void 0:E.name}),e.jsx("p",{className:"text-muted-foreground text-sm",children:(k=s.operatedBy)==null?void 0:k.email})]})]}),F&&(d?e.jsxs(Q,{children:[e.jsx(W,{asChild:!0,children:b}),e.jsxs(X,{side:"left",className:"flex items-center gap-1",children:[e.jsx(oe,{className:"h-4 w-4"}),f===S.TIAN_YUAN?"请通知测试人员在天元审核":"请通知管理员进行审核"]})]}):b)]}),j&&e.jsxs("div",{className:"mt-5 flex w-full flex-col gap-2",children:[e.jsx(K,{className:"min-h-20",placeholder:"请输入拒绝原因...",value:c,onChange:t=>P(t.target.value)}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(n,{variant:"outline",onClick:()=>g(!1),disabled:l,children:"取消"}),e.jsx(n,{variant:"destructive",onClick:G,disabled:l,children:"确认拒绝"})]})]})]}),s.error&&e.jsxs(pe,{variant:"destructive",className:"mb-6",children:[e.jsx(ce,{className:"size-4"}),e.jsx(ue,{children:"Error: 审核失败"}),e.jsx(xe,{children:s.error||"unknown"})]}),(s.dataPrevious||s.data)&&M&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(T,{children:N?"Previous Resource Data & New Resource Data":"Resource Data"}),e.jsx(O,{language:"json",value:JSON.stringify(I,null,2),modified:JSON.stringify(R,null,2),enableToggleDiff:!1,openDiff:N})]}),e.jsx("div",{className:"mt-6",children:s.meta&&e.jsxs("div",{children:[e.jsx(T,{children:"Meta Data"}),e.jsx("pre",{className:"bg-muted mt-1 overflow-x-auto rounded-lg p-4 text-sm whitespace-pre",children:JSON.stringify(v,null,2)})]})})]})}function Ke(){return e.jsx(J,{})}export{Ke as ErrorBoundary,qe as default};
