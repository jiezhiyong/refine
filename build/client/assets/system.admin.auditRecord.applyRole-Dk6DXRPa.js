import{j as s}from"./jsx-runtime-C-_spy54.js";import{t as R}from"./form-C6QjBNoK.js";import{C as L,F as P}from"./field-83Oe2ZIn.js";import{t as k}from"./i18next-BaiEmIpz.js";import{r as h}from"./index-aGVi9Z7h.js";import{z as p}from"./index-Cb7h-Ku-.js";import{P as w}from"./500-CUoB5SEY.js";import{F}from"./form-C6Kqb6cn.js";import{S as I}from"./select-multi-DdTJIlWD.js";import{B as x}from"./badge-D4AhLx1S.js";import{C as T,a as B}from"./card-cVzU8pnd.js";import{C as D}from"./checkbox-ymB5Ct45.js";import{L as M}from"./label-CQrdb056.js";import{a as O}from"./typography-I680OglX.js";import{E,A as U,a as b}from"./action-DSYjqVEc.js";import{E as _,a as z}from"./audit-channel-7xUlZfi7.js";import{E as $}from"./log-Dv4uGBGl.js";import{R as G,E as A}from"./resource-BEg55So-.js";import{g as H}from"./get-default-title-CrVGbO9H.js";import{u as V}from"./components-CzmxjdGq.js";import"./button-hXZAo1l1.js";import"./index-hdkCHUwo.js";import"./tslib.es6-DDzNqjJ8.js";import"./index-DN0hhrBY.js";import"./dayjs.min-CHrC0Ux9.js";import"./create-D7Ur1QKT.js";import"./circle-plus-e3zLOx1g.js";import"./check-check-BALC1p_C.js";import"./undo-2-BTw56Gmb.js";import"./command-UrgpALSp.js";import"./index-BBe4U18k.js";import"./index-D6J7U5p3.js";import"./index-BivEtBZR.js";import"./index-BTG9THwZ.js";import"./index-oFZnn4P-.js";import"./index-j_Y29uav.js";import"./search-P2vsbpZb.js";import"./popover-BoK46nO7.js";import"./index-BkIYOchD.js";import"./check-DuC-6lq_.js";import"./index-k7qIncBC.js";import"./resources-nPXTaVLM.js";import"./capitalize-first-letter-B7Vzw64t.js";const u=G.filter(n=>n!==A.userRole).sort(),W="role:apply",Ut=({matches:n})=>[{title:H(n)}];function _t(){const{roleList:n,casbinRuleList:a,currentRoles:t,auditRecord:m}=V();return s.jsx(K,{roleList:n,casbinRuleList:a,currentRoles:t,auditRecord:m})}function zt(){return s.jsx(w,{})}const q=p.object({roles:p.array(p.object({label:p.string(),value:p.string()}))});function J(n,a){const t={};if(u.forEach(e=>{t[e]={resource:e,actions:[],hasAllActions:!1,hasSomeActions:!1}}),!a||a.length===0)return t;const m=a.map(e=>e.label);return n.forEach(e=>{if(m.includes(e.v0))if(e.v1==="*"){const o=e.v2.split("|");u.forEach(r=>{const i=new Set([...t[r].actions,...o]);t[r].actions=Array.from(i),t[r].hasSomeActions=t[r].actions.length>0,t[r].hasAllActions=t[r].actions.length===b.length})}else{const[o]=e.v1.split("/");if(u.includes(o)){if(e.v3==="deny")return;const r=e.v2.split("|"),i=new Set([...t[o].actions,...r]);t[o].actions=Array.from(i),t[o].hasSomeActions=t[o].actions.length>0,t[o].hasAllActions=t[o].actions.length===b.length}}}),t}const K=({roleList:n,casbinRuleList:a,auditRecord:t,currentRoles:m})=>{const{id:e}=t||{},[o,r]=h.useState(m),i=L({resolver:R(q),defaultValues:{roles:m},warnWhenUnsavedChanges:!0,mode:"onChange",refineCoreProps:{id:e,resource:A.auditRecord,action:e?E.edit:E.create}});h.useEffect(()=>{const c=i.watch(l=>{l.roles&&r(l.roles)});return()=>c.unsubscribe()},[i]);const N=h.useMemo(()=>J(a,o),[a,o]),S=async c=>{const{roles:l}=c;return{meta:{parent:"account"},title:W,dataPrevious:m,resource:A.role,data:l,status:_.PENDING,action:$.update,channel:z.SELF,error:null}};return s.jsxs(F,{...i,beforeSubmit:S,className:"space-y-4",children:[s.jsxs(O,{className:"mb-8",children:[s.jsx("span",{children:"权限变更申请"}),s.jsx("p",{className:"text-muted-foreground text-sm font-normal",children:"选择角色，分配资源与相关操作的权限"})]}),s.jsx(P,{...i,name:"roles",label:"Roles",children:s.jsx(I,{options:n})}),s.jsx(M,{children:"当前所选角色拥有的资源、操作权限"}),s.jsx("div",{className:"mt-2 space-y-4 space-x-4",children:u.map(c=>{const l=N[c],{hasAllActions:d,hasSomeActions:f,actions:v}=l,y=v.sort().reverse(),g=d||f,C=f&&!d;return s.jsx(T,{className:"inline-block min-w-[300px]",children:s.jsxs(B,{className:"space-y-2 divide-y divide-dashed pb-3",children:[s.jsxs("div",{className:"flex items-center gap-2 pt-3 pb-2",children:[s.jsx(D,{"data-state":C?"indeterminate":g?"checked":"unchecked",className:"pointer-events-none",checked:g}),s.jsxs("span",{className:"capitalize",children:[c," - ",k(`menus.${c}`)]})]}),d&&s.jsx(x,{className:"bg-green-500",children:"All"}),!f&&s.jsx(x,{className:"bg-destructive",children:"Null"}),!d&&f&&s.jsx("div",{className:"mt-3 flex items-center gap-2",children:y.map(j=>s.jsx(x,{variant:"secondary",className:"border-green-500",children:U[j].name},j))})]})},c)})})]})};export{zt as ErrorBoundary,_t as default,Ut as meta};
