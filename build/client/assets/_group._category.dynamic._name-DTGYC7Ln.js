import{j as e}from"./jsx-runtime-C-_spy54.js";import{u as lt,t as ct,b as L,c as B,d as O,g as q,F as G,e as H,a as dt}from"./form-CvgtEUdj.js";import{T as ut,h as mt,k as ft,S as pt,a as ht}from"./index-Cr0IeYe7.js";import{d as se}from"./dayjs.min-CHrC0Ux9.js";import{r as p}from"./index-aGVi9Z7h.js";import{t as we}from"./index-GyqvGh2n.js";import{z as I}from"./index-Cb7h-Ku-.js";import{P as xt,S as bt}from"./layout-CH1p-QP-.js";import{N as gt}from"./404-Dmort30f.js";import{P as jt}from"./500-Bi-8cWwO.js";import{C as yt}from"./create-CmiFHpun.js";import{E as vt}from"./edit-Dx7d9g9V.js";import{E as Ct,T as z}from"./index-BFWjmPMM.js";import{C as St}from"./code-DTTOy2hJ.js";import{C as wt}from"./combobox-Cboc2YBq.js";import{S as kt}from"./select-multi-xQoT5VS_.js";import{A as Rt,b as Dt,c as Nt,d as At,e as Pt,f as Et,g as Mt,h as _t}from"./alert-dialog-Dm01bm4B.js";import{B as It}from"./badge-CojvZVMK.js";import{a as Re,u as ee,c as ae,B as me}from"./button-BExhSn8V.js";import{C as Ft}from"./calendar-DOD9YdDG.js";import{C as xe}from"./checkbox-DEVd789o.js";import{D as Tt,b as Vt,c as Kt,d as Bt,e as Ot,f as Lt}from"./dialog-WmsIQqGF.js";import{I as pe}from"./input-3H16G6Wh.js";import{P as De,a as Ne,b as Ae}from"./popover-CYP-dzmY.js";import{c as W,P as Gt,u as Pe}from"./index-Bm0JEqyb.js";import{c as ye}from"./index-BTG9THwZ.js";import{P as te}from"./index-hdGzps5C.js";import{c as Ee,R as qt,I as Ht}from"./index-Bx657W1H.js";import{u as Me}from"./index-CBJO-X9V.js";import{u as _e}from"./index-Cl449RIc.js";import{u as Ie}from"./index-k7qIncBC.js";import{c as Fe}from"./index-BdQq_4o_.js";import{c as zt}from"./index-TV27acJk.js";import{T as $t,a as Ut,b as Yt,c as Jt}from"./tooltip-D5jmThYi.js";import{S as Wt}from"./switch-NHA-Wa4j.js";import{T as Xt}from"./textarea-CKzgIjgt.js";import{a as Qt}from"./typography-BReC1Yg6.js";import{E as ue}from"./action-DSYjqVEc.js";import{E as Zt}from"./resource-BEg55So-.js";import{p as er,a as tr,s as rr}from"./playground.dashboard.dynamicPage.edit._id-DRL6QyHV.js";import{e as ke}from"./axios-DLE8MI3N.js";import{g as nr,d as or}from"./get-changed-values-vLde9APN.js";import{s as sr}from"./base-Dsx3AJoS.js";import{u as ar,a as ir,b as Te}from"./components-BZV9jaWy.js";import{u as lr}from"./index-DN0hhrBY.js";import{E as cr}from"./eye-Bg1C4op6.js";import{C as dr}from"./calendar-D-ZzU-i1.js";import{C as ur}from"./check-check-C26Dx8eK.js";import"./label-CIvoefGy.js";import"./i18next-BaiEmIpz.js";import"./chevron-right-I7jGxEVj.js";import"./index-D_Kcollw.js";import"./index-DtQLeWK5.js";import"./index-Bo1Sjtdr.js";import"./index-oFZnn4P-.js";import"./tslib.es6-DDzNqjJ8.js";import"./check-zjuh9tfK.js";import"./index-BoxfTfkS.js";import"./tiny-invariant-CCoILDQG.js";import"./avatar-DqSeWAHy.js";import"./collapsible-B06Kkta5.js";import"./separator-BSppQvb1.js";import"./x-Dffv_lKo.js";import"./capitalize-first-letter-B7Vzw64t.js";import"./roles-DiwHkXNk.js";import"./dynamic-icon-C-duCHAh.js";import"./lightbulb-Cord1U_s.js";import"./base-url-B9uMRsbQ.js";import"./gallery-vertical-end-BQu8b4oU.js";import"./plus-BhW0ZUBR.js";import"./isBrowser-C0tq15AE.js";import"./node-B7-pBh_n.js";import"./search-G3Oj3KZ-.js";import"./circle-plus-B2Q_hRa7.js";import"./pencil-HAuH5_AX.js";import"./index-CzMdUKCZ.js";import"./isEqual-KSD6Iy0l.js";import"./index-BP3s2TFO.js";import"./command-BYE4BpMC.js";import"./copy-check-D8hpOMeD.js";import"./trash-2-DSHqGTsk.js";import"./select-oiTXXINI.js";import"./index-By9-dvAW.js";import"./chevron-down-b85u3rlL.js";import"./field-C2fXiMPB.js";import"./form-CgbINn9k.js";import"./card-B99DATJd.js";import"./form-BJoh7EuQ.js";import"./get-default-title-CrVGbO9H.js";import"./resources-nPXTaVLM.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mr=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],fr=Re("Circle",mr);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pr=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],hr=Re("Link2",pr);var ve="Radio",[xr,Ve]=ye(ve),[br,gr]=xr(ve),Ke=p.forwardRef((t,r)=>{const{__scopeRadio:n,name:o,checked:a=!1,required:i,disabled:l,value:b="on",onCheck:x,form:m,...R}=t,[g,v]=p.useState(null),f=ee(r,D=>v(D)),k=p.useRef(!1),A=g?m||!!g.closest("form"):!0;return e.jsxs(br,{scope:n,checked:a,disabled:l,children:[e.jsx(te.button,{type:"button",role:"radio","aria-checked":a,"data-state":Le(a),"data-disabled":l?"":void 0,disabled:l,value:b,...R,ref:f,onClick:W(t.onClick,D=>{a||x==null||x(),A&&(k.current=D.isPropagationStopped(),k.current||D.stopPropagation())})}),A&&e.jsx(jr,{control:g,bubbles:!k.current,name:o,value:b,checked:a,required:i,disabled:l,form:m,style:{transform:"translateX(-100%)"}})]})});Ke.displayName=ve;var Be="RadioIndicator",Oe=p.forwardRef((t,r)=>{const{__scopeRadio:n,forceMount:o,...a}=t,i=gr(Be,n);return e.jsx(Gt,{present:o||i.checked,children:e.jsx(te.span,{"data-state":Le(i.checked),"data-disabled":i.disabled?"":void 0,...a,ref:r})})});Oe.displayName=Be;var jr=t=>{const{control:r,checked:n,bubbles:o=!0,...a}=t,i=p.useRef(null),l=Ie(n),b=_e(r);return p.useEffect(()=>{const x=i.current,m=window.HTMLInputElement.prototype,g=Object.getOwnPropertyDescriptor(m,"checked").set;if(l!==n&&g){const v=new Event("click",{bubbles:o});g.call(x,n),x.dispatchEvent(v)}},[l,n,o]),e.jsx("input",{type:"radio","aria-hidden":!0,defaultChecked:n,...a,tabIndex:-1,ref:i,style:{...t.style,...b,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function Le(t){return t?"checked":"unchecked"}var yr=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],Ce="RadioGroup",[vr,Vo]=ye(Ce,[Ee,Ve]),Ge=Ee(),qe=Ve(),[Cr,Sr]=vr(Ce),He=p.forwardRef((t,r)=>{const{__scopeRadioGroup:n,name:o,defaultValue:a,value:i,required:l=!1,disabled:b=!1,orientation:x,dir:m,loop:R=!0,onValueChange:g,...v}=t,f=Ge(n),k=Me(m),[A,D]=Pe({prop:i,defaultProp:a,onChange:g});return e.jsx(Cr,{scope:n,name:o,required:l,disabled:b,value:A,onValueChange:D,children:e.jsx(qt,{asChild:!0,...f,orientation:x,dir:k,loop:R,children:e.jsx(te.div,{role:"radiogroup","aria-required":l,"aria-orientation":x,"data-disabled":b?"":void 0,dir:k,...v,ref:r})})})});He.displayName=Ce;var ze="RadioGroupItem",$e=p.forwardRef((t,r)=>{const{__scopeRadioGroup:n,disabled:o,...a}=t,i=Sr(ze,n),l=i.disabled||o,b=Ge(n),x=qe(n),m=p.useRef(null),R=ee(r,m),g=i.value===a.value,v=p.useRef(!1);return p.useEffect(()=>{const f=A=>{yr.includes(A.key)&&(v.current=!0)},k=()=>v.current=!1;return document.addEventListener("keydown",f),document.addEventListener("keyup",k),()=>{document.removeEventListener("keydown",f),document.removeEventListener("keyup",k)}},[]),e.jsx(Ht,{asChild:!0,...b,focusable:!l,active:g,children:e.jsx(Ke,{disabled:l,required:i.required,checked:g,...x,...a,name:i.name,ref:R,onCheck:()=>i.onValueChange(a.value),onKeyDown:W(f=>{f.key==="Enter"&&f.preventDefault()}),onFocus:W(a.onFocus,()=>{var f;v.current&&((f=m.current)==null||f.click())})})})});$e.displayName=ze;var wr="RadioGroupIndicator",Ue=p.forwardRef((t,r)=>{const{__scopeRadioGroup:n,...o}=t,a=qe(n);return e.jsx(Oe,{...a,...o,ref:r})});Ue.displayName=wr;var kr=He,Rr=$e,Dr=Ue;function Nr({className:t,...r}){return e.jsx(kr,{"data-slot":"radio-group",className:ae("grid gap-3",t),...r})}function Ar({className:t,...r}){return e.jsx(Rr,{"data-slot":"radio-group-item",className:ae("border-input text-primary ring-ring/10 dark:ring-ring/20 dark:outline-ring/40 outline-ring/50 aspect-square size-4 shrink-0 rounded-full border shadow-xs transition-[color,box-shadow] focus-visible:ring-4 focus-visible:outline-1 disabled:cursor-not-allowed disabled:opacity-50 aria-invalid:focus-visible:ring-0",t),...r,children:e.jsx(Dr,{"data-slot":"radio-group-indicator",className:"relative flex items-center justify-center",children:e.jsx(fr,{className:"fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2"})})})}var Ye=["PageUp","PageDown"],Je=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],We={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},ie="Slider",[be,Pr,Er]=zt(ie),[Xe,Ko]=ye(ie,[Er]),[Mr,fe]=Xe(ie),Qe=p.forwardRef((t,r)=>{const{name:n,min:o=0,max:a=100,step:i=1,orientation:l="horizontal",disabled:b=!1,minStepsBetweenThumbs:x=0,defaultValue:m=[o],value:R,onValueChange:g=()=>{},onValueCommit:v=()=>{},inverted:f=!1,form:k,...A}=t,D=p.useRef(new Set),E=p.useRef(0),F=l==="horizontal"?_r:Ir,[M=[],Y]=Pe({prop:R,defaultProp:m,onChange:T=>{var U;(U=[...D.current][E.current])==null||U.focus(),g(T)}}),Q=p.useRef(M);function Z(T){const $=Br(M,T);J(T,$)}function re(T){J(T,E.current)}function le(){const T=Q.current[E.current];M[E.current]!==T&&v(M)}function J(T,$,{commit:U}={commit:!1}){const ne=qr(i),h=Hr(Math.round((T-o)/i)*i+o,ne),d=Fe(h,[o,a]);Y((j=[])=>{const s=Vr(j,d,$);if(Gr(s,x*i)){E.current=s.indexOf(d);const c=String(s)!==String(j);return c&&U&&v(s),c?s:j}else return j})}return e.jsx(Mr,{scope:t.__scopeSlider,name:n,disabled:b,min:o,max:a,valueIndexToChangeRef:E,thumbs:D.current,values:M,orientation:l,form:k,children:e.jsx(be.Provider,{scope:t.__scopeSlider,children:e.jsx(be.Slot,{scope:t.__scopeSlider,children:e.jsx(F,{"aria-disabled":b,"data-disabled":b?"":void 0,...A,ref:r,onPointerDown:W(A.onPointerDown,()=>{b||(Q.current=M)}),min:o,max:a,inverted:f,onSlideStart:b?void 0:Z,onSlideMove:b?void 0:re,onSlideEnd:b?void 0:le,onHomeKeyDown:()=>!b&&J(o,0,{commit:!0}),onEndKeyDown:()=>!b&&J(a,M.length-1,{commit:!0}),onStepKeyDown:({event:T,direction:$})=>{if(!b){const h=Ye.includes(T.key)||T.shiftKey&&Je.includes(T.key)?10:1,d=E.current,j=M[d],s=i*h*$;J(j+s,d,{commit:!0})}}})})})})});Qe.displayName=ie;var[Ze,et]=Xe(ie,{startEdge:"left",endEdge:"right",size:"width",direction:1}),_r=p.forwardRef((t,r)=>{const{min:n,max:o,dir:a,inverted:i,onSlideStart:l,onSlideMove:b,onSlideEnd:x,onStepKeyDown:m,...R}=t,[g,v]=p.useState(null),f=ee(r,F=>v(F)),k=p.useRef(void 0),A=Me(a),D=A==="ltr",E=D&&!i||!D&&i;function K(F){const M=k.current||g.getBoundingClientRect(),Y=[0,M.width],Z=Se(Y,E?[n,o]:[o,n]);return k.current=M,Z(F-M.left)}return e.jsx(Ze,{scope:t.__scopeSlider,startEdge:E?"left":"right",endEdge:E?"right":"left",direction:E?1:-1,size:"width",children:e.jsx(tt,{dir:A,"data-orientation":"horizontal",...R,ref:f,style:{...R.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:F=>{const M=K(F.clientX);l==null||l(M)},onSlideMove:F=>{const M=K(F.clientX);b==null||b(M)},onSlideEnd:()=>{k.current=void 0,x==null||x()},onStepKeyDown:F=>{const Y=We[E?"from-left":"from-right"].includes(F.key);m==null||m({event:F,direction:Y?-1:1})}})})}),Ir=p.forwardRef((t,r)=>{const{min:n,max:o,inverted:a,onSlideStart:i,onSlideMove:l,onSlideEnd:b,onStepKeyDown:x,...m}=t,R=p.useRef(null),g=ee(r,R),v=p.useRef(void 0),f=!a;function k(A){const D=v.current||R.current.getBoundingClientRect(),E=[0,D.height],F=Se(E,f?[o,n]:[n,o]);return v.current=D,F(A-D.top)}return e.jsx(Ze,{scope:t.__scopeSlider,startEdge:f?"bottom":"top",endEdge:f?"top":"bottom",size:"height",direction:f?1:-1,children:e.jsx(tt,{"data-orientation":"vertical",...m,ref:g,style:{...m.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:A=>{const D=k(A.clientY);i==null||i(D)},onSlideMove:A=>{const D=k(A.clientY);l==null||l(D)},onSlideEnd:()=>{v.current=void 0,b==null||b()},onStepKeyDown:A=>{const E=We[f?"from-bottom":"from-top"].includes(A.key);x==null||x({event:A,direction:E?-1:1})}})})}),tt=p.forwardRef((t,r)=>{const{__scopeSlider:n,onSlideStart:o,onSlideMove:a,onSlideEnd:i,onHomeKeyDown:l,onEndKeyDown:b,onStepKeyDown:x,...m}=t,R=fe(ie,n);return e.jsx(te.span,{...m,ref:r,onKeyDown:W(t.onKeyDown,g=>{g.key==="Home"?(l(g),g.preventDefault()):g.key==="End"?(b(g),g.preventDefault()):Ye.concat(Je).includes(g.key)&&(x(g),g.preventDefault())}),onPointerDown:W(t.onPointerDown,g=>{const v=g.target;v.setPointerCapture(g.pointerId),g.preventDefault(),R.thumbs.has(v)?v.focus():o(g)}),onPointerMove:W(t.onPointerMove,g=>{g.target.hasPointerCapture(g.pointerId)&&a(g)}),onPointerUp:W(t.onPointerUp,g=>{const v=g.target;v.hasPointerCapture(g.pointerId)&&(v.releasePointerCapture(g.pointerId),i(g))})})}),rt="SliderTrack",nt=p.forwardRef((t,r)=>{const{__scopeSlider:n,...o}=t,a=fe(rt,n);return e.jsx(te.span,{"data-disabled":a.disabled?"":void 0,"data-orientation":a.orientation,...o,ref:r})});nt.displayName=rt;var ge="SliderRange",ot=p.forwardRef((t,r)=>{const{__scopeSlider:n,...o}=t,a=fe(ge,n),i=et(ge,n),l=p.useRef(null),b=ee(r,l),x=a.values.length,m=a.values.map(v=>at(v,a.min,a.max)),R=x>1?Math.min(...m):0,g=100-Math.max(...m);return e.jsx(te.span,{"data-orientation":a.orientation,"data-disabled":a.disabled?"":void 0,...o,ref:b,style:{...t.style,[i.startEdge]:R+"%",[i.endEdge]:g+"%"}})});ot.displayName=ge;var je="SliderThumb",st=p.forwardRef((t,r)=>{const n=Pr(t.__scopeSlider),[o,a]=p.useState(null),i=ee(r,b=>a(b)),l=p.useMemo(()=>o?n().findIndex(b=>b.ref.current===o):-1,[n,o]);return e.jsx(Fr,{...t,ref:i,index:l})}),Fr=p.forwardRef((t,r)=>{const{__scopeSlider:n,index:o,name:a,...i}=t,l=fe(je,n),b=et(je,n),[x,m]=p.useState(null),R=ee(r,K=>m(K)),g=x?l.form||!!x.closest("form"):!0,v=_e(x),f=l.values[o],k=f===void 0?0:at(f,l.min,l.max),A=Kr(o,l.values.length),D=v==null?void 0:v[b.size],E=D?Or(D,k,b.direction):0;return p.useEffect(()=>{if(x)return l.thumbs.add(x),()=>{l.thumbs.delete(x)}},[x,l.thumbs]),e.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[b.startEdge]:`calc(${k}% + ${E}px)`},children:[e.jsx(be.ItemSlot,{scope:t.__scopeSlider,children:e.jsx(te.span,{role:"slider","aria-label":t["aria-label"]||A,"aria-valuemin":l.min,"aria-valuenow":f,"aria-valuemax":l.max,"aria-orientation":l.orientation,"data-orientation":l.orientation,"data-disabled":l.disabled?"":void 0,tabIndex:l.disabled?void 0:0,...i,ref:R,style:f===void 0?{display:"none"}:t.style,onFocus:W(t.onFocus,()=>{l.valueIndexToChangeRef.current=o})})}),g&&e.jsx(Tr,{name:a??(l.name?l.name+(l.values.length>1?"[]":""):void 0),form:l.form,value:f},o)]})});st.displayName=je;var Tr=t=>{const{value:r,...n}=t,o=p.useRef(null),a=Ie(r);return p.useEffect(()=>{const i=o.current,l=window.HTMLInputElement.prototype,x=Object.getOwnPropertyDescriptor(l,"value").set;if(a!==r&&x){const m=new Event("input",{bubbles:!0});x.call(i,r),i.dispatchEvent(m)}},[a,r]),e.jsx("input",{style:{display:"none"},...n,ref:o,defaultValue:r})};function Vr(t=[],r,n){const o=[...t];return o[n]=r,o.sort((a,i)=>a-i)}function at(t,r,n){const i=100/(n-r)*(t-r);return Fe(i,[0,100])}function Kr(t,r){return r>2?`Value ${t+1} of ${r}`:r===2?["Minimum","Maximum"][t]:void 0}function Br(t,r){if(t.length===1)return 0;const n=t.map(a=>Math.abs(a-r)),o=Math.min(...n);return n.indexOf(o)}function Or(t,r,n){const o=t/2,i=Se([0,50],[0,o]);return(o-i(r)*n)*n}function Lr(t){return t.slice(0,-1).map((r,n)=>t[n+1]-r)}function Gr(t,r){if(r>0){const n=Lr(t);return Math.min(...n)>=r}return!0}function Se(t,r){return n=>{if(t[0]===t[1]||r[0]===r[1])return r[0];const o=(r[1]-r[0])/(t[1]-t[0]);return r[0]+o*(n-t[0])}}function qr(t){return(String(t).split(".")[1]||"").length}function Hr(t,r){const n=Math.pow(10,r);return Math.round(t*n)/n}var zr=Qe,$r=nt,Ur=ot,Yr=st;function Jr({className:t,defaultValue:r,value:n,min:o=0,max:a=100,...i}){const l=p.useMemo(()=>Array.isArray(n)?n:Array.isArray(r)?r:[o,a],[n,r,o,a]);return e.jsxs(zr,{"data-slot":"slider",defaultValue:r,value:n,min:o,max:a,className:ae("relative flex w-full touch-none items-center select-none data-[disabled]:opacity-50 data-[orientation=vertical]:h-full data-[orientation=vertical]:min-h-44 data-[orientation=vertical]:w-auto data-[orientation=vertical]:flex-col",t),...i,children:[e.jsx($r,{"data-slot":"slider-track",className:ae("bg-muted relative grow overflow-hidden rounded-full data-[orientation=horizontal]:h-1.5 data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-1.5"),children:e.jsx(Ur,{"data-slot":"slider-range",className:ae("bg-primary absolute data-[orientation=horizontal]:h-full data-[orientation=vertical]:w-full")})}),Array.from({length:l.length},(b,x)=>e.jsx($t,{children:e.jsxs(Ut,{open:!0,children:[e.jsx(Yt,{asChild:!0,children:e.jsx(Yr,{"data-slot":"slider-thumb",className:"border-primary bg-background ring-ring/20 block size-4 shrink-0 rounded-full border shadow-sm transition-[color,box-shadow] hover:ring-4 focus-visible:ring-4 focus-visible:outline-hidden disabled:pointer-events-none disabled:opacity-50"},x)}),e.jsx(Jt,{children:l[x]})]})},x))]})}const it=(t,r)=>{if(t==null)return;const[n,...o]=r;if(!n)return t;const a=typeof t=="object"?t[n]:void 0;return o.length&&a!=null?it(a,o):a},he=(t,r,n)=>{if(!r)return t??n;const o=it(t,r.split("."));return o??n},Bo=({data:t})=>{var r;return[{title:((r=t==null?void 0:t.config)==null?void 0:r.title)||"配置化CRUD页面"}]};function Oo(){const{tableData:t={data:[],total:0},config:r={},resourceTable:n}=ar(),o=ir(),a=Te(),i=ut(),l=mt(),b=lr();p.useEffect(()=>{var y;const{err:s,success:c,type:u}=o||{};if(o){if(!c||s){we.error(`${u} 操作失败`,{description:s||"unknown"});return}we.success(`${u} 操作成功`,{description:"success"}),u==="deleteMany"?(y=k.current)==null||y.resetRowSelection():["create","edit"].includes(u||"")&&j()}},[o]);const{tableRecordLink:x=[],tableSql:m,formField:R=[]}=r||{},{data:g}=ft({resource:n,action:ue.delete}),v=p.useRef(void 0),f=p.useRef(void 0),k=p.useRef(void 0),[A,D]=p.useState(!1),E=s=>{const c=s.getSelectedRowModel().rows;return{className:"text-destructive!",label:`Delete Selected (${c.length}) ${l("Row",c.length>1?"plural":"singular")}`,disabled:!(g!=null&&g.can),onClick:()=>{k.current=s;const y=new FormData,w={type:"deleteMany",resourceTable:n,ids:c.map(C=>C.original.id)};y.append("data",JSON.stringify(w)),a(y,{method:"post"})}}},K=p.useMemo(()=>er(m),[m]),F=Array.isArray(x)?x:[],M=Array.isArray(R)?R:[],Y=()=>{const s=K&&K.length>1;if(!s&&!t.data.length)return[];const u=(s?K.map(P=>({name:P})):Object.keys(t.data[0]).map(P=>({name:P}))).map(({name:P})=>{const X=P.charAt(0).toUpperCase()+P.slice(1);let V="string";const N=he(t.data[0],P);typeof N=="number"?V="number":typeof N=="boolean"?V="boolean":N instanceof Date||typeof N=="string"&&/^\d{4}-\d{2}-\d{2}/.test(N)?V="date":typeof N=="object"&&(V="object");let ce;return V==="date"?ce=de=>e.jsx(z.Filter.DateRangePicker,{...de}):V==="string"&&(ce=de=>e.jsx(z.Filter.Search,{...de})),e.jsx(z.Column,{header:X,accessorKey:P,id:P,meta:V==="string"?{filterOperator:"contains"}:void 0,enableSorting:V!=="object",enableHiding:!0,filter:ce,cell:({row:{original:de}})=>{const oe=he(de,P);return oe==null?e.jsx("span",{className:"text-muted-foreground",children:"-"}):V==="boolean"?oe?"true":"false":V==="date"?se(oe).format("YYYY-MM-DD HH:mm:ss"):V==="object"?e.jsxs(De,{children:[e.jsx(Ne,{className:"text-link cursor-pointer",asChild:!0,children:e.jsx(me,{variant:"ghost",size:"icon",children:e.jsx(cr,{className:"h-4 w-4"})})}),e.jsx(Ae,{className:"w-auto",children:e.jsx("pre",{className:"text-sm",children:JSON.stringify(oe,null,2)})})]}):oe.toLocaleString()}},P)});r.enableDelete&&u.unshift(e.jsx(z.Column,{accessorKey:"id",id:"checkbox",header:({table:P})=>e.jsx(z.CheckAll,{table:P,options:[E(P)]}),cell:({row:P})=>e.jsx(xe,{className:"ml-2",checked:P.getIsSelected(),onCheckedChange:X=>P.toggleSelected(!!X),"aria-label":"Select row"},`checkbox-${P.original.id}`)},"checkbox"));const{enableDelete:y,enableEdit:w,enableClone:C,tableRecordLink:_}=r,S=w||C||y||(_==null?void 0:_.length);return u.push(e.jsx(z.Column,{header:"Actions",accessorKey:"id",id:"actions",cell:({row:{original:P}})=>S?e.jsx(z.Actions,{row:P,resource:n,children:Q(P,F)}):"N/A"},"actions")),u},Q=(s,c)=>{const u=[];return r.enableEdit&&u.push(e.jsx(z.EditAction,{onClick:()=>{v.current=s,f.current=ue.edit,i.show()}},"edit")),r.enableClone&&u.push(e.jsx(z.CloneAction,{onClick:()=>{v.current=s,f.current=ue.clone,i.show()}},"clone")),r.enableDelete&&u.push(e.jsx(z.DeleteAction,{onClick:()=>{v.current=s,D(!0)}},"delete")),c.length>0&&c.forEach(y=>{u.push(e.jsx(z.ShowAction,{title:y.name,icon:e.jsx(hr,{}),onClick:()=>{let w=y.url;const C=w.match(/\{([^}]+)\}/g);C&&C.forEach(_=>{const S=_.substring(1,_.length-1),P=he(s,S);w=w.replace(_,String(P||""))}),b(w)}},y.name))}),u},Z=Y(),re=[e.jsx(vt,{resource:Zt.dynamicPage,recordItemId:r.id,children:"编辑配置"},"edit"),e.jsx(Ct,{resource:n},"export")];r.enableCreate&&re.push(e.jsx(yt,{resource:n,onClick:()=>{v.current=void 0,f.current="create",i.show()}},"create"));const le=p.useMemo(()=>{const s={};return K.filter(c=>c.match(/Id|id$/)).forEach(c=>{s[c]=!1}),s},[K]),J=p.useMemo(()=>{const{orderBy:s}=tr(m),c=K.find(u=>s.includes(u));return c?[{id:c,desc:s.includes("DESC")}]:void 0},[m,K]),T=()=>{var c;const s=new FormData;s.append("data",JSON.stringify({type:"deleteOne",resourceTable:n,id:(c=v.current)==null?void 0:c.id})),a(s,{method:"post"})},[$,U]=p.useState({}),[ne,h]=p.useState(!1);p.useEffect(()=>{var c;if(!i.visible)return;const s={};(c=M==null?void 0:M.filter(u=>rr.includes(u.type)))==null||c.forEach(async u=>{u.optionsStatic&&(s[u.name]=u.optionsStatic),u.optionsType==="database"&&(s[u.name]=await d(u))}),U(s),setTimeout(()=>{h(!0)},100)},[i.visible]);const d=p.useCallback(async s=>{if(!s.optionsSql)return[];const{data:c}=await ke.post("/api/sql",{sql:s.optionsSql,pagination:{mode:"off"}}),u=c.data;return Array.isArray(u)?u:[]},[]),j=()=>{h(!1),i.close()};return r.id?e.jsxs(pt,{fallback:e.jsx(xt,{}),children:[e.jsxs(bt,{children:[e.jsxs(Qt,{children:[e.jsx("span",{children:"配置化CRUD页面 - "}),e.jsx("span",{className:"capitalize",children:n}),e.jsx("p",{className:"text-muted-foreground text-sm font-normal",children:"由配置化CRUD页面生成, 支持配置要展示的数据模型、查询语句、增删改查等交互"})]}),e.jsx(z,{enableSorting:!0,enableFilters:!0,enableHiding:!0,toolbar:re,initialState:{columnVisibility:le,sorting:J},refineCoreProps:{meta:{},resource:n,queryOptions:{initialData:{data:t.data,total:t.total},queryFn:async({queryKey:s=[]})=>{const c=s[3],{filters:u,pagination:y,sorters:w}=c||{},{data:C}=await ke.post("/api/sql",{sql:m,filters:u,pagination:y,sorters:w});return{data:(C==null?void 0:C.data)||[],total:(C==null?void 0:C.total)||0}}}},children:Z})]}),e.jsx(Rt,{open:A,onOpenChange:s=>!s&&D(!1),children:e.jsxs(Dt,{children:[e.jsxs(Nt,{children:[e.jsx(At,{children:"确认删除记录"}),e.jsx(Pt,{children:"确定要删除该记录吗？此操作不可撤销。"})]}),e.jsxs(Et,{children:[e.jsx(Mt,{children:"取消"}),e.jsx(_t,{onClick:T,variant:"destructive",children:"确认删除"})]})]})}),e.jsx(Tt,{open:ne,onOpenChange:j,children:e.jsxs(Vt,{className:"sm:max-w-5xl",children:[e.jsxs(Kt,{className:"border-b pb-4",children:[e.jsx(Bt,{children:f.current===ue.edit?`编辑 ${n}`:`新增 ${n}`}),e.jsx(Ot,{children:"表单由CRUD配置化功能生成"})]}),e.jsx(Qr,{action:f.current,formModalClose:j,initialData:v.current,config:r,allOptionsMap:$,resourceTable:n})]})})]}):e.jsx(gt,{})}function Lo(){return e.jsx(jt,{})}const Wr=(t={},r,n)=>r.reduce((o,a)=>{var x;const{name:i,type:l}=a,b=n[i]||[];return l==="text"||l==="textarea"||l==="file"||l==="code"||l==="date"?o[i]=t[i]||"":l==="number"?o[i]=t[i]||0:l==="slider"?o[i]=t[i]||[1,90]:["select","radio"].includes(l)?o[i]={label:((x=b.find(m=>m.value===t[i]))==null?void 0:x.label)||"",value:t[i]||""}:o[i]=t[i]||void 0,o},{}),Xr=t=>I.object(t.reduce((r,n)=>{const{name:o,type:a,required:i,min:l,max:b,step:x}=n;let m;switch(a){case"text":case"textarea":m=I.string();break;case"code":m=sr;break;case"number":m=I.number(),typeof l=="number"&&(m=m.min(l)),typeof b=="number"&&(m=m.max(b)),typeof x=="number"&&(m=m.step(x));break;case"switch":case"checkbox":m=I.boolean();break;case"select":case"radio":m=I.object({label:I.string(),value:I.string().or(I.number())});break;case"selectMany":case"checkboxMany":m=I.array(I.object({label:I.string(),value:I.string().or(I.number())}));break;case"date":m=I.string();break;case"dateRange":m=I.object({from:I.string(),to:I.string()});break;case"dateMany":m=I.array(I.string());break;case"file":m=I.any();break;case"slider":m=I.array(I.number());break;default:m=I.any()}return i?m=m.refine(R=>R!=null&&R!=="",{message:`${o} 是必填项`}):m=m.optional(),{...r,[o]:m}},{})),Qr=({initialData:t,formModalClose:r,action:n,config:o,allOptionsMap:a={},resourceTable:i})=>{const{formAction:l,id:b=t==null?void 0:t.id}=ht({action:n}),{formField:x}=o||{},m=Array.isArray(x)?x:[],R=Xr(m),g=Te(),v=Wr(t,m,a),f=lt({resolver:ct(R),defaultValues:v,mode:"onChange"}),k="YYYY-MM-DD",A=p.useCallback(h=>{const{name:d,type:j,label:s,description:c,readonly:u,start:y,end:w}=h,C={date:"single",dateMany:"multiple",dateRange:"range"};return e.jsx(L,{control:f.control,name:d,disabled:u,render:({field:_})=>{const{value:S,onChange:P}=_||{};let X,V;return Array.isArray(S)?(X=S.map(N=>new Date(N)),V=S.map(N=>se(N).format(k))):S!=null&&S.from||S!=null&&S.to?(X={from:S.from?new Date(S.from):void 0,to:S.to?new Date(S.to):void 0},V=[S.from,S.to]):S&&(X=new Date(S),V=[S]),e.jsxs(B,{className:"flex flex-col",children:[e.jsxs(O,{children:[s||d,c&&e.jsxs(q,{className:"inline-block",children:[" - ",c]})]}),e.jsxs(De,{children:[e.jsx(Ne,{asChild:!0,children:e.jsx(G,{children:e.jsxs(me,{variant:"outline",className:ae("h-auto w-[500px] gap-1 pl-3 text-left font-normal",!S&&"text-muted-foreground",j==="dateMany"&&"w-full"),children:[S?V==null?void 0:V.map(N=>e.jsx(It,{variant:"secondary",children:N},N)):e.jsx("span",{children:"Pick a date"}),e.jsx(dr,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(Ae,{className:"w-auto p-0",align:"start",children:e.jsx(Ft,{defaultMonth:new Date,mode:C[j]||"default",selected:X,onSelect:N=>{Array.isArray(N)?P(N.map(ce=>se(ce).format(k))):N!=null&&N.from||N!=null&&N.to?P({from:se(N.from).format(k),to:se(N.to).format(k)}):P(se(N).format(k))},disabled:u||(N=>N>new Date(w||"")||N<new Date(y||"")),initialFocus:!0,numberOfMonths:j==="date"?2:3})})]}),e.jsx(H,{})]})}},d)},[f.control]),D=p.useCallback(h=>{const{name:d,label:j,description:s,readonly:c}=h,u=a[d]||[];return e.jsx(L,{control:f.control,name:d,disabled:c,render:({field:y})=>{var w;return e.jsxs(B,{children:[e.jsxs(O,{children:[j||d,s&&e.jsxs(q,{className:"inline-block",children:[" - ",s]})]}),e.jsx(G,{children:e.jsxs(Nr,{disabled:c,defaultValue:(w=y.value)==null?void 0:w.value,onValueChange:C=>{var _;return y.onChange({label:((_=u.find(S=>S.value===C))==null?void 0:_.label)||"unknown",value:C})},className:"flex gap-6 rounded-md border px-3 py-3.5",children:[!u.length&&e.jsx("div",{className:"text-muted-foreground",children:"No options available"}),u.map(C=>e.jsxs(B,{className:"flex items-center space-y-0",children:[e.jsx(G,{children:e.jsx(Ar,{value:C.value})}),e.jsx(O,{className:"font-normal",children:C.label})]},C.value))]})}),e.jsx(H,{})]})}},d)},[f.control,a]),E=p.useCallback(h=>{const{name:d,label:j,description:s,readonly:c}=h;return e.jsx(L,{control:f.control,name:d,disabled:c,render:({field:u})=>e.jsxs(B,{children:[e.jsxs("div",{className:"flex gap-3 rounded-md border p-3",children:[e.jsx(G,{children:e.jsx(xe,{disabled:c,checked:u.value,onCheckedChange:u.onChange,className:"mt-[2px]"})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(O,{children:j||d}),s&&e.jsx(q,{children:s})]})]}),e.jsx(H,{})]})},d)},[f.control]),K=p.useCallback(h=>{const{name:d,label:j,description:s,readonly:c}=h,u=a[d]||[];return e.jsx(L,{disabled:c,control:f.control,name:d,render:()=>e.jsxs(B,{children:[e.jsxs(O,{className:"text-base",children:[j||d,s&&e.jsxs(q,{className:"inline-block",children:[" - ",s]})]}),e.jsxs("div",{className:"flex gap-6 rounded-md border p-3",children:[!u.length&&e.jsx("div",{className:"text-muted-foreground",children:"No options available"}),u.map(y=>e.jsx(L,{control:f.control,name:d,render:({field:w})=>{const C=w.value||[];return e.jsxs(B,{className:"flex flex-row items-center space-y-0",children:[e.jsx(G,{children:e.jsx(xe,{disabled:c,checked:C.find(_=>(_==null?void 0:_.value)===y.value)!==void 0,onCheckedChange:_=>_?w.onChange([...C,{label:y.label,value:y.value}]):w.onChange(C.filter(S=>(S==null?void 0:S.value)!==y.value))})}),e.jsx(O,{className:"text-sm font-normal",children:y.label})]},y.value)}},y.value))]}),e.jsx(H,{})]})},d)},[f.control,a]),F=p.useCallback(h=>{const{name:d,label:j,description:s,readonly:c,min:u,max:y,step:w}=h;return e.jsx(L,{control:f.control,name:d,disabled:c,render:({field:C})=>e.jsxs(B,{children:[e.jsxs(O,{children:[j||d,s&&e.jsxs(q,{className:"inline-block",children:[" - ",s]})]}),e.jsx(G,{className:"mt-12 w-[70%]",children:e.jsx(Jr,{disabled:c,value:C.value,onValueChange:C.onChange,minStepsBetweenThumbs:w,min:u,max:y,step:w})}),e.jsx(H,{})]})},d)},[f.control]),M=p.useCallback(h=>{const{name:d,label:j,description:s,readonly:c}=h;return e.jsx(L,{control:f.control,name:d,disabled:c,render:({field:u})=>e.jsxs(B,{className:"mr-2 inline-block flex-row items-center justify-between gap-3 rounded-lg border px-3 pt-2.5 pb-2",children:[e.jsxs(O,{className:"mb-2 block",children:[j||d,s&&e.jsxs(q,{className:"inline-block",children:[" - ",s]})]}),e.jsx(G,{children:e.jsx(Wt,{disabled:c,checked:u.value,onCheckedChange:u.onChange})}),e.jsx(H,{})]})},d)},[f.control]),Y=p.useCallback(h=>{const{name:d,label:j,description:s,readonly:c}=h,u=a[d]||[];return e.jsx(L,{control:f.control,name:d,disabled:c,render:({field:y})=>{var w;return e.jsxs(B,{children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(O,{children:j||d}),s&&e.jsxs(q,{className:"inline-block",children:[" - ",s]})]}),e.jsx(G,{children:e.jsx(wt,{disabled:c,options:u,popoverProps:{modal:!0},value:(w=y.value)==null?void 0:w.value,onChange:C=>{var _;return y.onChange({label:((_=u.find(S=>S.value===C))==null?void 0:_.label)||"unknown",value:C})}})}),e.jsx(H,{})]})}},d)},[f.control,a]),Q=p.useCallback(h=>{const{name:d,label:j,description:s,readonly:c,min:u,max:y,step:w}=h;return e.jsx(L,{control:f.control,name:d,disabled:c,render:({field:C})=>e.jsxs(B,{children:[e.jsxs(O,{children:[j||d,s&&e.jsxs(q,{className:"inline-block",children:[" - ",s]})]}),e.jsx(G,{children:e.jsx(pe,{disabled:c,type:"number",min:u,max:y,step:w,value:C.value,onChange:_=>C.onChange(Number(_.target.value))})}),e.jsx(H,{})]})},d)},[f.control]),Z=p.useCallback(h=>{const{name:d,label:j,description:s,readonly:c}=h;return e.jsx(L,{control:f.control,name:d,disabled:c,render:({field:u})=>e.jsxs(B,{children:[e.jsxs(O,{children:[j||d,s&&e.jsxs(q,{className:"inline-block",children:[" - ",s]})]}),e.jsx(G,{children:e.jsx(pe,{disabled:c,value:u.value,onChange:y=>u.onChange(y.target.value)})}),e.jsx(H,{})]})},d)},[f.control]),re=p.useCallback(h=>{const{name:d,label:j,description:s,readonly:c}=h;return e.jsx(L,{control:f.control,name:d,disabled:c,render:({field:u})=>e.jsxs(B,{children:[e.jsxs(O,{children:[j||d,s&&e.jsxs(q,{className:"inline-block",children:[" - ",s]})]}),e.jsx(G,{children:e.jsx(pe,{disabled:c,type:"file",value:u.value,onChange:y=>u.onChange(y.target.value)})}),e.jsx(H,{})]})},d)},[f.control]),le=p.useCallback(h=>{const{name:d,label:j,description:s,readonly:c}=h;return e.jsx(L,{control:f.control,name:d,disabled:c,render:({field:u})=>e.jsxs(B,{children:[e.jsxs(O,{children:[j||d,s&&e.jsxs(q,{className:"inline-block",children:[" - ",s]})]}),e.jsx(G,{children:e.jsx(Xt,{disabled:c,className:"min-h-20",value:u.value,onChange:y=>u.onChange(y.target.value)})}),e.jsx(H,{})]})},d)},[f.control]),J=p.useCallback(h=>{const{name:d,label:j,description:s,readonly:c}=h,u=a[d];return e.jsx(L,{control:f.control,name:d,disabled:c,render:({field:y})=>e.jsxs(B,{children:[e.jsxs(O,{children:[j||d,s&&e.jsxs(q,{className:"inline-block",children:[" - ",s]})]}),e.jsx(G,{children:e.jsx(kt,{disabled:c,options:u,popoverProps:{modal:!0},value:y.value,onChange:w=>y.onChange(w)})}),e.jsx(H,{})]})},d)},[f.control,a]),T=p.useCallback(h=>{const{name:d,label:j,description:s,readonly:c,language:u="json"}=h;return e.jsx(L,{control:f.control,name:d,disabled:c,render:({field:y})=>e.jsxs(B,{children:[e.jsxs(O,{children:[j||d,s&&e.jsxs(q,{className:"inline-block",children:[" - ",s]})]}),e.jsx(G,{children:e.jsx(St,{options:{readOnly:c},language:u,height:"20vh",value:y.value,onChange:w=>y.onChange(w)})}),e.jsx(H,{})]})},d)},[f.control]),$=h=>{switch(h.type){case"text":return Z(h);case"textarea":return le(h);case"file":return re(h);case"selectMany":return J(h);case"code":return T(h);case"number":return Q(h);case"select":return Y(h);case"radio":return D(h);case"switch":return M(h);case"slider":return F(h);case"date":case"dateRange":case"dateMany":return A(h);case"checkbox":return E(h);case"checkboxMany":return K(h);default:return null}},U=p.useCallback(h=>{const d=nr(h,v);return Object.keys(h).forEach(j=>{var c;const s=((c=m.find(u=>u.name===j))==null?void 0:c.type)||"";["select","radio"].includes(s)&&(d[j]=h[j].value)}),or(d)},[v]),ne=h=>{const d=U(h),j=new FormData;j.append("data",JSON.stringify({...d,type:l,id:b,resourceTable:i})),g(j,{method:"post"})};return e.jsx(dt,{...f,children:e.jsxs("form",{onSubmit:f.handleSubmit(ne),className:"space-y-4 py-2",children:[m.map(h=>$(h)),e.jsxs(Lt,{children:[e.jsx(me,{variant:"outline",type:"button",onClick:r,children:"取消"}),e.jsx(me,{type:"submit",icon:e.jsx(ur,{}),children:"保存"})]})]})})};export{Lo as ErrorBoundary,Oo as default,Bo as meta};
