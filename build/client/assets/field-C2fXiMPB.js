import{a as le,c as te}from"./button-BExhSn8V.js";import{r as W,R as q}from"./index-aGVi9Z7h.js";import{j as re,l as se,n as ie,p as ue,r as oe,u as de,v as fe,z as G,w as X,R as ce,C as K,x as Y,A as me,B as he,c as ye,D as ve,h as be,T as pe}from"./index-Cr0IeYe7.js";import{u as ge,b as xe,c as Se,d as z,F as Fe,g as Ce,e as ke}from"./form-CvgtEUdj.js";import{j}from"./jsx-runtime-C-_spy54.js";function Pe(e,n,d){n=re(n,e);for(var x=-1,t=n.length,v=!1;++x<t;){var b=se(n[x]);if(!(v=e!=null&&d(e,b)))break;e=e[b]}return v||++x!=t?v:(t=e==null?0:e.length,!!t&&ie(t)&&ue(b,t)&&(oe(e)||de(e)))}/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]],Be=le("Undo2",we);var Ee=Object.prototype,Ve=Ee.hasOwnProperty;function je(e,n){return e!=null&&Ve.call(e,n)}function We(e,n){return e!=null&&Pe(e,n,je)}var Oe=Object.defineProperty,k=(e,n)=>Oe(e,"name",{value:n,configurable:!0}),Z=k(({refineCoreProps:e,warnWhenUnsavedChanges:n,disableServerSideValidation:d=!1,...x}={})=>{let{options:t}=fe(),v=(t==null?void 0:t.disableServerSideValidation)||d,b=G(),{warnWhenUnsavedChanges:O,setWarnWhen:S}=X(),P=n??O,w=ge({...x}),{watch:y,setValue:f,getValues:s,handleSubmit:c,setError:m}=w,E=ce({...e,onMutationError:(l,a,i)=>{var C,u;if(v){(C=e==null?void 0:e.onMutationError)==null||C.call(e,l,a,i);return}let g=l==null?void 0:l.errors;for(let A in g){if(!Object.keys(K(a)).includes(A))continue;let h=g[A],V="";Array.isArray(h)&&(V=h.join(" ")),typeof h=="string"&&(V=h),typeof h=="boolean"&&h&&(V="Field is not valid."),typeof h=="object"&&"key"in h&&(V=b(h.key,h.message)),m(A,{message:V})}(u=e==null?void 0:e.onMutationError)==null||u.call(e,l,a,i)}}),{query:F,onFinish:p,formLoading:R,onFinishAutoSave:o}=E;W.useEffect(()=>{var l;let a=(l=F==null?void 0:F.data)==null?void 0:l.data;a&&Object.keys(K(s())).forEach(i=>{let C=We(a,i),u=Y(a,i);C&&f(i,u)})},[F==null?void 0:F.data,f,s]),W.useEffect(()=>{let l=y((a,{type:i})=>{i==="change"&&N(a)});return()=>l.unsubscribe()},[y]);let N=k(l=>{var a,i;if(P&&S(!0),(a=e==null?void 0:e.autoSave)!=null&&a.enabled){S(!1);let C=((i=e.autoSave)==null?void 0:i.onFinish)??(u=>u);return o(C(l)).catch(u=>u)}return l},"onValuesChange"),M=k((l,a)=>async i=>(S(!1),c(l,a)(i)),"handleSubmit");return{...w,handleSubmit:M,refineCore:E,saveButtonProps:{disabled:R,onClick:l=>{M(a=>p(a).catch(()=>{}),()=>!1)(l)}}}},"useForm"),Ne=k(({stepsProps:e,...n}={})=>{let{defaultStep:d=0,isBackValidate:x=!1}=e??{},[t,v]=W.useState(d),b=Z({...n}),{trigger:O,getValues:S,setValue:P,formState:{dirtyFields:w},refineCore:{query:y}}=b;W.useEffect(()=>{var s;let c=(s=y==null?void 0:y.data)==null?void 0:s.data;if(!c)return;let m=Object.keys(S());console.log({dirtyFields:w,registeredFields:m,data:c}),Object.entries(c).forEach(([E,F])=>{let p=E;m.includes(p)&&(Y(w,p)||P(p,F))})},[y==null?void 0:y.data,t,P,S]);let f=k(s=>{let c=s;s<0&&(c=0),v(c)},"go");return{...b,steps:{currentStep:t,gotoStep:k(async s=>{if(s!==t){if(s<t&&!x){f(s);return}await O()&&f(s)}},"gotoStep")}}},"useStepsForm"),qe=k(({modalProps:e,refineCoreProps:n,syncWithLocation:d,...x}={})=>{var t,v;let b=me(),[O,S]=q.useState(!1),P=G(),{resource:w,action:y}=n??{},{resource:f,action:s,identifier:c}=he(w),m=ye(),E=ve(),F=be(),p=y??s??"",R=!(typeof d=="object"&&(d==null?void 0:d.syncId)===!1),o=typeof d=="object"&&"key"in d?d.key:f&&p&&d?`modal-${c}-${p}`:void 0,{defaultVisible:N=!1,autoSubmitClose:M=!0,autoResetForm:l=!0}=e??{},a=Z({refineCoreProps:{...n,meta:{...o?{[o]:void 0}:{},...n==null?void 0:n.meta}},...x}),{reset:i,refineCore:{onFinish:C,id:u,setId:g,autoSaveProps:A},saveButtonProps:h,handleSubmit:V}=a,{visible:U,show:$,close:I}=pe({defaultVisible:N});q.useEffect(()=>{var r,D,Q,T;if(O===!1&&o){let B=(D=(r=m==null?void 0:m.params)==null?void 0:r[o])==null?void 0:D.open;if(typeof B=="boolean"?B&&$():typeof B=="string"&&B==="true"&&$(),R){let _=(T=(Q=m==null?void 0:m.params)==null?void 0:Q[o])==null?void 0:T.id;_&&(g==null||g(_))}S(!0)}},[o,m,R,g]),q.useEffect(()=>{var r;O===!0&&(U&&o?E({query:{[o]:{...(r=m==null?void 0:m.params)==null?void 0:r[o],open:!0,...R&&u&&{id:u}}},options:{keepQuery:!0},type:"replace"}):o&&!U&&E({query:{[o]:void 0},options:{keepQuery:!0},type:"replace"}))},[u,U,$,o,R]);let L=k(async r=>{await C(r),M&&I(),l&&i()},"submit"),{warnWhen:H,setWarnWhen:J}=X(),ee=W.useCallback(()=>{var r;if(A.status==="success"&&(r=n==null?void 0:n.autoSave)!=null&&r.invalidateOnClose&&b({id:u,invalidates:n.invalidates||["list","many","detail"],dataProviderName:n.dataProviderName,resource:c}),H)if(window.confirm(P("warnWhenUnsavedChanges","Are you sure you want to leave? You have unsaved changes.")))J(!1);else return;g==null||g(void 0),I()},[H,A.status]),ne=W.useCallback(r=>{typeof r<"u"&&(g==null||g(r)),(!(p==="edit"||p==="clone")||typeof r<"u"||typeof u<"u")&&$()},[u]),ae=P(`${c}.titles.${y}`,void 0,`${F(`${y} ${((t=f==null?void 0:f.meta)==null?void 0:t.label)??((v=f==null?void 0:f.options)==null?void 0:v.label)??(f==null?void 0:f.label)??c}`,"singular")}`);return{modal:{submit:L,close:ee,show:ne,visible:U,title:ae},...a,saveButtonProps:{...h,onClick:r=>V(L)(r)}}},"useModalForm");const Ie=e=>j.jsx(xe,{control:e.control,name:e.name,render:({field:n})=>j.jsxs(Se,{className:te(e.className,e.isCheckbox?"flex flex-row items-center space-y-0 space-x-3":""),children:[!e.isCheckbox&&j.jsx(z,{children:e.label}),j.jsx(Fe,{children:W.cloneElement(e.children,{...n,...e.children.props})}),e.isCheckbox&&j.jsx(z,{className:"text-sm font-normal",children:e.label}),e.description&&j.jsx(Ce,{children:e.description}),j.jsx(ke,{})]})});export{Z as C,Ie as F,Be as U,Ne as l,qe as x};
