import{j as t}from"./jsx-runtime-C-_spy54.js";import{t as R}from"./form-EOytp2cR.js";import{C as L,F as P}from"./field-RlHc_fdj.js";import{t as k}from"./i18next-BaiEmIpz.js";import{r as h}from"./index-aGVi9Z7h.js";import{z as p}from"./index-Cb7h-Ku-.js";import{P as w}from"./500-CvlJQvp0.js";import{F}from"./form-BJRS087V.js";import{S as I}from"./select-multi-B-0pe142.js";import{B as x}from"./badge-DliJJe0J.js";import{C as T,a as B}from"./card-BavCCNFE.js";import{C as D}from"./checkbox-Ns6fPQCo.js";import{L as M}from"./label-CGr_cgmC.js";import{a as O}from"./typography-BLrnCGnf.js";import{E,A as U,a as b}from"./action-DSYjqVEc.js";import{E as _,a as z}from"./audit-channel-7xUlZfi7.js";import{E as $}from"./log-Dv4uGBGl.js";import{R as G,E as A}from"./resource-BEg55So-.js";import{g as H}from"./get-default-title-CrVGbO9H.js";import{u as V}from"./components-CzmxjdGq.js";import"./button-8zOaFnqZ.js";import"./lucide-icons-Cs_6wGxK.js";import"./index-hdkCHUwo.js";import"./tslib.es6-DDzNqjJ8.js";import"./index-DN0hhrBY.js";import"./dayjs.min-CHrC0Ux9.js";import"./create-BR9gIq3J.js";import"./command-DoxM3uwe.js";import"./index-BEBrh2Va.js";import"./index-BU-I6paI.js";import"./index-BJ0lhZ-K.js";import"./index-BTG9THwZ.js";import"./index-oFZnn4P-.js";import"./index-CmlQ-bcy.js";import"./popover-Cif6mCbD.js";import"./index-bUQLM8l5.js";import"./index-k7qIncBC.js";import"./resources-nPXTaVLM.js";import"./capitalize-first-letter-B7Vzw64t.js";const u=G.filter(n=>n!==A.userRole).sort(),W="role:apply",Bs=({matches:n})=>[{title:H(n)}];function Ds(){const{roleList:n,casbinRuleList:a,currentRoles:s,auditRecord:m}=V();return t.jsx(K,{roleList:n,casbinRuleList:a,currentRoles:s,auditRecord:m})}function Ms(){return t.jsx(w,{})}const q=p.object({roles:p.array(p.object({label:p.string(),value:p.string()}))});function J(n,a){const s={};if(u.forEach(e=>{s[e]={resource:e,actions:[],hasAllActions:!1,hasSomeActions:!1}}),!a||a.length===0)return s;const m=a.map(e=>e.label);return n.forEach(e=>{if(m.includes(e.v0))if(e.v1==="*"){const o=e.v2.split("|");u.forEach(r=>{const i=new Set([...s[r].actions,...o]);s[r].actions=Array.from(i),s[r].hasSomeActions=s[r].actions.length>0,s[r].hasAllActions=s[r].actions.length===b.length})}else{const[o]=e.v1.split("/");if(u.includes(o)){if(e.v3==="deny")return;const r=e.v2.split("|"),i=new Set([...s[o].actions,...r]);s[o].actions=Array.from(i),s[o].hasSomeActions=s[o].actions.length>0,s[o].hasAllActions=s[o].actions.length===b.length}}}),s}const K=({roleList:n,casbinRuleList:a,auditRecord:s,currentRoles:m})=>{const{id:e}=s||{},[o,r]=h.useState(m),i=L({resolver:R(q),defaultValues:{roles:m},warnWhenUnsavedChanges:!0,mode:"onChange",refineCoreProps:{id:e,resource:A.auditRecord,action:e?E.edit:E.create}});h.useEffect(()=>{const c=i.watch(l=>{l.roles&&r(l.roles)});return()=>c.unsubscribe()},[i]);const N=h.useMemo(()=>J(a,o),[a,o]),S=async c=>{const{roles:l}=c;return{meta:{parent:"account"},title:W,dataPrevious:m,resource:A.role,data:l,status:_.PENDING,action:$.update,channel:z.SELF,error:null}};return t.jsxs(F,{...i,beforeSubmit:S,className:"space-y-4",children:[t.jsxs(O,{className:"mb-8",children:[t.jsx("span",{children:"权限变更申请"}),t.jsx("p",{className:"text-muted-foreground text-sm font-normal",children:"选择角色，分配资源与相关操作的权限"})]}),t.jsx(P,{...i,name:"roles",label:"Roles",children:t.jsx(I,{options:n})}),t.jsx(M,{children:"当前所选角色拥有的资源、操作权限"}),t.jsx("div",{className:"mt-2 space-y-4 space-x-4",children:u.map(c=>{const l=N[c],{hasAllActions:d,hasSomeActions:f,actions:v}=l,y=v.sort().reverse(),g=d||f,C=f&&!d;return t.jsx(T,{className:"inline-block min-w-[300px]",children:t.jsxs(B,{className:"space-y-2 divide-y divide-dashed pb-3",children:[t.jsxs("div",{className:"flex items-center gap-2 pt-3 pb-2",children:[t.jsx(D,{"data-state":C?"indeterminate":g?"checked":"unchecked",className:"pointer-events-none",checked:g}),t.jsxs("span",{className:"capitalize",children:[c," - ",k(`menus.${c}`)]})]}),d&&t.jsx(x,{className:"bg-green-500",children:"All"}),!f&&t.jsx(x,{className:"bg-destructive",children:"Null"}),!d&&f&&t.jsx("div",{className:"mt-3 flex items-center gap-2",children:y.map(j=>t.jsx(x,{variant:"secondary",className:"border-green-500",children:U[j].name},j))})]})},c)})})]})};export{Ms as ErrorBoundary,Ds as default,Bs as meta};
