import{j as e}from"./jsx-runtime-C-_spy54.js";import{z as w,t as k,k as N,c as B,M as E}from"./index-Cr0IeYe7.js";import{t as p}from"./i18next-BaiEmIpz.js";import{r as D}from"./index-aGVi9Z7h.js";import{d as L}from"./dayjs.min-CHrC0Ux9.js";import{c as j,B as b}from"./button-BExhSn8V.js";import{C as A}from"./create-CmiFHpun.js";import{C as H}from"./check-check-C26Dx8eK.js";import{C as M,a as R,e as U}from"./card-B99DATJd.js";import{a as _}from"./form-CvgtEUdj.js";import{E as v}from"./action-DSYjqVEc.js";import{U as z}from"./field-C2fXiMPB.js";const I=({status:t,elements:{success:s=e.jsx(l,{translationKey:"autoSave.success",defaultMessage:"saved"}),error:r=e.jsx(l,{translationKey:"autoSave.error",defaultMessage:"auto save failed"}),loading:o=e.jsx(l,{translationKey:"autoSave.loading",defaultMessage:"saving ..."}),idle:i=e.jsx(l,{translationKey:"autoSave.idle",defaultMessage:"waiting for changes ..."})}={}})=>{switch(t){case"success":return e.jsx(e.Fragment,{children:s});case"error":return e.jsx(e.Fragment,{children:r});case"loading":return e.jsx(e.Fragment,{children:o});default:return e.jsx(e.Fragment,{children:i})}},l=({translationKey:t,defaultMessage:s})=>{const r=w();return e.jsxs("span",{className:j("text-muted-foreground text-sm",{"text-destructive":t==="autoSave.error","text-green-500":t==="autoSave.success"}),children:[r(t,s),t==="autoSave.success"&&` - ${L().format("HH:mm:ss")}`]})},y=({hideText:t=!1,children:s,accessControl:r,access:o,resource:i,recordItemId:n,disabled:m,...f})=>{const{label:x}=k(),{data:a}=N({resource:i,action:"edit",params:{id:n}}),c=!(a!=null&&a.can)||m;return e.jsx(b,{icon:e.jsx(H,{}),disabled:c,...f,children:!t&&(s??x)})};y.displayName="SaveButton";const ae=({autoSave:t,beforeSubmit:s,formProps:r,isWatchable:o,saveButtonProps:i,formModalClose:n,recordItemId:m,className:f,classNameCardContent:x,...a})=>{const c=D.useRef(!1),{resource:K,action:h}=B(),C=E(),S=h!==v.list||typeof h<"u"?C:void 0;o&&!c.current&&(c.current=!0,a.watch());const F=a.handleSubmit(async P=>{var u;let d=a.getValues();if(s)try{d=await s(d)}catch{return}d!==null?await a.refineCore.onFinish(d):((u=a.refineCore)==null?void 0:u.redirect).call(u),n==null||n()}),{disabled:g}=i||{};return e.jsx(_,{...a,children:e.jsx("form",{...r,onSubmit:F,children:e.jsxs(M,{className:j("space-y-8 border-none p-8 shadow-none",f),children:[e.jsx(R,{className:j("space-y-4 p-0",x),children:a.children}),e.jsxs(U,{className:"flex gap-x-2 p-0",children:[h===v.edit?e.jsx(y,{type:"submit",recordItemId:m,loading:a.refineCore.formLoading,disabled:g||!a.formState.isDirty}):e.jsx(A,{type:"submit",loading:a.refineCore.formLoading,disabled:g||!a.formState.isDirty}),!a.hideCancel&&e.jsx(b,{icon:e.jsx(z,{}),type:"button",onClick:n||S,disabled:a.refineCore.formLoading,variant:"outline",children:p("buttons.cancel")}),t&&e.jsx("div",{className:"ml-auto",children:e.jsx(I,{...a.refineCore.autoSaveProps})})]})]})})})};export{ae as F};
